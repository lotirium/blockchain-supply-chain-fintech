{
  "version": 3,
  "sources": ["../../timestamp-nano/dist/timestamp.min.js", "../../is-electron/index.js", "../../truncate-utf8-bytes/lib/truncate.js", "../../utf8-byte-length/browser.js", "../../truncate-utf8-bytes/browser.js", "../../sanitize-filename/index.js", "../../@helia/bitswap/src/constants.ts", "../../@helia/bitswap/src/pb/message.ts", "../../@helia/bitswap/src/utils/merge-messages.ts", "../../@helia/bitswap/src/errors.ts", "../../@helia/bitswap/src/utils/split-message.ts", "../../@helia/bitswap/src/network.ts", "../../@helia/bitswap/src/utils/bitswap-message.ts", "../../@helia/bitswap/src/utils/varint-encoder.ts", "../../@helia/bitswap/src/utils/cid-prefix.ts", "../../@helia/bitswap/src/peer-want-lists/ledger.ts", "../../@helia/bitswap/src/peer-want-lists/index.ts", "../../multiformats/src/block.ts", "../../@helia/utils/src/pins.ts", "../../@helia/interface/src/blocks.ts", "../../@helia/interface/src/errors.ts", "../../@helia/utils/src/routing.ts", "../../@helia/utils/src/storage.ts", "../../@helia/utils/src/utils/datastore-version.ts", "../../@helia/utils/src/utils/is-promise.ts", "../../@helia/utils/src/utils/get-codec.ts", "../../@helia/utils/src/utils/get-hasher.ts", "../../blockstore-core/src/base.ts", "../../blockstore-core/src/identity.ts", "../../@helia/utils/src/utils/networked-storage.ts", "../../@helia/utils/src/abstract-session.ts", "../../@helia/utils/src/index.ts", "../../@helia/bitswap/src/session.ts", "../../@helia/bitswap/src/stats.ts", "../../@helia/bitswap/src/utils/varint-decoder.ts", "../../@helia/bitswap/src/want-list.ts", "../../@helia/bitswap/src/bitswap.ts", "../../@helia/bitswap/src/index.ts", "../../@helia/block-brokers/src/bitswap.ts", "../../@helia/block-brokers/src/trustless-gateway/trustless-gateway.ts", "../../@helia/block-brokers/src/trustless-gateway/utils.ts", "../../@helia/block-brokers/src/trustless-gateway/session.ts", "../../@helia/block-brokers/src/trustless-gateway/broker.ts", "../../@helia/block-brokers/src/trustless-gateway/index.ts", "../../browser-readablestream-to-it/src/index.ts", "../../ipns/src/index.ts", "../../ipns/src/errors.ts", "../../ipns/src/pb/ipns.ts", "../../ipns/src/utils.ts", "../../ipns/src/validator.ts", "../../it-ndjson/src/errors.ts", "../../it-ndjson/src/parse.ts", "../../@helia/delegated-routing-v1-http-api-client/src/errors.ts", "../../@helia/delegated-routing-v1-http-api-client/src/routings.ts", "../../@helia/delegated-routing-v1-http-api-client/src/client.ts", "../../@helia/delegated-routing-v1-http-api-client/src/index.ts", "../../@helia/routers/src/utils/delegated-http-routing-defaults.browser.ts", "../../@helia/routers/src/delegated-http-routing.ts", "../../ip-regex/index.js", "../../function-timeout/browser.js", "../../is-regexp/index.js", "../../clone-regexp/index.js", "../../super-regex/index.js", "../../is-ip/index.js", "../../@multiformats/uri-to-multiaddr/src/index.ts", "../../@helia/routers/src/http-gateway-routing.ts", "../../@helia/routers/src/libp2p-routing.ts", "../../blockstore-core/src/memory.ts", "../../blockstore-core/src/tiered.ts", "../../datastore-core/src/shard.ts", "../../datastore-core/src/sharding.ts", "../../datastore-core/src/tiered.ts", "../../helia/src/helia-p2p.ts", "../../@libp2p/utils/src/multiaddr/is-global-unicast.ts", "../../@libp2p/utils/src/repeating-task.ts", "../../it-protobuf-stream/src/index.ts", "../../@libp2p/autonat/src/constants.ts", "../../@libp2p/autonat/src/pb/index.ts", "../../@libp2p/autonat/src/autonat.ts", "../../@libp2p/autonat/src/index.ts", "../../@libp2p/circuit-relay-v2/src/constants.ts", "../../@libp2p/circuit-relay-v2/src/pb/index.ts", "../../@libp2p/circuit-relay-v2/src/errors.ts", "../../@libp2p/circuit-relay-v2/src/utils.ts", "../../retimeable-signal/src/index.ts", "../../@libp2p/circuit-relay-v2/src/server/reservation-store.ts", "../../@libp2p/circuit-relay-v2/src/server/reservation-voucher.ts", "../../@libp2p/circuit-relay-v2/src/server/index.ts", "../../@libp2p/utils/src/stream-to-ma-conn.ts", "../../@libp2p/circuit-relay-v2/src/transport/discovery.ts", "../../@libp2p/circuit-relay-v2/src/transport/listener.ts", "../../nanoid/url-alphabet/index.js", "../../nanoid/index.browser.js", "../../@libp2p/circuit-relay-v2/src/transport/reservation-store.ts", "../../@libp2p/circuit-relay-v2/src/transport/transport.ts", "../../@libp2p/circuit-relay-v2/src/transport/index.ts", "../../@libp2p/dcutr/src/pb/message.ts", "../../@libp2p/dcutr/src/utils.ts", "../../@libp2p/dcutr/src/dcutr.ts", "../../@libp2p/dcutr/src/index.ts", "../../@libp2p/identify/src/consts.ts", "../../@libp2p/identify/src/pb/message.ts", "../../wherearewe/src/index.js", "../../@libp2p/identify/src/utils.ts", "../../@libp2p/identify/src/identify-push.ts", "../../@libp2p/identify/src/identify.ts", "../../@libp2p/identify/src/index.ts", "../../@libp2p/kad-dht/src/constants.ts", "../../@libp2p/record/src/record.ts", "../../@libp2p/record/src/utils.ts", "../../@libp2p/record/src/index.ts", "../../@libp2p/kad-dht/src/errors.ts", "../../@libp2p/kad-dht/src/message/dht.ts", "../../@libp2p/kad-dht/src/query/events.ts", "../../@libp2p/kad-dht/src/record/selectors.ts", "../../@libp2p/kad-dht/src/record/validators.ts", "../../@libp2p/kad-dht/src/utils.ts", "../../@libp2p/kad-dht/src/content-fetching/index.ts", "../../@libp2p/kad-dht/src/message/utils.ts", "../../@libp2p/kad-dht/src/content-routing/index.ts", "../../@libp2p/kad-dht/src/network.ts", "../../uint8arrays/src/xor-compare.ts", "../../@libp2p/kad-dht/src/peer-distance-list.ts", "../../@libp2p/kad-dht/src/peer-routing/index.ts", "../../@libp2p/kad-dht/src/providers.ts", "../../@libp2p/kad-dht/src/query/query-path.ts", "../../@libp2p/kad-dht/src/query/manager.ts", "../../it-length/src/index.ts", "../../p-event/index.js", "../../@libp2p/kad-dht/src/query-self.ts", "../../@libp2p/kad-dht/src/reprovider.ts", "../../@libp2p/kad-dht/src/routing-table/closest-peers.ts", "../../@libp2p/kad-dht/src/routing-table/k-bucket.ts", "../../@libp2p/kad-dht/src/routing-table/index.ts", "../../@libp2p/kad-dht/src/routing-table/generated-prefix-list-browser.ts", "../../@libp2p/kad-dht/src/routing-table/refresh.ts", "../../@libp2p/kad-dht/src/rpc/handlers/add-provider.ts", "../../@libp2p/kad-dht/src/rpc/handlers/find-node.ts", "../../@libp2p/kad-dht/src/rpc/handlers/get-providers.ts", "../../@libp2p/kad-dht/src/rpc/handlers/get-value.ts", "../../@libp2p/kad-dht/src/rpc/handlers/ping.ts", "../../@libp2p/kad-dht/src/rpc/handlers/put-value.ts", "../../@libp2p/kad-dht/src/rpc/index.ts", "../../@libp2p/kad-dht/src/topology-listener.ts", "../../@libp2p/kad-dht/src/kad-dht.ts", "../../@libp2p/kad-dht/src/index.ts", "../../@libp2p/keychain/src/keychain.ts", "../../@libp2p/crypto/src/ciphers/aes-gcm.browser.ts", "../../@libp2p/keychain/src/utils/constants.ts", "../../@libp2p/keychain/src/utils/export.ts", "../../@libp2p/keychain/src/utils/import.ts", "../../@libp2p/keychain/src/index.ts", "../../@libp2p/mplex/src/message-types.ts", "../../@libp2p/mplex/src/decode.ts", "../../@libp2p/mplex/src/encode.ts", "../../@libp2p/mplex/src/errors.ts", "../../@libp2p/mplex/src/stream.ts", "../../@libp2p/mplex/src/mplex.ts", "../../@libp2p/mplex/src/index.ts", "../../@libp2p/ping/src/constants.ts", "../../@libp2p/ping/src/ping.ts", "../../@libp2p/ping/src/index.ts", "../../detect-browser/es/index.js", "../../@libp2p/webrtc/src/constants.ts", "../../@libp2p/webrtc/src/util.ts", "../../@libp2p/webrtc/src/maconn.ts", "../../@libp2p/webrtc/src/pb/message.ts", "../../@libp2p/webrtc/src/stream.ts", "../../@libp2p/webrtc/src/muxer.ts", "../../@libp2p/webrtc/src/webrtc/index.browser.ts", "../../@libp2p/webrtc/src/error.ts", "../../@libp2p/webrtc/src/private-to-private/pb/message.ts", "../../@libp2p/webrtc/src/private-to-private/util.ts", "../../@libp2p/webrtc/src/private-to-private/initiate-connection.ts", "../../@libp2p/webrtc/src/private-to-private/listener.ts", "../../@libp2p/webrtc/src/private-to-private/signaling-stream-handler.ts", "../../@libp2p/webrtc/src/private-to-private/transport.ts", "../../@libp2p/webrtc/src/private-to-public/sdp.ts", "../../@libp2p/webrtc/src/private-to-public/util.ts", "../../@libp2p/webrtc/src/private-to-public/transport.ts", "../../@libp2p/webrtc/src/index.ts", "../../ipns/src/selector.ts", "../../helia/src/version.ts", "../../helia/src/utils/bootstrappers.ts", "../../helia/src/utils/libp2p-defaults.browser.ts", "../../@libp2p/config/src/load-private-key.ts", "../../helia/src/utils/libp2p.ts", "../../helia/src/index.ts"],
  "sourcesContent": ["var Timestamp=function(){\"undefined\"!=typeof module&&(module.exports=d);var l=86400,s=3200,T=146097*s/400,e=l*T,f=1e3*e,c=864e13,g=4294967296,h=1e6,u=\"000000000\",m=Math.trunc||function(n){var t=n-n%1;return 0==t&&(n<0||0===n&&1/n!=1/0)?-0:t},n=d.prototype,o=(d.fromDate=function(n){return new d(+n)},d.fromInt64BE=r(0,1,2,3,0,4),d.fromInt64LE=r(3,2,1,0,4,0),d.fromString=function(n){var e,r=new d,n=(n+=\"\").replace(/^\\s*[+\\-]?\\d+/,function(n){var n=+n,t=1970+(n-1970)%400;return r.year=n-t,t}).replace(/(?:Z|([+\\-]\\d{2}):?(\\d{2}))$/,function(n,t,r){return t<0&&(r*=-1),e=6e4*(60*+t+ +r),\"\"}).replace(/\\.\\d+$/,function(n){return r.nano=+(n+u).substr(1,9),\"\"}).split(/\\D+/);1<n.length?n[1]--:n[1]=0;if(r.time=e=Date.UTC.apply(Date,n)-(e||0),isNaN(e))throw new TypeError(\"Invalid Date\");return p(r)},d.fromTimeT=function(n){return y(n,0)},n.year=0,n.time=0,n.nano=0,n.addNano=function(n){return this.nano+=+n||0,this},n.getNano=function(){var n=p(this);return(n.time%1e3*h+ +n.nano+1e9)%1e9},n.getTimeT=function(){var n=p(this),t=Math.floor(n.time/1e3),n=n.year;n&&(t+=n*T*l/s);return t},n.getYear=function(){return this.toDate().getUTCFullYear()+this.year},n.toDate=function(){return M(p(this).time)},n.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,\"Z\")},n.toString=function(n){var t=this,r=t.toDate(),u={H:function(){return C(r.getUTCHours())},L:function(){return D(r.getUTCMilliseconds(),3)},M:function(){return C(r.getUTCMinutes())},N:function(){return D(t.getNano(),9)},S:function(){return C(r.getUTCSeconds())},Y:function(){var n=t.getYear();return 999999<n?\"+\"+n:9999<n?\"+\"+D(n,6):0<=n?D(n,4):-999999<=n?\"-\"+D(-n,6):n},a:function(){return a[r.getUTCDay()]},b:function(){return i[r.getUTCMonth()]},d:function(){return C(r.getUTCDate())},e:function(){return function(n){return(9<n?\"\":\" \")+(0|n)}(r.getUTCDate())},m:function(){return C(r.getUTCMonth()+1)}};return function e(n){return n.replace(/%./g,function(n){var t=n[1],r=v[t],t=u[t];return r?e(r):t?t():n})}(n||o)},n.writeInt64BE=t(0,1,2,3,0,4),n.writeInt64LE=t(3,2,1,0,4,0),\"%Y-%m-%dT%H:%M:%S.%NZ\"),i=[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],a=[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],v={\"%\":\"%\",F:\"%Y-%m-%d\",n:\"\\n\",R:\"%H:%M\",T:\"%H:%M:%S\",t:\"\\t\",X:\"%T\",Z:\"GMT\",z:\"+0000\"};return d;function d(n,t,r){var e=this;if(!(e instanceof d))return new d(n,t,r);e.time=+n||0,e.nano=+t||0,e.year=+r||0,p(e)}function p(n){var t,r,e,u=n.year,o=n.time,i=n.nano,a=((i<0||h<=i)&&(i-=(r=Math.floor(i/h))*h,o+=r,r=1),u%s);return(o<-c||c<o||a)&&((t=m(o/f))&&(u+=t*s,o-=t*f),(e=M(o)).setUTCFullYear(a+e.getUTCFullYear()),e=(o=+e)+(t=m((u-=a)/s))*f,t&&-c<=e&&e<=c&&(u-=t*s,o=e),r=1),r&&(n.year=u,n.time=o,n.nano=i),n}function M(n){var t=new Date(0);return t.setTime(n),t}function y(n,t){n=+n||0;var r=m((t=(t|0)*g)/e)+m(n/e),t=t%e+n%e,n=m(t/e);return n&&(r+=n,t-=n*e),new d(1e3*t,0,r*s)}function t(e,u,o,i,a,f){return function(n,t){var r=p(this);n=n||new Array(8);w(n,t|=0);var e=Math.floor(r.time/1e3),r=r.year*(T*l/s),u=m(r/g)+m(e/g),r=r%g+e%g,e=Math.floor(r/g);e&&(u+=e,r-=e*g);return c(n,t+a,u),c(n,t+f,r),n};function c(n,t,r){n[t+e]=r>>24&255,n[t+u]=r>>16&255,n[t+o]=r>>8&255,n[t+i]=255&r}}function r(r,e,u,o,i,a){return function(n,t){w(n,t|=0);var r=f(n,t+i);return y(f(n,t+a),r)};function f(n,t){return 16777216*n[t+r]+(n[t+e]<<16|n[t+u]<<8|n[t+o])}}function w(n,t){n=n&&n.length;if(null==n)throw new TypeError(\"Invalid Buffer\");if(n<t+8)throw new RangeError(\"Out of range\")}function C(n){return(9<n?\"\":\"0\")+(0|n)}function D(n,t){return(u+(0|n)).substr(-t)}}();", "// https://github.com/electron/electron/issues/2288\nfunction isElectron() {\n    // Renderer process\n    if (typeof window !== 'undefined' && typeof window.process === 'object' && window.process.type === 'renderer') {\n        return true;\n    }\n\n    // Main process\n    if (typeof process !== 'undefined' && typeof process.versions === 'object' && !!process.versions.electron) {\n        return true;\n    }\n\n    // Detect the user agent when the `nodeIntegration` option is set to false\n    if (typeof navigator === 'object' && typeof navigator.userAgent === 'string' && navigator.userAgent.indexOf('Electron') >= 0) {\n        return true;\n    }\n\n    return false;\n}\n\nmodule.exports = isElectron;\n", "'use strict';\n\nfunction isHighSurrogate(codePoint) {\n  return codePoint >= 0xd800 && codePoint <= 0xdbff;\n}\n\nfunction isLowSurrogate(codePoint) {\n  return codePoint >= 0xdc00 && codePoint <= 0xdfff;\n}\n\n// Truncate string by size in bytes\nmodule.exports = function truncate(getLength, string, byteLength) {\n  if (typeof string !== \"string\") {\n    throw new Error(\"Input must be string\");\n  }\n\n  var charLength = string.length;\n  var curByteLength = 0;\n  var codePoint;\n  var segment;\n\n  for (var i = 0; i < charLength; i += 1) {\n    codePoint = string.charCodeAt(i);\n    segment = string[i];\n\n    if (isHighSurrogate(codePoint) && isLowSurrogate(string.charCodeAt(i + 1))) {\n      i += 1;\n      segment += string[i];\n    }\n\n    curByteLength += getLength(segment);\n\n    if (curByteLength === byteLength) {\n      return string.slice(0, i + 1);\n    }\n    else if (curByteLength > byteLength) {\n      return string.slice(0, i - segment.length + 1);\n    }\n  }\n\n  return string;\n};\n\n", "'use strict';\n\nfunction isHighSurrogate(codePoint) {\n  return codePoint >= 0xd800 && codePoint <= 0xdbff;\n}\n\nfunction isLowSurrogate(codePoint) {\n  return codePoint >= 0xdc00 && codePoint <= 0xdfff;\n}\n\n// Truncate string by size in bytes\nmodule.exports = function getByteLength(string) {\n  if (typeof string !== \"string\") {\n    throw new Error(\"Input must be string\");\n  }\n\n  var charLength = string.length;\n  var byteLength = 0;\n  var codePoint = null;\n  var prevCodePoint = null;\n  for (var i = 0; i < charLength; i++) {\n    codePoint = string.charCodeAt(i);\n    // handle 4-byte non-BMP chars\n    // low surrogate\n    if (isLowSurrogate(codePoint)) {\n      // when parsing previous hi-surrogate, 3 is added to byteLength\n      if (prevCodePoint != null && isHighSurrogate(prevCodePoint)) {\n        byteLength += 1;\n      }\n      else {\n        byteLength += 3;\n      }\n    }\n    else if (codePoint <= 0x7f ) {\n      byteLength += 1;\n    }\n    else if (codePoint >= 0x80 && codePoint <= 0x7ff) {\n      byteLength += 2;\n    }\n    else if (codePoint >= 0x800 && codePoint <= 0xffff) {\n      byteLength += 3;\n    }\n    prevCodePoint = codePoint;\n  }\n\n  return byteLength;\n};\n", "'use strict';\n\nvar truncate = require(\"./lib/truncate\");\nvar getLength = require(\"utf8-byte-length/browser\");\nmodule.exports = truncate.bind(null, getLength);\n", "/*jshint node:true*/\n'use strict';\n\n/**\n * Replaces characters in strings that are illegal/unsafe for filenames.\n * Unsafe characters are either removed or replaced by a substitute set\n * in the optional `options` object.\n *\n * Illegal Characters on Various Operating Systems\n * / ? < > \\ : * | \"\n * https://kb.acronis.com/content/39790\n *\n * Unicode Control codes\n * C0 0x00-0x1f & C1 (0x80-0x9f)\n * http://en.wikipedia.org/wiki/C0_and_C1_control_codes\n *\n * Reserved filenames on Unix-based systems (\".\", \"..\")\n * Reserved filenames in Windows (\"CON\", \"PRN\", \"AUX\", \"NUL\", \"COM1\",\n * \"COM2\", \"COM3\", \"COM4\", \"COM5\", \"COM6\", \"COM7\", \"COM8\", \"COM9\",\n * \"LPT1\", \"LPT2\", \"LPT3\", \"LPT4\", \"LPT5\", \"LPT6\", \"LPT7\", \"LPT8\", and\n * \"LPT9\") case-insesitively and with or without filename extensions.\n *\n * Capped at 255 characters in length.\n * http://unix.stackexchange.com/questions/32795/what-is-the-maximum-allowed-filename-and-folder-size-with-ecryptfs\n *\n * @param  {String} input   Original filename\n * @param  {Object} options {replacement: String | Function }\n * @return {String}         Sanitized filename\n */\n\nvar truncate = require(\"truncate-utf8-bytes\");\n\nvar illegalRe = /[\\/\\?<>\\\\:\\*\\|\"]/g;\nvar controlRe = /[\\x00-\\x1f\\x80-\\x9f]/g;\nvar reservedRe = /^\\.+$/;\nvar windowsReservedRe = /^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\\..*)?$/i;\nvar windowsTrailingRe = /[\\. ]+$/;\n\nfunction sanitize(input, replacement) {\n  if (typeof input !== 'string') {\n    throw new Error('Input must be string');\n  }\n  var sanitized = input\n    .replace(illegalRe, replacement)\n    .replace(controlRe, replacement)\n    .replace(reservedRe, replacement)\n    .replace(windowsReservedRe, replacement)\n    .replace(windowsTrailingRe, replacement);\n  return truncate(sanitized, 255);\n}\n\nmodule.exports = function (input, options) {\n  var replacement = (options && options.replacement) || '';\n  var output = sanitize(input, replacement);\n  if (replacement === '') {\n    return output;\n  }\n  return sanitize(output, '');\n};\n", "export const BITSWAP_120 = '/ipfs/bitswap/1.2.0'\nexport const DEFAULT_MAX_SIZE_REPLACE_HAS_WITH_BLOCK = 1024\nexport const DEFAULT_MAX_INBOUND_STREAMS = 1024\nexport const DEFAULT_MAX_OUTBOUND_STREAMS = 1024\nexport const DEFAULT_MESSAGE_RECEIVE_TIMEOUT = 5000\nexport const DEFAULT_MESSAGE_SEND_DELAY = 10\nexport const DEFAULT_MESSAGE_SEND_TIMEOUT = 5000\nexport const DEFAULT_MESSAGE_SEND_CONCURRENCY = 50\nexport const DEFAULT_RUN_ON_TRANSIENT_CONNECTIONS = false\nexport const DEFAULT_SESSION_ROOT_PRIORITY = 1\nexport const DEFAULT_MAX_PROVIDERS_PER_REQUEST = 3\nexport const DEFAULT_MAX_OUTGOING_MESSAGE_SIZE = 1024 * 1024 * 4\nexport const DEFAULT_MAX_INCOMING_MESSAGE_SIZE = DEFAULT_MAX_OUTGOING_MESSAGE_SIZE\n", "/* eslint-disable import/export */\n/* eslint-disable complexity */\n/* eslint-disable @typescript-eslint/no-namespace */\n/* eslint-disable @typescript-eslint/no-unnecessary-boolean-literal-compare */\n/* eslint-disable @typescript-eslint/no-empty-interface */\n\nimport { type Codec, decodeMessage, type DecodeOptions, encodeMessage, enumeration, MaxLengthError, message } from 'protons-runtime'\nimport { alloc as uint8ArrayAlloc } from 'uint8arrays/alloc'\nimport type { Uint8ArrayList } from 'uint8arraylist'\n\nexport enum WantType {\n  WantBlock = 'WantBlock',\n  WantHave = 'WantHave'\n}\n\nenum __WantTypeValues {\n  WantBlock = 0,\n  WantHave = 1\n}\n\nexport namespace WantType {\n  export const codec = (): Codec<WantType> => {\n    return enumeration<WantType>(__WantTypeValues)\n  }\n}\nexport interface WantlistEntry {\n  cid: Uint8Array\n  priority: number\n  cancel?: boolean\n  wantType?: WantType\n  sendDontHave?: boolean\n}\n\nexport namespace WantlistEntry {\n  let _codec: Codec<WantlistEntry>\n\n  export const codec = (): Codec<WantlistEntry> => {\n    if (_codec == null) {\n      _codec = message<WantlistEntry>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if ((obj.cid != null && obj.cid.byteLength > 0)) {\n          w.uint32(10)\n          w.bytes(obj.cid)\n        }\n\n        if ((obj.priority != null && obj.priority !== 0)) {\n          w.uint32(16)\n          w.int32(obj.priority)\n        }\n\n        if (obj.cancel != null) {\n          w.uint32(24)\n          w.bool(obj.cancel)\n        }\n\n        if (obj.wantType != null) {\n          w.uint32(32)\n          WantType.codec().encode(obj.wantType, w)\n        }\n\n        if (obj.sendDontHave != null) {\n          w.uint32(40)\n          w.bool(obj.sendDontHave)\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {\n          cid: uint8ArrayAlloc(0),\n          priority: 0\n        }\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.cid = reader.bytes()\n              break\n            }\n            case 2: {\n              obj.priority = reader.int32()\n              break\n            }\n            case 3: {\n              obj.cancel = reader.bool()\n              break\n            }\n            case 4: {\n              obj.wantType = WantType.codec().decode(reader)\n              break\n            }\n            case 5: {\n              obj.sendDontHave = reader.bool()\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<WantlistEntry>): Uint8Array => {\n    return encodeMessage(obj, WantlistEntry.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<WantlistEntry>): WantlistEntry => {\n    return decodeMessage(buf, WantlistEntry.codec(), opts)\n  }\n}\n\nexport interface Wantlist {\n  entries: WantlistEntry[]\n  full?: boolean\n}\n\nexport namespace Wantlist {\n  let _codec: Codec<Wantlist>\n\n  export const codec = (): Codec<Wantlist> => {\n    if (_codec == null) {\n      _codec = message<Wantlist>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if (obj.entries != null) {\n          for (const value of obj.entries) {\n            w.uint32(10)\n            WantlistEntry.codec().encode(value, w)\n          }\n        }\n\n        if (obj.full != null) {\n          w.uint32(16)\n          w.bool(obj.full)\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {\n          entries: []\n        }\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              if (opts.limits?.entries != null && obj.entries.length === opts.limits.entries) {\n                throw new MaxLengthError('Decode error - map field \"entries\" had too many elements')\n              }\n\n              obj.entries.push(WantlistEntry.codec().decode(reader, reader.uint32(), {\n                limits: opts.limits?.entries$\n              }))\n              break\n            }\n            case 2: {\n              obj.full = reader.bool()\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<Wantlist>): Uint8Array => {\n    return encodeMessage(obj, Wantlist.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<Wantlist>): Wantlist => {\n    return decodeMessage(buf, Wantlist.codec(), opts)\n  }\n}\n\nexport interface Block {\n  prefix: Uint8Array\n  data: Uint8Array\n}\n\nexport namespace Block {\n  let _codec: Codec<Block>\n\n  export const codec = (): Codec<Block> => {\n    if (_codec == null) {\n      _codec = message<Block>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if ((obj.prefix != null && obj.prefix.byteLength > 0)) {\n          w.uint32(10)\n          w.bytes(obj.prefix)\n        }\n\n        if ((obj.data != null && obj.data.byteLength > 0)) {\n          w.uint32(18)\n          w.bytes(obj.data)\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {\n          prefix: uint8ArrayAlloc(0),\n          data: uint8ArrayAlloc(0)\n        }\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.prefix = reader.bytes()\n              break\n            }\n            case 2: {\n              obj.data = reader.bytes()\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<Block>): Uint8Array => {\n    return encodeMessage(obj, Block.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<Block>): Block => {\n    return decodeMessage(buf, Block.codec(), opts)\n  }\n}\n\nexport enum BlockPresenceType {\n  HaveBlock = 'HaveBlock',\n  DontHaveBlock = 'DontHaveBlock'\n}\n\nenum __BlockPresenceTypeValues {\n  HaveBlock = 0,\n  DontHaveBlock = 1\n}\n\nexport namespace BlockPresenceType {\n  export const codec = (): Codec<BlockPresenceType> => {\n    return enumeration<BlockPresenceType>(__BlockPresenceTypeValues)\n  }\n}\nexport interface BlockPresence {\n  cid: Uint8Array\n  type: BlockPresenceType\n}\n\nexport namespace BlockPresence {\n  let _codec: Codec<BlockPresence>\n\n  export const codec = (): Codec<BlockPresence> => {\n    if (_codec == null) {\n      _codec = message<BlockPresence>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if ((obj.cid != null && obj.cid.byteLength > 0)) {\n          w.uint32(10)\n          w.bytes(obj.cid)\n        }\n\n        if (obj.type != null && __BlockPresenceTypeValues[obj.type] !== 0) {\n          w.uint32(16)\n          BlockPresenceType.codec().encode(obj.type, w)\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {\n          cid: uint8ArrayAlloc(0),\n          type: BlockPresenceType.HaveBlock\n        }\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.cid = reader.bytes()\n              break\n            }\n            case 2: {\n              obj.type = BlockPresenceType.codec().decode(reader)\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<BlockPresence>): Uint8Array => {\n    return encodeMessage(obj, BlockPresence.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<BlockPresence>): BlockPresence => {\n    return decodeMessage(buf, BlockPresence.codec(), opts)\n  }\n}\n\nexport interface BitswapMessage {\n  wantlist?: Wantlist\n  blocks: Block[]\n  blockPresences: BlockPresence[]\n  pendingBytes: number\n}\n\nexport namespace BitswapMessage {\n  let _codec: Codec<BitswapMessage>\n\n  export const codec = (): Codec<BitswapMessage> => {\n    if (_codec == null) {\n      _codec = message<BitswapMessage>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if (obj.wantlist != null) {\n          w.uint32(10)\n          Wantlist.codec().encode(obj.wantlist, w)\n        }\n\n        if (obj.blocks != null) {\n          for (const value of obj.blocks) {\n            w.uint32(26)\n            Block.codec().encode(value, w)\n          }\n        }\n\n        if (obj.blockPresences != null) {\n          for (const value of obj.blockPresences) {\n            w.uint32(34)\n            BlockPresence.codec().encode(value, w)\n          }\n        }\n\n        if ((obj.pendingBytes != null && obj.pendingBytes !== 0)) {\n          w.uint32(40)\n          w.int32(obj.pendingBytes)\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {\n          blocks: [],\n          blockPresences: [],\n          pendingBytes: 0\n        }\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.wantlist = Wantlist.codec().decode(reader, reader.uint32(), {\n                limits: opts.limits?.wantlist\n              })\n              break\n            }\n            case 3: {\n              if (opts.limits?.blocks != null && obj.blocks.length === opts.limits.blocks) {\n                throw new MaxLengthError('Decode error - map field \"blocks\" had too many elements')\n              }\n\n              obj.blocks.push(Block.codec().decode(reader, reader.uint32(), {\n                limits: opts.limits?.blocks$\n              }))\n              break\n            }\n            case 4: {\n              if (opts.limits?.blockPresences != null && obj.blockPresences.length === opts.limits.blockPresences) {\n                throw new MaxLengthError('Decode error - map field \"blockPresences\" had too many elements')\n              }\n\n              obj.blockPresences.push(BlockPresence.codec().decode(reader, reader.uint32(), {\n                limits: opts.limits?.blockPresences$\n              }))\n              break\n            }\n            case 5: {\n              obj.pendingBytes = reader.int32()\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<BitswapMessage>): Uint8Array => {\n    return encodeMessage(obj, BitswapMessage.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<BitswapMessage>): BitswapMessage => {\n    return decodeMessage(buf, BitswapMessage.codec(), opts)\n  }\n}\n", "import type { QueuedBitswapMessage } from './bitswap-message.js'\n\nexport function mergeMessages (existingMessage: QueuedBitswapMessage, newMessage: QueuedBitswapMessage): QueuedBitswapMessage {\n  for (const [key, entry] of newMessage.wantlist.entries()) {\n    const existingEntry = existingMessage.wantlist.get(key)\n\n    if (existingEntry != null) {\n      // take highest priority\n      if (existingEntry.priority > entry.priority) {\n        entry.priority = existingEntry.priority\n      }\n\n      // take later values if passed, otherwise use earlier ones\n      entry.cancel = entry.cancel ?? existingEntry.cancel\n      entry.wantType = entry.wantType ?? existingEntry.wantType\n      entry.sendDontHave = entry.sendDontHave ?? existingEntry.sendDontHave\n    }\n\n    existingMessage.wantlist.set(key, entry)\n  }\n\n  for (const [key, blockPresence] of newMessage.blockPresences.entries()) {\n    // override earlier block presence with later one as if duplicated it is\n    // likely to be more accurate since it is more recent\n    existingMessage.blockPresences.set(key, blockPresence)\n  }\n\n  for (const [key, block] of newMessage.blocks.entries()) {\n    existingMessage.blocks.set(key, block)\n  }\n\n  if (newMessage.full && !existingMessage.full) {\n    existingMessage.full = true\n  }\n\n  return existingMessage\n}\n", "export class BlockTooLargeError extends Error {\n  static name = 'BlockTooLargeError'\n\n  constructor (message = 'Block too large') {\n    super(message)\n    this.name = 'BlockTooLargeError'\n  }\n}\n", "/* eslint-disable complexity */\n\nimport { encodingLength } from 'uint8-varint'\nimport { BlockTooLargeError } from '../errors.js'\nimport { BitswapMessage, Block, BlockPresence, WantlistEntry } from '../pb/message.js'\nimport type { QueuedBitswapMessage } from './bitswap-message.js'\n\n/**\n * https://github.com/ipfs/kubo/issues/4473#issuecomment-350390693\n */\nexport const MAX_BLOCK_SIZE = 4193648\nconst MAX_ENCODED_BLOCK_SIZE = MAX_BLOCK_SIZE + 16\n\n/**\n * Split the passed Bitswap message into multiple smaller messages that when\n * serialized will be under the maximum message size.\n *\n * Since blocks are the largest thing to send, we first try to fit as many\n * blocks as possible into the message, then add (smaller) block presences and\n * wants until the max size is reached.\n *\n * If a block is encountered that is larger than the max message size an error\n * will be thrown.\n */\nexport function * splitMessage (message: QueuedBitswapMessage, maxSize: number): Generator<Uint8Array> {\n  const wantListEntries = [...message.wantlist.values()]\n  const blockPresences = [...message.blockPresences.values()]\n  const blocks = [...message.blocks.values()]\n\n  let wantListIndex = 0\n  let blockPresencesIndex = 0\n  let blocksIndex = 0\n  let doneSending = false\n\n  while (true) {\n    const subMessage: Required<BitswapMessage> = {\n      wantlist: {\n        full: message.full ?? false,\n        entries: []\n      },\n      blockPresences: [],\n      blocks: [],\n      pendingBytes: 0\n    }\n\n    let size = BitswapMessage.encode(subMessage).byteLength\n\n    let { added, hasMore, newSize } = addToMessage(blocks, subMessage.blocks, blocksIndex, maxSize, size, calculateEncodedBlockSize)\n\n    blocksIndex += added\n    size = newSize\n    const haveMoreBlocks = hasMore\n\n    ;({ added, hasMore, newSize } = addToMessage(blockPresences, subMessage.blockPresences, blockPresencesIndex, maxSize, size, calculateEncodedBlockPresenceSize))\n\n    blockPresencesIndex += added\n    size = newSize\n    const haveMorePresences = hasMore\n\n    ;({ added, hasMore, newSize } = addToMessage(wantListEntries, subMessage.wantlist.entries, wantListIndex, maxSize, size, calculateEncodedWantlistEntrySize))\n\n    wantListIndex += added\n    size = newSize\n    const haveMoreWantlistEntries = hasMore\n\n    doneSending = !haveMoreBlocks && !haveMorePresences && !haveMoreWantlistEntries\n\n    // if we're sending multiple messages this is no longer the full wantlist\n    if (!doneSending) {\n      subMessage.wantlist.full = false\n    }\n\n    yield BitswapMessage.encode(subMessage)\n\n    if (doneSending) {\n      break\n    }\n  }\n}\n\ninterface AddResult {\n  hasMore: boolean\n  added: number\n  newSize: number\n}\n\nfunction addToMessage <T> (input: T[], output: T[], start: number, maxSize: number, size: number, calculateSize: (arg: T) => number): AddResult {\n  let added = 0\n  let hasMore = false\n\n  // try to send as many blocks as possible\n  for (let i = start; i < input.length; i++) {\n    const item = input[i]\n    const itemSize = calculateSize(item)\n\n    if (itemSize > MAX_ENCODED_BLOCK_SIZE) {\n      throw new BlockTooLargeError('Cannot send block as after encoding it is over the max message size')\n    }\n\n    const newSize = size + itemSize\n\n    if (newSize > maxSize) {\n      hasMore = true\n      break\n    }\n\n    output.push(item)\n    added++\n    size = newSize\n  }\n\n  return { hasMore, added, newSize: size }\n}\n\nfunction calculateEncodedBlockSize (block: Block): number {\n  // 3 is the \"blocks\" field number in message.proto\n  return calculateLength(3, Block.encode(block))\n}\n\nfunction calculateEncodedBlockPresenceSize (blockPresence: BlockPresence): number {\n  // 4 is the \"blockPresences\" field number in message.proto\n  return calculateLength(4, BlockPresence.encode(blockPresence))\n}\n\nfunction calculateEncodedWantlistEntrySize (entry: WantlistEntry): number {\n  // 1 is the \"entries\" field number in message.proto\n  return calculateLength(1, WantlistEntry.encode(entry))\n}\n\nfunction calculateLength (fieldNumber: number, data: Uint8Array): number {\n  const fieldNumberLength = encodingLength(fieldNumber)\n  const dataLengthLength = encodingLength(data.byteLength)\n\n  return fieldNumberLength + dataLengthLength + data.byteLength\n}\n", "import { InvalidParametersError, NotStartedError, TimeoutError, TypedEventEmitter, UnsupportedProtocolError, setMaxListeners } from '@libp2p/interface'\nimport { PeerQueue, type PeerQueueJobOptions } from '@libp2p/utils/peer-queue'\nimport drain from 'it-drain'\nimport * as lp from 'it-length-prefixed'\nimport map from 'it-map'\nimport { pipe } from 'it-pipe'\nimport take from 'it-take'\nimport { CustomProgressEvent } from 'progress-events'\nimport { raceEvent } from 'race-event'\nimport { BITSWAP_120, DEFAULT_MAX_INBOUND_STREAMS, DEFAULT_MAX_INCOMING_MESSAGE_SIZE, DEFAULT_MAX_OUTBOUND_STREAMS, DEFAULT_MAX_OUTGOING_MESSAGE_SIZE, DEFAULT_MAX_PROVIDERS_PER_REQUEST, DEFAULT_MESSAGE_RECEIVE_TIMEOUT, DEFAULT_MESSAGE_SEND_CONCURRENCY, DEFAULT_RUN_ON_TRANSIENT_CONNECTIONS } from './constants.js'\nimport { BitswapMessage } from './pb/message.js'\nimport { mergeMessages } from './utils/merge-messages.js'\nimport { splitMessage } from './utils/split-message.js'\nimport type { WantOptions } from './bitswap.js'\nimport type { MultihashHasherLoader } from './index.js'\nimport type { Block } from './pb/message.js'\nimport type { QueuedBitswapMessage } from './utils/bitswap-message.js'\nimport type { Provider, Routing } from '@helia/interface/routing'\nimport type { Libp2p, AbortOptions, Connection, PeerId, IncomingStreamData, Topology, ComponentLogger, IdentifyResult, Counter, Metrics } from '@libp2p/interface'\nimport type { Logger } from '@libp2p/logger'\nimport type { CID } from 'multiformats/cid'\nimport type { ProgressEvent, ProgressOptions } from 'progress-events'\n\nexport type BitswapNetworkProgressEvents =\n  ProgressEvent<'bitswap:network:dial', PeerId>\n\nexport type BitswapNetworkWantProgressEvents =\n  ProgressEvent<'bitswap:network:send-wantlist', PeerId> |\n  ProgressEvent<'bitswap:network:send-wantlist:error', { peer: PeerId, error: Error }> |\n  ProgressEvent<'bitswap:network:find-providers', CID> |\n  BitswapNetworkProgressEvents\n\nexport type BitswapNetworkNotifyProgressEvents =\n  BitswapNetworkProgressEvents |\n  ProgressEvent<'bitswap:network:send-block', PeerId>\n\nexport interface NetworkInit {\n  hashLoader?: MultihashHasherLoader\n  maxInboundStreams?: number\n  maxOutboundStreams?: number\n  messageReceiveTimeout?: number\n  messageSendConcurrency?: number\n  protocols?: string[]\n  runOnLimitedConnections?: boolean\n  maxOutgoingMessageSize?: number\n  maxIncomingMessageSize?: number\n}\n\nexport interface NetworkComponents {\n  routing: Routing\n  logger: ComponentLogger\n  libp2p: Libp2p\n  metrics?: Metrics\n}\n\nexport interface BitswapMessageEventDetail {\n  peer: PeerId\n  message: BitswapMessage\n}\n\nexport interface NetworkEvents {\n  'bitswap:message': CustomEvent<{ peer: PeerId, message: BitswapMessage }>\n  'peer:connected': CustomEvent<PeerId>\n  'peer:disconnected': CustomEvent<PeerId>\n}\n\ninterface SendMessageJobOptions extends AbortOptions, ProgressOptions, PeerQueueJobOptions {\n  message: QueuedBitswapMessage\n}\n\nexport class Network extends TypedEventEmitter<NetworkEvents> {\n  private readonly log: Logger\n  private readonly libp2p: Libp2p\n  private readonly routing: Routing\n  private readonly protocols: string[]\n  private running: boolean\n  private readonly maxInboundStreams: number\n  private readonly maxOutboundStreams: number\n  private readonly messageReceiveTimeout: number\n  private registrarIds: string[]\n  private readonly metrics: { blocksSent?: Counter, dataSent?: Counter }\n  private readonly sendQueue: PeerQueue<void, SendMessageJobOptions>\n  private readonly runOnLimitedConnections: boolean\n  private readonly maxOutgoingMessageSize: number\n  private readonly maxIncomingMessageSize: number\n\n  constructor (components: NetworkComponents, init: NetworkInit = {}) {\n    super()\n\n    this.log = components.logger.forComponent('helia:bitswap:network')\n    this.libp2p = components.libp2p\n    this.routing = components.routing\n    this.protocols = init.protocols ?? [BITSWAP_120]\n    this.registrarIds = []\n    this.running = false\n\n    // bind event listeners\n    this._onStream = this._onStream.bind(this)\n    this.maxInboundStreams = init.maxInboundStreams ?? DEFAULT_MAX_INBOUND_STREAMS\n    this.maxOutboundStreams = init.maxOutboundStreams ?? DEFAULT_MAX_OUTBOUND_STREAMS\n    this.messageReceiveTimeout = init.messageReceiveTimeout ?? DEFAULT_MESSAGE_RECEIVE_TIMEOUT\n    this.runOnLimitedConnections = init.runOnLimitedConnections ?? DEFAULT_RUN_ON_TRANSIENT_CONNECTIONS\n    this.maxIncomingMessageSize = init.maxIncomingMessageSize ?? DEFAULT_MAX_OUTGOING_MESSAGE_SIZE\n    this.maxOutgoingMessageSize = init.maxOutgoingMessageSize ?? init.maxIncomingMessageSize ?? DEFAULT_MAX_INCOMING_MESSAGE_SIZE\n    this.metrics = {\n      blocksSent: components.metrics?.registerCounter('helia_bitswap_sent_blocks_total'),\n      dataSent: components.metrics?.registerCounter('helia_bitswap_sent_data_bytes_total')\n    }\n\n    this.sendQueue = new PeerQueue({\n      concurrency: init.messageSendConcurrency ?? DEFAULT_MESSAGE_SEND_CONCURRENCY,\n      metrics: components.metrics,\n      metricName: 'helia_bitswap_message_send_queue'\n    })\n    this.sendQueue.addEventListener('error', (evt) => {\n      this.log.error('error sending wantlist to peer', evt.detail)\n    })\n  }\n\n  async start (): Promise<void> {\n    if (this.running) {\n      return\n    }\n\n    this.running = true\n\n    await this.libp2p.handle(this.protocols, this._onStream, {\n      maxInboundStreams: this.maxInboundStreams,\n      maxOutboundStreams: this.maxOutboundStreams,\n      runOnLimitedConnection: this.runOnLimitedConnections\n    })\n\n    // register protocol with topology\n    const topology: Topology = {\n      onConnect: (peerId: PeerId) => {\n        this.safeDispatchEvent('peer:connected', {\n          detail: peerId\n        })\n      },\n      onDisconnect: (peerId: PeerId) => {\n        this.safeDispatchEvent('peer:disconnected', {\n          detail: peerId\n        })\n      }\n    }\n\n    this.registrarIds = []\n\n    for (const protocol of this.protocols) {\n      this.registrarIds.push(await this.libp2p.register(protocol, topology))\n    }\n\n    // All existing connections are like new ones for us\n    this.libp2p.getConnections().forEach(conn => {\n      this.safeDispatchEvent('peer:connected', {\n        detail: conn.remotePeer\n      })\n    })\n  }\n\n  async stop (): Promise<void> {\n    this.running = false\n\n    // Unhandle both, libp2p doesn't care if it's not already handled\n    await this.libp2p.unhandle(this.protocols)\n\n    // unregister protocol and handlers\n    if (this.registrarIds != null) {\n      for (const id of this.registrarIds) {\n        this.libp2p.unregister(id)\n      }\n\n      this.registrarIds = []\n    }\n  }\n\n  /**\n   * Handles incoming bitswap messages\n   */\n  _onStream (info: IncomingStreamData): void {\n    if (!this.running) {\n      return\n    }\n\n    const { stream, connection } = info\n\n    Promise.resolve().then(async () => {\n      this.log('incoming new bitswap %s stream from %p', stream.protocol, connection.remotePeer)\n      const abortListener = (): void => {\n        if (stream.status === 'open') {\n          stream.abort(new TimeoutError(`Incoming Bitswap stream timed out after ${this.messageReceiveTimeout}ms`))\n        } else {\n          this.log('stream aborted with status %s', stream.status)\n        }\n      }\n\n      let signal = AbortSignal.timeout(this.messageReceiveTimeout)\n      setMaxListeners(Infinity, signal)\n      signal.addEventListener('abort', abortListener)\n\n      await stream.closeWrite()\n\n      await pipe(\n        stream,\n        (source) => lp.decode(source, {\n          maxDataLength: this.maxIncomingMessageSize\n        }),\n        async (source) => {\n          for await (const data of source) {\n            try {\n              const message = BitswapMessage.decode(data)\n              this.log('incoming new bitswap %s message from %p on stream', stream.protocol, connection.remotePeer, stream.id)\n\n              this.safeDispatchEvent('bitswap:message', {\n                detail: {\n                  peer: connection.remotePeer,\n                  message\n                }\n              })\n\n              // we have received some data so reset the timeout controller\n              signal.removeEventListener('abort', abortListener)\n              signal = AbortSignal.timeout(this.messageReceiveTimeout)\n              setMaxListeners(Infinity, signal)\n              signal.addEventListener('abort', abortListener)\n            } catch (err: any) {\n              this.log.error('error reading incoming bitswap message from %p on stream', connection.remotePeer, stream.id, err)\n              stream.abort(err)\n              break\n            }\n          }\n        }\n      )\n    })\n      .catch(err => {\n        this.log.error('error handling incoming stream from %p', connection.remotePeer, err)\n        stream.abort(err)\n      })\n  }\n\n  /**\n   * Find bitswap providers for a given `cid`.\n   */\n  async * findProviders (cid: CID, options?: AbortOptions & ProgressOptions<BitswapNetworkWantProgressEvents>): AsyncIterable<Provider> {\n    options?.onProgress?.(new CustomProgressEvent<CID>('bitswap:network:find-providers', cid))\n\n    for await (const provider of this.routing.findProviders(cid, options)) {\n      // make sure we can dial the provider\n      const dialable = await this.libp2p.isDialable(provider.multiaddrs, {\n        runOnLimitedConnection: this.runOnLimitedConnections\n      })\n\n      if (!dialable) {\n        continue\n      }\n\n      yield provider\n    }\n  }\n\n  /**\n   * Find the providers of a given `cid` and connect to them.\n   */\n  async findAndConnect (cid: CID, options?: WantOptions): Promise<void> {\n    await drain(\n      map(\n        take(this.findProviders(cid, options), options?.maxProviders ?? DEFAULT_MAX_PROVIDERS_PER_REQUEST),\n        async provider => this.connectTo(provider.id, options)\n      )\n    )\n      .catch(err => {\n        this.log.error(err)\n      })\n  }\n\n  /**\n   * Connect to the given peer\n   * Send the given msg (instance of Message) to the given peer\n   */\n  async sendMessage (peerId: PeerId, message: QueuedBitswapMessage, options?: AbortOptions & ProgressOptions<BitswapNetworkWantProgressEvents>): Promise<void> {\n    if (!this.running) {\n      throw new Error('network isn\\'t running')\n    }\n\n    const existingJob = this.sendQueue.queue.find(job => {\n      return peerId.equals(job.options.peerId) && job.status === 'queued'\n    })\n\n    if (existingJob != null) {\n      existingJob.options.message = mergeMessages(existingJob.options.message, message)\n\n      await existingJob.join({\n        signal: options?.signal\n      })\n\n      return\n    }\n\n    await this.sendQueue.add(async (options) => {\n      const message = options?.message\n\n      if (message == null) {\n        throw new InvalidParametersError('No message to send')\n      }\n\n      this.log('sendMessage to %p', peerId)\n\n      options?.onProgress?.(new CustomProgressEvent<PeerId>('bitswap:network:send-wantlist', peerId))\n\n      const stream = await this.libp2p.dialProtocol(peerId, BITSWAP_120, options)\n      await stream.closeRead()\n\n      try {\n        await pipe(\n          splitMessage(message, this.maxOutgoingMessageSize),\n          (source) => lp.encode(source),\n          stream\n        )\n\n        await stream.close(options)\n      } catch (err: any) {\n        options?.onProgress?.(new CustomProgressEvent<{ peer: PeerId, error: Error }>('bitswap:network:send-wantlist:error', { peer: peerId, error: err }))\n        this.log.error('error sending message to %p', peerId, err)\n        stream.abort(err)\n      }\n\n      this._updateSentStats(message.blocks)\n    }, {\n      peerId,\n      signal: options?.signal,\n      message\n    })\n  }\n\n  /**\n   * Connects to another peer\n   */\n  async connectTo (peer: PeerId, options?: AbortOptions & ProgressOptions<BitswapNetworkProgressEvents>): Promise<Connection> { // eslint-disable-line require-await\n    if (!this.running) {\n      throw new NotStartedError('Network isn\\'t running')\n    }\n\n    options?.onProgress?.(new CustomProgressEvent<PeerId>('bitswap:network:dial', peer))\n\n    // dial and wait for identify - this is to avoid opening a protocol stream\n    // that we are not going to use but depends on the remote node running the\n    // identitfy protocol\n    const [\n      connection\n    ] = await Promise.all([\n      this.libp2p.dial(peer, options),\n      raceEvent(this.libp2p, 'peer:identify', options?.signal, {\n        filter: (evt: CustomEvent<IdentifyResult>): boolean => {\n          if (!evt.detail.peerId.equals(peer)) {\n            return false\n          }\n\n          if (evt.detail.protocols.includes(BITSWAP_120)) {\n            return true\n          }\n\n          throw new UnsupportedProtocolError(`${peer} did not support ${BITSWAP_120}`)\n        }\n      })\n    ])\n\n    return connection\n  }\n\n  _updateSentStats (blocks: Map<string, Block>): void {\n    let bytes = 0\n\n    for (const block of blocks.values()) {\n      bytes += block.data.byteLength\n    }\n\n    this.metrics.dataSent?.increment(bytes)\n    this.metrics.blocksSent?.increment(blocks.size)\n  }\n}\n", "import { base64 } from 'multiformats/bases/base64'\nimport type { Block, BlockPresence, WantlistEntry } from '../pb/message.js'\nimport type { CID } from 'multiformats'\n\n/**\n * A bitswap message that is in the send queue. So implemented to be\n * cheap to merge multiple messages when we repeatedly send messages\n * to the same peer.\n */\nexport class QueuedBitswapMessage {\n  public full: boolean\n  public pendingBytes: number\n  public wantlist: Map<string, WantlistEntry>\n  public blocks: Map<string, Block>\n  public blockPresences: Map<string, BlockPresence>\n\n  constructor (full: boolean = false, pendingBytes: number = 0) {\n    this.full = full\n    this.wantlist = new Map()\n    this.blocks = new Map()\n    this.blockPresences = new Map()\n    this.pendingBytes = 0\n  }\n\n  addWantlistEntry (cid: CID, entry: WantlistEntry): void {\n    const key = base64.encode(cid.multihash.bytes)\n    this.wantlist.set(key, entry)\n  }\n\n  addBlockPresence (cid: CID, blockPresence: BlockPresence): void {\n    const key = base64.encode(cid.multihash.bytes)\n    this.blockPresences.set(key, blockPresence)\n  }\n\n  addBlock (cid: CID, block: Block): void {\n    const key = base64.encode(cid.multihash.bytes)\n    this.blocks.set(key, block)\n  }\n}\n", "import { encode, encodingLength } from 'uint8-varint'\n\nfunction varintEncoder (buf: number[]): Uint8Array {\n  let out = new Uint8Array(buf.reduce((acc, curr) => {\n    return acc + encodingLength(curr)\n  }, 0))\n  let offset = 0\n\n  for (const num of buf) {\n    out = encode(num, out, offset)\n\n    offset += encodingLength(num)\n  }\n\n  return out\n}\n\nexport default varintEncoder\n", "import ve from './varint-encoder.js'\nimport type { CID } from 'multiformats/cid'\n\nexport function cidToPrefix (cid: CID): Uint8Array {\n  return ve([\n    cid.version, cid.code, cid.multihash.code, cid.multihash.digest.byteLength\n  ])\n}\n", "/* eslint-disable max-depth */\nimport { DEFAULT_MAX_SIZE_REPLACE_HAS_WITH_BLOCK } from '../constants.js'\nimport { BlockPresenceType, WantType } from '../pb/message.js'\nimport { QueuedBitswapMessage } from '../utils/bitswap-message.js'\nimport { cidToPrefix } from '../utils/cid-prefix.js'\nimport type { Network } from '../network.js'\nimport type { ComponentLogger, Logger, PeerId } from '@libp2p/interface'\nimport type { Blockstore } from 'interface-blockstore'\nimport type { AbortOptions } from 'it-length-prefixed-stream'\nimport type { CID } from 'multiformats/cid'\n\nexport interface LedgerComponents {\n  peerId: PeerId\n  blockstore: Blockstore\n  network: Network\n  logger: ComponentLogger\n}\n\nexport interface LedgerInit {\n  maxSizeReplaceHasWithBlock?: number\n}\n\nexport interface PeerWantListEntry {\n  /**\n   * The CID the peer has requested\n   */\n  cid: CID\n\n  /**\n   * The priority with which the remote should return the block\n   */\n  priority: number\n\n  /**\n   * If we want the block or if we want the remote to tell us if they have the\n   * block - note if the block is small they'll send it to us anyway.\n   */\n  wantType: WantType\n\n  /**\n   * Whether the remote should tell us if they have the block or not\n   */\n  sendDontHave: boolean\n\n  /**\n   * If we don't have the block and we've told them we don't have the block\n   */\n  sentDontHave?: boolean\n}\n\nexport class Ledger {\n  public peerId: PeerId\n  private readonly blockstore: Blockstore\n  private readonly network: Network\n  public wants: Map<string, PeerWantListEntry>\n  public exchangeCount: number\n  public bytesSent: number\n  public bytesReceived: number\n  public lastExchange?: number\n  private readonly maxSizeReplaceHasWithBlock: number\n  private readonly log: Logger\n\n  constructor (components: LedgerComponents, init: LedgerInit) {\n    this.peerId = components.peerId\n    this.blockstore = components.blockstore\n    this.network = components.network\n    this.wants = new Map()\n    this.log = components.logger.forComponent(`helia:bitswap:ledger:${components.peerId}`)\n\n    this.exchangeCount = 0\n    this.bytesSent = 0\n    this.bytesReceived = 0\n    this.maxSizeReplaceHasWithBlock = init.maxSizeReplaceHasWithBlock ?? DEFAULT_MAX_SIZE_REPLACE_HAS_WITH_BLOCK\n  }\n\n  sentBytes (n: number): void {\n    this.exchangeCount++\n    this.lastExchange = (new Date()).getTime()\n    this.bytesSent += n\n  }\n\n  receivedBytes (n: number): void {\n    this.exchangeCount++\n    this.lastExchange = (new Date()).getTime()\n    this.bytesReceived += n\n  }\n\n  debtRatio (): number {\n    return (this.bytesSent / (this.bytesReceived + 1)) // +1 is to prevent division by zero\n  }\n\n  public async sendBlocksToPeer (options?: AbortOptions): Promise<void> {\n    const message = new QueuedBitswapMessage()\n    const sentBlocks = new Set<string>()\n\n    for (const [key, entry] of this.wants.entries()) {\n      try {\n        const block = await this.blockstore.get(entry.cid, options)\n\n        // do they want the block or just us to tell them we have the block\n        if (entry.wantType === WantType.WantHave) {\n          if (block.byteLength < this.maxSizeReplaceHasWithBlock) {\n            this.log('sending have and block for %c', entry.cid)\n            // if the block is small we just send it to them\n            sentBlocks.add(key)\n            message.addBlock(entry.cid, {\n              data: block,\n              prefix: cidToPrefix(entry.cid)\n            })\n          } else {\n            this.log('sending have for %c', entry.cid)\n            // otherwise tell them we have the block\n            message.addBlockPresence(entry.cid, {\n              cid: entry.cid.bytes,\n              type: BlockPresenceType.HaveBlock\n            })\n          }\n        } else {\n          this.log('sending block for %c', entry.cid)\n          // they want the block, send it to them\n          sentBlocks.add(key)\n          message.addBlock(entry.cid, {\n            data: block,\n            prefix: cidToPrefix(entry.cid)\n          })\n        }\n      } catch (err: any) {\n        if (err.name !== 'NotFoundError') {\n          throw err\n        }\n\n        this.log('do not have block for %c', entry.cid)\n\n        // we don't have the requested block and the remote is not interested\n        // in us telling them that\n        if (!entry.sendDontHave) {\n          continue\n        }\n\n        // we have already told them we don't have the block\n        if (entry.sentDontHave === true) {\n          continue\n        }\n\n        entry.sentDontHave = true\n        message.addBlockPresence(entry.cid, {\n          cid: entry.cid.bytes,\n          type: BlockPresenceType.DontHaveBlock\n        })\n      }\n    }\n\n    // only send the message if we actually have something to send\n    if (message.blocks.size > 0 || message.blockPresences.size > 0) {\n      this.log('sending message')\n      await this.network.sendMessage(this.peerId, message, options)\n      this.log('sent message')\n\n      // update accounting\n      this.sentBytes([...message.blocks.values()].reduce((acc, curr) => acc + curr.data.byteLength, 0))\n\n      // remove sent blocks from local copy of their want list - they can still\n      // re-request if required\n      for (const key of sentBlocks) {\n        this.wants.delete(key)\n      }\n    }\n  }\n}\n", "import { trackedPeerMap } from '@libp2p/peer-collections'\nimport { CID } from 'multiformats/cid'\nimport { toString as uint8ArrayToString } from 'uint8arrays/to-string'\nimport { WantType } from '../pb/message.js'\nimport { Ledger } from './ledger.js'\nimport type { BitswapNotifyProgressEvents, WantListEntry } from '../index.js'\nimport type { Network } from '../network.js'\nimport type { BitswapMessage } from '../pb/message.js'\nimport type { ComponentLogger, Libp2p, Logger, Metrics, PeerId } from '@libp2p/interface'\nimport type { PeerMap } from '@libp2p/peer-collections'\nimport type { Blockstore } from 'interface-blockstore'\nimport type { AbortOptions } from 'it-length-prefixed-stream'\nimport type { ProgressOptions } from 'progress-events'\n\nexport interface PeerWantListsInit {\n  maxSizeReplaceHasWithBlock?: number\n}\n\nexport interface PeerWantListsComponents {\n  blockstore: Blockstore\n  network: Network\n  libp2p: Libp2p\n  logger: ComponentLogger\n  metrics?: Metrics\n}\n\nexport interface PeerLedger {\n  peer: PeerId\n  value: number\n  sent: number\n  received: number\n  exchanged: number\n}\n\nexport class PeerWantLists {\n  public blockstore: Blockstore\n  public network: Network\n  public readonly ledgerMap: PeerMap<Ledger>\n  private readonly maxSizeReplaceHasWithBlock?: number\n  private readonly log: Logger\n  private readonly logger: ComponentLogger\n\n  constructor (components: PeerWantListsComponents, init: PeerWantListsInit = {}) {\n    this.blockstore = components.blockstore\n    this.network = components.network\n    this.maxSizeReplaceHasWithBlock = init.maxSizeReplaceHasWithBlock\n    this.log = components.logger.forComponent('helia:bitswap:peer-want-lists')\n    this.logger = components.logger\n\n    this.ledgerMap = trackedPeerMap({\n      name: 'helia_bitswap_ledger_map',\n      metrics: components.metrics\n    })\n\n    this.network.addEventListener('bitswap:message', (evt) => {\n      this.receiveMessage(evt.detail.peer, evt.detail.message)\n        .catch(err => {\n          this.log.error('error receiving bitswap message from %p', evt.detail.peer, err)\n        })\n    })\n    this.network.addEventListener('peer:disconnected', evt => {\n      this.peerDisconnected(evt.detail)\n    })\n  }\n\n  ledgerForPeer (peerId: PeerId): PeerLedger | undefined {\n    const ledger = this.ledgerMap.get(peerId)\n\n    if (ledger == null) {\n      return undefined\n    }\n\n    return {\n      peer: ledger.peerId,\n      value: ledger.debtRatio(),\n      sent: ledger.bytesSent,\n      received: ledger.bytesReceived,\n      exchanged: ledger.exchangeCount\n    }\n  }\n\n  wantListForPeer (peerId: PeerId): WantListEntry[] | undefined {\n    const ledger = this.ledgerMap.get(peerId)\n\n    if (ledger == null) {\n      return undefined\n    }\n\n    return [...ledger.wants.values()]\n  }\n\n  peers (): PeerId[] {\n    return Array.from(this.ledgerMap.values()).map((l) => l.peerId)\n  }\n\n  /**\n   * Handle incoming messages\n   */\n  async receiveMessage (peerId: PeerId, message: BitswapMessage): Promise<void> {\n    let ledger = this.ledgerMap.get(peerId)\n\n    if (ledger == null) {\n      ledger = new Ledger({\n        peerId,\n        blockstore: this.blockstore,\n        network: this.network,\n        logger: this.logger\n      }, {\n        maxSizeReplaceHasWithBlock: this.maxSizeReplaceHasWithBlock\n      })\n      this.ledgerMap.set(peerId, ledger)\n    }\n\n    // record the amount of block data received\n    ledger.receivedBytes(message.blocks?.reduce((acc, curr) => acc + curr.data.byteLength, 0) ?? 0)\n\n    if (message.wantlist != null) {\n      // if the message has a full wantlist, clear the current wantlist\n      if (message.wantlist.full === true) {\n        ledger.wants.clear()\n      }\n\n      // clear cancelled wants and add new wants to the ledger\n      for (const entry of message.wantlist.entries) {\n        const cid = CID.decode(entry.cid)\n        const cidStr = uint8ArrayToString(cid.multihash.bytes, 'base64')\n\n        if (entry.cancel === true) {\n          this.log('peer %p cancelled want of block for %c', peerId, cid)\n          ledger.wants.delete(cidStr)\n        } else {\n          if (entry.wantType === WantType.WantHave) {\n            this.log('peer %p wanted block presence for %c', peerId, cid)\n          } else {\n            this.log('peer %p wanted block for %c', peerId, cid)\n          }\n\n          ledger.wants.set(cidStr, {\n            cid,\n            priority: entry.priority,\n            wantType: entry.wantType ?? WantType.WantBlock,\n            sendDontHave: entry.sendDontHave ?? false\n          })\n        }\n      }\n    }\n\n    this.log('send blocks to peer')\n    await ledger.sendBlocksToPeer()\n  }\n\n  async receivedBlock (cid: CID, options: ProgressOptions<BitswapNotifyProgressEvents> & AbortOptions): Promise<void> {\n    const cidStr = uint8ArrayToString(cid.multihash.bytes, 'base64')\n    const ledgers: Ledger[] = []\n\n    for (const ledger of this.ledgerMap.values()) {\n      if (ledger.wants.has(cidStr)) {\n        ledgers.push(ledger)\n      }\n    }\n\n    await Promise.all(\n      ledgers.map(async (ledger) => ledger.sendBlocksToPeer(options))\n    )\n  }\n\n  peerDisconnected (peerId: PeerId): void {\n    this.ledgerMap.delete(peerId)\n  }\n}\n", "import { bytes as binary, CID } from './index.js'\nimport type * as API from './interface.js'\n\nfunction readonly ({ enumerable = true, configurable = false } = {}): { enumerable: boolean, configurable: boolean, writable: false } {\n  return { enumerable, configurable, writable: false }\n}\n\nfunction * linksWithin (path: [string | number, string], value: any): Iterable<[string, CID]> {\n  if (value != null && typeof value === 'object') {\n    if (Array.isArray(value)) {\n      for (const [index, element] of value.entries()) {\n        const elementPath = [...path, index]\n        const cid = CID.asCID(element)\n        if (cid != null) {\n          yield [elementPath.join('/'), cid]\n        } else if (typeof element === 'object') {\n          yield * links(element, elementPath)\n        }\n      }\n    } else {\n      const cid = CID.asCID(value)\n      if (cid != null) {\n        yield [path.join('/'), cid]\n      } else {\n        yield * links(value, path)\n      }\n    }\n  }\n}\n\nfunction * links <T> (source: T, base: Array<string | number>): Iterable<[string, CID]> {\n  if (source == null || source instanceof Uint8Array) {\n    return\n  }\n  const cid = CID.asCID(source)\n  if (cid != null) {\n    yield [base.join('/'), cid]\n  }\n  for (const [key, value] of Object.entries(source)) {\n    const path = [...base, key] as [string | number, string]\n    yield * linksWithin(path, value)\n  }\n}\n\nfunction * treeWithin (path: [string | number, string], value: any): Iterable<string> {\n  if (Array.isArray(value)) {\n    for (const [index, element] of value.entries()) {\n      const elementPath = [...path, index]\n      yield elementPath.join('/')\n      if (typeof element === 'object' && (CID.asCID(element) == null)) {\n        yield * tree(element, elementPath)\n      }\n    }\n  } else {\n    yield * tree(value, path)\n  }\n}\n\nfunction * tree <T> (source: T, base: Array<string | number>): Iterable<string> {\n  if (source == null || typeof source !== 'object') {\n    return\n  }\n  for (const [key, value] of Object.entries(source)) {\n    const path = [...base, key] as [string | number, string]\n    yield path.join('/')\n    if (value != null && !(value instanceof Uint8Array) && typeof value === 'object' && (CID.asCID(value) == null)) {\n      yield * treeWithin(path, value)\n    }\n  }\n}\n\nfunction get <T> (source: T, path: string[]): API.BlockCursorView<unknown> {\n  let node = source as Record<string, any>\n  for (const [index, key] of path.entries()) {\n    node = node[key]\n    if (node == null) {\n      throw new Error(`Object has no property at ${path.slice(0, index + 1).map(part => `[${JSON.stringify(part)}]`).join('')}`)\n    }\n    const cid = CID.asCID(node)\n    if (cid != null) {\n      return { value: cid, remaining: path.slice(index + 1).join('/') }\n    }\n  }\n  return { value: node }\n}\n\n/**\n * @template T - Logical type of the data encoded in the block\n * @template C - multicodec code corresponding to codec used to encode the block\n * @template A - multicodec code corresponding to the hashing algorithm used in CID creation.\n * @template V - CID version\n */\nexport class Block<T, C extends number, A extends number, V extends API.Version> implements API.BlockView<T, C, A, V> {\n  readonly cid: CID<T, C, A, V>\n  readonly bytes: API.ByteView<T>\n  readonly value: T\n  readonly asBlock: this\n\n  constructor ({ cid, bytes, value }: { cid: CID<T, C, A, V>, bytes: API.ByteView<T>, value: T }) {\n    if (cid == null || bytes == null || typeof value === 'undefined') { throw new Error('Missing required argument') }\n\n    this.cid = cid\n    this.bytes = bytes\n    this.value = value\n    this.asBlock = this\n\n    // Mark all the properties immutable\n    Object.defineProperties(this, {\n      cid: readonly(),\n      bytes: readonly(),\n      value: readonly(),\n      asBlock: readonly()\n    })\n  }\n\n  links (): Iterable<[string, CID<unknown, number, number, API.Version>]> {\n    return links(this.value, [])\n  }\n\n  tree (): Iterable<string> {\n    return tree(this.value, [])\n  }\n\n  get (path = '/'): API.BlockCursorView<unknown> {\n    return get(this.value, path.split('/').filter(Boolean))\n  }\n}\n\ninterface EncodeInput <T, Code extends number, Alg extends number> {\n  value: T\n  codec: API.BlockEncoder<Code, T>\n  hasher: API.MultihashHasher<Alg>\n}\n\n/**\n * @template T - Logical type of the data encoded in the block\n * @template Code - multicodec code corresponding to codec used to encode the block\n * @template Alg - multicodec code corresponding to the hashing algorithm used in CID creation.\n */\nexport async function encode <T, Code extends number, Alg extends number> ({ value, codec, hasher }: EncodeInput<T, Code, Alg>): Promise<API.BlockView<T, Code, Alg>> {\n  if (typeof value === 'undefined') throw new Error('Missing required argument \"value\"')\n  if (codec == null || hasher == null) throw new Error('Missing required argument: codec or hasher')\n\n  const bytes = codec.encode(value)\n  const hash = await hasher.digest(bytes)\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n  const cid = CID.create(\n    1,\n    codec.code,\n    hash\n  ) as CID<T, Code, Alg, 1>\n\n  return new Block({ value, bytes, cid })\n}\n\ninterface DecodeInput <T, Code extends number, Alg extends number> {\n  bytes: API.ByteView<T>\n  codec: API.BlockDecoder<Code, T>\n  hasher: API.MultihashHasher<Alg>\n}\n\n/**\n * @template T - Logical type of the data encoded in the block\n * @template Code - multicodec code corresponding to codec used to encode the block\n * @template Alg - multicodec code corresponding to the hashing algorithm used in CID creation.\n */\nexport async function decode <T, Code extends number, Alg extends number> ({ bytes, codec, hasher }: DecodeInput<T, Code, Alg>): Promise<API.BlockView<T, Code, Alg>> {\n  if (bytes == null) throw new Error('Missing required argument \"bytes\"')\n  if (codec == null || hasher == null) throw new Error('Missing required argument: codec or hasher')\n\n  const value = codec.decode(bytes)\n  const hash = await hasher.digest(bytes)\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n  const cid = CID.create(1, codec.code, hash) as CID<T, Code, Alg, 1>\n\n  return new Block({ value, bytes, cid })\n}\n\ntype CreateUnsafeInput <T, Code extends number, Alg extends number, V extends API.Version> = {\n  cid: API.Link<T, Code, Alg, V>\n  value: T\n  codec?: API.BlockDecoder<Code, T>\n  bytes: API.ByteView<T>\n} | {\n  cid: API.Link<T, Code, Alg, V>\n  value?: undefined\n  codec: API.BlockDecoder<Code, T>\n  bytes: API.ByteView<T>\n}\n\n/**\n * @template T - Logical type of the data encoded in the block\n * @template Code - multicodec code corresponding to codec used to encode the block\n * @template Alg - multicodec code corresponding to the hashing algorithm used in CID creation.\n * @template V - CID version\n */\nexport function createUnsafe <T, Code extends number, Alg extends number, V extends API.Version> ({ bytes, cid, value: maybeValue, codec }: CreateUnsafeInput<T, Code, Alg, V>): API.BlockView<T, Code, Alg, V> {\n  // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\n  const value = maybeValue !== undefined\n    ? maybeValue\n    : (codec?.decode(bytes))\n\n  if (value === undefined) throw new Error('Missing required argument, must either provide \"value\" or \"codec\"')\n\n  return new Block({\n    cid: cid as CID<T, Code, Alg, V>,\n    bytes,\n    value\n  })\n}\n\ninterface CreateInput <T, Code extends number, Alg extends number, V extends API.Version> {\n  bytes: API.ByteView<T>\n  cid: API.Link<T, Code, Alg, V>\n  hasher: API.MultihashHasher<Alg>\n  codec: API.BlockDecoder<Code, T>\n}\n\n/**\n * @template T - Logical type of the data encoded in the block\n * @template Code - multicodec code corresponding to codec used to encode the block\n * @template Alg - multicodec code corresponding to the hashing algorithm used in CID creation.\n * @template V - CID version\n */\nexport async function create <T, Code extends number, Alg extends number, V extends API.Version> ({ bytes, cid, hasher, codec }: CreateInput<T, Code, Alg, V>): Promise<API.BlockView<T, Code, Alg, V>> {\n  if (bytes == null) throw new Error('Missing required argument \"bytes\"')\n  if (hasher == null) throw new Error('Missing required argument \"hasher\"')\n  const value = codec.decode(bytes)\n  const hash = await hasher.digest(bytes)\n  if (!binary.equals(cid.multihash.bytes, hash.bytes)) {\n    throw new Error('CID hash does not match bytes')\n  }\n\n  return createUnsafe({\n    bytes,\n    cid,\n    value,\n    codec\n  })\n}\n", "import { Queue } from '@libp2p/utils/queue'\nimport * as cborg from 'cborg'\nimport { type Datastore, Key } from 'interface-datastore'\nimport { base36 } from 'multiformats/bases/base36'\nimport { createUnsafe } from 'multiformats/block'\nimport { CID, type Version } from 'multiformats/cid'\nimport { CustomProgressEvent, type ProgressOptions } from 'progress-events'\nimport { equals as uint8ArrayEquals } from 'uint8arrays/equals'\nimport type { CodecLoader } from '@helia/interface'\nimport type { GetBlockProgressEvents } from '@helia/interface/blocks'\nimport type { AddOptions, AddPinEvents, IsPinnedOptions, LsOptions, Pin, Pins, RmOptions } from '@helia/interface/pins'\nimport type { AbortOptions } from '@libp2p/interface'\nimport type { Blockstore } from 'interface-blockstore'\n\ninterface DatastorePin {\n  /**\n   * 0 for a direct pin or an arbitrary (+ve, whole) number or Infinity\n   */\n  depth: number\n\n  /**\n   * User-specific metadata for the pin\n   */\n  metadata: Record<string, string | number | boolean>\n}\n\ninterface DatastorePinnedBlock {\n  pinCount: number\n  pinnedBy: Uint8Array[]\n}\n\n/**\n * Callback for updating a {@link DatastorePinnedBlock}'s properties when\n * calling `#updatePinnedBlock`\n *\n * The callback should return `false` to prevent any pinning modifications to\n * the block, and true in all other cases.\n */\ninterface WithPinnedBlockCallback {\n  (pinnedBlock: DatastorePinnedBlock): boolean\n}\n\nconst DATASTORE_PIN_PREFIX = '/pin/'\nconst DATASTORE_BLOCK_PREFIX = '/pinned-block/'\nconst DATASTORE_ENCODING = base36\nconst DAG_WALK_QUEUE_CONCURRENCY = 1\n\ninterface WalkDagOptions extends AbortOptions, ProgressOptions<GetBlockProgressEvents | AddPinEvents> {\n  depth: number\n}\n\nfunction toDSKey (cid: CID): Key {\n  if (cid.version === 0) {\n    cid = cid.toV1()\n  }\n\n  return new Key(`${DATASTORE_PIN_PREFIX}${cid.toString(DATASTORE_ENCODING)}`)\n}\n\nexport class PinsImpl implements Pins {\n  private readonly datastore: Datastore\n  private readonly blockstore: Blockstore\n  private readonly getCodec: CodecLoader\n\n  constructor (datastore: Datastore, blockstore: Blockstore, getCodec: CodecLoader) {\n    this.datastore = datastore\n    this.blockstore = blockstore\n    this.getCodec = getCodec\n  }\n\n  async * add (cid: CID<unknown, number, number, Version>, options: AddOptions = {}): AsyncGenerator<CID, void, undefined> {\n    const pinKey = toDSKey(cid)\n\n    if (await this.datastore.has(pinKey)) {\n      throw new Error('Already pinned')\n    }\n\n    const depth = Math.round(options.depth ?? Infinity)\n\n    if (depth < 0) {\n      throw new Error('Depth must be greater than or equal to 0')\n    }\n\n    // use a queue to walk the DAG instead of recursion so we can traverse very large DAGs\n    const queue = new Queue<AsyncGenerator<CID>>({\n      concurrency: DAG_WALK_QUEUE_CONCURRENCY\n    })\n\n    for await (const childCid of this.#walkDag(cid, queue, {\n      ...options,\n      depth\n    })) {\n      await this.#updatePinnedBlock(childCid, (pinnedBlock: DatastorePinnedBlock) => {\n        // do not update pinned block if this block is already pinned by this CID\n        if (pinnedBlock.pinnedBy.find(c => uint8ArrayEquals(c, cid.bytes)) != null) {\n          return false\n        }\n\n        pinnedBlock.pinCount++\n        pinnedBlock.pinnedBy.push(cid.bytes)\n        return true\n      }, options)\n\n      yield childCid\n    }\n\n    const pin: DatastorePin = {\n      depth,\n      metadata: options.metadata ?? {}\n    }\n\n    await this.datastore.put(pinKey, cborg.encode(pin), options)\n  }\n\n  /**\n   * Walk a DAG in an iterable fashion\n   */\n  async * #walkDag (cid: CID, queue: Queue<AsyncGenerator<CID>>, options: WalkDagOptions): AsyncGenerator<CID> {\n    if (options.depth === -1) {\n      return\n    }\n\n    const codec = await this.getCodec(cid.code)\n    const bytes = await this.blockstore.get(cid, options)\n    const block = createUnsafe({ bytes, cid, codec })\n\n    yield cid\n\n    // walk dag, ensure all blocks are present\n    for await (const [,cid] of block.links()) {\n      yield * await queue.add(async () => {\n        return this.#walkDag(cid, queue, {\n          ...options,\n          depth: options.depth - 1\n        })\n      })\n    }\n  }\n\n  /**\n   * Update the pin count for the CID\n   */\n  async #updatePinnedBlock (cid: CID, withPinnedBlock: WithPinnedBlockCallback, options: AddOptions): Promise<void> {\n    const blockKey = new Key(`${DATASTORE_BLOCK_PREFIX}${DATASTORE_ENCODING.encode(cid.multihash.bytes)}`)\n\n    let pinnedBlock: DatastorePinnedBlock = {\n      pinCount: 0,\n      pinnedBy: []\n    }\n\n    try {\n      pinnedBlock = cborg.decode(await this.datastore.get(blockKey, options))\n    } catch (err: any) {\n      if (err.name !== 'NotFoundError') {\n        throw err\n      }\n    }\n\n    const shouldContinue = withPinnedBlock(pinnedBlock)\n\n    if (!shouldContinue) {\n      return\n    }\n\n    if (pinnedBlock.pinCount === 0) {\n      if (await this.datastore.has(blockKey)) {\n        await this.datastore.delete(blockKey)\n        return\n      }\n    }\n\n    await this.datastore.put(blockKey, cborg.encode(pinnedBlock), options)\n    options.onProgress?.(new CustomProgressEvent<CID>('helia:pin:add', cid))\n  }\n\n  async * rm (cid: CID<unknown, number, number, Version>, options: RmOptions = {}): AsyncGenerator<CID, void, undefined> {\n    const pinKey = toDSKey(cid)\n    const buf = await this.datastore.get(pinKey, options)\n    const pin = cborg.decode(buf)\n\n    await this.datastore.delete(pinKey, options)\n\n    // use a queue to walk the DAG instead of recursion so we can traverse very large DAGs\n    const queue = new Queue<AsyncGenerator<CID>>({\n      concurrency: DAG_WALK_QUEUE_CONCURRENCY\n    })\n\n    for await (const childCid of this.#walkDag(cid, queue, {\n      ...options,\n      depth: pin.depth\n    })) {\n      await this.#updatePinnedBlock(childCid, (pinnedBlock): boolean => {\n        pinnedBlock.pinCount--\n        pinnedBlock.pinnedBy = pinnedBlock.pinnedBy.filter(c => uint8ArrayEquals(c, cid.bytes))\n        return true\n      }, {\n        ...options,\n        depth: pin.depth\n      })\n\n      yield childCid\n    }\n  }\n\n  async * ls (options: LsOptions = {}): AsyncGenerator<Pin, void, undefined> {\n    for await (const { key, value } of this.datastore.query({\n      prefix: DATASTORE_PIN_PREFIX + (options.cid != null ? `${options.cid.toString(base36)}` : '')\n    }, options)) {\n      const cid = CID.parse(key.toString().substring(5), base36)\n      const pin = cborg.decode(value)\n\n      yield {\n        cid,\n        ...pin\n      }\n    }\n  }\n\n  async isPinned (cid: CID, options: IsPinnedOptions = {}): Promise<boolean> {\n    const blockKey = new Key(`${DATASTORE_BLOCK_PREFIX}${DATASTORE_ENCODING.encode(cid.multihash.bytes)}`)\n\n    return this.datastore.has(blockKey, options)\n  }\n\n  async get (cid: CID, options?: AbortOptions): Promise<Pin> {\n    const pinKey = toDSKey(cid)\n    const buf = await this.datastore.get(pinKey, options)\n\n    return cborg.decode(buf)\n  }\n\n  async setMetadata (cid: CID, metadata: Record<string, string | number | boolean> | undefined, options?: AbortOptions): Promise<void> {\n    const pinKey = toDSKey(cid)\n    const buf = await this.datastore.get(pinKey, options)\n    const pin: DatastorePin = cborg.decode(buf)\n\n    pin.metadata = metadata ?? {}\n\n    await this.datastore.put(pinKey, cborg.encode(pin), options)\n  }\n}\n", "import type { Blockstore } from 'interface-blockstore'\nimport type { AbortOptions } from 'interface-store'\nimport type { CID } from 'multiformats/cid'\nimport type { ProgressEvent, ProgressOptions } from 'progress-events'\n\nexport interface Pair {\n  cid: CID\n  block: Uint8Array\n}\n\nexport type HasBlockProgressEvents =\n  ProgressEvent<'blocks:put:duplicate', CID> |\n  ProgressEvent<'blocks:put:providers:notify', CID> |\n  ProgressEvent<'blocks:put:blockstore:put', CID>\n\nexport type PutBlockProgressEvents =\n  ProgressEvent<'blocks:put:duplicate', CID> |\n  ProgressEvent<'blocks:put:providers:notify', CID> |\n  ProgressEvent<'blocks:put:blockstore:put', CID>\n\nexport type PutManyBlocksProgressEvents =\n  ProgressEvent<'blocks:put-many:duplicate', CID> |\n  ProgressEvent<'blocks:put-many:providers:notify', CID> |\n  ProgressEvent<'blocks:put-many:blockstore:put-many'>\n\nexport type GetBlockProgressEvents =\n  ProgressEvent<'blocks:get:providers:want', CID> |\n  ProgressEvent<'blocks:get:blockstore:get', CID> |\n  ProgressEvent<'blocks:get:blockstore:put', CID>\n\nexport type GetManyBlocksProgressEvents =\n  ProgressEvent<'blocks:get-many:blockstore:get-many'> |\n  ProgressEvent<'blocks:get-many:providers:want', CID> |\n  ProgressEvent<'blocks:get-many:blockstore:put', CID>\n\nexport type GetAllBlocksProgressEvents =\n  ProgressEvent<'blocks:get-all:blockstore:get-many'>\n\nexport type DeleteBlockProgressEvents =\n  ProgressEvent<'blocks:delete:blockstore:delete', CID>\n\nexport type DeleteManyBlocksProgressEvents =\n  ProgressEvent<'blocks:delete-many:blockstore:delete-many'>\n\nexport interface GetOfflineOptions {\n  /**\n   * If true, do not attempt to fetch any missing blocks from the network\n   *\n   * @default false\n   */\n  offline?: boolean\n}\n\nexport interface Blocks extends Blockstore<ProgressOptions<HasBlockProgressEvents>,\nProgressOptions<PutBlockProgressEvents>, ProgressOptions<PutManyBlocksProgressEvents>,\nGetOfflineOptions & ProgressOptions<GetBlockProgressEvents>, GetOfflineOptions & ProgressOptions<GetManyBlocksProgressEvents>, ProgressOptions<GetAllBlocksProgressEvents>,\nProgressOptions<DeleteBlockProgressEvents>, ProgressOptions<DeleteManyBlocksProgressEvents>\n> {\n\n  createSession(root: CID, options?: CreateSessionOptions<GetBlockProgressEvents>): SessionBlockstore\n}\n\n/**\n * A session blockstore is a special blockstore that only pulls content from a\n * subset of network peers which respond as having the block for the initial\n * root CID.\n *\n * Any blocks written to the blockstore as part of the session will propagate\n * to the blockstore the session was created from.\n *\n */\nexport interface SessionBlockstore extends Blockstore<ProgressOptions<HasBlockProgressEvents>,\nProgressOptions<PutBlockProgressEvents>, ProgressOptions<PutManyBlocksProgressEvents>,\nGetOfflineOptions & ProgressOptions<GetBlockProgressEvents>, GetOfflineOptions & ProgressOptions<GetManyBlocksProgressEvents>, ProgressOptions<GetAllBlocksProgressEvents>,\nProgressOptions<DeleteBlockProgressEvents>, ProgressOptions<DeleteManyBlocksProgressEvents>\n> {\n  /**\n   * Any in-progress operations will be aborted.\n   */\n  close(): void\n}\n\nexport interface BlockRetrievalOptions <ProgressEvents extends ProgressEvent<any, any> = ProgressEvent<any, any>> extends AbortOptions, ProgressOptions<ProgressEvents> {\n  /**\n   * A function that blockBrokers should call prior to returning a block to ensure it can maintain control\n   * of the block request flow. e.g. TrustedGatewayBlockBroker will use this to ensure that the block\n   * is valid from one of the gateways before assuming its work is done. If the block is not valid, it should try another gateway\n   * and WILL consider the gateway that returned the invalid blocks completely unreliable.\n   */\n  validateFn?(block: Uint8Array): Promise<void>\n}\n\nexport interface BlockAnnounceOptions <ProgressEvents extends ProgressEvent<any, any> = ProgressEvent<any, any>> extends AbortOptions, ProgressOptions<ProgressEvents> {\n\n}\n\nexport interface CreateSessionOptions <ProgressEvents extends ProgressEvent<any, any> = ProgressEvent<any, any>> extends AbortOptions, ProgressOptions<ProgressEvents> {\n  /**\n   * The minimum number of providers for the root CID that are required for\n   * successful session creation.\n   *\n   * The session will become usable once this many providers have been\n   * discovered, up to `maxProviders` providers will continue to be added.\n   *\n   * @default 1\n   */\n  minProviders?: number\n\n  /**\n   * The maximum number of providers for the root CID to be added to a session.\n   *\n   * @default 5\n   */\n  maxProviders?: number\n}\n\nexport interface BlockBroker<RetrieveProgressEvents extends ProgressEvent<any, any> = ProgressEvent<any, any>, AnnounceProgressEvents extends ProgressEvent<any, any> = ProgressEvent<any, any>> {\n  /**\n   * Retrieve a block from a source\n   */\n  retrieve?(cid: CID, options?: BlockRetrievalOptions<RetrieveProgressEvents>): Promise<Uint8Array>\n\n  /**\n   * Make a new block available to peers\n   */\n  announce?(cid: CID, block: Uint8Array, options?: BlockAnnounceOptions<AnnounceProgressEvents>): Promise<void>\n\n  /**\n   * Create a new session\n   */\n  createSession?(options?: CreateSessionOptions<RetrieveProgressEvents>): BlockBroker<RetrieveProgressEvents, AnnounceProgressEvents>\n}\n\nexport const DEFAULT_SESSION_MIN_PROVIDERS = 1\nexport const DEFAULT_SESSION_MAX_PROVIDERS = 5\n", "export class InsufficientProvidersError extends Error {\n  static name = 'InsufficientProvidersError'\n\n  constructor (message = 'Insufficient providers found') {\n    super(message)\n    this.name = 'InsufficientProvidersError'\n  }\n}\n\nexport class NoRoutersAvailableError extends Error {\n  static name = 'NoRoutersAvailableError'\n\n  constructor (message = 'No routers available') {\n    super(message)\n    this.name = 'NoRoutersAvailableError'\n  }\n}\n\nexport class UnknownHashAlgorithmError extends Error {\n  static name = 'UnknownHashAlgorithmError'\n\n  constructor (message = 'Unknown hash algorithm') {\n    super(message)\n    this.name = 'UnknownHashAlgorithmError'\n  }\n}\n\nexport class UnknownCodecError extends Error {\n  static name = 'UnknownCodecError'\n\n  constructor (message = 'Unknown codec') {\n    super(message)\n    this.name = 'UnknownCodecError'\n  }\n}\n", "import { NoRoutersAvailableError } from '@helia/interface'\nimport { NotFoundError, start, stop } from '@libp2p/interface'\nimport { PeerQueue } from '@libp2p/utils/peer-queue'\nimport merge from 'it-merge'\nimport type { Routing as RoutingInterface, Provider, RoutingOptions } from '@helia/interface'\nimport type { AbortOptions, ComponentLogger, Logger, Metrics, PeerId, PeerInfo, Startable } from '@libp2p/interface'\nimport type { CID } from 'multiformats/cid'\n\nconst DEFAULT_PROVIDER_LOOKUP_CONCURRENCY = 5\n\nexport interface RoutingInit {\n  routers: Array<Partial<RoutingInterface>>\n  providerLookupConcurrency?: number\n}\n\nexport interface RoutingComponents {\n  logger: ComponentLogger\n  metrics?: Metrics\n}\n\nexport class Routing implements RoutingInterface, Startable {\n  private readonly log: Logger\n  private readonly routers: Array<Partial<RoutingInterface>>\n  private readonly providerLookupConcurrency: number\n\n  constructor (components: RoutingComponents, init: RoutingInit) {\n    this.log = components.logger.forComponent('helia:routing')\n    this.routers = init.routers ?? []\n    this.providerLookupConcurrency = init.providerLookupConcurrency ?? DEFAULT_PROVIDER_LOOKUP_CONCURRENCY\n\n    this.findProviders = components.metrics?.traceFunction('helia.routing.findProviders', this.findProviders.bind(this), {\n      optionsIndex: 1\n    }) ?? this.findProviders\n    this.provide = components.metrics?.traceFunction('helia.routing.provide', this.provide.bind(this), {\n      optionsIndex: 1\n    }) ?? this.provide\n    this.cancelReprovide = components.metrics?.traceFunction('helia.routing.cancelReprovide', this.cancelReprovide.bind(this), {\n      optionsIndex: 1\n    }) ?? this.cancelReprovide\n    this.put = components.metrics?.traceFunction('helia.routing.put', this.put.bind(this), {\n      optionsIndex: 2\n    }) ?? this.put\n    this.get = components.metrics?.traceFunction('helia.routing.get', this.get.bind(this), {\n      optionsIndex: 1\n    }) ?? this.get\n    this.findPeer = components.metrics?.traceFunction('helia.routing.findPeer', this.findPeer.bind(this), {\n      optionsIndex: 1\n    }) ?? this.findPeer\n    this.getClosestPeers = components.metrics?.traceFunction('helia.routing.getClosestPeers', this.getClosestPeers.bind(this), {\n      optionsIndex: 1\n    }) ?? this.getClosestPeers\n  }\n\n  async start (): Promise<void> {\n    await start(...this.routers)\n  }\n\n  async stop (): Promise<void> {\n    await stop(...this.routers)\n  }\n\n  /**\n   * Iterates over all content routers in parallel to find providers of the\n   * given key\n   */\n  async * findProviders (key: CID, options: RoutingOptions = {}): AsyncIterable<Provider> {\n    if (this.routers.length === 0) {\n      throw new NoRoutersAvailableError('No content routers available')\n    }\n\n    // provider multiaddrs are only cached for a limited time, so they can come\n    // back as an empty array - when this happens we have to do a FIND_PEER\n    // query to get updated addresses, but we shouldn't block on this so use a\n    // separate bounded queue to perform this lookup\n    const queue = new PeerQueue<Provider | null>({\n      concurrency: this.providerLookupConcurrency\n    })\n    queue.addEventListener('error', () => {})\n\n    for await (const peer of merge(\n      queue.toGenerator(),\n      ...supports(this.routers, 'findProviders')\n        .map(router => router.findProviders(key, options))\n    )) {\n      // the peer was yielded by a content router without multiaddrs and we\n      // failed to load them\n      if (peer == null) {\n        continue\n      }\n\n      // have to refresh peer info for this peer to get updated multiaddrs\n      if (peer.multiaddrs.length === 0) {\n        // already looking this peer up\n        if (queue.find(peer.id) != null) {\n          continue\n        }\n\n        queue.add(async () => {\n          try {\n            const provider = await this.findPeer(peer.id, options)\n\n            if (provider.multiaddrs.length === 0) {\n              return null\n            }\n\n            return provider\n          } catch (err) {\n            this.log.error('could not load multiaddrs for peer %p', peer.id, err)\n            return null\n          }\n        }, {\n          peerId: peer.id,\n          signal: options.signal\n        })\n          .catch(err => {\n            this.log.error('could not load multiaddrs for peer %p', peer.id, err)\n          })\n      }\n\n      yield peer\n    }\n  }\n\n  /**\n   * Iterates over all content routers in parallel to notify it is\n   * a provider of the given key\n   */\n  async provide (key: CID, options: AbortOptions = {}): Promise<void> {\n    if (this.routers.length === 0) {\n      throw new NoRoutersAvailableError('No content routers available')\n    }\n\n    await Promise.all(\n      supports(this.routers, 'provide')\n        .map(async (router) => {\n          await router.provide(key, options)\n        })\n    )\n  }\n\n  async cancelReprovide (key: CID, options: AbortOptions = {}): Promise<void> {\n    await Promise.all(\n      supports(this.routers, 'cancelReprovide')\n        .map(async (router) => {\n          await router.cancelReprovide(key, options)\n        })\n    )\n  }\n\n  /**\n   * Store the given key/value pair in the available content routings\n   */\n  async put (key: Uint8Array, value: Uint8Array, options?: AbortOptions): Promise<void> {\n    await Promise.all(\n      supports(this.routers, 'put')\n        .map(async (router) => {\n          await router.put(key, value, options)\n        })\n    )\n  }\n\n  /**\n   * Get the value to the given key.\n   * Times out after 1 minute by default.\n   */\n  async get (key: Uint8Array, options?: AbortOptions): Promise<Uint8Array> {\n    return Promise.any(\n      supports(this.routers, 'get')\n        .map(async (router) => {\n          return router.get(key, options)\n        })\n    )\n  }\n\n  /**\n   * Iterates over all peer routers in parallel to find the given peer\n   */\n  async findPeer (id: PeerId, options?: RoutingOptions): Promise<PeerInfo> {\n    if (this.routers.length === 0) {\n      throw new NoRoutersAvailableError('No peer routers available')\n    }\n\n    const self = this\n    const source = merge(\n      ...supports(this.routers, 'findPeer')\n        .map(router => (async function * () {\n          try {\n            yield await router.findPeer(id, options)\n          } catch (err) {\n            self.log.error(err)\n          }\n        })())\n    )\n\n    for await (const peer of source) {\n      if (peer == null) {\n        continue\n      }\n\n      return peer\n    }\n\n    throw new NotFoundError('Could not find peer in routing')\n  }\n\n  /**\n   * Attempt to find the closest peers on the network to the given key\n   */\n  async * getClosestPeers (key: Uint8Array, options: RoutingOptions = {}): AsyncIterable<PeerInfo> {\n    if (this.routers.length === 0) {\n      throw new NoRoutersAvailableError('No peer routers available')\n    }\n\n    for await (const peer of merge(\n      ...supports(this.routers, 'getClosestPeers')\n        .map(router => router.getClosestPeers(key, options))\n    )) {\n      if (peer == null) {\n        continue\n      }\n\n      yield peer\n    }\n  }\n}\n\nfunction supports <Operation extends keyof Routing> (routers: any[], key: Operation): Array<Pick<Routing, Operation>> {\n  return routers.filter(router => router[key] != null)\n}\n", "import { start, stop } from '@libp2p/interface'\nimport createMortice from 'mortice'\nimport type { Blocks, Pair, DeleteManyBlocksProgressEvents, DeleteBlockProgressEvents, GetBlockProgressEvents, GetManyBlocksProgressEvents, PutManyBlocksProgressEvents, PutBlockProgressEvents, GetAllBlocksProgressEvents, GetOfflineOptions, SessionBlockstore } from '@helia/interface/blocks'\nimport type { Pins } from '@helia/interface/pins'\nimport type { AbortOptions, Startable } from '@libp2p/interface'\nimport type { Blockstore } from 'interface-blockstore'\nimport type { AwaitIterable } from 'interface-store'\nimport type { Mortice } from 'mortice'\nimport type { CID } from 'multiformats/cid'\nimport type { ProgressOptions } from 'progress-events'\n\nexport interface BlockStorageInit {\n  holdGcLock?: boolean\n}\n\nexport interface GetOptions extends AbortOptions {\n  progress?(evt: Event): void\n}\n\n/**\n * BlockStorage is a hybrid blockstore that puts/gets blocks from a configured\n * blockstore (that may be on disk, s3, or something else). If the blocks are\n * not present Bitswap will be used to fetch them from network peers.\n */\nexport class BlockStorage implements Blocks, Startable {\n  public lock: Mortice\n  private readonly child: Blocks\n  private readonly pins: Pins\n  private started: boolean\n\n  /**\n   * Create a new BlockStorage\n   */\n  constructor (blockstore: Blocks, pins: Pins, options: BlockStorageInit = {}) {\n    this.child = blockstore\n    this.pins = pins\n    this.lock = createMortice({\n      singleProcess: options.holdGcLock\n    })\n    this.started = false\n  }\n\n  isStarted (): boolean {\n    return this.started\n  }\n\n  async start (): Promise<void> {\n    await start(this.child)\n    this.started = true\n  }\n\n  async stop (): Promise<void> {\n    await stop(this.child)\n    this.started = false\n  }\n\n  unwrap (): Blockstore {\n    return this.child\n  }\n\n  /**\n   * Put a block to the underlying datastore\n   */\n  async put (cid: CID, block: Uint8Array, options: AbortOptions & ProgressOptions<PutBlockProgressEvents> = {}): Promise<CID> {\n    options?.signal?.throwIfAborted()\n    const releaseLock = await this.lock.readLock()\n\n    try {\n      return await this.child.put(cid, block, options)\n    } finally {\n      releaseLock()\n    }\n  }\n\n  /**\n   * Put a multiple blocks to the underlying datastore\n   */\n  async * putMany (blocks: AwaitIterable<{ cid: CID, block: Uint8Array }>, options: AbortOptions & ProgressOptions<PutManyBlocksProgressEvents> = {}): AsyncIterable<CID> {\n    options?.signal?.throwIfAborted()\n    const releaseLock = await this.lock.readLock()\n\n    try {\n      yield * this.child.putMany(blocks, options)\n    } finally {\n      releaseLock()\n    }\n  }\n\n  /**\n   * Get a block by cid\n   */\n  async get (cid: CID, options: GetOfflineOptions & AbortOptions & ProgressOptions<GetBlockProgressEvents> = {}): Promise<Uint8Array> {\n    options?.signal?.throwIfAborted()\n    const releaseLock = await this.lock.readLock()\n\n    try {\n      return await this.child.get(cid, options)\n    } finally {\n      releaseLock()\n    }\n  }\n\n  /**\n   * Get multiple blocks back from an (async) iterable of cids\n   */\n  async * getMany (cids: AwaitIterable<CID>, options: GetOfflineOptions & AbortOptions & ProgressOptions<GetManyBlocksProgressEvents> = {}): AsyncIterable<Pair> {\n    options?.signal?.throwIfAborted()\n    const releaseLock = await this.lock.readLock()\n\n    try {\n      yield * this.child.getMany(cids, options)\n    } finally {\n      releaseLock()\n    }\n  }\n\n  /**\n   * Delete a block from the blockstore\n   */\n  async delete (cid: CID, options: AbortOptions & ProgressOptions<DeleteBlockProgressEvents> = {}): Promise<void> {\n    options?.signal?.throwIfAborted()\n    const releaseLock = await this.lock.writeLock()\n\n    try {\n      if (await this.pins.isPinned(cid)) {\n        throw new Error('CID was pinned')\n      }\n\n      await this.child.delete(cid, options)\n    } finally {\n      releaseLock()\n    }\n  }\n\n  /**\n   * Delete multiple blocks from the blockstore\n   */\n  async * deleteMany (cids: AwaitIterable<CID>, options: AbortOptions & ProgressOptions<DeleteManyBlocksProgressEvents> = {}): AsyncIterable<CID> {\n    options?.signal?.throwIfAborted()\n    const releaseLock = await this.lock.writeLock()\n\n    try {\n      const storage = this\n\n      yield * this.child.deleteMany((async function * (): AsyncGenerator<CID> {\n        for await (const cid of cids) {\n          if (await storage.pins.isPinned(cid)) {\n            throw new Error('CID was pinned')\n          }\n\n          yield cid\n        }\n      }()), options)\n    } finally {\n      releaseLock()\n    }\n  }\n\n  async has (cid: CID, options: AbortOptions = {}): Promise<boolean> {\n    options?.signal?.throwIfAborted()\n    const releaseLock = await this.lock.readLock()\n\n    try {\n      return await this.child.has(cid, options)\n    } finally {\n      releaseLock()\n    }\n  }\n\n  async * getAll (options: AbortOptions & ProgressOptions<GetAllBlocksProgressEvents> = {}): AsyncIterable<Pair> {\n    options?.signal?.throwIfAborted()\n    const releaseLock = await this.lock.readLock()\n\n    try {\n      yield * this.child.getAll(options)\n    } finally {\n      releaseLock()\n    }\n  }\n\n  createSession (root: CID, options?: AbortOptions): SessionBlockstore {\n    options?.signal?.throwIfAborted()\n    return this.child.createSession(root, options)\n  }\n}\n", "import { type Datastore, Key } from 'interface-datastore'\nimport { fromString as uint8ArrayFromString } from 'uint8arrays/from-string'\nimport { toString as uint8ArrayToString } from 'uint8arrays/to-string'\n\nconst DS_VERSION_KEY = new Key('/version')\nconst CURRENT_VERSION = 1\n\nexport async function assertDatastoreVersionIsCurrent (datastore: Datastore): Promise<void> {\n  if (!(await datastore.has(DS_VERSION_KEY))) {\n    await datastore.put(DS_VERSION_KEY, uint8ArrayFromString(`${CURRENT_VERSION}`))\n\n    return\n  }\n\n  const buf = await datastore.get(DS_VERSION_KEY)\n  const str = uint8ArrayToString(buf)\n  const version = parseInt(str, 10)\n\n  if (version !== CURRENT_VERSION) {\n    // TODO: write migrations when we break compatibility - for an example, see https://github.com/ipfs/js-ipfs-repo/tree/master/packages/ipfs-repo-migrations\n    throw new Error('Unknown datastore version, a datastore migration may be required')\n  }\n}\n", "export function isPromise <T> (p?: any): p is Promise<T> {\n  return p?.then != null\n}\n", "/* eslint max-depth: [\"error\", 7] */\n\nimport { UnknownCodecError } from '@helia/interface'\nimport * as dagCbor from '@ipld/dag-cbor'\nimport * as dagJson from '@ipld/dag-json'\nimport * as dagPb from '@ipld/dag-pb'\nimport * as json from 'multiformats/codecs/json'\nimport * as raw from 'multiformats/codecs/raw'\nimport { isPromise } from './is-promise.js'\nimport type { Await } from '@helia/interface'\nimport type { BlockCodec } from 'multiformats/codecs/interface'\n\nexport function getCodec <T = any, Code extends number = any> (initialCodecs: Array<BlockCodec<any, any>> = [], loadCodec?: (code: number) => Await<BlockCodec<any, any>>): (code: Code) => Await<BlockCodec<Code, T>> {\n  const codecs: Record<number, BlockCodec<any, any>> = {\n    [dagPb.code]: dagPb,\n    [raw.code]: raw,\n    [dagCbor.code]: dagCbor,\n    [dagJson.code]: dagJson,\n    [json.code]: json\n  }\n\n  initialCodecs.forEach(codec => {\n    codecs[codec.code] = codec\n  })\n\n  return async (code) => {\n    let codec = codecs[code]\n\n    if (codec == null && loadCodec != null) {\n      const res = loadCodec(code)\n\n      if (isPromise(res)) {\n        codec = await res\n      } else {\n        codec = res\n      }\n\n      codecs[codec.code] = codec\n    }\n\n    if (codec != null) {\n      return codec\n    }\n\n    throw new UnknownCodecError(`Could not load codec for ${code}`)\n  }\n}\n", "import { UnknownHashAlgorithmError } from '@helia/interface'\nimport { identity } from 'multiformats/hashes/identity'\nimport { sha256, sha512 } from 'multiformats/hashes/sha2'\nimport { isPromise } from './is-promise.js'\nimport type { Await } from '@helia/interface'\nimport type { MultihashHasher } from 'multiformats/hashes/interface'\n\nexport function getHasher (initialHashers: MultihashHasher[] = [], loadHasher?: (code: number) => Await<MultihashHasher>): (code: number) => Await<MultihashHasher> {\n  const hashers: Record<number, MultihashHasher> = {\n    [sha256.code]: sha256,\n    [sha512.code]: sha512,\n    [identity.code]: identity\n  }\n\n  initialHashers.forEach(hasher => {\n    hashers[hasher.code] = hasher\n  })\n\n  return async (code) => {\n    let hasher = hashers[code]\n\n    if (hasher == null && loadHasher != null) {\n      const res = loadHasher(code)\n\n      if (isPromise(res)) {\n        hasher = await res\n      } else {\n        hasher = res\n      }\n\n      hashers[hasher.code] = hasher\n    }\n\n    if (hasher != null) {\n      return hasher\n    }\n\n    throw new UnknownHashAlgorithmError(`No hasher configured for multihash code 0x${code.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`)\n  }\n}\n", "import type { Blockstore, Pair } from 'interface-blockstore'\nimport type { AbortOptions, Await, AwaitIterable } from 'interface-store'\nimport type { CID } from 'multiformats/cid'\n\nexport class BaseBlockstore implements Blockstore {\n  has (key: CID, options?: AbortOptions): Await<boolean> {\n    return Promise.reject(new Error('.has is not implemented'))\n  }\n\n  put (key: CID, val: Uint8Array, options?: AbortOptions): Await<CID> {\n    return Promise.reject(new Error('.put is not implemented'))\n  }\n\n  async * putMany (source: AwaitIterable<Pair>, options?: AbortOptions): AwaitIterable<CID> {\n    for await (const { cid, block } of source) {\n      await this.put(cid, block, options)\n      yield cid\n    }\n  }\n\n  get (key: CID, options?: AbortOptions): Await<Uint8Array> {\n    return Promise.reject(new Error('.get is not implemented'))\n  }\n\n  async * getMany (source: AwaitIterable<CID>, options?: AbortOptions): AwaitIterable<Pair> {\n    for await (const key of source) {\n      yield {\n        cid: key,\n        block: await this.get(key, options)\n      }\n    }\n  }\n\n  delete (key: CID, options?: AbortOptions): Await<void> {\n    return Promise.reject(new Error('.delete is not implemented'))\n  }\n\n  async * deleteMany (source: AwaitIterable<CID>, options?: AbortOptions): AwaitIterable<CID> {\n    for await (const key of source) {\n      await this.delete(key, options)\n      yield key\n    }\n  }\n\n  /**\n   * Extending classes should override `query` or implement this method\n   */\n  async * getAll (options?: AbortOptions): AwaitIterable<Pair> { // eslint-disable-line require-yield\n    throw new Error('.getAll is not implemented')\n  }\n}\n", "import { NotFoundError } from 'interface-store'\nimport { BaseBlockstore } from './base.js'\nimport type { Blockstore, Pair } from 'interface-blockstore'\nimport type { AbortOptions, Await, AwaitIterable } from 'interface-store'\nimport type { CID } from 'multiformats/cid'\n\n// https://github.com/multiformats/multicodec/blob/d06fc6194710e8909bac64273c43f16b56ca4c34/table.csv#L2\nconst IDENTITY_CODEC = 0x00\n\nexport class IdentityBlockstore extends BaseBlockstore {\n  private readonly child?: Blockstore\n\n  constructor (child?: Blockstore) {\n    super()\n\n    this.child = child\n  }\n\n  put (key: CID, block: Uint8Array): Await<CID> {\n    if (key.multihash.code === IDENTITY_CODEC) {\n      return key\n    }\n\n    if (this.child == null) {\n      return key\n    }\n\n    return this.child.put(key, block)\n  }\n\n  get (key: CID): Await<Uint8Array> {\n    if (key.multihash.code === IDENTITY_CODEC) {\n      return key.multihash.digest\n    }\n\n    if (this.child == null) {\n      throw new NotFoundError()\n    }\n\n    return this.child.get(key)\n  }\n\n  has (key: CID): Await<boolean> {\n    if (key.multihash.code === IDENTITY_CODEC) {\n      return true\n    }\n\n    if (this.child == null) {\n      return false\n    }\n\n    return this.child.has(key)\n  }\n\n  delete (key: CID): Await<void> {\n    if (key.code === IDENTITY_CODEC) {\n      return\n    }\n\n    if (this.child != null) {\n      return this.child.delete(key)\n    }\n  }\n\n  getAll (options?: AbortOptions): AwaitIterable<Pair> {\n    if (this.child != null) {\n      return this.child.getAll(options)\n    }\n\n    return []\n  }\n}\n", "import { InvalidMultihashError, InvalidParametersError, setMaxListeners, start, stop } from '@libp2p/interface'\nimport { anySignal } from 'any-signal'\nimport { IdentityBlockstore } from 'blockstore-core/identity'\nimport filter from 'it-filter'\nimport forEach from 'it-foreach'\nimport { CustomProgressEvent, type ProgressOptions } from 'progress-events'\nimport { equals as uint8ArrayEquals } from 'uint8arrays/equals'\nimport { isPromise } from './is-promise.js'\nimport type { HasherLoader } from '@helia/interface'\nimport type { BlockBroker, Blocks, Pair, DeleteManyBlocksProgressEvents, DeleteBlockProgressEvents, GetBlockProgressEvents, GetManyBlocksProgressEvents, PutManyBlocksProgressEvents, PutBlockProgressEvents, GetAllBlocksProgressEvents, GetOfflineOptions, BlockRetrievalOptions, CreateSessionOptions, SessionBlockstore } from '@helia/interface/blocks'\nimport type { AbortOptions, ComponentLogger, Logger, LoggerOptions, Startable } from '@libp2p/interface'\nimport type { Blockstore } from 'interface-blockstore'\nimport type { AwaitIterable } from 'interface-store'\nimport type { CID } from 'multiformats/cid'\nimport type { MultihashDigest, MultihashHasher } from 'multiformats/hashes/interface'\n\nexport interface GetOptions extends AbortOptions {\n  progress?(evt: Event): void\n}\n\nexport interface StorageComponents {\n  blockstore: Blockstore\n  logger: ComponentLogger\n  blockBrokers: BlockBroker[]\n  getHasher: HasherLoader\n}\n\nclass Storage implements Blockstore {\n  protected readonly child: Blockstore\n  protected readonly getHasher: HasherLoader\n  protected log: Logger\n  protected readonly logger: ComponentLogger\n  protected readonly components: StorageComponents\n\n  /**\n   * Create a new BlockStorage\n   */\n  constructor (components: StorageComponents) {\n    this.log = components.logger.forComponent('helia:networked-storage')\n    this.logger = components.logger\n    this.components = components\n    this.child = new IdentityBlockstore(components.blockstore)\n    this.getHasher = components.getHasher\n  }\n\n  /**\n   * Put a block to the underlying datastore\n   */\n  async put (cid: CID, block: Uint8Array, options: AbortOptions & ProgressOptions<PutBlockProgressEvents> = {}): Promise<CID> {\n    if (await this.child.has(cid, options)) {\n      options.onProgress?.(new CustomProgressEvent<CID>('blocks:put:duplicate', cid))\n      return cid\n    }\n\n    options.onProgress?.(new CustomProgressEvent<CID>('blocks:put:providers:notify', cid))\n\n    await Promise.all(\n      this.components.blockBrokers.map(async broker => broker.announce?.(cid, block, options))\n    )\n\n    options.onProgress?.(new CustomProgressEvent<CID>('blocks:put:blockstore:put', cid))\n\n    return this.child.put(cid, block, options)\n  }\n\n  /**\n   * Put a multiple blocks to the underlying datastore\n   */\n  async * putMany (blocks: AwaitIterable<{ cid: CID, block: Uint8Array }>, options: AbortOptions & ProgressOptions<PutManyBlocksProgressEvents> = {}): AsyncIterable<CID> {\n    const missingBlocks = filter(blocks, async ({ cid }): Promise<boolean> => {\n      const has = await this.child.has(cid, options)\n\n      if (has) {\n        options.onProgress?.(new CustomProgressEvent<CID>('blocks:put-many:duplicate', cid))\n      }\n\n      return !has\n    })\n\n    const notifyEach = forEach(missingBlocks, async ({ cid, block }): Promise<void> => {\n      options.onProgress?.(new CustomProgressEvent<CID>('blocks:put-many:providers:notify', cid))\n      await Promise.all(\n        this.components.blockBrokers.map(async broker => broker.announce?.(cid, block, options))\n      )\n    })\n\n    options.onProgress?.(new CustomProgressEvent('blocks:put-many:blockstore:put-many'))\n    yield * this.child.putMany(notifyEach, options)\n  }\n\n  /**\n   * Get a block by cid\n   */\n  async get (cid: CID, options: GetOfflineOptions & AbortOptions & ProgressOptions<GetBlockProgressEvents> = {}): Promise<Uint8Array> {\n    if (options.offline !== true && !(await this.child.has(cid, options))) {\n      const hasher = await this.getHasher(cid.multihash.code)\n\n      // we do not have the block locally, get it from a block provider\n      options.onProgress?.(new CustomProgressEvent<CID>('blocks:get:providers:get', cid))\n      const block = await raceBlockRetrievers(cid, this.components.blockBrokers, hasher, {\n        ...options,\n        log: this.log\n      })\n      options.onProgress?.(new CustomProgressEvent<CID>('blocks:get:blockstore:put', cid))\n      await this.child.put(cid, block, options)\n\n      // notify other block providers of the new block\n      options.onProgress?.(new CustomProgressEvent<CID>('blocks:get:providers:notify', cid))\n      await Promise.all(\n        this.components.blockBrokers.map(async broker => broker.announce?.(cid, block, options))\n      )\n\n      return block\n    }\n\n    options.onProgress?.(new CustomProgressEvent<CID>('blocks:get:blockstore:get', cid))\n\n    return this.child.get(cid, options)\n  }\n\n  /**\n   * Get multiple blocks back from an (async) iterable of cids\n   */\n  async * getMany (cids: AwaitIterable<CID>, options: GetOfflineOptions & AbortOptions & ProgressOptions<GetManyBlocksProgressEvents> = {}): AsyncIterable<Pair> {\n    options.onProgress?.(new CustomProgressEvent('blocks:get-many:blockstore:get-many'))\n\n    yield * this.child.getMany(forEach(cids, async (cid): Promise<void> => {\n      if (options.offline !== true && !(await this.child.has(cid, options))) {\n        const hasher = await this.getHasher(cid.multihash.code)\n\n        // we do not have the block locally, get it from a block provider\n        options.onProgress?.(new CustomProgressEvent<CID>('blocks:get-many:providers:get', cid))\n        const block = await raceBlockRetrievers(cid, this.components.blockBrokers, hasher, {\n          ...options,\n          log: this.log\n        })\n        options.onProgress?.(new CustomProgressEvent<CID>('blocks:get-many:blockstore:put', cid))\n        await this.child.put(cid, block, options)\n\n        // notify other block providers of the new block\n        options.onProgress?.(new CustomProgressEvent<CID>('blocks:get-many:providers:notify', cid))\n        await Promise.all(\n          this.components.blockBrokers.map(async broker => broker.announce?.(cid, block, options))\n        )\n      }\n    }))\n  }\n\n  /**\n   * Delete a block from the blockstore\n   */\n  async delete (cid: CID, options: AbortOptions & ProgressOptions<DeleteBlockProgressEvents> = {}): Promise<void> {\n    options.onProgress?.(new CustomProgressEvent<CID>('blocks:delete:blockstore:delete', cid))\n\n    await this.child.delete(cid, options)\n  }\n\n  /**\n   * Delete multiple blocks from the blockstore\n   */\n  async * deleteMany (cids: AwaitIterable<CID>, options: AbortOptions & ProgressOptions<DeleteManyBlocksProgressEvents> = {}): AsyncIterable<CID> {\n    options.onProgress?.(new CustomProgressEvent('blocks:delete-many:blockstore:delete-many'))\n    yield * this.child.deleteMany((async function * (): AsyncGenerator<CID> {\n      for await (const cid of cids) {\n        yield cid\n      }\n    }()), options)\n  }\n\n  async has (cid: CID, options: AbortOptions = {}): Promise<boolean> {\n    return this.child.has(cid, options)\n  }\n\n  async * getAll (options: AbortOptions & ProgressOptions<GetAllBlocksProgressEvents> = {}): AwaitIterable<Pair> {\n    options.onProgress?.(new CustomProgressEvent('blocks:get-all:blockstore:get-many'))\n    yield * this.child.getAll(options)\n  }\n}\n\nexport type NetworkedStorageComponents = StorageComponents\n\n/**\n * Networked storage wraps a regular blockstore - when getting blocks if the\n * blocks are not present, the configured BlockBrokers will be used to fetch them.\n */\nexport class NetworkedStorage extends Storage implements Blocks, Startable {\n  private started: boolean\n\n  /**\n   * Create a new BlockStorage\n   */\n  constructor (components: NetworkedStorageComponents) {\n    super(components)\n\n    this.started = false\n  }\n\n  isStarted (): boolean {\n    return this.started\n  }\n\n  async start (): Promise<void> {\n    await start(this.child, ...this.components.blockBrokers)\n    this.started = true\n  }\n\n  async stop (): Promise<void> {\n    await stop(this.child, ...this.components.blockBrokers)\n    this.started = false\n  }\n\n  unwrap (): Blockstore {\n    return this.child\n  }\n\n  createSession (root: CID, options?: CreateSessionOptions): SessionBlockstore {\n    const blockBrokers = this.components.blockBrokers.map(broker => {\n      if (broker.createSession == null) {\n        return broker\n      }\n\n      return broker.createSession(options)\n    })\n\n    return new SessionStorage({\n      blockstore: this.child,\n      blockBrokers,\n      getHasher: this.getHasher,\n      logger: this.logger\n    }, {\n      root\n    })\n  }\n}\n\ninterface SessionStorageInit {\n  root: CID\n}\n\n/**\n * Storage subclass that can cancel any ongoing operation at any point.\n */\nclass SessionStorage extends Storage implements SessionBlockstore {\n  private readonly closeController: AbortController\n\n  constructor (components: StorageComponents, init: SessionStorageInit) {\n    super(components)\n\n    // because brokers are allowed to continue searching for providers after the\n    // session has been created, we need a way to tell them that the user has\n    // finished using the session any in-flight requests should be cancelled\n    this.closeController = new AbortController()\n    setMaxListeners(Infinity, this.closeController.signal)\n\n    this.log = components.logger.forComponent(`helia:session-storage:${init.root}`)\n  }\n\n  close (): void {\n    this.closeController.abort()\n  }\n\n  /**\n   * Put a block to the underlying datastore\n   */\n  async put (cid: CID, block: Uint8Array, options: AbortOptions & ProgressOptions<PutBlockProgressEvents> = {}): Promise<CID> {\n    const signal = anySignal([this.closeController.signal, options.signal])\n    setMaxListeners(Infinity, signal)\n\n    try {\n      return await super.put(cid, block, {\n        ...options,\n        signal\n      })\n    } finally {\n      signal.clear()\n    }\n  }\n\n  /**\n   * Put a multiple blocks to the underlying datastore\n   */\n  async * putMany (blocks: AwaitIterable<{ cid: CID, block: Uint8Array }>, options: AbortOptions & ProgressOptions<PutManyBlocksProgressEvents> = {}): AsyncIterable<CID> {\n    const signal = anySignal([this.closeController.signal, options.signal])\n    setMaxListeners(Infinity, signal)\n\n    try {\n      yield * super.putMany(blocks, {\n        ...options,\n        signal\n      })\n    } finally {\n      signal.clear()\n    }\n  }\n\n  /**\n   * Get a block by cid\n   */\n  async get (cid: CID, options: GetOfflineOptions & AbortOptions & ProgressOptions<GetBlockProgressEvents> = {}): Promise<Uint8Array> {\n    const signal = anySignal([this.closeController.signal, options.signal])\n    setMaxListeners(Infinity, signal)\n\n    try {\n      return await super.get(cid, {\n        ...options,\n        signal\n      })\n    } finally {\n      signal.clear()\n    }\n  }\n\n  /**\n   * Get multiple blocks back from an (async) iterable of cids\n   */\n  async * getMany (cids: AwaitIterable<CID>, options: GetOfflineOptions & AbortOptions & ProgressOptions<GetManyBlocksProgressEvents> = {}): AsyncIterable<Pair> {\n    const signal = anySignal([this.closeController.signal, options.signal])\n    setMaxListeners(Infinity, signal)\n\n    try {\n      yield * super.getMany(cids, {\n        ...options,\n        signal\n      })\n    } finally {\n      signal.clear()\n    }\n  }\n\n  /**\n   * Delete a block from the blockstore\n   */\n  async delete (cid: CID, options: AbortOptions & ProgressOptions<DeleteBlockProgressEvents> = {}): Promise<void> {\n    const signal = anySignal([this.closeController.signal, options.signal])\n    setMaxListeners(Infinity, signal)\n\n    try {\n      await super.delete(cid, {\n        ...options,\n        signal\n      })\n    } finally {\n      signal.clear()\n    }\n  }\n\n  /**\n   * Delete multiple blocks from the blockstore\n   */\n  async * deleteMany (cids: AwaitIterable<CID>, options: AbortOptions & ProgressOptions<DeleteManyBlocksProgressEvents> = {}): AsyncIterable<CID> {\n    const signal = anySignal([this.closeController.signal, options.signal])\n    setMaxListeners(Infinity, signal)\n\n    try {\n      yield * super.deleteMany(cids, {\n        ...options,\n        signal\n      })\n    } finally {\n      signal.clear()\n    }\n  }\n\n  async has (cid: CID, options: AbortOptions = {}): Promise<boolean> {\n    const signal = anySignal([this.closeController.signal, options.signal])\n    setMaxListeners(Infinity, signal)\n\n    try {\n      return await super.has(cid, {\n        ...options,\n        signal\n      })\n    } finally {\n      signal.clear()\n    }\n  }\n\n  async * getAll (options: AbortOptions & ProgressOptions<GetAllBlocksProgressEvents> = {}): AwaitIterable<Pair> {\n    const signal = anySignal([this.closeController.signal, options.signal])\n    setMaxListeners(Infinity, signal)\n\n    try {\n      yield * super.getAll({\n        ...options,\n        signal\n      })\n    } finally {\n      signal.clear()\n    }\n  }\n}\n\nfunction isRetrievingBlockBroker (broker: BlockBroker): broker is Required<Pick<BlockBroker, 'retrieve'>> {\n  return typeof broker.retrieve === 'function'\n}\n\nexport const getCidBlockVerifierFunction = (cid: CID, hasher: MultihashHasher): Required<BlockRetrievalOptions>['validateFn'] => {\n  if (hasher == null) {\n    throw new InvalidParametersError(`No hasher configured for multihash code 0x${cid.multihash.code.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`)\n  }\n\n  return async (block: Uint8Array): Promise<void> => {\n    // verify block\n    let hash: MultihashDigest<number>\n    const res = hasher.digest(block)\n\n    if (isPromise(res)) {\n      hash = await res\n    } else {\n      hash = res\n    }\n\n    if (!uint8ArrayEquals(hash.digest, cid.multihash.digest)) {\n      // if a hash mismatch occurs for a TrustlessGatewayBlockBroker, we should try another gateway\n      throw new InvalidMultihashError('Hash of downloaded block did not match multihash from passed CID')\n    }\n  }\n}\n\n/**\n * Race block providers cancelling any pending requests once the block has been\n * found.\n */\nasync function raceBlockRetrievers (cid: CID, blockBrokers: BlockBroker[], hasher: MultihashHasher, options: AbortOptions & LoggerOptions): Promise<Uint8Array> {\n  const validateFn = getCidBlockVerifierFunction(cid, hasher)\n\n  const controller = new AbortController()\n  const signal = anySignal([controller.signal, options.signal])\n  setMaxListeners(Infinity, controller.signal, signal)\n\n  const retrievers: Array<Required<Pick<BlockBroker, 'retrieve'>>> = []\n\n  for (const broker of blockBrokers) {\n    if (isRetrievingBlockBroker(broker)) {\n      retrievers.push(broker)\n    }\n  }\n\n  try {\n    return await Promise.any(\n      retrievers\n        .map(async retriever => {\n          try {\n            let blocksWereValidated = false\n            const block = await retriever.retrieve(cid, {\n              ...options,\n              signal,\n              validateFn: async (block: Uint8Array): Promise<void> => {\n                await validateFn(block)\n                blocksWereValidated = true\n              }\n            })\n\n            if (!blocksWereValidated) {\n              // the blockBroker either did not throw an error when attempting to validate the block\n              // or did not call the validateFn at all. We should validate the block ourselves\n              await validateFn(block)\n            }\n\n            return block\n          } catch (err) {\n            options.log.error('could not retrieve verified block for %c', cid, err)\n            throw err\n          }\n        })\n    )\n  } finally {\n    // we have the block from the fastest block retriever, abort any still\n    // in-flight retrieve attempts\n    controller.abort()\n    signal.clear()\n  }\n}\n", "import { DEFAULT_SESSION_MIN_PROVIDERS, DEFAULT_SESSION_MAX_PROVIDERS, InsufficientProvidersError } from '@helia/interface'\nimport { TypedEventEmitter, setMaxListeners } from '@libp2p/interface'\nimport { createScalableCuckooFilter } from '@libp2p/utils/filters'\nimport { Queue } from '@libp2p/utils/queue'\nimport { base64 } from 'multiformats/bases/base64'\nimport pDefer from 'p-defer'\nimport type { BlockBroker, BlockRetrievalOptions, CreateSessionOptions } from '@helia/interface'\nimport type { AbortOptions, ComponentLogger, Logger } from '@libp2p/interface'\nimport type { Filter } from '@libp2p/utils/filters'\nimport type { CID } from 'multiformats/cid'\nimport type { DeferredPromise } from 'p-defer'\nimport type { ProgressEvent } from 'progress-events'\n\nexport interface AbstractSessionComponents {\n  logger: ComponentLogger\n}\n\nexport interface AbstractCreateSessionOptions extends CreateSessionOptions {\n  name: string\n}\n\nexport interface BlockstoreSessionEvents<Provider> {\n  provider: CustomEvent<Provider>\n}\n\nexport abstract class AbstractSession<Provider, RetrieveBlockProgressEvents extends ProgressEvent> extends TypedEventEmitter<BlockstoreSessionEvents<Provider>> implements BlockBroker<RetrieveBlockProgressEvents> {\n  private intialPeerSearchComplete?: Promise<void>\n  private readonly requests: Map<string, Promise<Uint8Array>>\n  private readonly name: string\n  protected log: Logger\n  protected logger: ComponentLogger\n  private readonly minProviders: number\n  private readonly maxProviders: number\n  public readonly providers: Provider[]\n  private readonly evictionFilter: Filter\n\n  constructor (components: AbstractSessionComponents, init: AbstractCreateSessionOptions) {\n    super()\n\n    setMaxListeners(Infinity, this)\n    this.name = init.name\n    this.logger = components.logger\n    this.log = components.logger.forComponent(this.name)\n    this.requests = new Map()\n    this.minProviders = init.minProviders ?? DEFAULT_SESSION_MIN_PROVIDERS\n    this.maxProviders = init.maxProviders ?? DEFAULT_SESSION_MAX_PROVIDERS\n    this.providers = []\n    this.evictionFilter = createScalableCuckooFilter(this.maxProviders)\n  }\n\n  async retrieve (cid: CID, options: BlockRetrievalOptions<RetrieveBlockProgressEvents> = {}): Promise<Uint8Array> {\n    // see if we are already requesting this CID in this session\n    const cidStr = base64.encode(cid.multihash.bytes)\n    const existingJob = this.requests.get(cidStr)\n\n    if (existingJob != null) {\n      this.log('join existing request for %c', cid)\n      return existingJob\n    }\n\n    const deferred: DeferredPromise<Uint8Array> = pDefer()\n    this.requests.set(cidStr, deferred.promise)\n\n    if (this.providers.length === 0) {\n      let first = false\n\n      if (this.intialPeerSearchComplete == null) {\n        first = true\n        this.log = this.logger.forComponent(`${this.name}:${cid}`)\n        this.intialPeerSearchComplete = this.findProviders(cid, this.minProviders, options)\n      }\n\n      await this.intialPeerSearchComplete\n\n      if (first) {\n        this.log('found initial session peers for %c', cid)\n      }\n    }\n\n    let foundBlock = false\n\n    // this queue manages outgoing requests - as new peers are added to the\n    // session they will be added to the queue so we can request the current\n    // block from multiple peers as they are discovered\n    const queue = new Queue<Uint8Array, { provider: Provider, priority?: number } & AbortOptions>({\n      concurrency: this.maxProviders\n    })\n    queue.addEventListener('error', () => {})\n    queue.addEventListener('failure', (evt) => {\n      this.log.error('error querying provider %o, evicting from session', evt.detail.job.options.provider, evt.detail.error)\n      this.evict(evt.detail.job.options.provider)\n    })\n    queue.addEventListener('success', (evt) => {\n      // peer has sent block, return it to the caller\n      foundBlock = true\n      deferred.resolve(evt.detail.result)\n    })\n    queue.addEventListener('idle', () => {\n      if (foundBlock || options.signal?.aborted === true) {\n        // we either found the block or the user gave up\n        return\n      }\n\n      // find more session peers and retry\n      Promise.resolve()\n        .then(async () => {\n          this.log('no session peers had block for for %c, finding new providers', cid)\n\n          // evict this.minProviders random providers to make room for more\n          for (let i = 0; i < this.minProviders; i++) {\n            if (this.providers.length === 0) {\n              break\n            }\n\n            const provider = this.providers[Math.floor(Math.random() * this.providers.length)]\n            this.evict(provider)\n          }\n\n          // find new providers for the CID\n          await this.findProviders(cid, this.minProviders, options)\n\n          // keep trying until the abort signal fires\n          this.log('found new providers re-retrieving %c', cid)\n          this.requests.delete(cidStr)\n          deferred.resolve(await this.retrieve(cid, options))\n        })\n        .catch(err => {\n          this.log.error('could not find new providers for %c', cid, err)\n          deferred.reject(err)\n        })\n    })\n\n    const peerAddedToSessionListener = (event: CustomEvent<Provider>): void => {\n      queue.add(async () => {\n        return this.queryProvider(cid, event.detail, options)\n      }, {\n        provider: event.detail\n      })\n        .catch(err => {\n          if (options.signal?.aborted === true) {\n            // skip logging error if signal was aborted because abort can happen\n            // on success (e.g. another session found the block)\n            return\n          }\n\n          this.log.error('error retrieving session block for %c', cid, err)\n        })\n    }\n\n    // add new session peers to query as they are discovered\n    this.addEventListener('provider', peerAddedToSessionListener)\n\n    // query each session peer directly\n    Promise.all([...this.providers].map(async (provider) => {\n      return queue.add(async () => {\n        return this.queryProvider(cid, provider, options)\n      }, {\n        provider\n      })\n    }))\n      .catch(err => {\n        if (options.signal?.aborted === true) {\n          // skip logging error if signal was aborted because abort can happen\n          // on success (e.g. another session found the block)\n          return\n        }\n\n        this.log.error('error retrieving session block for %c', cid, err)\n      })\n\n    try {\n      return await deferred.promise\n    } finally {\n      this.removeEventListener('provider', peerAddedToSessionListener)\n      queue.clear()\n      this.requests.delete(cidStr)\n    }\n  }\n\n  evict (provider: Provider): void {\n    this.evictionFilter.add(this.toEvictionKey(provider))\n    const index = this.providers.findIndex(prov => this.equals(prov, provider))\n\n    if (index === -1) {\n      return\n    }\n\n    this.providers.splice(index, 1)\n  }\n\n  isEvicted (provider: Provider): boolean {\n    return this.evictionFilter.has(this.toEvictionKey(provider))\n  }\n\n  hasProvider (provider: Provider): boolean {\n    // dedupe existing gateways\n    if (this.providers.find(prov => this.equals(prov, provider)) != null) {\n      return true\n    }\n\n    // dedupe failed session peers\n    if (this.isEvicted(provider)) {\n      return true\n    }\n\n    return false\n  }\n\n  private async findProviders (cid: CID, count: number, options: AbortOptions): Promise<void> {\n    const deferred: DeferredPromise<void> = pDefer()\n    let found = 0\n\n    // run async to resolve the deferred promise when `count` providers are\n    // found but continue util this.providers reaches this.maxProviders\n    void Promise.resolve()\n      .then(async () => {\n        this.log('finding %d-%d new provider(s) for %c', count, this.maxProviders, cid)\n\n        for await (const provider of this.findNewProviders(cid, options)) {\n          if (found === this.maxProviders || options.signal?.aborted === true) {\n            break\n          }\n\n          if (this.hasProvider(provider)) {\n            continue\n          }\n\n          this.log('found %d/%d new providers', found, this.maxProviders)\n          this.providers.push(provider)\n\n          // let the new peer join current queries\n          this.safeDispatchEvent('provider', {\n            detail: provider\n          })\n\n          found++\n\n          if (found === count) {\n            this.log('session is ready')\n            deferred.resolve()\n            // continue finding peers until we reach this.maxProviders\n          }\n\n          if (this.providers.length === this.maxProviders) {\n            this.log('found max session peers', found)\n            break\n          }\n        }\n\n        this.log('found %d/%d new session peers', found, this.maxProviders)\n\n        if (found < count) {\n          throw new InsufficientProvidersError(`Found ${found} of ${count} ${this.name} providers for ${cid}`)\n        }\n      })\n      .catch(err => {\n        this.log.error('error searching routing for potential session peers for %c', cid, err.errors ?? err)\n        deferred.reject(err)\n      })\n\n    return deferred.promise\n  }\n\n  /**\n   * This method should search for new providers and yield them.\n   */\n  abstract findNewProviders (cid: CID, options: AbortOptions): AsyncGenerator<Provider>\n\n  /**\n   * The subclass should contact the provider and request the block from it.\n   *\n   * If the provider cannot provide the block an error should be thrown.\n   *\n   * The provider will then be excluded from ongoing queries.\n   */\n  abstract queryProvider (cid: CID, provider: Provider, options: AbortOptions): Promise<Uint8Array>\n\n  /**\n   * Turn a provider into a concise Uint8Array representation for use in a Bloom\n   * filter\n   */\n  abstract toEvictionKey (provider: Provider): Uint8Array | string\n\n  /**\n   * Return `true` if we consider one provider to be the same as another\n   */\n  abstract equals (providerA: Provider, providerB: Provider): boolean\n}\n", "/**\n * @packageDocumentation\n *\n * Exports a `Helia` class that implements the Helia API.\n *\n * In general you should use the `helia` or `@helia/http` modules instead which\n * pre-configure Helia for certain use-cases (p2p or pure-HTTP).\n *\n * @example\n *\n * ```typescript\n * import { Helia } from '@helia/utils'\n * import type { HeliaInit } from '@helia/utils'\n *\n * const node = new Helia({\n *   // ...options\n * } as HeliaInit)\n * ```\n */\n\nimport { contentRoutingSymbol, peerRoutingSymbol, start, stop } from '@libp2p/interface'\nimport { defaultLogger } from '@libp2p/logger'\nimport { dns } from '@multiformats/dns'\nimport drain from 'it-drain'\nimport { CustomProgressEvent } from 'progress-events'\nimport { PinsImpl } from './pins.js'\nimport { Routing as RoutingClass } from './routing.js'\nimport { BlockStorage } from './storage.js'\nimport { assertDatastoreVersionIsCurrent } from './utils/datastore-version.js'\nimport { getCodec } from './utils/get-codec.js'\nimport { getHasher } from './utils/get-hasher.js'\nimport { NetworkedStorage } from './utils/networked-storage.js'\nimport type { BlockStorageInit } from './storage.js'\nimport type { Await, CodecLoader, GCOptions, HasherLoader, Helia as HeliaInterface, Routing } from '@helia/interface'\nimport type { BlockBroker } from '@helia/interface/blocks'\nimport type { Pins } from '@helia/interface/pins'\nimport type { ComponentLogger, Logger, Metrics } from '@libp2p/interface'\nimport type { DNS } from '@multiformats/dns'\nimport type { Blockstore } from 'interface-blockstore'\nimport type { Datastore } from 'interface-datastore'\nimport type { BlockCodec } from 'multiformats'\nimport type { CID } from 'multiformats/cid'\nimport type { MultihashHasher } from 'multiformats/hashes/interface'\n\nexport { AbstractSession } from './abstract-session.js'\nexport type { AbstractCreateSessionOptions, BlockstoreSessionEvents, AbstractSessionComponents } from './abstract-session.js'\n\nexport type { BlockStorage, BlockStorageInit }\n\n/**\n * Options used to create a Helia node.\n */\nexport interface HeliaInit {\n  /**\n   * The blockstore is where blocks are stored\n   */\n  blockstore: Blockstore\n\n  /**\n   * The datastore is where data is stored\n   */\n  datastore: Datastore\n\n  /**\n   * By default sha256, sha512 and identity hashes are supported for\n   * bitswap operations. To bitswap blocks with CIDs using other hashes\n   * pass appropriate MultihashHashers here.\n   */\n  hashers?: MultihashHasher[]\n\n  /**\n   * An optional function that can load a MultihashHasher on demand. May return\n   * a promise.\n   */\n  loadHasher?(code: number): Await<MultihashHasher>\n\n  /**\n   * In order to pin CIDs that correspond to a DAG, it's necessary to know\n   * how to traverse that DAG.  DAGWalkers take a block and yield any CIDs\n   * encoded within that block.\n   */\n  codecs?: Array<BlockCodec<any, any>>\n\n  /**\n   * An optional function that can load a BlockCodec on demand. May return a\n   * promise.\n   */\n  loadCodec?(code: number): Await<BlockCodec<any, any>>\n\n  /**\n   * A list of strategies used to fetch blocks when they are not present in\n   * the local blockstore\n   */\n  blockBrokers: Array<(components: any) => BlockBroker>\n\n  /**\n   * Garbage collection requires preventing blockstore writes during searches\n   * for unpinned blocks as DAGs are typically pinned after they've been\n   * imported - without locking this could lead to the deletion of blocks while\n   * they are being added to the blockstore.\n   *\n   * By default this lock is held on the current process and other processes\n   * will contact this process for access.\n   *\n   * If Helia is being run in multiple processes, one process must hold the GC\n   * lock so use this option to control which process that is.\n   *\n   * @default true\n   */\n  holdGcLock?: boolean\n\n  /**\n   * An optional logging component to pass to libp2p. If not specified the\n   * default implementation from libp2p will be used.\n   */\n  logger?: ComponentLogger\n\n  /**\n   * Routers perform operations such as looking up content providers,\n   * information about network peers or getting/putting records.\n   */\n  routers?: Array<Partial<Routing>>\n\n  /**\n   * During provider lookups, peers can be returned from routing implementations\n   * with no multiaddrs.\n   *\n   * This can happen when they've been retrieved from network peers that only\n   * store multiaddrs for a limited amount of time.\n   *\n   * When this happens the peer's info has to be looked up with a further query.\n   *\n   * To not have this query block the yielding of other providers returned with\n   * multiaddrs, a separate queue is used to perform this lookup.\n   *\n   * This config value controls the concurrency of that queue.\n   *\n   * @default 5\n   */\n  providerLookupConcurrency?: number\n\n  /**\n   * Components used by subclasses\n   */\n  components?: Record<string, any>\n\n  /**\n   * An optional DNS implementation used to perform queries for DNS records.\n   */\n  dns?: DNS\n\n  /**\n   * A metrics object that can be used to collected arbitrary stats about node\n   * usage.\n   */\n  metrics?: Metrics\n}\n\ninterface Components {\n  blockstore: Blockstore\n  datastore: Datastore\n  logger: ComponentLogger\n  blockBrokers: BlockBroker[]\n  routing: Routing\n  dns: DNS\n  metrics?: Metrics\n  getCodec: CodecLoader\n  getHasher: HasherLoader\n}\n\nexport class Helia implements HeliaInterface {\n  public blockstore: BlockStorage\n  public datastore: Datastore\n  public pins: Pins\n  public logger: ComponentLogger\n  public routing: Routing\n  public getCodec: CodecLoader\n  public getHasher: HasherLoader\n  public dns: DNS\n  public metrics?: Metrics\n  private readonly log: Logger\n\n  constructor (init: HeliaInit) {\n    this.logger = init.logger ?? defaultLogger()\n    this.log = this.logger.forComponent('helia')\n    this.getHasher = getHasher(init.hashers, init.loadHasher)\n    this.getCodec = getCodec(init.codecs, init.loadCodec)\n    this.dns = init.dns ?? dns()\n    this.metrics = init.metrics\n\n    // @ts-expect-error routing is not set\n    const components: Components = {\n      blockstore: init.blockstore,\n      datastore: init.datastore,\n      logger: this.logger,\n      blockBrokers: [],\n      getHasher: this.getHasher,\n      getCodec: this.getCodec,\n      dns: this.dns,\n      metrics: this.metrics,\n      ...(init.components ?? {})\n    }\n\n    this.routing = components.routing = new RoutingClass(components, {\n      routers: (init.routers ?? []).flatMap((router: any) => {\n        // if the router itself is a router\n        const routers = [\n          router\n        ]\n\n        // if the router provides a libp2p-style ContentRouter\n        if (router[contentRoutingSymbol] != null) {\n          routers.push(router[contentRoutingSymbol])\n        }\n\n        // if the router provides a libp2p-style PeerRouter\n        if (router[peerRoutingSymbol] != null) {\n          routers.push(router[peerRoutingSymbol])\n        }\n\n        return routers\n      }),\n      providerLookupConcurrency: init.providerLookupConcurrency\n    })\n\n    const networkedStorage = new NetworkedStorage(components)\n    this.pins = new PinsImpl(init.datastore, networkedStorage, this.getCodec)\n    this.blockstore = new BlockStorage(networkedStorage, this.pins, {\n      holdGcLock: init.holdGcLock ?? true\n    })\n    this.datastore = init.datastore\n\n    components.blockBrokers = init.blockBrokers.map((fn) => {\n      return fn(components)\n    })\n  }\n\n  async start (): Promise<void> {\n    await assertDatastoreVersionIsCurrent(this.datastore)\n    await start(\n      this.blockstore,\n      this.datastore,\n      this.routing\n    )\n  }\n\n  async stop (): Promise<void> {\n    await stop(\n      this.blockstore,\n      this.datastore,\n      this.routing\n    )\n  }\n\n  async gc (options: GCOptions = {}): Promise<void> {\n    const releaseLock = await this.blockstore.lock.writeLock()\n\n    try {\n      const helia = this\n      const blockstore = this.blockstore.unwrap()\n\n      this.log('gc start')\n\n      await drain(blockstore.deleteMany((async function * (): AsyncGenerator<CID> {\n        for await (const { cid } of blockstore.getAll()) {\n          try {\n            if (await helia.pins.isPinned(cid, options)) {\n              continue\n            }\n\n            yield cid\n\n            options.onProgress?.(new CustomProgressEvent<CID>('helia:gc:deleted', cid))\n          } catch (err: any) {\n            helia.log.error('Error during gc', err)\n            options.onProgress?.(new CustomProgressEvent<Error>('helia:gc:error', err))\n          }\n        }\n      }())))\n    } finally {\n      releaseLock()\n    }\n\n    this.log('gc finished')\n  }\n}\n", "import { AbstractSession } from '@helia/utils'\nimport type { BitswapWantProgressEvents } from './index.js'\nimport type { Network } from './network.js'\nimport type { WantList } from './want-list.js'\nimport type { CreateSessionOptions } from '@helia/interface'\nimport type { ComponentLogger, PeerId } from '@libp2p/interface'\nimport type { AbortOptions } from 'interface-store'\nimport type { CID } from 'multiformats/cid'\n\nexport interface BitswapSessionComponents {\n  network: Network\n  wantList: WantList\n  logger: ComponentLogger\n}\n\nclass BitswapSession extends AbstractSession<PeerId, BitswapWantProgressEvents> {\n  private readonly wantList: WantList\n  private readonly network: Network\n\n  constructor (components: BitswapSessionComponents, init: CreateSessionOptions) {\n    super(components, {\n      ...init,\n      name: 'helia:bitswap:session'\n    })\n\n    this.wantList = components.wantList\n    this.network = components.network\n  }\n\n  async queryProvider (cid: CID, provider: PeerId, options: AbortOptions): Promise<Uint8Array> {\n    this.log('sending WANT-BLOCK for %c to %p', cid, provider)\n\n    const result = await this.wantList.wantSessionBlock(cid, provider, options)\n\n    this.log('%p %s %c', provider, result.has ? 'has' : 'does not have', cid)\n\n    if (result.has && result.block != null) {\n      return result.block\n    }\n\n    throw new Error('Provider did not have block')\n  }\n\n  async * findNewProviders (cid: CID, options: AbortOptions = {}): AsyncGenerator<PeerId> {\n    for await (const provider of this.network.findProviders(cid, options)) {\n      yield provider.id\n    }\n  }\n\n  toEvictionKey (provider: PeerId): Uint8Array | string {\n    return provider.toMultihash().bytes\n  }\n\n  equals (providerA: PeerId, providerB: PeerId): boolean {\n    return providerA.equals(providerB)\n  }\n}\n\nexport function createBitswapSession (components: BitswapSessionComponents, init: CreateSessionOptions): BitswapSession {\n  return new BitswapSession(components, init)\n}\n", "import type { Libp2p, MetricGroup, Metrics, PeerId } from '@libp2p/interface'\n\nexport interface StatsComponents {\n  libp2p: Libp2p\n  metrics?: Metrics\n}\n\nexport class Stats {\n  private readonly blocksReceived?: MetricGroup\n  private readonly duplicateBlocksReceived?: MetricGroup\n  private readonly dataReceived?: MetricGroup\n  private readonly duplicateDataReceived?: MetricGroup\n\n  constructor (components: StatsComponents) {\n    this.blocksReceived = components.metrics?.registerMetricGroup('helia_bitswap_received_blocks')\n    this.duplicateBlocksReceived = components.metrics?.registerMetricGroup('helia_bitswap_duplicate_received_blocks')\n    this.dataReceived = components.metrics?.registerMetricGroup('helia_bitswap_data_received_bytes')\n    this.duplicateDataReceived = components.metrics?.registerMetricGroup('helia_bitswap_duplicate_data_received_bytes')\n  }\n\n  updateBlocksReceived (count: number = 1, peerId?: PeerId): void {\n    const stats: Record<string, number | true> = {\n      global: count\n    }\n\n    if (peerId != null) {\n      stats[peerId.toString()] = count\n    }\n\n    this.blocksReceived?.increment(stats)\n  }\n\n  updateDuplicateBlocksReceived (count: number = 1, peerId?: PeerId): void {\n    const stats: Record<string, number | true> = {\n      global: count\n    }\n\n    if (peerId != null) {\n      stats[peerId.toString()] = count\n    }\n\n    this.duplicateBlocksReceived?.increment(stats)\n  }\n\n  updateDataReceived (bytes: number, peerId?: PeerId): void {\n    const stats: Record<string, number> = {\n      global: bytes\n    }\n\n    if (peerId != null) {\n      stats[peerId.toString()] = bytes\n    }\n\n    this.dataReceived?.increment(stats)\n  }\n\n  updateDuplicateDataReceived (bytes: number, peerId?: PeerId): void {\n    const stats: Record<string, number> = {\n      global: bytes\n    }\n\n    if (peerId != null) {\n      stats[peerId.toString()] = bytes\n    }\n\n    this.duplicateDataReceived?.increment(stats)\n  }\n}\n", "import { decode, encodingLength } from 'uint8-varint'\n\nfunction varintDecoder (buf: Uint8Array): number[] {\n  if (!(buf instanceof Uint8Array)) {\n    throw new Error('arg needs to be a Uint8Array')\n  }\n\n  const result: number[] = []\n\n  while (buf.length > 0) {\n    const num = decode(buf)\n    result.push(num)\n    buf = buf.slice(encodingLength(num))\n  }\n\n  return result\n}\n\nexport default varintDecoder\n", "import { TypedEventEmitter, setMaxListeners } from '@libp2p/interface'\nimport { trackedPeerMap } from '@libp2p/peer-collections'\nimport { trackedMap } from '@libp2p/utils/tracked-map'\nimport { CID } from 'multiformats/cid'\nimport { sha256 } from 'multiformats/hashes/sha2'\nimport pDefer from 'p-defer'\nimport { raceEvent } from 'race-event'\nimport { equals as uint8ArrayEquals } from 'uint8arrays/equals'\nimport { toString as uint8ArrayToString } from 'uint8arrays/to-string'\nimport { DEFAULT_MESSAGE_SEND_DELAY } from './constants.js'\nimport { BlockPresenceType, WantType } from './pb/message.js'\nimport { QueuedBitswapMessage } from './utils/bitswap-message.js'\nimport vd from './utils/varint-decoder.js'\nimport type { BitswapNotifyProgressEvents, MultihashHasherLoader } from './index.js'\nimport type { BitswapNetworkWantProgressEvents, Network } from './network.js'\nimport type { BitswapMessage } from './pb/message.js'\nimport type { ComponentLogger, PeerId, Startable, AbortOptions, Libp2p, TypedEventTarget, Metrics } from '@libp2p/interface'\nimport type { Logger } from '@libp2p/logger'\nimport type { PeerMap } from '@libp2p/peer-collections'\nimport type { DeferredPromise } from 'p-defer'\nimport type { ProgressOptions } from 'progress-events'\n\nexport interface WantListComponents {\n  network: Network\n  logger: ComponentLogger\n  libp2p: Libp2p\n  metrics?: Metrics\n}\n\nexport interface WantListInit {\n  sendMessagesDelay?: number\n  hashLoader?: MultihashHasherLoader\n}\n\nexport interface WantListEntry {\n  /**\n   * The CID we send to the remote\n   */\n  cid: CID\n\n  /**\n   * The priority with which the remote should return the block\n   */\n  priority: number\n\n  /**\n   * If we want the block or if we want the remote to tell us if they have the\n   * block - note if the block is small they'll send it to us anyway.\n   */\n  wantType: WantType\n\n  /**\n   * Whether we are cancelling the block want or not\n   */\n  cancel: boolean\n\n  /**\n   * Whether the remote should tell us if they have the block or not\n   */\n  sendDontHave: boolean\n}\n\nexport interface WantOptions extends AbortOptions, ProgressOptions<BitswapNetworkWantProgressEvents> {\n  /**\n   * Allow prioritising blocks\n   */\n  priority?: number\n}\n\nexport interface WantBlockResult {\n  sender: PeerId\n  cid: CID\n  block: Uint8Array\n}\n\nexport interface WantDontHaveResult {\n  sender: PeerId\n  cid: CID\n  has: false\n}\n\nexport interface WantHaveResult {\n  sender: PeerId\n  cid: CID\n  has: true\n  block?: Uint8Array\n}\n\nexport type WantPresenceResult = WantDontHaveResult | WantHaveResult\n\nexport interface WantListEvents {\n  block: CustomEvent<WantBlockResult>\n  presence: CustomEvent<WantPresenceResult>\n}\n\nexport class WantList extends TypedEventEmitter<WantListEvents> implements Startable, TypedEventTarget<WantListEvents> {\n  /**\n   * Tracks what CIDs we've previously sent to which peers\n   */\n  public readonly peers: PeerMap<Set<string>>\n  public readonly wants: Map<string, WantListEntry>\n  private readonly network: Network\n  private readonly log: Logger\n  private readonly sendMessagesDelay: number\n  private sendMessagesTimeout?: ReturnType<typeof setTimeout>\n  private readonly hashLoader?: MultihashHasherLoader\n  private sendingMessages?: DeferredPromise<void>\n\n  constructor (components: WantListComponents, init: WantListInit = {}) {\n    super()\n\n    setMaxListeners(Infinity, this)\n    this.peers = trackedPeerMap({\n      name: 'helia_bitswap_peers',\n      metrics: components.metrics\n    })\n    this.wants = trackedMap({\n      name: 'helia_bitswap_wantlist',\n      metrics: components.metrics\n    })\n    this.network = components.network\n    this.sendMessagesDelay = init.sendMessagesDelay ?? DEFAULT_MESSAGE_SEND_DELAY\n    this.log = components.logger.forComponent('helia:bitswap:wantlist')\n    this.hashLoader = init.hashLoader\n\n    this.network.addEventListener('bitswap:message', (evt) => {\n      this.receiveMessage(evt.detail.peer, evt.detail.message)\n        .catch(err => {\n          this.log.error('error receiving bitswap message from %p', evt.detail.peer, err)\n        })\n    })\n    this.network.addEventListener('peer:connected', evt => {\n      this.peerConnected(evt.detail)\n        .catch(err => {\n          this.log.error('error processing newly connected bitswap peer %p', evt.detail, err)\n        })\n    })\n    this.network.addEventListener('peer:disconnected', evt => {\n      this.peerDisconnected(evt.detail)\n    })\n  }\n\n  private async addEntry (cid: CID, options: WantOptions & { wantType: WantType.WantBlock }): Promise<WantBlockResult>\n  private async addEntry (cid: CID, options: WantOptions & { wantType: WantType.WantHave }): Promise<WantPresenceResult>\n  private async addEntry (cid: CID, options: WantOptions & { wantType: WantType }): Promise<WantBlockResult | WantPresenceResult> {\n    const cidStr = uint8ArrayToString(cid.multihash.bytes, 'base64')\n    let entry = this.wants.get(cidStr)\n\n    if (entry == null) {\n      entry = {\n        cid,\n        priority: options.priority ?? 1,\n        wantType: options.wantType ?? WantType.WantBlock,\n        cancel: false,\n        sendDontHave: true\n      }\n\n      this.wants.set(cidStr, entry)\n    }\n\n    // upgrade want-have to want-block if the new want is a WantBlock but the\n    // previous want was a WantHave\n    if (entry.wantType === WantType.WantHave && options.wantType === WantType.WantBlock) {\n      entry.wantType = WantType.WantBlock\n    }\n\n    // broadcast changes\n    await this.sendMessagesDebounced()\n\n    try {\n      if (options.wantType === WantType.WantBlock) {\n        const event = await raceEvent<CustomEvent<WantBlockResult>>(this, 'block', options?.signal, {\n          filter: (event) => {\n            return uint8ArrayEquals(cid.multihash.digest, event.detail.cid.multihash.digest)\n          },\n          errorMessage: 'Want was aborted'\n        })\n\n        return event.detail\n      }\n\n      const event = await raceEvent<CustomEvent<WantPresenceResult>>(this, 'presence', options?.signal, {\n        filter: (event) => {\n          return uint8ArrayEquals(cid.multihash.digest, event.detail.cid.multihash.digest)\n        },\n        errorMessage: 'Want was aborted'\n      })\n\n      return event.detail\n    } finally {\n      if (options.signal?.aborted === true) {\n        this.log('want for %c was aborted, cancelling want', cid)\n        entry.cancel = true\n        // broadcast changes\n        await this.sendMessagesDebounced()\n      }\n    }\n  }\n\n  private async sendMessagesDebounced (): Promise<void> {\n    await this.sendingMessages?.promise\n\n    // broadcast changes\n    clearTimeout(this.sendMessagesTimeout)\n    this.sendMessagesTimeout = setTimeout(() => {\n      void this.sendMessages()\n        .catch(err => {\n          this.log('error sending messages to peers', err)\n        })\n    }, this.sendMessagesDelay)\n  }\n\n  private async sendMessages (): Promise<void> {\n    this.sendingMessages = pDefer()\n\n    await Promise.all(\n      [...this.peers.entries()].map(async ([peerId, sentWants]) => {\n        const sent = new Set<string>()\n        const message = new QueuedBitswapMessage()\n\n        for (const [key, entry] of this.wants.entries()) {\n          const sentPreviously = sentWants.has(key)\n\n          // only send if either we've not sent it before, or we haven't sent it\n          // but we're also cancelling the want.\n          if (sentPreviously || entry.cancel) {\n            continue\n          }\n\n          sent.add(key)\n\n          message.addWantlistEntry(entry.cid, {\n            cid: entry.cid.bytes,\n            priority: entry.priority,\n            wantType: entry.wantType,\n            cancel: entry.cancel,\n            sendDontHave: entry.sendDontHave\n          })\n        }\n\n        if (message.wantlist.size === 0) {\n          return\n        }\n\n        // add message to send queue\n        try {\n          await this.network.sendMessage(peerId, message)\n\n          // update list of messages sent to remote\n          for (const key of sent) {\n            sentWants.add(key)\n          }\n        } catch (err: any) {\n          this.log.error('error sending full wantlist to new peer', err)\n        }\n      })\n    ).catch(err => {\n      this.log.error('error sending messages', err)\n    })\n\n    // queued all message sends, remove cancelled wants from wantlist and sent\n    // wants\n    for (const [key, entry] of this.wants) {\n      if (entry.cancel) {\n        this.wants.delete(key)\n\n        for (const sentWants of this.peers.values()) {\n          sentWants.delete(key)\n        }\n      }\n    }\n\n    this.sendingMessages.resolve()\n  }\n\n  has (cid: CID): boolean {\n    const cidStr = uint8ArrayToString(cid.multihash.bytes, 'base64')\n    return this.wants.has(cidStr)\n  }\n\n  /**\n   * Add a CID to the wantlist\n   */\n  async wantSessionPresence (cid: CID, peerId: PeerId, options: WantOptions = {}): Promise<WantPresenceResult> {\n    const message = new QueuedBitswapMessage()\n    message.addWantlistEntry(cid, {\n      cid: cid.bytes,\n      sendDontHave: true,\n      wantType: WantType.WantHave,\n      priority: 1\n    })\n\n    // sending WantHave directly to peer\n    await this.network.sendMessage(peerId, message)\n\n    // wait for peer response\n    const event = await raceEvent<CustomEvent<WantHaveResult | WantDontHaveResult>>(this, 'presence', options.signal, {\n      filter: (event) => {\n        return peerId.equals(event.detail.sender) && uint8ArrayEquals(cid.multihash.digest, event.detail.cid.multihash.digest)\n      }\n    })\n\n    return event.detail\n  }\n\n  /**\n   * Add a CID to the wantlist\n   */\n  async wantBlock (cid: CID, options: WantOptions = {}): Promise<WantBlockResult> {\n    return this.addEntry(cid, {\n      ...options,\n      wantType: WantType.WantBlock\n    })\n  }\n\n  /**\n   * Add a CID to the wantlist\n   */\n  async wantSessionBlock (cid: CID, peerId: PeerId, options: WantOptions = {}): Promise<WantPresenceResult> {\n    const message = new QueuedBitswapMessage()\n    message.addWantlistEntry(cid, {\n      cid: cid.bytes,\n      sendDontHave: true,\n      wantType: WantType.WantBlock,\n      priority: 1\n    })\n\n    // sending WantBlockResult directly to peer\n    await this.network.sendMessage(peerId, message)\n\n    // wait for peer response\n    const event = await raceEvent<CustomEvent<WantPresenceResult>>(this, 'presence', options.signal, {\n      filter: (event) => {\n        return peerId.equals(event.detail.sender) && uint8ArrayEquals(cid.multihash.digest, event.detail.cid.multihash.digest)\n      }\n    })\n\n    return event.detail\n  }\n\n  /**\n   * Invoked when a block has been received from an external source\n   */\n  async receivedBlock (cid: CID, options: ProgressOptions<BitswapNotifyProgressEvents> & AbortOptions): Promise<void> {\n    const cidStr = uint8ArrayToString(cid.multihash.bytes, 'base64')\n\n    const entry = this.wants.get(cidStr)\n\n    if (entry == null) {\n      return\n    }\n\n    entry.cancel = true\n\n    await this.sendMessagesDebounced()\n  }\n\n  /**\n   * Invoked when a message is received from a bitswap peer\n   */\n  private async receiveMessage (sender: PeerId, message: BitswapMessage): Promise<void> {\n    this.log('received message from %p with %d blocks', sender, message.blocks.length)\n    let blocksCancelled = false\n\n    // process blocks\n    for (const block of message.blocks) {\n      if (block.prefix == null || block.data == null) {\n        continue\n      }\n\n      const values = vd(block.prefix)\n      const cidVersion = values[0]\n      const multicodec = values[1]\n      const hashAlg = values[2]\n      // const hashLen = values[3] // We haven't need to use this so far\n\n      const hasher = hashAlg === sha256.code ? sha256 : await this.hashLoader?.getHasher(hashAlg)\n\n      if (hasher == null) {\n        this.log.error('unknown hash algorithm', hashAlg)\n        continue\n      }\n\n      let hash: any = hasher.digest(block.data)\n\n      if (hash.then != null) {\n        hash = await hash\n      }\n\n      const cid = CID.create(cidVersion === 0 ? 0 : 1, multicodec, hash)\n\n      this.log('received block from %p for %c', sender, cid)\n\n      this.safeDispatchEvent<WantBlockResult>('block', {\n        detail: {\n          sender,\n          cid,\n          block: block.data\n        }\n      })\n\n      this.safeDispatchEvent<WantHaveResult | WantDontHaveResult>('presence', {\n        detail: {\n          sender,\n          cid,\n          has: true,\n          block: block.data\n        }\n      })\n\n      const cidStr = uint8ArrayToString(cid.multihash.bytes, 'base64')\n      const entry = this.wants.get(cidStr)\n\n      if (entry == null) {\n        continue\n      }\n\n      // since we received the block, flip the cancel flag to send cancels to\n      // any peers on the next message sending iteration, this will remove it\n      // from the internal want list\n      entry.cancel = true\n      blocksCancelled = true\n    }\n\n    // process block presences\n    for (const { cid: cidBytes, type } of message.blockPresences) {\n      const cid = CID.decode(cidBytes)\n\n      this.log('received %s from %p for %c', type, sender, cid)\n\n      this.safeDispatchEvent<WantHaveResult | WantDontHaveResult>('presence', {\n        detail: {\n          sender,\n          cid,\n          has: type === BlockPresenceType.HaveBlock\n        }\n      })\n    }\n\n    if (blocksCancelled) {\n      await this.sendMessagesDebounced()\n    }\n  }\n\n  /**\n   * Invoked when the network topology notices a new peer that supports Bitswap\n   */\n  async peerConnected (peerId: PeerId): Promise<void> {\n    const sentWants = new Set<string>()\n    const message = new QueuedBitswapMessage(true)\n\n    // new peer, give them the full wantlist\n    for (const [key, entry] of this.wants.entries()) {\n      if (entry.cancel) {\n        continue\n      }\n\n      sentWants.add(key)\n\n      message.addWantlistEntry(entry.cid, {\n        cid: entry.cid.bytes,\n        priority: 1,\n        wantType: WantType.WantBlock,\n        cancel: false,\n        sendDontHave: false\n      })\n    }\n\n    // only send the wantlist if we have something to send\n    if (message.wantlist.size === 0) {\n      this.peers.set(peerId, sentWants)\n\n      return\n    }\n\n    try {\n      await this.network.sendMessage(peerId, message)\n\n      this.peers.set(peerId, sentWants)\n    } catch (err) {\n      this.log.error('error sending full wantlist to new peer %p', peerId, err)\n    }\n  }\n\n  /**\n   * Invoked when the network topology notices peer that supports Bitswap has\n   * disconnected\n   */\n  peerDisconnected (peerId: PeerId): void {\n    this.peers.delete(peerId)\n  }\n\n  start (): void {\n\n  }\n\n  stop (): void {\n    this.peers.clear()\n    clearTimeout(this.sendMessagesTimeout)\n  }\n}\n", "/* eslint-disable no-loop-func */\nimport { setMaxListeners } from '@libp2p/interface'\nimport { anySignal } from 'any-signal'\nimport { Network } from './network.js'\nimport { PeerWantLists } from './peer-want-lists/index.js'\nimport { createBitswapSession } from './session.js'\nimport { Stats } from './stats.js'\nimport { WantList } from './want-list.js'\nimport type { BitswapOptions, Bitswap as BitswapInterface, BitswapWantProgressEvents, BitswapNotifyProgressEvents, WantListEntry, BitswapComponents } from './index.js'\nimport type { BlockBroker, CreateSessionOptions } from '@helia/interface'\nimport type { ComponentLogger, PeerId } from '@libp2p/interface'\nimport type { Logger } from '@libp2p/logger'\nimport type { AbortOptions } from '@multiformats/multiaddr'\nimport type { Blockstore } from 'interface-blockstore'\nimport type { CID } from 'multiformats/cid'\nimport type { ProgressOptions } from 'progress-events'\n\nexport interface WantOptions extends AbortOptions, ProgressOptions<BitswapWantProgressEvents> {\n  /**\n   * When searching the routing for providers, stop searching after finding this\n   * many providers.\n   *\n   * @default 3\n   */\n  maxProviders?: number\n}\n\n/**\n * JavaScript implementation of the Bitswap 'data exchange' protocol\n * used by IPFS.\n */\nexport class Bitswap implements BitswapInterface {\n  private readonly log: Logger\n  private readonly logger: ComponentLogger\n  public readonly stats: Stats\n  public network: Network\n  public blockstore: Blockstore\n  public peerWantLists: PeerWantLists\n  public wantList: WantList\n\n  constructor (components: BitswapComponents, init: BitswapOptions = {}) {\n    this.logger = components.logger\n    this.log = components.logger.forComponent('helia:bitswap')\n    this.blockstore = components.blockstore\n\n    // report stats to libp2p metrics\n    this.stats = new Stats(components)\n\n    // the network delivers messages\n    this.network = new Network(components, init)\n\n    // handle which blocks we send to peers\n    this.peerWantLists = new PeerWantLists({\n      ...components,\n      network: this.network\n    }, init)\n\n    // handle which blocks we ask peers for\n    this.wantList = new WantList({\n      ...components,\n      network: this.network\n    }, init)\n  }\n\n  createSession (options: CreateSessionOptions = {}): Required<Pick<BlockBroker<BitswapWantProgressEvents>, 'retrieve'>> {\n    return createBitswapSession({\n      wantList: this.wantList,\n      network: this.network,\n      logger: this.logger\n    }, options)\n  }\n\n  async want (cid: CID, options: WantOptions = {}): Promise<Uint8Array> {\n    const controller = new AbortController()\n    const signal = anySignal([controller.signal, options.signal])\n    setMaxListeners(Infinity, controller.signal, signal)\n\n    // find providers and connect to them\n    this.network.findAndConnect(cid, {\n      ...options,\n      signal\n    })\n      .catch(err => {\n        // if the controller was aborted we found the block already so ignore\n        // the error\n        if (!controller.signal.aborted) {\n          this.log.error('error during finding and connect for cid %c', cid, err)\n        }\n      })\n\n    try {\n      const result = await this.wantList.wantBlock(cid, {\n        ...options,\n        signal\n      })\n\n      return result.block\n    } finally {\n      // since we have the block we can now abort any outstanding attempts to\n      // find providers for it\n      controller.abort()\n      signal.clear()\n    }\n  }\n\n  /**\n   * Sends notifications about the arrival of a block\n   */\n  async notify (cid: CID, block: Uint8Array, options: ProgressOptions<BitswapNotifyProgressEvents> & AbortOptions = {}): Promise<void> {\n    await Promise.all([\n      this.peerWantLists.receivedBlock(cid, options),\n      this.wantList.receivedBlock(cid, options)\n    ])\n  }\n\n  getWantlist (): WantListEntry[] {\n    return [...this.wantList.wants.values()]\n      .filter(entry => !entry.cancel)\n      .map(entry => ({\n        cid: entry.cid,\n        priority: entry.priority,\n        wantType: entry.wantType\n      }))\n  }\n\n  getPeerWantlist (peer: PeerId): WantListEntry[] | undefined {\n    return this.peerWantLists.wantListForPeer(peer)\n  }\n\n  /**\n   * Start the bitswap node\n   */\n  async start (): Promise<void> {\n    this.wantList.start()\n    await this.network.start()\n  }\n\n  /**\n   * Stop the bitswap node\n   */\n  async stop (): Promise<void> {\n    this.wantList.stop()\n    await this.network.stop()\n  }\n}\n", "/**\n * @packageDocumentation\n *\n * This module implements the [Bitswap protocol](https://docs.ipfs.tech/concepts/bitswap/) in TypeScript.\n *\n * It supersedes the older [ipfs-bitswap](https://www.npmjs.com/package/ipfs-bitswap) module with the aim of being smaller, faster, better integrated with libp2p/helia, having fewer dependencies and using standard JavaScript instead of Node.js APIs.\n */\n\nimport { Bitswap as BitswapClass } from './bitswap.js'\nimport type { BitswapNetworkNotifyProgressEvents, BitswapNetworkWantProgressEvents, BitswapNetworkProgressEvents } from './network.js'\nimport type { WantType } from './pb/message.js'\nimport type { BlockBroker, CreateSessionOptions } from '@helia/interface'\nimport type { Routing } from '@helia/interface/routing'\nimport type { Libp2p, AbortOptions, Startable, ComponentLogger, Metrics, PeerId } from '@libp2p/interface'\nimport type { Blockstore } from 'interface-blockstore'\nimport type { CID } from 'multiformats/cid'\nimport type { MultihashHasher } from 'multiformats/hashes/interface'\nimport type { ProgressEvent, ProgressOptions } from 'progress-events'\n\nexport type BitswapWantProgressEvents =\n  BitswapWantBlockProgressEvents\n\nexport type BitswapNotifyProgressEvents =\n  BitswapNetworkNotifyProgressEvents\n\nexport type BitswapWantBlockProgressEvents =\n  ProgressEvent<'bitswap:want-block:unwant', CID> |\n  ProgressEvent<'bitswap:want-block:block', CID> |\n  BitswapNetworkWantProgressEvents\n\nexport type { BitswapNetworkNotifyProgressEvents }\nexport type { BitswapNetworkWantProgressEvents }\nexport type { BitswapNetworkProgressEvents }\nexport type { WantType }\n\nexport interface WantListEntry {\n  cid: CID\n  priority: number\n  wantType: WantType\n}\n\nexport interface Bitswap extends Startable {\n  /**\n   * Returns the current state of the wantlist\n   */\n  getWantlist(): WantListEntry[]\n\n  /**\n   * Returns the current state of the wantlist for a peer, if it is being\n   * tracked\n   */\n  getPeerWantlist(peerId: PeerId): WantListEntry[] | undefined\n\n  /**\n   * Notify bitswap that a new block is available\n   */\n  notify(cid: CID, block: Uint8Array, options?: ProgressOptions<BitswapNotifyProgressEvents>): Promise<void>\n\n  /**\n   * Start a session to retrieve a file from the network\n   */\n  want(cid: CID, options?: AbortOptions & ProgressOptions<BitswapWantProgressEvents>): Promise<Uint8Array>\n\n  /**\n   * Start a session to retrieve a file from the network\n   */\n  createSession(options?: CreateSessionOptions<BitswapWantProgressEvents>): Required<Pick<BlockBroker<BitswapWantProgressEvents>, 'retrieve'>>\n}\n\nexport interface MultihashHasherLoader {\n  getHasher(codeOrName: number | string): Promise<MultihashHasher>\n}\n\nexport interface BitswapComponents {\n  routing: Routing\n  blockstore: Blockstore\n  logger: ComponentLogger\n  libp2p: Libp2p\n  metrics?: Metrics\n}\n\nexport interface BitswapOptions {\n  /**\n   * This is the maximum number of concurrent inbound bitswap streams that are\n   * allowed\n   *\n   * @default 32\n   */\n  maxInboundStreams?: number\n\n  /**\n   * This is the maximum number of concurrent outbound bitswap streams that are\n   * allowed\n   *\n   * @default 128\n   */\n  maxOutboundStreams?: number\n\n  /**\n   * An incoming stream must resolve within this number of seconds\n   *\n   * @default 30000\n   */\n  incomingStreamTimeout?: number\n\n  /**\n   * Whether to run on transient (e.g. time/data limited) connections\n   *\n   * @default false\n   */\n  runOnLimitedConnections?: boolean\n\n  /**\n   * Enables loading esoteric hash functions\n   */\n  hashLoader?: MultihashHasherLoader\n\n  /**\n   * The protocol that we speak\n   *\n   * @default '/ipfs/bitswap/1.2.0'\n   */\n  protocol?: string\n\n  /**\n   * When sending want list updates to peers, how many messages to send at once\n   *\n   * @default 50\n   */\n  messageSendConcurrency?: number\n\n  /**\n   * When sending blocks to peers, how many messages to send at once\n   *\n   * @default 50\n   */\n  sendBlocksConcurrency?: number\n\n  /**\n   * When sending blocks to peers, timeout after this many milliseconds.\n   * This is useful for preventing slow/large peer-connections from consuming\n   * your bandwidth/streams.\n   *\n   * @default 10000\n   */\n  sendBlocksTimeout?: number\n\n  /**\n   * When a block is added to the blockstore and we are about to send that block\n   * to peers who have it in their wantlist, wait this many milliseconds before\n   * queueing the send job in case more blocks are added that they want\n   *\n   * @default 10\n   */\n  sendBlocksDebounce?: number\n\n  /**\n   * If the client sends a want-have, and we have the corresponding block, we\n   * check the size of the block and if it's small enough we send the block\n   * itself, rather than sending a HAVE.\n   *\n   * This defines the maximum size up to which we replace a HAVE with a block.\n   *\n   * @default 1024\n   */\n  maxSizeReplaceHasWithBlock?: number\n\n  /**\n   * The maximum size in bytes of a message that we will send. If a message is\n   * larger than this (due to lots of blocks or wantlist entries) it will be\n   * broken up into several smaller messages that are under this size.\n   *\n   * @see https://github.com/ipfs/boxo/blob/eeea414587350401b6b804f0574ed8436833331d/bitswap/client/internal/messagequeue/messagequeue.go#L33\n   *\n   * @default 2097152\n   */\n  maxOutgoingMessageSize?: number\n\n  /**\n   * The maximum size in bytes of an incoming message that we will process.\n   *\n   * Messages larger than this will cause the incoming stream to be reset.\n   *\n   * Defaults to `maxOutgoingMessageSize`\n   *\n   * @default 2097152\n   */\n  maxIncomingMessageSize?: number\n}\n\nexport const createBitswap = (components: BitswapComponents, options: BitswapOptions = {}): Bitswap => {\n  return new BitswapClass(components, options)\n}\n", "import { createBitswap } from '@helia/bitswap'\nimport type { BitswapOptions, Bitswap, BitswapWantBlockProgressEvents, BitswapNotifyProgressEvents } from '@helia/bitswap'\nimport type { BlockAnnounceOptions, BlockBroker, BlockRetrievalOptions, CreateSessionOptions, Routing, HasherLoader } from '@helia/interface'\nimport type { Libp2p, Startable, ComponentLogger } from '@libp2p/interface'\nimport type { Blockstore } from 'interface-blockstore'\nimport type { CID } from 'multiformats/cid'\nimport type { MultihashHasher } from 'multiformats/hashes/interface'\n\nexport interface BitswapBlockBrokerComponents {\n  libp2p: Libp2p\n  blockstore: Blockstore\n  routing: Routing\n  logger: ComponentLogger\n  getHasher: HasherLoader\n}\n\nexport interface BitswapBlockBrokerInit extends BitswapOptions {\n\n}\n\nclass BitswapBlockBroker implements BlockBroker<BitswapWantBlockProgressEvents, BitswapNotifyProgressEvents>, Startable {\n  private readonly bitswap: Bitswap\n  private started: boolean\n\n  constructor (components: BitswapBlockBrokerComponents, init: BitswapBlockBrokerInit = {}) {\n    const { getHasher } = components\n\n    this.bitswap = createBitswap(components, {\n      hashLoader: {\n        getHasher: async (codecOrName: number): Promise<MultihashHasher<number>> => {\n          return getHasher(codecOrName)\n        }\n      },\n      ...init\n    })\n    this.started = false\n  }\n\n  isStarted (): boolean {\n    return this.started\n  }\n\n  async start (): Promise<void> {\n    await this.bitswap.start()\n    this.started = true\n  }\n\n  async stop (): Promise<void> {\n    await this.bitswap.stop()\n    this.started = false\n  }\n\n  async announce (cid: CID, block: Uint8Array, options?: BlockAnnounceOptions<BitswapNotifyProgressEvents>): Promise<void> {\n    await this.bitswap.notify(cid, block, options)\n  }\n\n  async retrieve (cid: CID, options: BlockRetrievalOptions<BitswapWantBlockProgressEvents> = {}): Promise<Uint8Array> {\n    return this.bitswap.want(cid, options)\n  }\n\n  createSession (options?: CreateSessionOptions<BitswapWantBlockProgressEvents>): BlockBroker<BitswapWantBlockProgressEvents, BitswapNotifyProgressEvents> {\n    const session = this.bitswap.createSession(options)\n\n    return {\n      announce: async (cid, block, options) => {\n        await this.bitswap.notify(cid, block, options)\n      },\n\n      retrieve: async (cid, options) => {\n        return session.retrieve(cid, options)\n      }\n    }\n  }\n}\n\n/**\n * A helper factory for users who want to override Helia `blockBrokers` but\n * still want to use the default `BitswapBlockBroker`.\n */\nexport function bitswap (init: BitswapBlockBrokerInit = {}): (components: BitswapBlockBrokerComponents) => BlockBroker {\n  return (components) => new BitswapBlockBroker(components, init)\n}\n", "import { base64 } from 'multiformats/bases/base64'\nimport type { ComponentLogger, Logger } from '@libp2p/interface'\nimport type { CID } from 'multiformats/cid'\n\nexport interface TrustlessGatewayStats {\n  attempts: number\n  errors: number\n  invalidBlocks: number\n  successes: number\n  pendingResponses?: number\n}\n\n/**\n * A `TrustlessGateway` keeps track of the number of attempts, errors, and\n * successes for a given gateway url so that we can prioritize gateways that\n * have been more reliable in the past, and ensure that requests are distributed\n * across all gateways within a given `TrustlessGatewayBlockBroker` instance.\n */\nexport class TrustlessGateway {\n  public readonly url: URL\n  /**\n   * The number of times this gateway has been attempted to be used to fetch a\n   * block. This includes successful, errored, and aborted attempts. By counting\n   * even aborted attempts, slow gateways that are out-raced by others will be\n   * considered less reliable.\n   */\n  #attempts = 0\n\n  /**\n   * The number of times this gateway has errored while attempting to fetch a\n   * block. This includes `response.ok === false` and any other errors that\n   * throw while attempting to fetch a block. This does not include aborted\n   * attempts.\n   */\n  #errors = 0\n\n  /**\n   * The number of times this gateway has returned an invalid block. A gateway\n   * that returns the wrong blocks for a CID should be considered for removal\n   * from the list of gateways to fetch blocks from.\n   */\n  #invalidBlocks = 0\n\n  /**\n   * The number of times this gateway has successfully fetched a block.\n   */\n  #successes = 0\n\n  /**\n   * A map of pending responses for this gateway. This is used to ensure that\n   * only one request per CID is made to a given gateway at a time, and that we\n   * don't make multiple in-flight requests for the same CID to the same gateway.\n   */\n  readonly #pendingResponses = new Map<string, Promise<Uint8Array>>()\n\n  private readonly log: Logger\n\n  constructor (url: URL | string, logger: ComponentLogger) {\n    this.url = url instanceof URL ? url : new URL(url)\n    this.log = logger.forComponent(`helia:trustless-gateway-block-broker:${this.url.hostname}`)\n  }\n\n  /**\n   * This function returns a unique string for the multihash.bytes of the CID.\n   *\n   * Some useful resources for why this is needed can be found using the links below:\n   *\n   * - https://github.com/ipfs/helia/pull/503#discussion_r1572451331\n   * - https://github.com/ipfs/kubo/issues/6815\n   * - https://www.notion.so/pl-strflt/Handling-ambiguity-around-CIDs-9d5e14f6516f438980b01ef188efe15d#d9d45cd1ed8b4d349b96285de4aed5ab\n   */\n  #uniqueBlockId (cid: CID): string {\n    const multihashBytes = cid.multihash.bytes\n    return base64.encode(multihashBytes)\n  }\n\n  /**\n   * Fetch a raw block from `this.url` following the specification defined at\n   * https://specs.ipfs.tech/http-gateways/trustless-gateway/\n   */\n  async getRawBlock (cid: CID, signal?: AbortSignal): Promise<Uint8Array> {\n    const gwUrl = new URL(this.url.toString())\n    gwUrl.pathname = `/ipfs/${cid.toString()}`\n\n    // necessary as not every gateway supports dag-cbor, but every should support\n    // sending raw block as-is\n    gwUrl.search = '?format=raw'\n\n    if (signal?.aborted === true) {\n      throw new Error(`Signal to fetch raw block for CID ${cid} from gateway ${this.url} was aborted prior to fetch`)\n    }\n\n    const blockId = this.#uniqueBlockId(cid)\n\n    // workaround for https://github.com/nodejs/node/issues/52635\n    const innerController = new AbortController()\n    const abortInnerSignal = (): void => {\n      innerController.abort()\n    }\n    signal?.addEventListener('abort', abortInnerSignal)\n\n    try {\n      let pendingResponse: Promise<Uint8Array> | undefined = this.#pendingResponses.get(blockId)\n      if (pendingResponse == null) {\n        this.#attempts++\n        pendingResponse = fetch(gwUrl.toString(), {\n          signal: innerController.signal,\n          headers: {\n            Accept: 'application/vnd.ipld.raw'\n          },\n          cache: 'force-cache'\n        }).then(async (res) => {\n          this.log('GET %s %d', gwUrl, res.status)\n          if (!res.ok) {\n            this.#errors++\n            throw new Error(`unable to fetch raw block for CID ${cid} from gateway ${this.url}`)\n          }\n          this.#successes++\n          return new Uint8Array(await res.arrayBuffer())\n        })\n        this.#pendingResponses.set(blockId, pendingResponse)\n      }\n      return await pendingResponse\n    } catch (cause) {\n      // @ts-expect-error - TS thinks signal?.aborted can only be false now\n      // because it was checked for true above.\n      if (signal?.aborted === true) {\n        throw new Error(`fetching raw block for CID ${cid} from gateway ${this.url} was aborted`)\n      }\n      this.#errors++\n      throw new Error(`unable to fetch raw block for CID ${cid}`)\n    } finally {\n      signal?.removeEventListener('abort', abortInnerSignal)\n      this.#pendingResponses.delete(blockId)\n    }\n  }\n\n  /**\n   * Encapsulate the logic for determining whether a gateway is considered\n   * reliable, for prioritization. This is based on the number of successful attempts made\n   * and the number of errors encountered.\n   *\n   * Unused gateways have 100% reliability; They will be prioritized over\n   * gateways with a 100% success rate to ensure that we attempt all gateways.\n   */\n  reliability (): number {\n    /**\n     * if we have never tried to use this gateway, it is considered the most\n     * reliable until we determine otherwise (prioritize unused gateways)\n     */\n    if (this.#attempts === 0) {\n      return 1\n    }\n\n    if (this.#invalidBlocks > 0) {\n      // this gateway may not be trustworthy..\n      return -Infinity\n    }\n\n    /**\n     * We have attempted the gateway, so we need to calculate the reliability\n     * based on the number of attempts, errors, and successes. Gateways that\n     * return a single error should drop their reliability score more than a\n     * single success increases it.\n     *\n     * Play around with the below reliability function at https://www.desmos.com/calculator/d6hfhf5ukm\n     */\n    return this.#successes / (this.#attempts + (this.#errors * 3))\n  }\n\n  /**\n   * Increment the number of invalid blocks returned by this gateway.\n   */\n  incrementInvalidBlocks (): void {\n    this.#invalidBlocks++\n  }\n\n  getStats (): TrustlessGatewayStats {\n    return {\n      attempts: this.#attempts,\n      errors: this.#errors,\n      invalidBlocks: this.#invalidBlocks,\n      successes: this.#successes,\n      pendingResponses: this.#pendingResponses.size\n    }\n  }\n}\n", "import { isPrivateIp } from '@libp2p/utils/private-ip'\nimport { DNS, HTTP, HTTPS } from '@multiformats/multiaddr-matcher'\nimport { multiaddrToUri } from '@multiformats/multiaddr-to-uri'\nimport { TrustlessGateway } from './trustless-gateway.js'\nimport type { Routing } from '@helia/interface'\nimport type { ComponentLogger } from '@libp2p/interface'\nimport type { AbortOptions, Multiaddr } from '@multiformats/multiaddr'\nimport type { CID } from 'multiformats/cid'\n\nexport function filterNonHTTPMultiaddrs (multiaddrs: Multiaddr[], allowInsecure: boolean, allowLocal: boolean): Multiaddr[] {\n  return multiaddrs.filter(ma => {\n    if (HTTPS.matches(ma) || (allowInsecure && HTTP.matches(ma))) {\n      if (allowLocal) {\n        return true\n      }\n\n      if (DNS.matches(ma)) {\n        return true\n      }\n\n      return isPrivateIp(ma.toOptions().host) === false\n    }\n\n    // When allowInsecure is false and allowLocal is true, allow multiaddrs with \"127.0.0.1\", \"localhost\", or any subdomain ending with \".localhost\"\n    if (!allowInsecure && allowLocal) {\n      const { host } = ma.toOptions()\n      if (host === '127.0.0.1' || host === 'localhost' || host.endsWith('.localhost')) {\n        return true\n      }\n    }\n\n    return false\n  })\n}\n\nexport async function * findHttpGatewayProviders (cid: CID, routing: Routing, logger: ComponentLogger, allowInsecure: boolean, allowLocal: boolean, options?: AbortOptions): AsyncGenerator<TrustlessGateway> {\n  for await (const provider of routing.findProviders(cid, options)) {\n    // require http(s) addresses\n    const httpAddresses = filterNonHTTPMultiaddrs(provider.multiaddrs, allowInsecure, allowLocal)\n\n    if (httpAddresses.length === 0) {\n      continue\n    }\n\n    // take first address?\n    // /ip4/x.x.x.x/tcp/31337/http\n    // /ip4/x.x.x.x/tcp/31337/https\n    // etc\n    const uri = multiaddrToUri(httpAddresses[0])\n\n    yield new TrustlessGateway(uri, logger)\n  }\n}\n", "import { AbstractSession } from '@helia/utils'\nimport { findHttpGatewayProviders } from './utils.js'\nimport { DEFAULT_ALLOW_INSECURE, DEFAULT_ALLOW_LOCAL } from './index.js'\nimport type { CreateTrustlessGatewaySessionOptions } from './broker.js'\nimport type { TrustlessGatewayGetBlockProgressEvents } from './index.js'\nimport type { TrustlessGateway } from './trustless-gateway.js'\nimport type { BlockRetrievalOptions, Routing } from '@helia/interface'\nimport type { ComponentLogger } from '@libp2p/interface'\nimport type { AbortOptions } from 'interface-store'\nimport type { CID } from 'multiformats/cid'\n\nexport interface TrustlessGatewaySessionComponents {\n  logger: ComponentLogger\n  routing: Routing\n}\n\nclass TrustlessGatewaySession extends AbstractSession<TrustlessGateway, TrustlessGatewayGetBlockProgressEvents> {\n  private readonly routing: Routing\n  private readonly allowInsecure: boolean\n  private readonly allowLocal: boolean\n\n  constructor (components: TrustlessGatewaySessionComponents, init: CreateTrustlessGatewaySessionOptions) {\n    super(components, {\n      ...init,\n      name: 'helia:trustless-gateway:session'\n    })\n\n    this.routing = components.routing\n    this.allowInsecure = init.allowInsecure ?? DEFAULT_ALLOW_INSECURE\n    this.allowLocal = init.allowLocal ?? DEFAULT_ALLOW_LOCAL\n  }\n\n  async queryProvider (cid: CID, provider: TrustlessGateway, options: BlockRetrievalOptions): Promise<Uint8Array> {\n    this.log('fetching BLOCK for %c from %s', cid, provider.url)\n\n    const block = await provider.getRawBlock(cid, options.signal)\n    this.log.trace('got block for %c from %s', cid, provider.url)\n\n    await options.validateFn?.(block)\n\n    return block\n  }\n\n  async * findNewProviders (cid: CID, options: AbortOptions = {}): AsyncGenerator<TrustlessGateway> {\n    yield * findHttpGatewayProviders(cid, this.routing, this.logger, this.allowInsecure, this.allowLocal, options)\n  }\n\n  toEvictionKey (provider: TrustlessGateway): Uint8Array | string {\n    return provider.url.toString()\n  }\n\n  equals (providerA: TrustlessGateway, providerB: TrustlessGateway): boolean {\n    return providerA.url.toString() === providerB.url.toString()\n  }\n}\n\nexport function createTrustlessGatewaySession (components: TrustlessGatewaySessionComponents, init: CreateTrustlessGatewaySessionOptions): TrustlessGatewaySession {\n  return new TrustlessGatewaySession(components, init)\n}\n", "import { createTrustlessGatewaySession } from './session.js'\nimport { findHttpGatewayProviders } from './utils.js'\nimport { DEFAULT_ALLOW_INSECURE, DEFAULT_ALLOW_LOCAL } from './index.js'\nimport type { TrustlessGatewayBlockBrokerInit, TrustlessGatewayBlockBrokerComponents, TrustlessGatewayGetBlockProgressEvents } from './index.js'\nimport type { Routing, BlockRetrievalOptions, BlockBroker, CreateSessionOptions } from '@helia/interface'\nimport type { ComponentLogger, Logger } from '@libp2p/interface'\nimport type { CID } from 'multiformats/cid'\n\nexport interface CreateTrustlessGatewaySessionOptions extends CreateSessionOptions<TrustlessGatewayGetBlockProgressEvents> {\n  /**\n   * By default we will only connect to peers with HTTPS addresses, pass true\n   * to also connect to HTTP addresses.\n   *\n   * @default false\n   */\n  allowInsecure?: boolean\n\n  /**\n   * By default we will only connect to peers with public or DNS addresses, pass\n   * true to also connect to private addresses.\n   *\n   * @default false\n   */\n  allowLocal?: boolean\n}\n\n/**\n * A class that accepts a list of trustless gateways that are queried\n * for blocks.\n */\nexport class TrustlessGatewayBlockBroker implements BlockBroker<TrustlessGatewayGetBlockProgressEvents> {\n  private readonly allowInsecure: boolean\n  private readonly allowLocal: boolean\n  private readonly routing: Routing\n  private readonly log: Logger\n  private readonly logger: ComponentLogger\n\n  constructor (components: TrustlessGatewayBlockBrokerComponents, init: TrustlessGatewayBlockBrokerInit = {}) {\n    this.log = components.logger.forComponent('helia:trustless-gateway-block-broker')\n    this.logger = components.logger\n    this.routing = components.routing\n    this.allowInsecure = init.allowInsecure ?? DEFAULT_ALLOW_INSECURE\n    this.allowLocal = init.allowLocal ?? DEFAULT_ALLOW_LOCAL\n  }\n\n  async retrieve (cid: CID, options: BlockRetrievalOptions<TrustlessGatewayGetBlockProgressEvents> = {}): Promise<Uint8Array> {\n    const aggregateErrors: Error[] = []\n\n    for await (const gateway of findHttpGatewayProviders(cid, this.routing, this.logger, this.allowInsecure, this.allowLocal, options)) {\n      this.log('getting block for %c from %s', cid, gateway.url)\n\n      try {\n        const block = await gateway.getRawBlock(cid, options.signal)\n        this.log.trace('got block for %c from %s', cid, gateway.url)\n\n        try {\n          await options.validateFn?.(block)\n        } catch (err) {\n          this.log.error('failed to validate block for %c from %s', cid, gateway.url, err)\n          // try another gateway\n          continue\n        }\n\n        return block\n      } catch (err: unknown) {\n        this.log.error('failed to get block for %c from %s', cid, gateway.url, err)\n\n        if (err instanceof Error) {\n          aggregateErrors.push(err)\n        } else {\n          aggregateErrors.push(new Error(`Unable to fetch raw block for CID ${cid} from gateway ${gateway.url}`))\n        }\n\n        // if signal was aborted, exit the loop\n        if (options.signal?.aborted === true) {\n          this.log.trace('request aborted while fetching raw block for CID %c from gateway %s', cid, gateway.url)\n          break\n        }\n      }\n    }\n\n    if (aggregateErrors.length > 0) {\n      throw new AggregateError(aggregateErrors, `Unable to fetch raw block for CID ${cid} from any gateway`)\n    } else {\n      throw new Error(`Unable to fetch raw block for CID ${cid} from any gateway`)\n    }\n  }\n\n  createSession (options: CreateTrustlessGatewaySessionOptions = {}): BlockBroker<TrustlessGatewayGetBlockProgressEvents> {\n    return createTrustlessGatewaySession({\n      logger: this.logger,\n      routing: this.routing\n    }, {\n      ...options,\n      allowLocal: this.allowLocal,\n      allowInsecure: this.allowInsecure\n    })\n  }\n}\n", "import { TrustlessGatewayBlockBroker } from './broker.js'\nimport type { Routing, BlockBroker } from '@helia/interface'\nimport type { ComponentLogger } from '@libp2p/interface'\nimport type { ProgressEvent } from 'progress-events'\n\nexport const DEFAULT_ALLOW_INSECURE = false\nexport const DEFAULT_ALLOW_LOCAL = false\n\nexport type TrustlessGatewayGetBlockProgressEvents =\n  ProgressEvent<'trustless-gateway:get-block:fetch', URL>\n\nexport interface TrustlessGatewayBlockBrokerInit {\n  /**\n   * By default we will only connect to peers with HTTPS addresses, pass true\n   * to also connect to HTTP addresses.\n   *\n   * @default false\n   */\n  allowInsecure?: boolean\n\n  /**\n   * By default we will only connect to peers with public or DNS addresses, pass\n   * true to also connect to private addresses.\n   *\n   * @default false\n   */\n  allowLocal?: boolean\n}\n\nexport interface TrustlessGatewayBlockBrokerComponents {\n  routing: Routing\n  logger: ComponentLogger\n}\n\nexport function trustlessGateway (init: TrustlessGatewayBlockBrokerInit = {}): (components: TrustlessGatewayBlockBrokerComponents) => BlockBroker<TrustlessGatewayGetBlockProgressEvents> {\n  return (components) => new TrustlessGatewayBlockBroker(components, init)\n}\n", "/**\n * @packageDocumentation\n *\n * Allows treating a browser readable stream as an async iterator.\n *\n * @example\n *\n * ```javascript\n * import toIt from 'browser-readablestream-to-it'\n * import all from 'it-all'\n *\n * const content = [0, 1, 2, 3, 4]\n *\n * const stream = new ReadableStream({\n *   start(controller) {\n *     for (let i = 0; i < content.length; i++) {\n *       controller.enqueue(content[i])\n *     }\n *\n *     controller.close()\n *   }\n * })\n *\n * const arr = await all(toIt(stream))\n *\n * console.info(arr) // 0, 1, 2, 3, 4\n * ```\n *\n * ## preventCancel\n *\n * By default a readable stream will have [.cancel](https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream/cancel) called on it once it has ended or\n * reading has stopped prematurely.\n *\n * To prevent this behaviour, pass `preventCancel: true` as an option:\n *\n * ```javascript\n * const arr = await all(toIt(stream, { preventCancel: true }))\n *\n * console.info(arr) // 0, 1, 2, 3, 4\n * ```\n */\n\nexport interface BrowserReadableStreamToItOptions {\n  preventCancel?: boolean\n}\n\n/**\n * Turns a browser readable stream into an async iterable. Async iteration over\n * returned iterable will lock give stream, preventing any other consumer from\n * acquiring a reader. The lock will be released if iteration loop is broken. To\n * prevent stream cancelling optional `{ preventCancel: true }` could be passed\n * as a second argument.\n */\nexport default async function * browserReadableStreamToIt <T> (stream: ReadableStream<T>, options: BrowserReadableStreamToItOptions = {}): AsyncGenerator<T, void, undefined> {\n  const reader = stream.getReader()\n\n  try {\n    while (true) {\n      const result = await reader.read()\n\n      if (result.done) {\n        return\n      }\n\n      yield result.value\n    }\n  } finally {\n    if (options.preventCancel !== true) {\n      await reader.cancel()\n    }\n\n    reader.releaseLock()\n  }\n}\n", "import { publicKeyToProtobuf } from '@libp2p/crypto/keys'\nimport { logger } from '@libp2p/logger'\nimport { type Key } from 'interface-datastore/key'\nimport NanoDate from 'timestamp-nano'\nimport { fromString as uint8ArrayFromString } from 'uint8arrays/from-string'\nimport { SignatureCreationError } from './errors.js'\nimport { IpnsEntry } from './pb/ipns.js'\nimport { createCborData, ipnsRecordDataForV1Sig, ipnsRecordDataForV2Sig, normalizeValue } from './utils.js'\nimport type { PrivateKey, PublicKey } from '@libp2p/interface'\nimport type { CID } from 'multiformats/cid'\nimport type { MultihashDigest } from 'multiformats/hashes/interface'\n\nconst log = logger('ipns')\nconst DEFAULT_TTL_NS = 60 * 60 * 1e+9 // 1 Hour or 3600 Seconds\n\nexport const namespace = '/ipns/'\nexport const namespaceLength = namespace.length\n\nexport interface IPNSRecordV1V2 {\n  /**\n   * value of the record\n   */\n  value: string\n\n  /**\n   * signature of the record\n   */\n  signatureV1: Uint8Array\n\n  /**\n   * Type of validation being used\n   */\n  validityType: IpnsEntry.ValidityType\n\n  /**\n   * expiration datetime for the record in RFC3339 format\n   */\n  validity: string\n\n  /**\n   * number representing the version of the record\n   */\n  sequence: bigint\n\n  /**\n   * ttl in nanoseconds\n   */\n  ttl?: bigint\n\n  /**\n   * the public portion of the key that signed this record (only present if it was not embedded in the IPNS key)\n   */\n  pubKey?: Uint8Array\n\n  /**\n   * the v2 signature of the record\n   */\n  signatureV2: Uint8Array\n\n  /**\n   * extensible data\n   */\n  data: Uint8Array\n}\n\nexport interface IPNSRecordV2 {\n  /**\n   * value of the record\n   */\n  value: string\n\n  /**\n   * the v2 signature of the record\n   */\n  signatureV2: Uint8Array\n\n  /**\n   * Type of validation being used\n   */\n  validityType: IpnsEntry.ValidityType\n\n  /**\n   * If the validity type is EOL, this is the expiration datetime for the record\n   * in RFC3339 format\n   */\n  validity: string\n\n  /**\n   * number representing the version of the record\n   */\n  sequence: bigint\n\n  /**\n   * ttl in nanoseconds\n   */\n  ttl?: bigint\n\n  /**\n   * the public portion of the key that signed this record (only present if it was not embedded in the IPNS key)\n   */\n  pubKey?: Uint8Array\n\n  /**\n   * extensible data\n   */\n  data: Uint8Array\n}\n\nexport type IPNSRecord = IPNSRecordV1V2 | IPNSRecordV2\n\nexport interface IPNSRecordData {\n  Value: Uint8Array\n  Validity: Uint8Array\n  ValidityType: IpnsEntry.ValidityType\n  Sequence: bigint\n  TTL: bigint\n}\n\nexport interface IDKeys {\n  routingPubKey: Key\n  pkKey: Key\n  routingKey: Key\n  ipnsKey: Key\n}\n\nexport interface CreateOptions {\n  ttlNs?: number | bigint\n  v1Compatible?: boolean\n}\n\nexport interface CreateV2OrV1Options {\n  v1Compatible: true\n}\n\nexport interface CreateV2Options {\n  v1Compatible: false\n}\n\nconst defaultCreateOptions: CreateOptions = {\n  v1Compatible: true,\n  ttlNs: DEFAULT_TTL_NS\n}\n\n/**\n * Creates a new IPNS record and signs it with the given private key.\n * The IPNS Record validity should follow the [RFC3339]{@link https://www.ietf.org/rfc/rfc3339.txt} with nanoseconds precision.\n * Note: This function does not embed the public key. If you want to do that, use `EmbedPublicKey`.\n *\n * The passed value can be a CID, a PeerID or an arbitrary string path.\n *\n * * CIDs will be converted to v1 and stored in the record as a string similar to: `/ipfs/${cid}`\n * * PeerIDs will create recursive records, eg. the record value will be `/ipns/${cidV1Libp2pKey}`\n * * String paths will be stored in the record as-is, but they must start with `\"/\"`\n *\n * @param {PrivateKey} privateKey - the private key for signing the record.\n * @param {CID | PublicKey | string} value - content to be stored in the record.\n * @param {number | bigint} seq - number representing the current version of the record.\n * @param {number} lifetime - lifetime of the record (in milliseconds).\n * @param {CreateOptions} options - additional create options.\n */\nexport async function createIPNSRecord (privateKey: PrivateKey, value: CID | PublicKey | MultihashDigest<0x00 | 0x12> | string, seq: number | bigint, lifetime: number, options?: CreateV2OrV1Options): Promise<IPNSRecordV1V2>\nexport async function createIPNSRecord (privateKey: PrivateKey, value: CID | PublicKey | MultihashDigest<0x00 | 0x12> | string, seq: number | bigint, lifetime: number, options: CreateV2Options): Promise<IPNSRecordV2>\nexport async function createIPNSRecord (privateKey: PrivateKey, value: CID | PublicKey | MultihashDigest<0x00 | 0x12> | string, seq: number | bigint, lifetime: number, options: CreateOptions): Promise<IPNSRecordV1V2>\nexport async function createIPNSRecord (privateKey: PrivateKey, value: CID | PublicKey | MultihashDigest<0x00 | 0x12> | string, seq: number | bigint, lifetime: number, options: CreateOptions = defaultCreateOptions): Promise<IPNSRecord> {\n  // Validity in ISOString with nanoseconds precision and validity type EOL\n  const expirationDate = new NanoDate(Date.now() + Number(lifetime))\n  const validityType = IpnsEntry.ValidityType.EOL\n  const ttlNs = BigInt(options.ttlNs ?? DEFAULT_TTL_NS)\n\n  return _create(privateKey, value, seq, validityType, expirationDate.toString(), ttlNs, options)\n}\n\n/**\n * Same as create(), but instead of generating a new Date, it receives the intended expiration time\n * WARNING: nano precision is not standard, make sure the value in seconds is 9 orders of magnitude lesser than the one provided.\n *\n * The passed value can be a CID, a PeerID or an arbitrary string path.\n *\n * * CIDs will be converted to v1 and stored in the record as a string similar to: `/ipfs/${cid}`\n * * PeerIDs will create recursive records, eg. the record value will be `/ipns/${cidV1Libp2pKey}`\n * * String paths will be stored in the record as-is, but they must start with `\"/\"`\n *\n * @param {PrivateKey} privateKey - the private key for signing the record.\n * @param {CID | PublicKey | string} value - content to be stored in the record.\n * @param {number | bigint} seq - number representing the current version of the record.\n * @param {string} expiration - expiration datetime for record in the [RFC3339]{@link https://www.ietf.org/rfc/rfc3339.txt} with nanoseconds precision.\n * @param {CreateOptions} options - additional creation options.\n */\nexport async function createIPNSRecordWithExpiration (privateKey: PrivateKey, value: CID | PublicKey | MultihashDigest<0x00 | 0x12> | string, seq: number | bigint, expiration: string, options?: CreateV2OrV1Options): Promise<IPNSRecordV1V2>\nexport async function createIPNSRecordWithExpiration (privateKey: PrivateKey, value: CID | PublicKey | MultihashDigest<0x00 | 0x12> | string, seq: number | bigint, expiration: string, options: CreateV2Options): Promise<IPNSRecordV2>\nexport async function createIPNSRecordWithExpiration (privateKey: PrivateKey, value: CID | PublicKey | MultihashDigest<0x00 | 0x12> | string, seq: number | bigint, expiration: string, options: CreateOptions): Promise<IPNSRecordV1V2>\nexport async function createIPNSRecordWithExpiration (privateKey: PrivateKey, value: CID | PublicKey | MultihashDigest<0x00 | 0x12> | string, seq: number | bigint, expiration: string, options: CreateOptions = defaultCreateOptions): Promise<IPNSRecord> {\n  const expirationDate = NanoDate.fromString(expiration)\n  const validityType = IpnsEntry.ValidityType.EOL\n  const ttlNs = BigInt(options.ttlNs ?? DEFAULT_TTL_NS)\n\n  return _create(privateKey, value, seq, validityType, expirationDate.toString(), ttlNs, options)\n}\n\nconst _create = async (privateKey: PrivateKey, value: CID | PublicKey | MultihashDigest<0x00 | 0x12> | string, seq: number | bigint, validityType: IpnsEntry.ValidityType, validity: string, ttl: bigint, options: CreateOptions = defaultCreateOptions): Promise<IPNSRecord> => {\n  seq = BigInt(seq)\n  const isoValidity = uint8ArrayFromString(validity)\n  const normalizedValue = normalizeValue(value)\n  const encodedValue = uint8ArrayFromString(normalizedValue)\n  const data = createCborData(encodedValue, validityType, isoValidity, seq, ttl)\n  const sigData = ipnsRecordDataForV2Sig(data)\n  const signatureV2 = await privateKey.sign(sigData)\n  let pubKey: Uint8Array | undefined\n\n  // if we cannot derive the public key from the PeerId (e.g. RSA PeerIDs),\n  // we have to embed it in the IPNS record\n  if (privateKey.type === 'RSA') {\n    pubKey = publicKeyToProtobuf(privateKey.publicKey)\n  }\n\n  if (options.v1Compatible === true) {\n    const signatureV1 = await signLegacyV1(privateKey, encodedValue, validityType, isoValidity)\n\n    const record: IPNSRecord = {\n      value: normalizedValue,\n      signatureV1,\n      validity,\n      validityType,\n      sequence: seq,\n      ttl,\n      signatureV2,\n      data\n    }\n\n    if (pubKey != null) {\n      record.pubKey = pubKey\n    }\n\n    return record\n  } else {\n    const record: IPNSRecordV2 = {\n      value: normalizedValue,\n      validity,\n      validityType,\n      sequence: seq,\n      ttl,\n      signatureV2,\n      data\n    }\n\n    if (pubKey != null) {\n      record.pubKey = pubKey\n    }\n\n    return record\n  }\n}\n\nexport { unmarshalIPNSRecord } from './utils.js'\nexport { marshalIPNSRecord } from './utils.js'\nexport { multihashToIPNSRoutingKey } from './utils.js'\nexport { multihashFromIPNSRoutingKey } from './utils.js'\nexport { extractPublicKeyFromIPNSRecord } from './utils.js'\n\n/**\n * Sign ipns record data using the legacy V1 signature scheme\n */\nconst signLegacyV1 = async (privateKey: PrivateKey, value: Uint8Array, validityType: IpnsEntry.ValidityType, validity: Uint8Array): Promise<Uint8Array> => {\n  try {\n    const dataForSignature = ipnsRecordDataForV1Sig(value, validityType, validity)\n\n    return await privateKey.sign(dataForSignature)\n  } catch (error: any) {\n    log.error('record signature creation failed', error)\n    throw new SignatureCreationError('Record signature creation failed')\n  }\n}\n", "export class SignatureCreationError extends Error {\n  static name = 'SignatureCreationError'\n\n  constructor (message = 'Record signature creation failed') {\n    super(message)\n    this.name = 'SignatureCreationError'\n  }\n}\n\nexport class SignatureVerificationError extends Error {\n  static name = 'SignatureVerificationError'\n\n  constructor (message = 'Record signature verification failed') {\n    super(message)\n    this.name = 'SignatureVerificationError'\n  }\n}\n\nexport class RecordExpiredError extends Error {\n  static name = 'RecordExpiredError'\n\n  constructor (message = 'Record has expired') {\n    super(message)\n    this.name = 'RecordExpiredError'\n  }\n}\n\nexport class UnsupportedValidityError extends Error {\n  static name = 'UnsupportedValidityError'\n\n  constructor (message = 'The validity type is unsupported') {\n    super(message)\n    this.name = 'UnsupportedValidityError'\n  }\n}\n\nexport class RecordTooLargeError extends Error {\n  static name = 'RecordTooLargeError'\n\n  constructor (message = 'The record is too large') {\n    super(message)\n    this.name = 'RecordTooLargeError'\n  }\n}\n\nexport class InvalidValueError extends Error {\n  static name = 'InvalidValueError'\n\n  constructor (message = 'Value must be a valid content path starting with /') {\n    super(message)\n    this.name = 'InvalidValueError'\n  }\n}\n\nexport class InvalidRecordDataError extends Error {\n  static name = 'InvalidRecordDataError'\n\n  constructor (message = 'Invalid record data') {\n    super(message)\n    this.name = 'InvalidRecordDataError'\n  }\n}\n\nexport class InvalidEmbeddedPublicKeyError extends Error {\n  static name = 'InvalidEmbeddedPublicKeyError'\n\n  constructor (message = 'Invalid embedded public key') {\n    super(message)\n    this.name = 'InvalidEmbeddedPublicKeyError'\n  }\n}\n", "/* eslint-disable import/export */\n/* eslint-disable complexity */\n/* eslint-disable @typescript-eslint/no-namespace */\n/* eslint-disable @typescript-eslint/no-unnecessary-boolean-literal-compare */\n/* eslint-disable @typescript-eslint/no-empty-interface */\n\nimport { type Codec, decodeMessage, type DecodeOptions, encodeMessage, enumeration, message } from 'protons-runtime'\nimport type { Uint8ArrayList } from 'uint8arraylist'\n\nexport interface IpnsEntry {\n  value?: Uint8Array\n  signatureV1?: Uint8Array\n  validityType?: IpnsEntry.ValidityType\n  validity?: Uint8Array\n  sequence?: bigint\n  ttl?: bigint\n  pubKey?: Uint8Array\n  signatureV2?: Uint8Array\n  data?: Uint8Array\n}\n\nexport namespace IpnsEntry {\n  export enum ValidityType {\n    EOL = 'EOL'\n  }\n\n  enum __ValidityTypeValues {\n    EOL = 0\n  }\n\n  export namespace ValidityType {\n    export const codec = (): Codec<ValidityType> => {\n      return enumeration<ValidityType>(__ValidityTypeValues)\n    }\n  }\n\n  let _codec: Codec<IpnsEntry>\n\n  export const codec = (): Codec<IpnsEntry> => {\n    if (_codec == null) {\n      _codec = message<IpnsEntry>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if (obj.value != null) {\n          w.uint32(10)\n          w.bytes(obj.value)\n        }\n\n        if (obj.signatureV1 != null) {\n          w.uint32(18)\n          w.bytes(obj.signatureV1)\n        }\n\n        if (obj.validityType != null) {\n          w.uint32(24)\n          IpnsEntry.ValidityType.codec().encode(obj.validityType, w)\n        }\n\n        if (obj.validity != null) {\n          w.uint32(34)\n          w.bytes(obj.validity)\n        }\n\n        if (obj.sequence != null) {\n          w.uint32(40)\n          w.uint64(obj.sequence)\n        }\n\n        if (obj.ttl != null) {\n          w.uint32(48)\n          w.uint64(obj.ttl)\n        }\n\n        if (obj.pubKey != null) {\n          w.uint32(58)\n          w.bytes(obj.pubKey)\n        }\n\n        if (obj.signatureV2 != null) {\n          w.uint32(66)\n          w.bytes(obj.signatureV2)\n        }\n\n        if (obj.data != null) {\n          w.uint32(74)\n          w.bytes(obj.data)\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {}\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.value = reader.bytes()\n              break\n            }\n            case 2: {\n              obj.signatureV1 = reader.bytes()\n              break\n            }\n            case 3: {\n              obj.validityType = IpnsEntry.ValidityType.codec().decode(reader)\n              break\n            }\n            case 4: {\n              obj.validity = reader.bytes()\n              break\n            }\n            case 5: {\n              obj.sequence = reader.uint64()\n              break\n            }\n            case 6: {\n              obj.ttl = reader.uint64()\n              break\n            }\n            case 7: {\n              obj.pubKey = reader.bytes()\n              break\n            }\n            case 8: {\n              obj.signatureV2 = reader.bytes()\n              break\n            }\n            case 9: {\n              obj.data = reader.bytes()\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<IpnsEntry>): Uint8Array => {\n    return encodeMessage(obj, IpnsEntry.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<IpnsEntry>): IpnsEntry => {\n    return decodeMessage(buf, IpnsEntry.codec(), opts)\n  }\n}\n", "import { publicKeyFromProtobuf } from '@libp2p/crypto/keys'\nimport { InvalidMultihashError } from '@libp2p/interface'\nimport { logger } from '@libp2p/logger'\nimport * as cborg from 'cborg'\nimport { base36 } from 'multiformats/bases/base36'\nimport { CID, type MultihashDigest } from 'multiformats/cid'\nimport * as Digest from 'multiformats/hashes/digest'\nimport { concat as uint8ArrayConcat } from 'uint8arrays/concat'\nimport { equals as uint8ArrayEquals } from 'uint8arrays/equals'\nimport { fromString as uint8ArrayFromString } from 'uint8arrays/from-string'\nimport { toString as uint8ArrayToString } from 'uint8arrays/to-string'\nimport { InvalidRecordDataError, InvalidValueError, SignatureVerificationError, UnsupportedValidityError } from './errors.js'\nimport { IpnsEntry } from './pb/ipns.js'\nimport type { IPNSRecord, IPNSRecordV2, IPNSRecordData } from './index.js'\nimport type { PublicKey } from '@libp2p/interface'\n\nconst log = logger('ipns:utils')\nconst IPNS_PREFIX = uint8ArrayFromString('/ipns/')\nconst LIBP2P_CID_CODEC = 0x72\nconst IDENTITY_CODEC = 0x0\nconst SHA2_256_CODEC = 0x12\n\n/**\n * Extracts a public key from the passed PeerId, falling back to the pubKey\n * embedded in the ipns record\n */\nexport function extractPublicKeyFromIPNSRecord (record: IPNSRecord | IPNSRecordV2): PublicKey | undefined {\n  let pubKey: PublicKey | undefined\n\n  if (record.pubKey != null) {\n    try {\n      pubKey = publicKeyFromProtobuf(record.pubKey)\n    } catch (err) {\n      log.error(err)\n      throw err\n    }\n  }\n\n  if (pubKey != null) {\n    return pubKey\n  }\n}\n\n/**\n * Utility for creating the record data for being signed\n */\nexport function ipnsRecordDataForV1Sig (value: Uint8Array, validityType: IpnsEntry.ValidityType, validity: Uint8Array): Uint8Array {\n  const validityTypeBuffer = uint8ArrayFromString(validityType)\n\n  return uint8ArrayConcat([value, validity, validityTypeBuffer])\n}\n\n/**\n * Utility for creating the record data for being signed\n */\nexport function ipnsRecordDataForV2Sig (data: Uint8Array): Uint8Array {\n  const entryData = uint8ArrayFromString('ipns-signature:')\n\n  return uint8ArrayConcat([entryData, data])\n}\n\nexport function marshalIPNSRecord (obj: IPNSRecord | IPNSRecordV2): Uint8Array {\n  if ('signatureV1' in obj) {\n    return IpnsEntry.encode({\n      value: uint8ArrayFromString(obj.value),\n      signatureV1: obj.signatureV1,\n      validityType: obj.validityType,\n      validity: uint8ArrayFromString(obj.validity),\n      sequence: obj.sequence,\n      ttl: obj.ttl,\n      pubKey: obj.pubKey,\n      signatureV2: obj.signatureV2,\n      data: obj.data\n    })\n  } else {\n    return IpnsEntry.encode({\n      pubKey: obj.pubKey,\n      signatureV2: obj.signatureV2,\n      data: obj.data\n    })\n  }\n}\n\nexport function unmarshalIPNSRecord (buf: Uint8Array): IPNSRecord {\n  const message = IpnsEntry.decode(buf)\n\n  // protobufjs returns bigints as numbers\n  if (message.sequence != null) {\n    message.sequence = BigInt(message.sequence)\n  }\n\n  // protobufjs returns bigints as numbers\n  if (message.ttl != null) {\n    message.ttl = BigInt(message.ttl)\n  }\n\n  // Check if we have the data field. If we don't, we fail. We've been producing\n  // V1+V2 records for quite a while and we don't support V1-only records during\n  // validation any more\n  if (message.signatureV2 == null || message.data == null) {\n    throw new SignatureVerificationError('Missing data or signatureV2')\n  }\n\n  const data = parseCborData(message.data)\n  const value = normalizeByteValue(data.Value)\n  const validity = uint8ArrayToString(data.Validity)\n\n  if (message.value != null && message.signatureV1 != null) {\n    // V1+V2\n    validateCborDataMatchesPbData(message)\n\n    return {\n      value,\n      validityType: IpnsEntry.ValidityType.EOL,\n      validity,\n      sequence: data.Sequence,\n      ttl: data.TTL,\n      pubKey: message.pubKey,\n      signatureV1: message.signatureV1,\n      signatureV2: message.signatureV2,\n      data: message.data\n    }\n  } else if (message.signatureV2 != null) {\n    // V2-only\n    return {\n      value,\n      validityType: IpnsEntry.ValidityType.EOL,\n      validity,\n      sequence: data.Sequence,\n      ttl: data.TTL,\n      pubKey: message.pubKey,\n      signatureV2: message.signatureV2,\n      data: message.data\n    }\n  } else {\n    throw new Error('invalid record: does not include signatureV1 or signatureV2')\n  }\n}\n\nexport function multihashToIPNSRoutingKey (digest: MultihashDigest<0x00 | 0x12>): Uint8Array {\n  return uint8ArrayConcat([\n    IPNS_PREFIX,\n    digest.bytes\n  ])\n}\n\nexport function multihashFromIPNSRoutingKey (key: Uint8Array): MultihashDigest<0x00 | 0x12> {\n  const digest = Digest.decode(key.slice(IPNS_PREFIX.length))\n\n  if (!isCodec(digest, IDENTITY_CODEC) && !isCodec(digest, SHA2_256_CODEC)) {\n    throw new InvalidMultihashError('Multihash in IPNS key was not identity or sha2-256')\n  }\n\n  return digest\n}\n\nexport function createCborData (value: Uint8Array, validityType: IpnsEntry.ValidityType, validity: Uint8Array, sequence: bigint, ttl: bigint): Uint8Array {\n  let ValidityType\n\n  if (validityType === IpnsEntry.ValidityType.EOL) {\n    ValidityType = 0\n  } else {\n    throw new UnsupportedValidityError('The validity type is unsupported')\n  }\n\n  const data = {\n    Value: value,\n    Validity: validity,\n    ValidityType,\n    Sequence: sequence,\n    TTL: ttl\n  }\n\n  return cborg.encode(data)\n}\n\nexport function parseCborData (buf: Uint8Array): IPNSRecordData {\n  const data = cborg.decode(buf)\n\n  if (data.ValidityType === 0) {\n    data.ValidityType = IpnsEntry.ValidityType.EOL\n  } else {\n    throw new UnsupportedValidityError('The validity type is unsupported')\n  }\n\n  if (Number.isInteger(data.Sequence)) {\n    // sequence must be a BigInt, but DAG-CBOR doesn't preserve this for Numbers within the safe-integer range\n    data.Sequence = BigInt(data.Sequence)\n  }\n\n  if (Number.isInteger(data.TTL)) {\n    // ttl must be a BigInt, but DAG-CBOR doesn't preserve this for Numbers within the safe-integer range\n    data.TTL = BigInt(data.TTL)\n  }\n\n  return data\n}\n\nexport function normalizeByteValue (value: Uint8Array): string {\n  const string = uint8ArrayToString(value).trim()\n\n  // if we have a path, check it is a valid path\n  if (string.startsWith('/')) {\n    return string\n  }\n\n  // try parsing what we have as CID bytes or a CID string\n  try {\n    return `/ipfs/${CID.decode(value).toV1().toString()}`\n  } catch {\n    // fall through\n  }\n\n  try {\n    return `/ipfs/${CID.parse(string).toV1().toString()}`\n  } catch {\n    // fall through\n  }\n\n  throw new InvalidValueError('Value must be a valid content path starting with /')\n}\n\n/**\n * Normalizes the given record value. It ensures it is a PeerID, a CID or a\n * string starting with '/'. PeerIDs become `/ipns/${cidV1Libp2pKey}`,\n * CIDs become `/ipfs/${cidAsV1}`.\n */\nexport function normalizeValue (value?: CID | PublicKey | MultihashDigest<0x00 | 0x12> | string): string {\n  if (value != null) {\n    const cid = asCID(value)\n\n    // if we have a CID, turn it into an ipfs path\n    if (cid != null) {\n      // PeerID encoded as a CID\n      if (cid.code === LIBP2P_CID_CODEC) {\n        return `/ipns/${cid.toString(base36)}`\n      }\n\n      return `/ipfs/${cid.toV1().toString()}`\n    }\n\n    if (hasBytes(value)) {\n      return `/ipns/${base36.encode(value.bytes)}`\n    }\n\n    // if we have a path, check it is a valid path\n    const string = value.toString().trim()\n\n    if (string.startsWith('/') && string.length > 1) {\n      return string\n    }\n  }\n\n  throw new InvalidValueError('Value must be a valid content path starting with /')\n}\n\nfunction validateCborDataMatchesPbData (entry: IpnsEntry): void {\n  if (entry.data == null) {\n    throw new InvalidRecordDataError('Record data is missing')\n  }\n\n  const data = parseCborData(entry.data)\n\n  if (!uint8ArrayEquals(data.Value, entry.value ?? new Uint8Array(0))) {\n    throw new SignatureVerificationError('Field \"value\" did not match between protobuf and CBOR')\n  }\n\n  if (!uint8ArrayEquals(data.Validity, entry.validity ?? new Uint8Array(0))) {\n    throw new SignatureVerificationError('Field \"validity\" did not match between protobuf and CBOR')\n  }\n\n  if (data.ValidityType !== entry.validityType) {\n    throw new SignatureVerificationError('Field \"validityType\" did not match between protobuf and CBOR')\n  }\n\n  if (data.Sequence !== entry.sequence) {\n    throw new SignatureVerificationError('Field \"sequence\" did not match between protobuf and CBOR')\n  }\n\n  if (data.TTL !== entry.ttl) {\n    throw new SignatureVerificationError('Field \"ttl\" did not match between protobuf and CBOR')\n  }\n}\n\nfunction hasBytes (obj?: any): obj is { bytes: Uint8Array } {\n  return obj.bytes instanceof Uint8Array\n}\n\nfunction hasToCID (obj?: any): obj is { toCID(): CID } {\n  return typeof obj?.toCID === 'function'\n}\n\nfunction asCID (obj?: any): CID | null {\n  if (hasToCID(obj)) {\n    return obj.toCID()\n  }\n\n  // try parsing as a CID string\n  try {\n    return CID.parse(obj)\n  } catch {\n    // fall through\n  }\n\n  return CID.asCID(obj)\n}\n\nexport function isCodec <T extends number> (digest: MultihashDigest, codec: T): digest is MultihashDigest<T> {\n  return digest.code === codec\n}\n", "import { publicKeyFromMultihash } from '@libp2p/crypto/keys'\nimport { logger } from '@libp2p/logger'\nimport NanoDate from 'timestamp-nano'\nimport { equals as uint8ArrayEquals } from 'uint8arrays/equals'\nimport { InvalidEmbeddedPublicKeyError, RecordExpiredError, RecordTooLargeError, SignatureVerificationError, UnsupportedValidityError } from './errors.js'\nimport { IpnsEntry } from './pb/ipns.js'\nimport { extractPublicKeyFromIPNSRecord, ipnsRecordDataForV2Sig, isCodec, multihashFromIPNSRoutingKey, multihashToIPNSRoutingKey, unmarshalIPNSRecord } from './utils.js'\nimport type { PublicKey } from '@libp2p/interface'\n\nconst log = logger('ipns:validator')\n\n/**\n * Limit valid IPNS record sizes to 10kb\n */\nconst MAX_RECORD_SIZE = 1024 * 10\n\n/**\n * Validates the given IPNS Record against the given public key. We need a \"raw\"\n * record in order to be able to access to all of its fields.\n */\nexport const validate = async (publicKey: PublicKey, buf: Uint8Array): Promise<void> => {\n  // unmarshal ensures that (1) SignatureV2 and Data are present, (2) that ValidityType\n  // and Validity are of valid types and have a value, (3) that CBOR data matches protobuf\n  // if it's a V1+V2 record.\n  const record = unmarshalIPNSRecord(buf)\n\n  // Validate Signature V2\n  let isValid\n\n  try {\n    const dataForSignature = ipnsRecordDataForV2Sig(record.data)\n    isValid = await publicKey.verify(dataForSignature, record.signatureV2)\n  } catch (err) {\n    isValid = false\n  }\n\n  if (!isValid) {\n    log.error('record signature verification failed')\n    throw new SignatureVerificationError('Record signature verification failed')\n  }\n\n  // Validate according to the validity type\n  if (record.validityType === IpnsEntry.ValidityType.EOL) {\n    if (NanoDate.fromString(record.validity).toDate().getTime() < Date.now()) {\n      log.error('record has expired')\n      throw new RecordExpiredError('record has expired')\n    }\n  } else if (record.validityType != null) {\n    log.error('the validity type is unsupported')\n    throw new UnsupportedValidityError('The validity type is unsupported')\n  }\n\n  log('ipns record for %s is valid', record.value)\n}\n\nexport async function ipnsValidator (key: Uint8Array, marshalledData: Uint8Array): Promise<void> {\n  if (marshalledData.byteLength > MAX_RECORD_SIZE) {\n    throw new RecordTooLargeError('The record is too large')\n  }\n\n  // try to extract public key from routing key\n  const routingMultihash = multihashFromIPNSRoutingKey(key)\n  let routingPubKey: PublicKey | undefined\n\n  // identity hash\n  if (isCodec(routingMultihash, 0x0)) {\n    routingPubKey = publicKeyFromMultihash(routingMultihash)\n  }\n\n  // extract public key from record\n  const receivedRecord = unmarshalIPNSRecord(marshalledData)\n  const recordPubKey = extractPublicKeyFromIPNSRecord(receivedRecord) ?? routingPubKey\n\n  if (recordPubKey == null) {\n    throw new InvalidEmbeddedPublicKeyError('Could not extract public key from IPNS record or routing key')\n  }\n\n  const routingKey = multihashToIPNSRoutingKey(recordPubKey.toMultihash())\n\n  if (!uint8ArrayEquals(key, routingKey)) {\n    throw new InvalidEmbeddedPublicKeyError('Embedded public key did not match routing key')\n  }\n\n  // Record validation\n  await validate(recordPubKey, marshalledData)\n}\n", "/**\n * A serialized message was received that was too large\n */\nexport class InvalidMessageLengthError extends Error {\n  name = 'InvalidMessageLengthError'\n  code = 'ERR_INVALID_MESSAGE_LENGTH'\n}\n", "import { isUint8ArrayList } from 'uint8arraylist'\nimport { InvalidMessageLengthError } from './errors.js'\nimport type { Uint8ArrayList } from 'uint8arraylist'\n\nexport interface ParseOptions {\n  /**\n   * Limit the possible size of incoming serialized messages in bytes\n   */\n  maxMessageLength?: number\n}\n\nexport default async function * parse <T> (source: AsyncIterable<Uint8Array | Uint8ArrayList | string> | Iterable<Uint8Array | Uint8ArrayList | string>, opts: ParseOptions = {}): AsyncGenerator<T, void, undefined> {\n  const matcher = /\\r?\\n/\n  const decoder = new TextDecoder('utf8')\n  let buffer = ''\n\n  for await (let chunk of source) {\n    if (typeof chunk === 'string') {\n      chunk = new TextEncoder().encode(chunk)\n    }\n\n    if (isUint8ArrayList(chunk)) {\n      chunk = chunk.subarray()\n    }\n\n    buffer += decoder.decode(chunk, { stream: true })\n\n    if (buffer.length > (opts?.maxMessageLength ?? buffer.length)) {\n      throw new InvalidMessageLengthError('Incoming message too long')\n    }\n\n    const parts = buffer.split(matcher)\n    buffer = parts.pop() ?? ''\n\n    for (let i = 0; i < parts.length; i++) {\n      yield JSON.parse(parts[i])\n    }\n  }\n\n  buffer += decoder.decode()\n\n  if (buffer !== '') {\n    yield JSON.parse(buffer)\n  }\n}\n", "export class InvalidRequestError extends Error {\n  static name = 'InvalidRequestError'\n\n  constructor (message = 'Invalid request') {\n    super(message)\n    this.name = 'InvalidRequestError'\n  }\n}\n\nexport class BadResponseError extends Error {\n  static name = 'BadResponseError'\n\n  constructor (message = 'Bad response') {\n    super(message)\n    this.name = 'BadResponseError'\n  }\n}\n", "import { type ContentRouting, type PeerRouting, type AbortOptions, type PeerId, type PeerInfo, NotFoundError } from '@libp2p/interface'\nimport { marshalIPNSRecord, multihashFromIPNSRoutingKey, unmarshalIPNSRecord } from 'ipns'\nimport first from 'it-first'\nimport map from 'it-map'\nimport { CID } from 'multiformats/cid'\nimport { equals as uint8ArrayEquals } from 'uint8arrays/equals'\nimport { fromString as uint8ArrayFromString } from 'uint8arrays/from-string'\nimport type { DelegatedRoutingV1HttpApiClient } from './index.js'\n\nconst IPNS_PREFIX = uint8ArrayFromString('/ipns/')\n\nfunction isIPNSKey (key: Uint8Array): boolean {\n  return uint8ArrayEquals(key.subarray(0, IPNS_PREFIX.byteLength), IPNS_PREFIX)\n}\n\n/**\n * Wrapper class to convert [http-routing-v1 content events](https://specs.ipfs.tech/routing/http-routing-v1/#response-body) into returned values\n */\nexport class DelegatedRoutingV1HttpApiClientContentRouting implements ContentRouting {\n  private readonly client: DelegatedRoutingV1HttpApiClient\n\n  constructor (client: DelegatedRoutingV1HttpApiClient) {\n    this.client = client\n  }\n\n  async * findProviders (cid: CID, options: AbortOptions = {}): AsyncIterable<PeerInfo> {\n    yield * map(this.client.getProviders(cid, options), (record) => {\n      return {\n        id: record.ID,\n        multiaddrs: record.Addrs ?? []\n      }\n    })\n  }\n\n  async provide (): Promise<void> {\n    // noop\n  }\n\n  async cancelReprovide (): Promise<void> {\n    // noop\n  }\n\n  async put (key: Uint8Array, value: Uint8Array, options?: AbortOptions): Promise<void> {\n    if (!isIPNSKey(key)) {\n      return\n    }\n\n    const digest = multihashFromIPNSRoutingKey(key)\n    const cid = CID.createV1(0x72, digest)\n    const record = unmarshalIPNSRecord(value)\n\n    await this.client.putIPNS(cid, record, options)\n  }\n\n  async get (key: Uint8Array, options?: AbortOptions): Promise<Uint8Array> {\n    if (!isIPNSKey(key)) {\n      throw new NotFoundError('Not found')\n    }\n\n    const digest = multihashFromIPNSRoutingKey(key)\n    const cid = CID.createV1(0x72, digest)\n\n    try {\n      const record = await this.client.getIPNS(cid, options)\n\n      return marshalIPNSRecord(record)\n    } catch (err: any) {\n      // BadResponseError is thrown when the response had no body, which means\n      // the record couldn't be found\n      if (err.name === 'BadResponseError') {\n        throw new NotFoundError('Not found')\n      }\n\n      throw err\n    }\n  }\n}\n\n/**\n * Wrapper class to convert [http-routing-v1](https://specs.ipfs.tech/routing/http-routing-v1/#response-body-0) events into expected libp2p values\n */\nexport class DelegatedRoutingV1HttpApiClientPeerRouting implements PeerRouting {\n  private readonly client: DelegatedRoutingV1HttpApiClient\n\n  constructor (client: DelegatedRoutingV1HttpApiClient) {\n    this.client = client\n  }\n\n  async findPeer (peerId: PeerId, options: AbortOptions = {}): Promise<PeerInfo> {\n    const peer = await first(this.client.getPeers(peerId, options))\n\n    if (peer != null) {\n      return {\n        id: peer.ID,\n        multiaddrs: peer.Addrs ?? []\n      }\n    }\n\n    throw new NotFoundError('Not found')\n  }\n\n  async * getClosestPeers (key: Uint8Array, options: AbortOptions = {}): AsyncIterable<PeerInfo> {\n    // noop\n  }\n}\n", "import { NotFoundError, contentRoutingSymbol, peerRoutingSymbol, setMaxListeners } from '@libp2p/interface'\nimport { logger } from '@libp2p/logger'\nimport { peerIdFromString } from '@libp2p/peer-id'\nimport { multiaddr } from '@multiformats/multiaddr'\nimport { anySignal } from 'any-signal'\nimport toIt from 'browser-readablestream-to-it'\nimport { unmarshalIPNSRecord, type IPNSRecord, marshalIPNSRecord, multihashToIPNSRoutingKey } from 'ipns'\nimport { ipnsValidator } from 'ipns/validator'\nimport { parse as ndjson } from 'it-ndjson'\nimport defer from 'p-defer'\nimport PQueue from 'p-queue'\nimport { BadResponseError, InvalidRequestError } from './errors.js'\nimport { DelegatedRoutingV1HttpApiClientContentRouting, DelegatedRoutingV1HttpApiClientPeerRouting } from './routings.js'\nimport type { DelegatedRoutingV1HttpApiClient, DelegatedRoutingV1HttpApiClientInit, GetProvidersOptions, GetPeersOptions, GetIPNSOptions, PeerRecord } from './index.js'\nimport type { ContentRouting, PeerRouting, AbortOptions, PeerId } from '@libp2p/interface'\nimport type { Multiaddr } from '@multiformats/multiaddr'\nimport type { CID } from 'multiformats'\n\nconst log = logger('delegated-routing-v1-http-api-client')\n\nconst defaultValues = {\n  concurrentRequests: 4,\n  timeout: 30e3,\n  cacheTTL: 5 * 60 * 1000, // 5 minutes default as per https://specs.ipfs.tech/routing/http-routing-v1/#response-headers\n  cacheName: 'delegated-routing-v1-cache'\n}\n\nexport class DefaultDelegatedRoutingV1HttpApiClient implements DelegatedRoutingV1HttpApiClient {\n  private started: boolean\n  private readonly httpQueue: PQueue\n  private readonly shutDownController: AbortController\n  private readonly clientUrl: URL\n  private readonly timeout: number\n  private readonly contentRouting: ContentRouting\n  private readonly peerRouting: PeerRouting\n  private readonly filterAddrs?: string[]\n  private readonly filterProtocols?: string[]\n  private readonly inFlightRequests: Map<string, Promise<Response>>\n  private readonly cacheName: string\n  private cache?: Cache\n  private readonly cacheTTL: number\n  /**\n   * Create a new DelegatedContentRouting instance\n   */\n  constructor (url: string | URL, init: DelegatedRoutingV1HttpApiClientInit = {}) {\n    this.started = false\n    this.shutDownController = new AbortController()\n    setMaxListeners(Infinity, this.shutDownController.signal)\n    this.httpQueue = new PQueue({\n      concurrency: init.concurrentRequests ?? defaultValues.concurrentRequests\n    })\n    this.inFlightRequests = new Map() // Tracks in-flight requests to avoid duplicate requests\n    this.clientUrl = url instanceof URL ? url : new URL(url)\n    this.timeout = init.timeout ?? defaultValues.timeout\n    this.filterAddrs = init.filterAddrs\n    this.filterProtocols = init.filterProtocols\n    this.contentRouting = new DelegatedRoutingV1HttpApiClientContentRouting(this)\n    this.peerRouting = new DelegatedRoutingV1HttpApiClientPeerRouting(this)\n\n    this.cacheName = init.cacheName ?? defaultValues.cacheName\n    this.cacheTTL = init.cacheTTL ?? defaultValues.cacheTTL\n  }\n\n  get [contentRoutingSymbol] (): ContentRouting {\n    return this.contentRouting\n  }\n\n  get [peerRoutingSymbol] (): PeerRouting {\n    return this.peerRouting\n  }\n\n  isStarted (): boolean {\n    return this.started\n  }\n\n  async start (): Promise<void> {\n    if (this.started) {\n      return\n    }\n\n    this.started = true\n\n    if (this.cacheTTL > 0) {\n      this.cache = await globalThis.caches?.open(this.cacheName)\n\n      if (this.cache != null) {\n        log('cache enabled with ttl %d', this.cacheTTL)\n      }\n    }\n  }\n\n  async stop (): Promise<void> {\n    this.httpQueue.clear()\n    this.shutDownController.abort()\n\n    // Clear the cache when stopping\n    await globalThis.caches?.delete(this.cacheName)\n\n    this.started = false\n  }\n\n  async * getProviders (cid: CID, options: GetProvidersOptions = {}): AsyncGenerator<PeerRecord> {\n    log('getProviders starts: %c', cid)\n\n    const timeoutSignal = AbortSignal.timeout(this.timeout)\n    const signal = anySignal([this.shutDownController.signal, timeoutSignal, options.signal])\n    setMaxListeners(Infinity, timeoutSignal, signal)\n    const onStart = defer()\n    const onFinish = defer()\n\n    void this.httpQueue.add(async () => {\n      onStart.resolve()\n      return onFinish.promise\n    })\n\n    try {\n      await onStart.promise\n\n      // https://specs.ipfs.tech/routing/http-routing-v1/\n      const url = new URL(`${this.clientUrl}routing/v1/providers/${cid.toString()}`)\n      this.#addFilterParams(url, options.filterAddrs, options.filterProtocols)\n      const getOptions = { headers: { Accept: 'application/x-ndjson' }, signal }\n      const res = await this.#makeRequest(url.toString(), getOptions)\n\n      if (res.status === 404) {\n        // https://specs.ipfs.tech/routing/http-routing-v1/#response-status-codes\n        // 404 (Not Found): must be returned if no matching records are found\n        throw new NotFoundError('No matching records found')\n      }\n\n      if (res.status === 422) {\n        // https://specs.ipfs.tech/routing/http-routing-v1/#response-status-codes\n        // 422 (Unprocessable Entity): request does not conform to schema or semantic constraints\n        throw new InvalidRequestError('Request does not conform to schema or semantic constraints')\n      }\n\n      if (res.body == null) {\n        throw new BadResponseError('Routing response had no body')\n      }\n\n      const contentType = res.headers.get('Content-Type')\n      if (contentType === 'application/json') {\n        const body = await res.json()\n\n        for (const provider of body.Providers) {\n          const record = this.#conformToPeerSchema(provider)\n          if (record != null) {\n            yield record\n          }\n        }\n      } else {\n        for await (const provider of ndjson(toIt(res.body))) {\n          const record = this.#conformToPeerSchema(provider)\n          if (record != null) {\n            yield record\n          }\n        }\n      }\n    } catch (err) {\n      log.error('getProviders errored:', err)\n    } finally {\n      signal.clear()\n      onFinish.resolve()\n      log('getProviders finished: %c', cid)\n    }\n  }\n\n  async * getPeers (peerId: PeerId, options: GetPeersOptions = {}): AsyncGenerator<PeerRecord> {\n    log('getPeers starts: %c', peerId)\n\n    const timeoutSignal = AbortSignal.timeout(this.timeout)\n    const signal = anySignal([this.shutDownController.signal, timeoutSignal, options.signal])\n    setMaxListeners(Infinity, timeoutSignal, signal)\n    const onStart = defer()\n    const onFinish = defer()\n\n    void this.httpQueue.add(async () => {\n      onStart.resolve()\n      return onFinish.promise\n    })\n\n    try {\n      await onStart.promise\n\n      // https://specs.ipfs.tech/routing/http-routing-v1/\n      const url = new URL(`${this.clientUrl}routing/v1/peers/${peerId.toCID().toString()}`)\n      this.#addFilterParams(url, options.filterAddrs, options.filterProtocols)\n\n      const getOptions = { headers: { Accept: 'application/x-ndjson' }, signal }\n      const res = await this.#makeRequest(url.toString(), getOptions)\n\n      if (res.status === 404) {\n        // https://specs.ipfs.tech/routing/http-routing-v1/#response-status-codes\n        // 404 (Not Found): must be returned if no matching records are found.\n        throw new NotFoundError('No matching records found')\n      }\n\n      if (res.status === 422) {\n        // https://specs.ipfs.tech/routing/http-routing-v1/#response-status-codes\n        // 422 (Unprocessable Entity): request does not conform to schema or semantic constraints\n        throw new InvalidRequestError('Request does not conform to schema or semantic constraints')\n      }\n\n      if (res.body == null) {\n        throw new BadResponseError('Routing response had no body')\n      }\n\n      const contentType = res.headers.get('Content-Type')\n      if (contentType === 'application/json') {\n        const body = await res.json()\n\n        for (const peer of body.Peers) {\n          const record = this.#conformToPeerSchema(peer)\n          if (record != null) {\n            yield record\n          }\n        }\n      } else {\n        for await (const peer of ndjson(toIt(res.body))) {\n          const record = this.#conformToPeerSchema(peer)\n          if (record != null) {\n            yield record\n          }\n        }\n      }\n    } catch (err) {\n      log.error('getPeers errored:', err)\n    } finally {\n      signal.clear()\n      onFinish.resolve()\n      log('getPeers finished: %c', peerId)\n    }\n  }\n\n  async getIPNS (libp2pKey: CID<unknown, 0x72, 0x00 | 0x12, 1>, options: GetIPNSOptions = {}): Promise<IPNSRecord> {\n    log('getIPNS starts: %s', libp2pKey)\n\n    const timeoutSignal = AbortSignal.timeout(this.timeout)\n    const signal = anySignal([this.shutDownController.signal, timeoutSignal, options.signal])\n    setMaxListeners(Infinity, timeoutSignal, signal)\n    const onStart = defer()\n    const onFinish = defer()\n\n    void this.httpQueue.add(async () => {\n      onStart.resolve()\n      return onFinish.promise\n    })\n\n    // https://specs.ipfs.tech/routing/http-routing-v1/\n    const resource = `${this.clientUrl}routing/v1/ipns/${libp2pKey}`\n\n    try {\n      await onStart.promise\n\n      const getOptions = { headers: { Accept: 'application/vnd.ipfs.ipns-record' }, signal }\n      const res = await this.#makeRequest(resource, getOptions)\n\n      log('getIPNS GET %s %d', resource, res.status)\n\n      if (res.status === 404) {\n        // https://specs.ipfs.tech/routing/http-routing-v1/#response-status-codes\n        // 404 (Not Found): must be returned if no matching records are found\n        throw new NotFoundError('No matching records found')\n      }\n\n      if (res.status === 422) {\n        // https://specs.ipfs.tech/routing/http-routing-v1/#response-status-codes\n        // 422 (Unprocessable Entity): request does not conform to schema or semantic constraints\n        throw new InvalidRequestError('Request does not conform to schema or semantic constraints')\n      }\n\n      if (res.body == null) {\n        throw new BadResponseError('GET ipns response had no body')\n      }\n\n      const buf = await res.arrayBuffer()\n      const body = new Uint8Array(buf, 0, buf.byteLength)\n\n      if (options.validate !== false) {\n        await ipnsValidator(multihashToIPNSRoutingKey(libp2pKey.multihash), body)\n      }\n\n      return unmarshalIPNSRecord(body)\n    } catch (err: any) {\n      log.error('getIPNS GET %s error:', resource, err)\n\n      throw err\n    } finally {\n      signal.clear()\n      onFinish.resolve()\n      log('getIPNS finished: %s', libp2pKey)\n    }\n  }\n\n  async putIPNS (libp2pKey: CID<unknown, 0x72, 0x00 | 0x12, 1>, record: IPNSRecord, options: AbortOptions = {}): Promise<void> {\n    log('putIPNS starts: %c', libp2pKey)\n\n    const timeoutSignal = AbortSignal.timeout(this.timeout)\n    const signal = anySignal([this.shutDownController.signal, timeoutSignal, options.signal])\n    setMaxListeners(Infinity, timeoutSignal, signal)\n    const onStart = defer()\n    const onFinish = defer()\n\n    void this.httpQueue.add(async () => {\n      onStart.resolve()\n      return onFinish.promise\n    })\n\n    // https://specs.ipfs.tech/routing/http-routing-v1/\n    const resource = `${this.clientUrl}routing/v1/ipns/${libp2pKey}`\n\n    try {\n      await onStart.promise\n\n      const body = marshalIPNSRecord(record)\n\n      const getOptions = { method: 'PUT', headers: { 'Content-Type': 'application/vnd.ipfs.ipns-record' }, body, signal }\n      const res = await this.#makeRequest(resource, getOptions)\n\n      log('putIPNS PUT %s %d', resource, res.status)\n\n      if (res.status !== 200) {\n        throw new BadResponseError('PUT ipns response had status other than 200')\n      }\n    } catch (err: any) {\n      log.error('putIPNS PUT %s error:', resource, err.stack)\n\n      throw err\n    } finally {\n      signal.clear()\n      onFinish.resolve()\n      log('putIPNS finished: %c', libp2pKey)\n    }\n  }\n\n  #conformToPeerSchema (record: any): PeerRecord | undefined {\n    try {\n      const protocols: string[] = []\n      const multiaddrs: Multiaddr[] = record.Addrs?.map(multiaddr) ?? []\n\n      if (record.Protocols != null) {\n        protocols.push(...record.Protocols)\n      }\n\n      if (record.Protocol != null) {\n        protocols.push(record.Protocol)\n        delete record.Protocol\n      }\n\n      return {\n        ...record,\n        Schema: 'peer',\n        ID: peerIdFromString(record.ID),\n        Addrs: multiaddrs,\n        Protocols: protocols\n      }\n    } catch (err) {\n      log.error('could not conform record to peer schema', err)\n    }\n  }\n\n  #addFilterParams (url: URL, filterAddrs?: string[], filterProtocols?: string[]): void {\n    // IPIP-484 filtering. local options filter precedence over global filter\n    if (filterAddrs != null || this.filterAddrs != null) {\n      const adressFilter = filterAddrs?.join(',') ?? this.filterAddrs?.join(',') ?? ''\n      if (adressFilter !== '') {\n        url.searchParams.set('filter-addrs', adressFilter)\n      }\n    }\n    if (filterProtocols != null || this.filterProtocols != null) {\n      const protocolFilter = filterProtocols?.join(',') ?? this.filterProtocols?.join(',') ?? ''\n      if (protocolFilter !== '') {\n        url.searchParams.set('filter-protocols', protocolFilter)\n      }\n    }\n  }\n\n  /**\n   * makeRequest has two features:\n   * - Ensures only one concurrent request is made for the same URL\n   * - Caches GET requests if the Cache API is available\n   */\n  async #makeRequest (url: string, options: RequestInit): Promise<Response> {\n    const requestMethod = options.method ?? 'GET'\n    const key = `${requestMethod}-${url}`\n\n    // Only try to use cache for GET requests\n    if (requestMethod === 'GET') {\n      const cachedResponse = await this.cache?.match(url)\n      if (cachedResponse != null) {\n        // Check if the cached response has expired\n        const expires = parseInt(cachedResponse.headers.get('x-cache-expires') ?? '0', 10)\n        if (expires > Date.now()) {\n          log('returning cached response for %s', key)\n          return cachedResponse\n        } else {\n          // Remove expired response from cache\n          await this.cache?.delete(url)\n        }\n      }\n    }\n\n    // Check if there's already an in-flight request for this URL\n    const existingRequest = this.inFlightRequests.get(key)\n    if (existingRequest != null) {\n      const response = await existingRequest\n      log('deduplicating outgoing request for %s', key)\n      return response.clone()\n    }\n\n    // Create new request and track it\n    const requestPromise = fetch(url, options).then(async response => {\n      // Only cache successful GET requests\n      if (this.cache != null && response.ok && requestMethod === 'GET') {\n        const expires = Date.now() + this.cacheTTL\n        const headers = new Headers(response.headers)\n        headers.set('x-cache-expires', expires.toString())\n\n        // Create a new response with expiration header\n        const cachedResponse = new Response(response.clone().body, {\n          status: response.status,\n          statusText: response.statusText,\n          headers\n        })\n\n        await this.cache.put(url, cachedResponse)\n      }\n      return response\n    }).finally(() => {\n      // Clean up the tracked request when it completes\n      this.inFlightRequests.delete(key)\n    })\n\n    this.inFlightRequests.set(key, requestPromise)\n    const response = await requestPromise\n    return response\n  }\n}\n", "/**\n * @packageDocumentation\n *\n * A client implementation of the IPFS [Delegated Routing V1 HTTP API](https://specs.ipfs.tech/routing/http-routing-v1/) that can be used to interact with any compliant server implementation.\n *\n * @example\n *\n * ```typescript\n * import { createDelegatedRoutingV1HttpApiClient } from '@helia/delegated-routing-v1-http-api-client'\n * import { CID } from 'multiformats/cid'\n *\n * const client = createDelegatedRoutingV1HttpApiClient('https://example.org')\n *\n * for await (const prov of getProviders(CID.parse('QmFoo'))) {\n *   // ...\n * }\n * ```\n *\n * ### How to use with libp2p\n *\n * The client can be configured as a libp2p service, this will enable it as both a {@link https://libp2p.github.io/js-libp2p/interfaces/_libp2p_interface.content_routing.ContentRouting.html | ContentRouting} and a {@link https://libp2p.github.io/js-libp2p/interfaces/_libp2p_interface.peer_routing.PeerRouting.html | PeerRouting} implementation\n *\n * @example\n *\n * ```typescript\n * import { createDelegatedRoutingV1HttpApiClient } from '@helia/delegated-routing-v1-http-api-client'\n * import { createLibp2p } from 'libp2p'\n * import { peerIdFromString } from '@libp2p/peer-id'\n *\n * const client = createDelegatedRoutingV1HttpApiClient('https://example.org')\n * const libp2p = await createLibp2p({\n *   // other config here\n *   services: {\n *     delegatedRouting: client\n *   }\n * })\n *\n * // later this will use the configured HTTP gateway\n * await libp2p.peerRouting.findPeer(peerIdFromString('QmFoo'))\n * ```\n *\n * ### Caching\n *\n * By default, the client caches successful (200) delegated routing responses in browser environments (that support the [Cache API](https://developer.mozilla.org/en-US/docs/Web/API/Cache)) for a duration of 5 minutes. The client does this by adding an `x-cache-expires` header to the response object.\n *\n * If caching is enabled, the client will cache responses for the duration of `cacheTTL` milliseconds.\n * If `cacheTTL` is 0, caching is disabled:\n *\n * @example\n *\n * ```typescript\n * // disable caching\n * const client = createDelegatedRoutingV1HttpApiClient('https://example.org', { cacheTTL: 0 })\n * ```\n *\n * ### Filtering with IPIP-484\n *\n * The client can be configured to pass filter options to the delegated routing server as defined in IPIP-484.\n * The filter options be set globally, by passing them to the client constructor, or on a per-request basis.\n *\n * @see https://github.com/ipfs/specs/pull/484\n *\n * @example\n *\n * ```typescript\n * import { createDelegatedRoutingV1HttpApiClient } from '@helia/delegated-routing-v1-http-api-client'\n * import { createLibp2p } from 'libp2p'\n * import { peerIdFromString } from '@libp2p/peer-id'\n *\n * // globally set filter options\n * const client = createDelegatedRoutingV1HttpApiClient('https://delegated-ipfs.dev', {\n *   filterProtocols: ['transport-bitswap', 'unknown', 'transport-ipfs-gateway-http'],\n *   filterAddrs: ['webtransport', 'webrtc-direct', 'wss']\n * })\n *\n * // per-request filter options\n * for await (const prov of getProviders(CID.parse('bafy'), {\n *   filterProtocols: ['transport-ipfs-gateway-http'],\n *   filterAddrs: ['!p2p-circuit']\n * })) {\n *   // ...\n * }\n * ```\n */\n\nimport { DefaultDelegatedRoutingV1HttpApiClient } from './client.js'\nimport type { AbortOptions, PeerId } from '@libp2p/interface'\nimport type { Multiaddr } from '@multiformats/multiaddr'\nimport type { IPNSRecord } from 'ipns'\nimport type { CID } from 'multiformats/cid'\n\n/**\n * A peer that conforms to the [Peer Schema](https://specs.ipfs.tech/routing/http-routing-v1/#peer-schema).\n *\n * Note that legacy schemas may be reformatted internally by this module.\n *\n * If `Addrs` is empty, a caller may wish to perform a `findPeer` operation to\n * ascertain the peer's multiaddrs.\n *\n * If `Protocols` is empty, a caller may wish to dial the peer and peform a\n * libp2p identify operation to ascertain the peer's supported protocols.\n */\nexport interface PeerRecord {\n  Schema: 'peer'\n  ID: PeerId\n  Addrs: Multiaddr[]\n  Protocols: string[]\n}\n\nexport interface FilterOptions {\n  /**\n   * List of protocols to filter in the PeerRecords as defined in IPIP-484\n   * If undefined, PeerRecords are not filtered by protocol\n   *\n   * @see https://github.com/ipfs/specs/pull/484\n   * @default undefined\n   */\n  filterProtocols?: string[]\n\n  /**\n   * Array of address filters to filter PeerRecords's addresses as defined in IPIP-484\n   * If undefined, PeerRecords are not filtered by address\n   *\n   * @see https://github.com/ipfs/specs/pull/484\n   * @default undefined\n   */\n  filterAddrs?: string[]\n}\nexport interface DelegatedRoutingV1HttpApiClientInit extends FilterOptions {\n  /**\n   * A concurrency limit to avoid request flood in web browser (default: 4)\n   *\n   * @see https://github.com/libp2p/js-libp2p-delegated-content-routing/issues/12\n   */\n  concurrentRequests?: number\n\n  /**\n   * How long a request is allowed to take in ms (default: 30 seconds)\n   */\n  timeout?: number\n\n  /**\n   * How long to cache responses for in ms (default: 5 minutes)\n   * If 0, caching is disabled\n   */\n  cacheTTL?: number\n\n  /**\n   * Where a [Cache](https://developer.mozilla.org/en-US/docs/Web/API/Cache) is\n   * available in the global scope, we will store request/responses to avoid\n   * making duplicate requests.\n   *\n   * @default 'delegated-routing-v1-cache'\n   */\n  cacheName?: string\n}\n\nexport interface GetIPNSOptions extends AbortOptions {\n  /**\n   * By default incoming IPNS records are validated, pass false here to skip\n   * validation and just return the record.\n   *\n   * @default true\n   */\n  validate?: boolean\n}\n\nexport type GetProvidersOptions = FilterOptions & AbortOptions\nexport type GetPeersOptions = FilterOptions & AbortOptions\n\nexport interface DelegatedRoutingV1HttpApiClient {\n  /**\n   * Returns an async generator of {@link PeerRecord}s that can provide the\n   * content for the passed {@link CID}\n   */\n  getProviders(cid: CID, options?: GetProvidersOptions): AsyncGenerator<PeerRecord>\n\n  /**\n   * Returns an async generator of {@link PeerRecord}s for the provided\n   * {@link PeerId}\n   */\n  getPeers(peerId: PeerId, options?: GetPeersOptions): AsyncGenerator<PeerRecord>\n\n  /**\n   * Returns a promise of a {@link IPNSRecord} for the given {@link MultihashDigest}\n   */\n  getIPNS(libp2pKey: CID<unknown, 0x72, 0x00 | 0x12, 1>, options?: GetIPNSOptions): Promise<IPNSRecord>\n\n  /**\n   * Publishes the given {@link IPNSRecord} for the provided {@link MultihashDigest}\n   */\n  putIPNS(libp2pKey: CID<unknown, 0x72, 0x00 | 0x12, 1>, record: IPNSRecord, options?: AbortOptions): Promise<void>\n\n  /**\n   * Create the request/response cache used to ensure duplicate requests aren't\n   * made for the same data\n   */\n  start(): Promise<void>\n\n  /**\n   * Shut down any currently running HTTP requests and clear up any resources\n   * that are in use\n   */\n  stop(): Promise<void>\n}\n\n/**\n * Create and return a client to use with a Routing V1 HTTP API server\n */\nexport function createDelegatedRoutingV1HttpApiClient (url: URL | string, init: DelegatedRoutingV1HttpApiClientInit = {}): DelegatedRoutingV1HttpApiClient {\n  return new DefaultDelegatedRoutingV1HttpApiClient(new URL(url), init)\n}\n", "import type { DelegatedRoutingV1HttpApiClientInit } from '@helia/delegated-routing-v1-http-api-client'\n\nexport function delegatedHTTPRoutingDefaults (): DelegatedRoutingV1HttpApiClientInit {\n  return {\n    filterProtocols: ['unknown', 'transport-bitswap', 'transport-ipfs-gateway-http'],\n    filterAddrs: ['https', 'webtransport', 'webrtc', 'webrtc-direct', 'wss', 'tls']\n  }\n}\n", "import { createDelegatedRoutingV1HttpApiClient } from '@helia/delegated-routing-v1-http-api-client'\nimport { NotFoundError } from '@libp2p/interface'\nimport { marshalIPNSRecord, multihashFromIPNSRoutingKey, unmarshalIPNSRecord } from 'ipns'\nimport first from 'it-first'\nimport map from 'it-map'\nimport { CID } from 'multiformats/cid'\nimport { equals as uint8ArrayEquals } from 'uint8arrays/equals'\nimport { fromString as uint8ArrayFromString } from 'uint8arrays/from-string'\nimport { delegatedHTTPRoutingDefaults } from './utils/delegated-http-routing-defaults.js'\nimport type { DelegatedRoutingV1HttpApiClient, DelegatedRoutingV1HttpApiClientInit } from '@helia/delegated-routing-v1-http-api-client'\nimport type { Provider, Routing, RoutingOptions } from '@helia/interface'\nimport type { PeerId, PeerInfo } from '@libp2p/interface'\nimport type { Version } from 'multiformats'\n\nconst IPNS_PREFIX = uint8ArrayFromString('/ipns/')\n\nfunction isIPNSKey (key: Uint8Array): boolean {\n  return uint8ArrayEquals(key.subarray(0, IPNS_PREFIX.byteLength), IPNS_PREFIX)\n}\n\nclass DelegatedHTTPRouter implements Routing {\n  private readonly client: DelegatedRoutingV1HttpApiClient\n\n  constructor (url: URL, init: DelegatedRoutingV1HttpApiClientInit = {}) {\n    this.client = createDelegatedRoutingV1HttpApiClient(url, init)\n  }\n\n  async provide (cid: CID, options?: RoutingOptions): Promise<void> {\n    // noop\n  }\n\n  async cancelReprovide (cid?: CID, options?: RoutingOptions): Promise<void> {\n    // noop\n  }\n\n  async * findProviders (cid: CID<unknown, number, number, Version>, options?: RoutingOptions): AsyncIterable<Provider> {\n    yield * map(this.client.getProviders(cid, options), (record) => {\n      return {\n        id: record.ID,\n        multiaddrs: record.Addrs,\n        protocols: record.Protocols\n      }\n    })\n  }\n\n  async put (key: Uint8Array, value: Uint8Array, options?: RoutingOptions): Promise<void> {\n    if (!isIPNSKey(key)) {\n      return\n    }\n\n    const digest = multihashFromIPNSRoutingKey(key)\n    const cid = CID.createV1(0x72, digest)\n    const record = unmarshalIPNSRecord(value)\n\n    await this.client.putIPNS(cid, record, options)\n  }\n\n  async get (key: Uint8Array, options?: RoutingOptions): Promise<Uint8Array> {\n    if (!isIPNSKey(key)) {\n      throw new NotFoundError('Not found')\n    }\n\n    const digest = multihashFromIPNSRoutingKey(key)\n    const cid = CID.createV1(0x72, digest)\n\n    try {\n      const record = await this.client.getIPNS(cid, options)\n\n      return marshalIPNSRecord(record)\n    } catch (err: any) {\n      // BadResponseError is thrown when the response had no body, which means\n      // the record couldn't be found\n      if (err.name === 'BadResponseError') {\n        throw new NotFoundError('Not found')\n      }\n\n      throw err\n    }\n  }\n\n  async findPeer (peerId: PeerId, options?: RoutingOptions): Promise<PeerInfo> {\n    const peer = await first(this.client.getPeers(peerId, options))\n\n    if (peer != null) {\n      return {\n        id: peer.ID,\n        multiaddrs: peer.Addrs ?? []\n      }\n    }\n\n    throw new NotFoundError('Not found')\n  }\n\n  async * getClosestPeers (key: Uint8Array, options?: RoutingOptions): AsyncIterable<PeerInfo> {\n    // noop\n  }\n}\n\n/**\n * Creates a Helia Router that connects to an endpoint that supports the [Delegated Routing V1 HTTP API](https://specs.ipfs.tech/routing/http-routing-v1/) spec.\n */\nexport function delegatedHTTPRouting (url: string | URL, init?: DelegatedRoutingV1HttpApiClientInit): Routing {\n  const config = init ?? delegatedHTTPRoutingDefaults()\n  return new DelegatedHTTPRouter(new URL(url), config)\n}\n", "const word = '[a-fA-F\\\\d:]';\n\nconst boundry = options => options && options.includeBoundaries\n\t? `(?:(?<=\\\\s|^)(?=${word})|(?<=${word})(?=\\\\s|$))`\n\t: '';\n\nconst v4 = '(?:25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]\\\\d|\\\\d)(?:\\\\.(?:25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]\\\\d|\\\\d)){3}';\n\nconst v6segment = '[a-fA-F\\\\d]{1,4}';\n\nconst v6 = `\n(?:\n(?:${v6segment}:){7}(?:${v6segment}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:${v6segment}:){6}(?:${v4}|:${v6segment}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:${v6segment}:){5}(?::${v4}|(?::${v6segment}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:${v6segment}:){4}(?:(?::${v6segment}){0,1}:${v4}|(?::${v6segment}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:${v6segment}:){3}(?:(?::${v6segment}){0,2}:${v4}|(?::${v6segment}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:${v6segment}:){2}(?:(?::${v6segment}){0,3}:${v4}|(?::${v6segment}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:${v6segment}:){1}(?:(?::${v6segment}){0,4}:${v4}|(?::${v6segment}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::${v6segment}){0,5}:${v4}|(?::${v6segment}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n`.replace(/\\s*\\/\\/.*$/gm, '').replace(/\\n/g, '').trim();\n\n// Pre-compile only the exact regexes because adding a global flag make regexes stateful\nconst v46Exact = new RegExp(`(?:^${v4}$)|(?:^${v6}$)`);\nconst v4exact = new RegExp(`^${v4}$`);\nconst v6exact = new RegExp(`^${v6}$`);\n\nconst ipRegex = options => options && options.exact\n\t? v46Exact\n\t: new RegExp(`(?:${boundry(options)}${v4}${boundry(options)})|(?:${boundry(options)}${v6}${boundry(options)})`, 'g');\n\nipRegex.v4 = options => options && options.exact ? v4exact : new RegExp(`${boundry(options)}${v4}${boundry(options)}`, 'g');\nipRegex.v6 = options => options && options.exact ? v6exact : new RegExp(`${boundry(options)}${v6}${boundry(options)}`, 'g');\n\nexport default ipRegex;\n", "// Even though the browser version is a no-op, we wrap it to ensure consistent behavior.\nexport default function functionTimeout(function_) {\n\tconst wrappedFunction = (...arguments_) => function_(...arguments_);\n\n\tObject.defineProperty(wrappedFunction, 'name', {\n\t\tvalue: `functionTimeout(${function_.name || '<anonymous>'})`,\n\t\tconfigurable: true,\n\t});\n\n\treturn wrappedFunction;\n}\n\nexport function isTimeoutError() {\n\treturn false;\n}\n", "const {toString} = Object.prototype;\n\nexport default function isRegexp(value) {\n\treturn toString.call(value) === '[object RegExp]';\n}\n", "import isRegexp from 'is-regexp';\n\nconst flagMap = {\n\tglobal: 'g',\n\tignoreCase: 'i',\n\tmultiline: 'm',\n\tdotAll: 's',\n\tsticky: 'y',\n\tunicode: 'u'\n};\n\nexport default function clonedRegexp(regexp, options = {}) {\n\tif (!isRegexp(regexp)) {\n\t\tthrow new TypeError('Expected a RegExp instance');\n\t}\n\n\tconst flags = Object.keys(flagMap).map(flag => (\n\t\t(typeof options[flag] === 'boolean' ? options[flag] : regexp[flag]) ? flagMap[flag] : ''\n\t)).join('');\n\n\tconst clonedRegexp = new RegExp(options.source || regexp.source, flags);\n\n\tclonedRegexp.lastIndex = typeof options.lastIndex === 'number' ?\n\t\toptions.lastIndex :\n\t\tregexp.lastIndex;\n\n\treturn clonedRegexp;\n}\n", "import functionTimeout, {isTimeoutError} from 'function-timeout';\nimport timeSpan from 'time-span';\nimport cloneRegexp from 'clone-regexp'; // TODO: Use `structuredClone` instead when targeting Node.js 18.\n\nconst resultToMatch = result => ({\n\tmatch: result[0],\n\tindex: result.index,\n\tgroups: result.slice(1),\n\tnamedGroups: result.groups ?? {},\n\tinput: result.input,\n});\n\nexport function isMatch(regex, string, {timeout} = {}) {\n\ttry {\n\t\treturn functionTimeout(() => cloneRegexp(regex).test(string), {timeout})();\n\t} catch (error) {\n\t\tif (isTimeoutError(error)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthrow error;\n\t}\n}\n\nexport function firstMatch(regex, string, {timeout} = {}) {\n\ttry {\n\t\tconst result = functionTimeout(() => cloneRegexp(regex).exec(string), {timeout})();\n\n\t\tif (result === null) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn resultToMatch(result);\n\t} catch (error) {\n\t\tif (isTimeoutError(error)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthrow error;\n\t}\n}\n\nexport function matches(regex, string, {timeout = Number.POSITIVE_INFINITY, matchTimeout = Number.POSITIVE_INFINITY} = {}) {\n\tif (!regex.global) {\n\t\tthrow new Error('The regex must have the global flag, otherwise, use `firstMatch()` instead');\n\t}\n\n\treturn {\n\t\t* [Symbol.iterator]() {\n\t\t\ttry {\n\t\t\t\tconst matches = string.matchAll(regex); // The regex is only executed when iterated over.\n\n\t\t\t\twhile (true) {\n\t\t\t\t\tconst nextMatch = functionTimeout(() => matches.next(), {timeout: (timeout !== Number.POSITIVE_INFINITY || matchTimeout !== Number.POSITIVE_INFINITY) ? Math.min(timeout, matchTimeout) : undefined}); // `matches.next` must be called within an arrow function so that it doesn't loose its context.\n\n\t\t\t\t\tconst end = timeSpan();\n\t\t\t\t\tconst {value, done} = nextMatch();\n\t\t\t\t\ttimeout -= Math.ceil(end());\n\n\t\t\t\t\tif (done) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tyield resultToMatch(value);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tif (!isTimeoutError(error)) {\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t};\n}\n", "import ipRegex from 'ip-regex';\nimport {isMatch} from 'super-regex';\n\nconst maxIPv4Length = 15;\nconst maxIPv6Length = 45;\n\nconst options = {\n\ttimeout: 400,\n};\n\nexport function isIP(string) {\n\tif (string.length > maxIPv6Length) {\n\t\treturn false;\n\t}\n\n\treturn isMatch(ipRegex({exact: true}), string, options);\n}\n\nexport function isIPv6(string) {\n\tif (string.length > maxIPv6Length) {\n\t\treturn false;\n\t}\n\n\treturn isMatch(ipRegex.v6({exact: true}), string, options);\n}\n\nexport function isIPv4(string) {\n\tif (string.length > maxIPv4Length) {\n\t\treturn false;\n\t}\n\n\treturn isMatch(ipRegex.v4({exact: true}), string, options);\n}\n\nexport function ipVersion(string) {\n\tif (isIPv6(string)) {\n\t\treturn 6;\n\t}\n\n\tif (isIPv4(string)) {\n\t\treturn 4;\n\t}\n}\n", "/**\n * @packageDocumentation\n *\n * ```typescript\n * import { uriToMultiaddr } from '@multiformats/uri-to-multiaddr'\n *\n * console.log(uriToMultiaddr('https://protocol.ai'))\n * // -> /dns4/protocol.ai/tcp/443/https\n * ```\n *\n * Domain names can represent one of\n *\n * - `/dns4` - domain resolves to an ipv4 address (**default**)\n * - `/dns6` - domain resolves to an ipv6 address\n * - `/dnsaddr` - domain has a [DNSLink](https://docs.ipfs.io/guides/concepts/dnslink/) TXT record pointing to an IPFS CID\n *\n * This library assumes `/dns4` when it finds a domain name in the input string.\n * It makes no attempt query DNS. To override the default assumption, you can pass\n * in an options object as the second parameter to override it:\n *\n * ```typescript\n * import { uriToMultiaddr } from '@multiformats/uri-to-multiaddr'\n *\n * console.log(uriToMultiaddr('https://protocol.ai'), { defaultDnsType: 'dns6' })\n * // -> /dns6/protocol.ai/tcp/443/https\n * ```\n *\n * See [test.js](./test.js) for the currently supported conversions.\n *\n * **Note**: `uri-to-multiaddr` will throw if the passed URI:\n *\n * - is not a valid, according the WHATWG URL spec implementation used.\n * - is not supported yet\n *\n * ## Related\n *\n * - [@multiformats/multiaddr-to-uri](https://github.com/multiformats/js-multiaddr-to-uri) - convert it back again\n */\n\nimport { multiaddr } from '@multiformats/multiaddr'\nimport { isIPv4, isIPv6 } from 'is-ip'\nimport type { Multiaddr } from '@multiformats/multiaddr'\n\nconst portFor: Record<string, string> = {\n  http: '80',\n  https: '443',\n  ws: '80',\n  wss: '443'\n}\n\nconst BROWSER_SCHEMES = ['http', 'https', 'ws', 'wss']\n\nexport interface MultiaddrFromUriOpts {\n  defaultDnsType?: string\n}\n\n/**\n * Convert a URI to a multiaddr\n *\n * http://foobar.com => /dns4/foobar.com/tcp/80/http\n * https://foobar.com => /dns4/foobar.com/tcp/443/https\n * https://foobar.com:5001 => /dns4/foobar.com/tcp/5001/https\n * https://127.0.0.1:8080 => /ip4/127.0.0.1/tcp/8080/https\n * http://[::1]:8080 => /ip6/::1/tcp/8080/http\n * tcp://foobar.com:8080 => /dns4/foobar.com/tcp/8080\n * udp://foobar.com:8080 => /dns4/foobar.com/udp/8080\n */\n\nexport function uriToMultiaddr (uriStr: string, opts?: MultiaddrFromUriOpts): Multiaddr {\n  opts = opts ?? {}\n  const defaultDnsType = opts.defaultDnsType ?? 'dns4'\n  const { scheme, hostname, port } = parseUri(uriStr)\n  const parts = [\n    tupleForHostname(hostname, defaultDnsType),\n    tupleForPort(port, scheme),\n    tupleForScheme(scheme)\n  ]\n\n  const multiaddrStr = '/' + parts\n    .filter(x => Boolean(x))\n    // @ts-expect-error ts cannot see we filter falsy values\n    .reduce((a, b) => a.concat(b), [])\n    .join('/')\n\n  return multiaddr(multiaddrStr)\n}\n\nfunction parseUri (uriStr: string): { scheme: string, hostname: string, port: string } {\n  const [scheme] = uriStr.split(':')\n\n  // browsers will only parse URLs with schemes they understand\n  if (!BROWSER_SCHEMES.includes(scheme)) {\n    uriStr = 'http' + uriStr.substring(scheme.length)\n  }\n\n  // Use the WHATWG URL global, in node >= 10 and the browser\n  let { protocol, hostname, port } = new URL(uriStr)\n\n  if (port == null || port === '') {\n    const protocolPort = portForProtocol(scheme)\n\n    if (protocolPort != null) {\n      port = protocolPort\n    }\n\n    // browsers will omit the port when it's common\n    if (protocolPort == null && protocol === 'http:') {\n      // we overrode the protocol with http, set the port to 80\n      port = '80'\n    }\n  }\n\n  return { scheme, hostname, port }\n}\n\nfunction tupleForHostname (hostname: string, defaultDnsType: string): [string, string] | undefined {\n  if (hostname == null || hostname === '') {\n    return undefined\n  }\n\n  if (isIPv4(hostname)) {\n    return ['ip4', hostname]\n  }\n\n  if (isIPv6(hostname)) {\n    return ['ip6', hostname]\n  }\n\n  // literal ipv6 in url should be wrapped in square brackets [x:y:z]\n  // https://www.ietf.org/rfc/rfc2732.txt\n  if (hostname[0] === '[') {\n    const trimmed = hostname.substring(1, hostname.length - 1)\n    if (isIPv6(trimmed)) {\n      return ['ip6', trimmed]\n    }\n  }\n  // assumes that any non-ip hostname is a dns4 address.\n  return [defaultDnsType, hostname]\n}\n\nfunction tupleForPort (port: string, scheme: string): [string, string] | undefined {\n  if (port == null || port === '') {\n    return undefined\n  }\n\n  if (scheme === 'udp') {\n    return ['udp', port]\n  }\n\n  return ['tcp', port]\n}\n\nfunction tupleForScheme (scheme: string): [string] | undefined {\n  if (scheme.match(/^tcp$|^udp$/) != null) {\n    return undefined\n  }\n\n  return [scheme]\n}\n\nfunction portForProtocol (protocol: string): string | undefined {\n  if (protocol == null || protocol === '' || portFor[protocol] == null) {\n    return undefined\n  }\n\n  return portFor[protocol]\n}\n", "import { peerIdFromCID } from '@libp2p/peer-id'\nimport { uriToMultiaddr } from '@multiformats/uri-to-multiaddr'\nimport { CID } from 'multiformats/cid'\nimport { identity } from 'multiformats/hashes/identity'\nimport { fromString as uint8ArrayFromString } from 'uint8arrays/from-string'\nimport type { Provider, Routing, RoutingOptions } from '@helia/interface'\nimport type { PeerInfo } from '@libp2p/interface'\nimport type { Version } from 'multiformats'\n\nexport const DEFAULT_TRUSTLESS_GATEWAYS = [\n  // 2023-10-03: IPNS, Origin, and Block/CAR support from https://ipfs-public-gateway-checker.on.fleek.co/\n  'https://trustless-gateway.link',\n\n  // 2023-10-03: IPNS, Origin, and Block/CAR support from https://ipfs-public-gateway-checker.on.fleek.co/\n  'https://4everland.io'\n]\n\nexport interface HTTPGatewayRouterInit {\n  gateways?: Array<URL | string>\n}\n\n// this value is from https://github.com/multiformats/multicodec/blob/master/table.csv\nconst TRANSPORT_IPFS_GATEWAY_HTTP_CODE = 0x0920\n\nfunction toPeerInfo (url: string | URL): PeerInfo {\n  url = url.toString()\n\n  return {\n    id: peerIdFromCID(CID.createV1(TRANSPORT_IPFS_GATEWAY_HTTP_CODE, identity.digest(uint8ArrayFromString(url)))),\n    multiaddrs: [\n      uriToMultiaddr(url)\n    ]\n  }\n}\n\nclass HTTPGatewayRouter implements Partial<Routing> {\n  private readonly gateways: PeerInfo[]\n\n  constructor (init: HTTPGatewayRouterInit = {}) {\n    this.gateways = (init.gateways ?? DEFAULT_TRUSTLESS_GATEWAYS).map(url => toPeerInfo(url))\n  }\n\n  async * findProviders (cid: CID<unknown, number, number, Version>, options?: RoutingOptions | undefined): AsyncIterable<Provider> {\n    yield * this.gateways.toSorted(() => Math.random() > 0.5 ? 1 : -1).map(info => ({\n      ...info,\n      protocols: ['transport-ipfs-gateway-http']\n    }))\n  }\n}\n\n/**\n * Returns a static list of HTTP Gateways as providers\n */\nexport function httpGatewayRouting (init: HTTPGatewayRouterInit = {}): Partial<Routing> {\n  return new HTTPGatewayRouter(init)\n}\n", "import type { Provider, Routing, RoutingOptions } from '@helia/interface'\nimport type { Libp2p, PeerId, PeerInfo } from '@libp2p/interface'\nimport type { CID } from 'multiformats'\n\nclass Libp2pRouter implements Routing {\n  private readonly libp2p: Libp2p\n\n  constructor (libp2p: Libp2p) {\n    this.libp2p = libp2p\n  }\n\n  async provide (cid: CID, options?: RoutingOptions): Promise<void> {\n    await this.libp2p.contentRouting.provide(cid, options)\n  }\n\n  async cancelReprovide (key: CID, options?: RoutingOptions): Promise<void> {\n    await this.libp2p.contentRouting.cancelReprovide(key, options)\n  }\n\n  async * findProviders (cid: CID, options?: RoutingOptions): AsyncIterable<Provider> {\n    yield * this.libp2p.contentRouting.findProviders(cid, options)\n  }\n\n  async put (key: Uint8Array, value: Uint8Array, options?: RoutingOptions): Promise<void> {\n    await this.libp2p.contentRouting.put(key, value, options)\n  }\n\n  async get (key: Uint8Array, options?: RoutingOptions): Promise<Uint8Array> {\n    return this.libp2p.contentRouting.get(key, options)\n  }\n\n  async findPeer (peerId: PeerId, options?: RoutingOptions): Promise<PeerInfo> {\n    return this.libp2p.peerRouting.findPeer(peerId, options)\n  }\n\n  async * getClosestPeers (key: Uint8Array, options?: RoutingOptions): AsyncIterable<PeerInfo> {\n    yield * this.libp2p.peerRouting.getClosestPeers(key, options)\n  }\n}\n\nexport function libp2pRouting (libp2p: Libp2p): Routing {\n  return new Libp2pRouter(libp2p)\n}\n", "import { NotFoundError } from 'interface-store'\nimport { base32 } from 'multiformats/bases/base32'\nimport { CID } from 'multiformats/cid'\nimport * as raw from 'multiformats/codecs/raw'\nimport * as Digest from 'multiformats/hashes/digest'\nimport { BaseBlockstore } from './base.js'\nimport type { Pair } from 'interface-blockstore'\nimport type { Await, AwaitIterable } from 'interface-store'\n\nexport class MemoryBlockstore extends BaseBlockstore {\n  private readonly data: Map<string, Uint8Array>\n\n  constructor () {\n    super()\n\n    this.data = new Map()\n  }\n\n  put (key: CID, val: Uint8Array): Await<CID> { // eslint-disable-line require-await\n    this.data.set(base32.encode(key.multihash.bytes), val)\n\n    return key\n  }\n\n  get (key: CID): Await<Uint8Array> {\n    const buf = this.data.get(base32.encode(key.multihash.bytes))\n\n    if (buf == null) {\n      throw new NotFoundError()\n    }\n\n    return buf\n  }\n\n  has (key: CID): Await<boolean> {\n    return this.data.has(base32.encode(key.multihash.bytes))\n  }\n\n  async delete (key: CID): Promise<void> {\n    this.data.delete(base32.encode(key.multihash.bytes))\n  }\n\n  async * getAll (): AwaitIterable<Pair> {\n    for (const [key, value] of this.data.entries()) {\n      yield {\n        cid: CID.createV1(raw.code, Digest.decode(base32.decode(key))),\n        block: value\n      }\n    }\n  }\n}\n", "import { logger } from '@libp2p/logger'\nimport { DeleteFailedError, NotFoundError, PutFailedError } from 'interface-store'\nimport drain from 'it-drain'\nimport filter from 'it-filter'\nimport merge from 'it-merge'\nimport { pushable } from 'it-pushable'\nimport { BaseBlockstore } from './base.js'\nimport type { Blockstore, Pair } from 'interface-blockstore'\nimport type { AbortOptions, AwaitIterable } from 'interface-store'\nimport type { CID } from 'multiformats/cid'\n\nconst log = logger('blockstore:core:tiered')\n\n/**\n * A blockstore that can combine multiple stores. Puts and deletes\n * will write through to all blockstores. Has and get will\n * try each store sequentially. getAll will use every store but also\n * deduplicate any yielded pairs.\n */\nexport class TieredBlockstore extends BaseBlockstore {\n  private readonly stores: Blockstore[]\n\n  constructor (stores: Blockstore[]) {\n    super()\n\n    this.stores = stores.slice()\n  }\n\n  async put (key: CID, value: Uint8Array, options?: AbortOptions): Promise<CID> {\n    try {\n      await Promise.all(this.stores.map(async store => { await store.put(key, value, options) }))\n      return key\n    } catch (err: any) {\n      throw new PutFailedError(String(err))\n    }\n  }\n\n  async get (key: CID, options?: AbortOptions): Promise<Uint8Array> {\n    for (const store of this.stores) {\n      try {\n        const res = await store.get(key, options)\n        if (res != null) return res\n      } catch (err) {\n        log.error(err)\n      }\n    }\n    throw new NotFoundError()\n  }\n\n  async has (key: CID, options?: AbortOptions): Promise<boolean> {\n    for (const s of this.stores) {\n      if (await s.has(key, options)) {\n        return true\n      }\n    }\n\n    return false\n  }\n\n  async delete (key: CID, options?: AbortOptions): Promise<void> {\n    try {\n      await Promise.all(this.stores.map(async store => { await store.delete(key, options) }))\n    } catch (err: any) {\n      throw new DeleteFailedError(String(err))\n    }\n  }\n\n  async * putMany (source: AwaitIterable<Pair>, options: AbortOptions = {}): AsyncIterable<CID> {\n    let error: Error | undefined\n    const pushables = this.stores.map(store => {\n      const source = pushable<Pair>({\n        objectMode: true\n      })\n\n      drain(store.putMany(source, options))\n        .catch(err => {\n          // store threw while putting, make sure we bubble the error up\n          error = err\n        })\n\n      return source\n    })\n\n    try {\n      for await (const pair of source) {\n        if (error != null) {\n          throw error\n        }\n\n        pushables.forEach(p => p.push(pair))\n\n        yield pair.cid\n      }\n    } finally {\n      pushables.forEach(p => p.end())\n    }\n  }\n\n  async * deleteMany (source: AwaitIterable<CID>, options: AbortOptions = {}): AsyncIterable<CID> {\n    let error: Error | undefined\n    const pushables = this.stores.map(store => {\n      const source = pushable<CID>({\n        objectMode: true\n      })\n\n      drain(store.deleteMany(source, options))\n        .catch(err => {\n          // store threw while deleting, make sure we bubble the error up\n          error = err\n        })\n\n      return source\n    })\n\n    try {\n      for await (const key of source) {\n        if (error != null) {\n          throw error\n        }\n\n        pushables.forEach(p => p.push(key))\n\n        yield key\n      }\n    } finally {\n      pushables.forEach(p => p.end())\n    }\n  }\n\n  async * getAll (options?: AbortOptions): AwaitIterable<Pair> { // eslint-disable-line require-yield\n    // deduplicate yielded pairs\n    const seen = new Set<string>()\n\n    yield * filter(merge(...this.stores.map(s => s.getAll(options))), (pair) => {\n      const cidStr = pair.cid.toString()\n\n      if (seen.has(cidStr)) {\n        return false\n      }\n\n      seen.add(cidStr)\n\n      return true\n    })\n  }\n}\n", "import { Key } from 'interface-datastore/key'\nimport type { Shard } from './index.js'\nimport type { Datastore } from 'interface-datastore'\n\nexport const PREFIX = '/repo/flatfs/shard/'\nexport const SHARDING_FN = 'SHARDING'\n\nexport class ShardBase implements Shard {\n  public param: number\n  public name: string\n  public _padding: string\n\n  constructor (param: number) {\n    this.param = param\n    this.name = 'base'\n    this._padding = ''\n  }\n\n  fun (s: string): string {\n    return 'implement me'\n  }\n\n  toString (): string {\n    return `${PREFIX}v1/${this.name}/${this.param}`\n  }\n}\n\nexport class Prefix extends ShardBase {\n  constructor (prefixLen: number) {\n    super(prefixLen)\n    this._padding = ''.padStart(prefixLen, '_')\n    this.name = 'prefix'\n  }\n\n  fun (noslash: string): string {\n    return (noslash + this._padding).slice(0, this.param)\n  }\n}\n\nexport class Suffix extends ShardBase {\n  constructor (suffixLen: number) {\n    super(suffixLen)\n\n    this._padding = ''.padStart(suffixLen, '_')\n    this.name = 'suffix'\n  }\n\n  fun (noslash: string): string {\n    const s = this._padding + noslash\n    return s.slice(s.length - this.param)\n  }\n}\n\nexport class NextToLast extends ShardBase {\n  constructor (suffixLen: number) {\n    super(suffixLen)\n    this._padding = ''.padStart(suffixLen + 1, '_')\n    this.name = 'next-to-last'\n  }\n\n  fun (noslash: string): string {\n    const s = this._padding + noslash\n    const offset = s.length - this.param - 1\n    return s.slice(offset, offset + this.param)\n  }\n}\n\n/**\n * Convert a given string to the matching sharding function\n */\nexport function parseShardFun (str: string): Shard {\n  str = str.trim()\n\n  if (str.length === 0) {\n    throw new Error('empty shard string')\n  }\n\n  if (!str.startsWith(PREFIX)) {\n    throw new Error(`invalid or no path prefix: ${str}`)\n  }\n\n  const parts = str.slice(PREFIX.length).split('/')\n  const version = parts[0]\n\n  if (version !== 'v1') {\n    throw new Error(`expect 'v1' version, got '${version}'`)\n  }\n\n  const name = parts[1]\n\n  if (parts[2] == null || parts[2] === '') {\n    throw new Error('missing param')\n  }\n\n  const param = parseInt(parts[2], 10)\n\n  switch (name) {\n    case 'prefix':\n      return new Prefix(param)\n    case 'suffix':\n      return new Suffix(param)\n    case 'next-to-last':\n      return new NextToLast(param)\n    default:\n      throw new Error(`unkown sharding function: ${name}`)\n  }\n}\n\nexport const readShardFun = async (path: string | Uint8Array, store: Datastore): Promise<Shard> => {\n  const key = new Key(path).child(new Key(SHARDING_FN))\n  // @ts-expect-error not all stores have this\n  const get = typeof store.getRaw === 'function' ? store.getRaw.bind(store) : store.get.bind(store)\n  const res = await get(key)\n  return parseShardFun(new TextDecoder().decode(res ?? '').trim())\n}\n", "import { Key } from 'interface-datastore'\nimport { OpenFailedError } from 'interface-store'\nimport { BaseDatastore } from './base.js'\nimport { KeyTransformDatastore } from './keytransform.js'\nimport {\n  readShardFun,\n  SHARDING_FN\n} from './shard.js'\nimport type { Shard } from './index.js'\nimport type { Batch, KeyQuery, KeyQueryFilter, Pair, Query, QueryFilter, Datastore } from 'interface-datastore'\nimport type { AbortOptions, AwaitIterable } from 'interface-store'\n\nconst shardKey = new Key(SHARDING_FN)\n\n/**\n * Backend independent abstraction of go-ds-flatfs.\n *\n * Wraps another datastore such that all values are stored\n * sharded according to the given sharding function.\n */\nexport class ShardingDatastore extends BaseDatastore {\n  private readonly child: KeyTransformDatastore\n  private shard: Shard\n\n  constructor (store: Datastore, shard: Shard) {\n    super()\n\n    this.child = new KeyTransformDatastore(store, {\n      convert: this._convertKey.bind(this),\n      invert: this._invertKey.bind(this)\n    })\n    this.shard = shard\n  }\n\n  async open (): Promise<void> {\n    this.shard = await ShardingDatastore.create(this.child, this.shard)\n  }\n\n  _convertKey (key: Key): Key {\n    const s = key.toString()\n    if (s === shardKey.toString()) {\n      return key\n    }\n\n    const parent = new Key(this.shard.fun(s))\n    return parent.child(key)\n  }\n\n  _invertKey (key: Key): Key {\n    const s = key.toString()\n    if (s === shardKey.toString()) {\n      return key\n    }\n    return Key.withNamespaces(key.list().slice(1))\n  }\n\n  static async create (store: Datastore, shard?: Shard): Promise<Shard> {\n    const hasShard = await store.has(shardKey)\n\n    if (!hasShard) {\n      if (shard == null) {\n        throw new OpenFailedError('Shard is required when datastore doesn\\'t have a shard key already')\n      }\n\n      await store.put(shardKey, new TextEncoder().encode(shard.toString() + '\\n'))\n    }\n\n    if (shard == null) {\n      shard = await readShardFun('/', store)\n    }\n\n    // test shards\n    const diskShard = await readShardFun('/', store)\n    const a = diskShard.toString()\n    const b = shard.toString()\n\n    if (a !== b) {\n      throw new Error(`specified fun ${b} does not match repo shard fun ${a}`)\n    }\n\n    return diskShard\n  }\n\n  async put (key: Key, val: Uint8Array, options?: AbortOptions): Promise<Key> {\n    await this.child.put(key, val, options)\n\n    return key\n  }\n\n  async get (key: Key, options?: AbortOptions): Promise<Uint8Array> {\n    return this.child.get(key, options)\n  }\n\n  async has (key: Key, options?: AbortOptions): Promise<boolean> {\n    return this.child.has(key, options)\n  }\n\n  async delete (key: Key, options?: AbortOptions): Promise<void> {\n    await this.child.delete(key, options)\n  }\n\n  async * putMany (source: AwaitIterable<Pair>, options: AbortOptions = {}): AsyncIterable<Key> {\n    yield * this.child.putMany(source, options)\n  }\n\n  async * getMany (source: AwaitIterable<Key>, options: AbortOptions = {}): AsyncIterable<Pair> {\n    yield * this.child.getMany(source, options)\n  }\n\n  async * deleteMany (source: AwaitIterable<Key>, options: AbortOptions = {}): AsyncIterable<Key> {\n    yield * this.child.deleteMany(source, options)\n  }\n\n  batch (): Batch {\n    return this.child.batch()\n  }\n\n  query (q: Query, options?: AbortOptions): AsyncIterable<Pair> {\n    const omitShard: QueryFilter = ({ key }) => key.toString() !== shardKey.toString()\n\n    const tq: Query = {\n      ...q,\n      filters: [\n        omitShard\n      ].concat(q.filters ?? [])\n    }\n\n    return this.child.query(tq, options)\n  }\n\n  queryKeys (q: KeyQuery, options?: AbortOptions): AsyncIterable<Key> {\n    const omitShard: KeyQueryFilter = (key) => key.toString() !== shardKey.toString()\n\n    const tq: KeyQuery = {\n      ...q,\n      filters: [\n        omitShard\n      ].concat(q.filters ?? [])\n    }\n\n    return this.child.queryKeys(tq, options)\n  }\n}\n", "import { logger } from '@libp2p/logger'\nimport { PutFailedError, NotFoundError, DeleteFailedError } from 'interface-store'\nimport drain from 'it-drain'\nimport { pushable } from 'it-pushable'\nimport { BaseDatastore } from './base.js'\nimport type { Batch, Datastore, Key, KeyQuery, Pair, Query } from 'interface-datastore'\nimport type { AbortOptions, AwaitIterable } from 'interface-store'\n\nconst log = logger('datastore:core:tiered')\n\n/**\n * A datastore that can combine multiple stores. Puts and deletes\n * will write through to all datastores. Has and get will\n * try each store sequentially. Query will always try the\n * last one first.\n *\n */\nexport class TieredDatastore extends BaseDatastore {\n  private readonly stores: Datastore[]\n\n  constructor (stores: Datastore[]) {\n    super()\n\n    this.stores = stores.slice()\n  }\n\n  async put (key: Key, value: Uint8Array, options?: AbortOptions): Promise<Key> {\n    try {\n      await Promise.all(this.stores.map(async store => { await store.put(key, value, options) }))\n      return key\n    } catch (err: any) {\n      throw new PutFailedError(err.message)\n    }\n  }\n\n  async get (key: Key, options?: AbortOptions): Promise<Uint8Array> {\n    for (const store of this.stores) {\n      try {\n        const res = await store.get(key, options)\n        if (res != null) return res\n      } catch (err) {\n        log.error(err)\n      }\n    }\n    throw new NotFoundError()\n  }\n\n  async has (key: Key, options?: AbortOptions): Promise<boolean> {\n    for (const s of this.stores) {\n      if (await s.has(key, options)) {\n        return true\n      }\n    }\n\n    return false\n  }\n\n  async delete (key: Key, options?: AbortOptions): Promise<void> {\n    try {\n      await Promise.all(this.stores.map(async store => { await store.delete(key, options) }))\n    } catch (err: any) {\n      throw new DeleteFailedError(err.message)\n    }\n  }\n\n  async * putMany (source: AwaitIterable<Pair>, options: AbortOptions = {}): AsyncIterable<Key> {\n    let error: Error | undefined\n    const pushables = this.stores.map(store => {\n      const source = pushable<Pair>({\n        objectMode: true\n      })\n\n      drain(store.putMany(source, options))\n        .catch(err => {\n          // store threw while putting, make sure we bubble the error up\n          error = err\n        })\n\n      return source\n    })\n\n    try {\n      for await (const pair of source) {\n        if (error != null) {\n          throw error\n        }\n\n        pushables.forEach(p => p.push(pair))\n\n        yield pair.key\n      }\n    } finally {\n      pushables.forEach(p => p.end())\n    }\n  }\n\n  async * deleteMany (source: AwaitIterable<Key>, options: AbortOptions = {}): AsyncIterable<Key> {\n    let error: Error | undefined\n    const pushables = this.stores.map(store => {\n      const source = pushable<Key>({\n        objectMode: true\n      })\n\n      drain(store.deleteMany(source, options))\n        .catch(err => {\n          // store threw while deleting, make sure we bubble the error up\n          error = err\n        })\n\n      return source\n    })\n\n    try {\n      for await (const key of source) {\n        if (error != null) {\n          throw error\n        }\n\n        pushables.forEach(p => p.push(key))\n\n        yield key\n      }\n    } finally {\n      pushables.forEach(p => p.end())\n    }\n  }\n\n  batch (): Batch {\n    const batches = this.stores.map(store => store.batch())\n\n    return {\n      put: (key, value) => {\n        batches.forEach(b => { b.put(key, value) })\n      },\n      delete: (key) => {\n        batches.forEach(b => { b.delete(key) })\n      },\n      commit: async (options) => {\n        for (const batch of batches) {\n          await batch.commit(options)\n        }\n      }\n    }\n  }\n\n  query (q: Query, options?: AbortOptions): AwaitIterable<Pair> {\n    return this.stores[this.stores.length - 1].query(q, options)\n  }\n\n  queryKeys (q: KeyQuery, options?: AbortOptions): AwaitIterable<Key> {\n    return this.stores[this.stores.length - 1].queryKeys(q, options)\n  }\n}\n", "import { Helia, type HeliaInit } from '@helia/utils'\nimport type { BlockBroker } from './index.js'\nimport type { Libp2p } from '@libp2p/interface'\nimport type { Blockstore } from 'interface-blockstore'\nimport type { Datastore } from 'interface-datastore'\n\nexport interface HeliaP2PInit<T extends Libp2p = Libp2p> extends HeliaInit {\n  libp2p: T\n  blockstore: Blockstore\n  datastore: Datastore\n  blockBrokers: Array<(components: any) => BlockBroker>\n}\n\nexport class HeliaP2P<T extends Libp2p> extends Helia {\n  public libp2p: T\n\n  constructor (init: HeliaP2PInit<T>) {\n    super({\n      ...init,\n      components: {\n        libp2p: init.libp2p\n      }\n    })\n\n    this.libp2p = init.libp2p\n  }\n\n  async start (): Promise<void> {\n    await super.start()\n    await this.libp2p.start()\n  }\n\n  async stop (): Promise<void> {\n    await super.stop()\n    await this.libp2p.stop()\n  }\n}\n", "import { cidrContains } from '@chainsafe/netmask'\nimport type { Multiaddr } from '@multiformats/multiaddr'\n\nconst CODEC_IP6 = 0x29\n\n/**\n * Check if a given multiaddr is an IPv6 global unicast address\n */\nexport function isGlobalUnicast (ma: Multiaddr): boolean {\n  try {\n    const [[codec, value]] = ma.stringTuples()\n\n    if (value == null) {\n      return false\n    }\n\n    if (codec === CODEC_IP6) {\n      return cidrContains('2000::/3', value)\n    }\n  } catch {\n\n  }\n\n  return false\n}\n", "import { setMaxListeners } from '@libp2p/interface'\nimport { anySignal } from 'any-signal'\nimport type { AbortOptions } from '@libp2p/interface'\n\nexport interface RepeatingTask {\n  start(): void\n  stop(): void\n}\n\nexport interface RepeatingTaskOptions {\n  /**\n   * How long the task is allowed to run before the passed AbortSignal fires an\n   * abort event\n   */\n  timeout?: number\n\n  /**\n   * Whether to schedule the task to run immediately\n   */\n  runImmediately?: boolean\n}\n\nexport function repeatingTask (fn: (options?: AbortOptions) => void | Promise<void>, interval: number, options?: RepeatingTaskOptions): RepeatingTask {\n  let timeout: ReturnType<typeof setTimeout>\n  let shutdownController: AbortController\n\n  function runTask (): void {\n    const opts: AbortOptions = {\n      signal: shutdownController.signal\n    }\n\n    if (options?.timeout != null) {\n      const signal = anySignal([shutdownController.signal, AbortSignal.timeout(options.timeout)])\n      setMaxListeners(Infinity, signal)\n\n      opts.signal = signal\n    }\n\n    Promise.resolve().then(async () => {\n      await fn(opts)\n    })\n      .catch(() => {})\n      .finally(() => {\n        if (shutdownController.signal.aborted) {\n          // task has been cancelled, bail\n          return\n        }\n\n        // reschedule\n        timeout = setTimeout(runTask, interval)\n      })\n  }\n\n  let started = false\n\n  return {\n    start: () => {\n      if (started) {\n        return\n      }\n\n      started = true\n      shutdownController = new AbortController()\n      setMaxListeners(Infinity, shutdownController.signal)\n\n      // run now\n      if (options?.runImmediately === true) {\n        queueMicrotask(() => {\n          runTask()\n        })\n      } else {\n        // run later\n        timeout = setTimeout(runTask, interval)\n      }\n    },\n    stop: () => {\n      clearTimeout(timeout)\n      shutdownController?.abort()\n      started = false\n    }\n  }\n}\n", "/**\n * @packageDocumentation\n *\n * This module makes it easy to send and receive length-prefixed Protobuf encoded\n * messages over streams.\n *\n * @example\n *\n * ```typescript\n * import { pbStream } from 'it-protobuf-stream'\n * import { MessageType } from './src/my-message-type.js'\n *\n * // RequestType and ResponseType have been generate from `.proto` files and have\n * // `.encode` and `.decode` methods for serialization/deserialization\n *\n * const stream = pbStream(duplex)\n *\n * // write a message to the stream\n * stream.write({\n *   foo: 'bar'\n * }, MessageType)\n *\n * // read a message from the stream\n * const res = await stream.read(MessageType)\n * ```\n */\n\nimport { lpStream } from 'it-length-prefixed-stream'\nimport type { LengthPrefixedStreamOpts } from 'it-length-prefixed-stream'\nimport type { Duplex } from 'it-stream-types'\nimport type { Uint8ArrayList } from 'uint8arraylist'\n\nexport interface AbortOptions {\n  signal?: AbortSignal\n}\n\n/**\n * A protobuf decoder - takes a byte array and returns an object\n */\nexport interface Decoder<T> {\n  (data: Uint8Array | Uint8ArrayList): T\n}\n\n/**\n * A protobuf encoder - takes an object and returns a byte array\n */\nexport interface Encoder<T> {\n  (data: T): Uint8Array\n}\n\n/**\n * Convenience methods for working with protobuf streams\n */\nexport interface ProtobufStream <Stream = unknown> {\n  /**\n   * Read the next length-prefixed byte array from the stream and decode it as the passed protobuf format\n   */\n  read<T>(proto: { decode: Decoder<T> }, options?: AbortOptions): Promise<T>\n\n  /**\n   * Encode the passed object as a protobuf message and write it's length-prefixed bytes to the stream\n   */\n  write<T>(data: T, proto: { encode: Encoder<T> }, options?: AbortOptions): Promise<void>\n\n  /**\n   * Encode the passed objects as protobuf messages and write their length-prefixed bytes to the stream as a single write\n   */\n  writeV<T>(input: T[], proto: { encode: Encoder<T> }, options?: AbortOptions): Promise<void>\n\n  /**\n   * Returns an object with read/write methods for operating on one specific type of protobuf message\n   */\n  pb<T>(proto: { encode: Encoder<T>, decode: Decoder<T> }): MessageStream<T, Stream>\n\n  /**\n   * Returns the underlying stream\n   */\n  unwrap(): Stream\n}\n\n/**\n * A message reader/writer that only uses one type of message\n */\nexport interface MessageStream <T, S = unknown> {\n  /**\n   * Read a message from the stream\n   */\n  read(options?: AbortOptions): Promise<T>\n\n  /**\n   * Write a message to the stream\n   */\n  write(d: T, options?: AbortOptions): Promise<void>\n\n  /**\n   * Write several messages to the stream\n   */\n  writeV(d: T[], options?: AbortOptions): Promise<void>\n\n  /**\n   * Unwrap the underlying protobuf stream\n   */\n  unwrap(): ProtobufStream<S>\n}\n\nexport interface ProtobufStreamOpts extends LengthPrefixedStreamOpts {\n\n}\n\nexport function pbStream <Stream extends Duplex<any, any, any>> (duplex: Stream, opts?: Partial<ProtobufStreamOpts>): ProtobufStream<Stream> {\n  const lp = lpStream(duplex, opts)\n\n  const W: ProtobufStream<Stream> = {\n    read: async (proto, options?: AbortOptions) => {\n      // readLP, decode\n      const value = await lp.read(options)\n\n      return proto.decode(value)\n    },\n    write: async (message, proto, options?: AbortOptions) => {\n      // encode, writeLP\n      await lp.write(proto.encode(message), options)\n    },\n    writeV: async (messages, proto, options?: AbortOptions) => {\n      // encode, writeLP\n      await lp.writeV(messages.map(message => proto.encode(message)), options)\n    },\n    pb: (proto) => {\n      return {\n        read: async (options) => W.read(proto, options),\n        write: async (d, options) => W.write(d, proto, options),\n        writeV: async (d, options) => W.writeV(d, proto, options),\n        unwrap: () => W\n      }\n    },\n    unwrap: () => {\n      return lp.unwrap()\n    }\n  }\n\n  return W\n}\n", "/**\n * The prefix to use in the protocol\n */\nexport const PROTOCOL_PREFIX = 'libp2p'\n\n/**\n * The name to use in the protocol\n */\nexport const PROTOCOL_NAME = 'autonat'\n\n/**\n * The version to use in the protocol\n */\nexport const PROTOCOL_VERSION = '1.0.0'\nexport const TIMEOUT = 30000\nexport const MAX_INBOUND_STREAMS = 2\nexport const MAX_OUTBOUND_STREAMS = 20\nexport const DEFAULT_CONNECTION_THRESHOLD = 80\nexport const MAX_MESSAGE_SIZE = 8192\n", "/* eslint-disable import/export */\n/* eslint-disable complexity */\n/* eslint-disable @typescript-eslint/no-namespace */\n/* eslint-disable @typescript-eslint/no-unnecessary-boolean-literal-compare */\n/* eslint-disable @typescript-eslint/no-empty-interface */\n\nimport { type Codec, decodeMessage, type DecodeOptions, encodeMessage, enumeration, MaxLengthError, message } from 'protons-runtime'\nimport type { Uint8ArrayList } from 'uint8arraylist'\n\nexport interface Message {\n  type?: Message.MessageType\n  dial?: Message.Dial\n  dialResponse?: Message.DialResponse\n}\n\nexport namespace Message {\n  export enum MessageType {\n    DIAL = 'DIAL',\n    DIAL_RESPONSE = 'DIAL_RESPONSE'\n  }\n\n  enum __MessageTypeValues {\n    DIAL = 0,\n    DIAL_RESPONSE = 1\n  }\n\n  export namespace MessageType {\n    export const codec = (): Codec<MessageType> => {\n      return enumeration<MessageType>(__MessageTypeValues)\n    }\n  }\n\n  export enum ResponseStatus {\n    OK = 'OK',\n    E_DIAL_ERROR = 'E_DIAL_ERROR',\n    E_DIAL_REFUSED = 'E_DIAL_REFUSED',\n    E_BAD_REQUEST = 'E_BAD_REQUEST',\n    E_INTERNAL_ERROR = 'E_INTERNAL_ERROR'\n  }\n\n  enum __ResponseStatusValues {\n    OK = 0,\n    E_DIAL_ERROR = 100,\n    E_DIAL_REFUSED = 101,\n    E_BAD_REQUEST = 200,\n    E_INTERNAL_ERROR = 300\n  }\n\n  export namespace ResponseStatus {\n    export const codec = (): Codec<ResponseStatus> => {\n      return enumeration<ResponseStatus>(__ResponseStatusValues)\n    }\n  }\n\n  export interface PeerInfo {\n    id?: Uint8Array\n    addrs: Uint8Array[]\n  }\n\n  export namespace PeerInfo {\n    let _codec: Codec<PeerInfo>\n\n    export const codec = (): Codec<PeerInfo> => {\n      if (_codec == null) {\n        _codec = message<PeerInfo>((obj, w, opts = {}) => {\n          if (opts.lengthDelimited !== false) {\n            w.fork()\n          }\n\n          if (obj.id != null) {\n            w.uint32(10)\n            w.bytes(obj.id)\n          }\n\n          if (obj.addrs != null) {\n            for (const value of obj.addrs) {\n              w.uint32(18)\n              w.bytes(value)\n            }\n          }\n\n          if (opts.lengthDelimited !== false) {\n            w.ldelim()\n          }\n        }, (reader, length, opts = {}) => {\n          const obj: any = {\n            addrs: []\n          }\n\n          const end = length == null ? reader.len : reader.pos + length\n\n          while (reader.pos < end) {\n            const tag = reader.uint32()\n\n            switch (tag >>> 3) {\n              case 1: {\n                obj.id = reader.bytes()\n                break\n              }\n              case 2: {\n                if (opts.limits?.addrs != null && obj.addrs.length === opts.limits.addrs) {\n                  throw new MaxLengthError('Decode error - map field \"addrs\" had too many elements')\n                }\n\n                obj.addrs.push(reader.bytes())\n                break\n              }\n              default: {\n                reader.skipType(tag & 7)\n                break\n              }\n            }\n          }\n\n          return obj\n        })\n      }\n\n      return _codec\n    }\n\n    export const encode = (obj: Partial<PeerInfo>): Uint8Array => {\n      return encodeMessage(obj, PeerInfo.codec())\n    }\n\n    export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<PeerInfo>): PeerInfo => {\n      return decodeMessage(buf, PeerInfo.codec(), opts)\n    }\n  }\n\n  export interface Dial {\n    peer?: Message.PeerInfo\n  }\n\n  export namespace Dial {\n    let _codec: Codec<Dial>\n\n    export const codec = (): Codec<Dial> => {\n      if (_codec == null) {\n        _codec = message<Dial>((obj, w, opts = {}) => {\n          if (opts.lengthDelimited !== false) {\n            w.fork()\n          }\n\n          if (obj.peer != null) {\n            w.uint32(10)\n            Message.PeerInfo.codec().encode(obj.peer, w)\n          }\n\n          if (opts.lengthDelimited !== false) {\n            w.ldelim()\n          }\n        }, (reader, length, opts = {}) => {\n          const obj: any = {}\n\n          const end = length == null ? reader.len : reader.pos + length\n\n          while (reader.pos < end) {\n            const tag = reader.uint32()\n\n            switch (tag >>> 3) {\n              case 1: {\n                obj.peer = Message.PeerInfo.codec().decode(reader, reader.uint32(), {\n                  limits: opts.limits?.peer\n                })\n                break\n              }\n              default: {\n                reader.skipType(tag & 7)\n                break\n              }\n            }\n          }\n\n          return obj\n        })\n      }\n\n      return _codec\n    }\n\n    export const encode = (obj: Partial<Dial>): Uint8Array => {\n      return encodeMessage(obj, Dial.codec())\n    }\n\n    export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<Dial>): Dial => {\n      return decodeMessage(buf, Dial.codec(), opts)\n    }\n  }\n\n  export interface DialResponse {\n    status?: Message.ResponseStatus\n    statusText?: string\n    addr?: Uint8Array\n  }\n\n  export namespace DialResponse {\n    let _codec: Codec<DialResponse>\n\n    export const codec = (): Codec<DialResponse> => {\n      if (_codec == null) {\n        _codec = message<DialResponse>((obj, w, opts = {}) => {\n          if (opts.lengthDelimited !== false) {\n            w.fork()\n          }\n\n          if (obj.status != null) {\n            w.uint32(8)\n            Message.ResponseStatus.codec().encode(obj.status, w)\n          }\n\n          if (obj.statusText != null) {\n            w.uint32(18)\n            w.string(obj.statusText)\n          }\n\n          if (obj.addr != null) {\n            w.uint32(26)\n            w.bytes(obj.addr)\n          }\n\n          if (opts.lengthDelimited !== false) {\n            w.ldelim()\n          }\n        }, (reader, length, opts = {}) => {\n          const obj: any = {}\n\n          const end = length == null ? reader.len : reader.pos + length\n\n          while (reader.pos < end) {\n            const tag = reader.uint32()\n\n            switch (tag >>> 3) {\n              case 1: {\n                obj.status = Message.ResponseStatus.codec().decode(reader)\n                break\n              }\n              case 2: {\n                obj.statusText = reader.string()\n                break\n              }\n              case 3: {\n                obj.addr = reader.bytes()\n                break\n              }\n              default: {\n                reader.skipType(tag & 7)\n                break\n              }\n            }\n          }\n\n          return obj\n        })\n      }\n\n      return _codec\n    }\n\n    export const encode = (obj: Partial<DialResponse>): Uint8Array => {\n      return encodeMessage(obj, DialResponse.codec())\n    }\n\n    export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<DialResponse>): DialResponse => {\n      return decodeMessage(buf, DialResponse.codec(), opts)\n    }\n  }\n\n  let _codec: Codec<Message>\n\n  export const codec = (): Codec<Message> => {\n    if (_codec == null) {\n      _codec = message<Message>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if (obj.type != null) {\n          w.uint32(8)\n          Message.MessageType.codec().encode(obj.type, w)\n        }\n\n        if (obj.dial != null) {\n          w.uint32(18)\n          Message.Dial.codec().encode(obj.dial, w)\n        }\n\n        if (obj.dialResponse != null) {\n          w.uint32(26)\n          Message.DialResponse.codec().encode(obj.dialResponse, w)\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {}\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.type = Message.MessageType.codec().decode(reader)\n              break\n            }\n            case 2: {\n              obj.dial = Message.Dial.codec().decode(reader, reader.uint32(), {\n                limits: opts.limits?.dial\n              })\n              break\n            }\n            case 3: {\n              obj.dialResponse = Message.DialResponse.codec().decode(reader, reader.uint32(), {\n                limits: opts.limits?.dialResponse\n              })\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<Message>): Uint8Array => {\n    return encodeMessage(obj, Message.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<Message>): Message => {\n    return decodeMessage(buf, Message.codec(), opts)\n  }\n}\n", "import { serviceCapabilities, serviceDependencies, setMaxListeners } from '@libp2p/interface'\nimport { peerSet } from '@libp2p/peer-collections'\nimport { peerIdFromMultihash } from '@libp2p/peer-id'\nimport { createScalableCuckooFilter } from '@libp2p/utils/filters'\nimport { isGlobalUnicast } from '@libp2p/utils/multiaddr/is-global-unicast'\nimport { isPrivate } from '@libp2p/utils/multiaddr/is-private'\nimport { PeerQueue } from '@libp2p/utils/peer-queue'\nimport { repeatingTask } from '@libp2p/utils/repeating-task'\nimport { multiaddr, protocols } from '@multiformats/multiaddr'\nimport { anySignal } from 'any-signal'\nimport { pbStream } from 'it-protobuf-stream'\nimport * as Digest from 'multiformats/hashes/digest'\nimport { DEFAULT_CONNECTION_THRESHOLD, MAX_INBOUND_STREAMS, MAX_MESSAGE_SIZE, MAX_OUTBOUND_STREAMS, PROTOCOL_NAME, PROTOCOL_PREFIX, PROTOCOL_VERSION, TIMEOUT } from './constants.js'\nimport { Message } from './pb/index.js'\nimport type { AutoNATComponents, AutoNATServiceInit } from './index.js'\nimport type { Logger, Connection, PeerId, Startable, AbortOptions } from '@libp2p/interface'\nimport type { AddressType, IncomingStreamData } from '@libp2p/interface-internal'\nimport type { PeerSet } from '@libp2p/peer-collections'\nimport type { Filter } from '@libp2p/utils/filters'\nimport type { RepeatingTask } from '@libp2p/utils/repeating-task'\nimport type { Multiaddr } from '@multiformats/multiaddr'\n\n// if more than 3 peers manage to dial us on what we believe to be our external\n// IP then we are convinced that it is, in fact, our external IP\n// https://github.com/libp2p/specs/blob/master/autonat/autonat-v1.md#autonat-protocol\nconst REQUIRED_SUCCESSFUL_DIALS = 4\nconst REQUIRED_FAILED_DIALS = 8\n\ninterface TestAddressOptions extends AbortOptions {\n  multiaddr: Multiaddr\n  peerId: PeerId\n}\n\ninterface DialResults {\n  /**\n   * The address being tested\n   */\n  multiaddr: Multiaddr\n\n  /**\n   * The number of successful dials from peers\n   */\n  success: number\n\n  /**\n   * The number of dial failures from peers\n   */\n  failure: number\n\n  /**\n   * For the multiaddr corresponding the the string key of the `dialResults`\n   * map, these are the IP segments that a successful dial result has been\n   * received from\n   */\n  networkSegments: string[]\n\n  /**\n   * Ensure that the same peer id can't verify multiple times\n   */\n  verifyingPeers: PeerSet\n\n  /**\n   * The number of peers currently verifying this address\n   */\n  queue: PeerQueue<void, TestAddressOptions>\n\n  /**\n   * Updated when this address is verified or failed\n   */\n  result?: boolean\n\n  /**\n   * The type of address\n   */\n  type: AddressType\n\n  /**\n   * The last time the address was verified\n   */\n  lastVerified?: number\n}\n\nexport class AutoNATService implements Startable {\n  private readonly components: AutoNATComponents\n  private readonly protocol: string\n  private readonly timeout: number\n  private readonly maxInboundStreams: number\n  private readonly maxOutboundStreams: number\n  private readonly maxMessageSize: number\n  private started: boolean\n  private readonly log: Logger\n  private topologyId?: string\n  private readonly dialResults: Map<string, DialResults>\n  private readonly findPeers: RepeatingTask\n  private readonly addressFilter: Filter\n  private readonly connectionThreshold: number\n\n  constructor (components: AutoNATComponents, init: AutoNATServiceInit) {\n    this.components = components\n    this.log = components.logger.forComponent('libp2p:auto-nat')\n    this.started = false\n    this.protocol = `/${init.protocolPrefix ?? PROTOCOL_PREFIX}/${PROTOCOL_NAME}/${PROTOCOL_VERSION}`\n    this.timeout = init.timeout ?? TIMEOUT\n    this.maxInboundStreams = init.maxInboundStreams ?? MAX_INBOUND_STREAMS\n    this.maxOutboundStreams = init.maxOutboundStreams ?? MAX_OUTBOUND_STREAMS\n    this.connectionThreshold = init.connectionThreshold ?? DEFAULT_CONNECTION_THRESHOLD\n    this.maxMessageSize = init.maxMessageSize ?? MAX_MESSAGE_SIZE\n    this.dialResults = new Map()\n    this.findPeers = repeatingTask(this.findRandomPeers.bind(this), 60_000)\n    this.addressFilter = createScalableCuckooFilter(1024)\n  }\n\n  readonly [Symbol.toStringTag] = '@libp2p/autonat'\n\n  readonly [serviceCapabilities]: string[] = [\n    '@libp2p/autonat'\n  ]\n\n  get [serviceDependencies] (): string[] {\n    return [\n      '@libp2p/identify'\n    ]\n  }\n\n  isStarted (): boolean {\n    return this.started\n  }\n\n  async start (): Promise<void> {\n    if (this.started) {\n      return\n    }\n\n    await this.components.registrar.handle(this.protocol, (data) => {\n      void this.handleIncomingAutonatStream(data)\n        .catch(err => {\n          this.log.error('error handling incoming autonat stream - %e', err)\n        })\n    }, {\n      maxInboundStreams: this.maxInboundStreams,\n      maxOutboundStreams: this.maxOutboundStreams\n    })\n\n    this.topologyId = await this.components.registrar.register(this.protocol, {\n      onConnect: (peerId, connection) => {\n        this.verifyExternalAddresses(connection)\n          .catch(err => {\n            this.log.error('could not verify addresses - %e', err)\n          })\n      }\n    })\n\n    this.findPeers.start()\n    this.started = true\n  }\n\n  async stop (): Promise<void> {\n    await this.components.registrar.unhandle(this.protocol)\n\n    if (this.topologyId != null) {\n      await this.components.registrar.unhandle(this.topologyId)\n    }\n\n    this.dialResults.clear()\n    this.findPeers.stop()\n    this.started = false\n  }\n\n  private allAddressesAreVerified (): boolean {\n    return this.components.addressManager.getAddressesWithMetadata().every(addr => {\n      if (addr.expires > Date.now()) {\n        // ignore any unverified addresses within their TTL\n        return true\n      }\n\n      return addr.verified\n    })\n  }\n\n  async findRandomPeers (options?: AbortOptions): Promise<void> {\n    // skip if all addresses are verified\n    if (this.allAddressesAreVerified()) {\n      return\n    }\n\n    const signal = anySignal([\n      AbortSignal.timeout(10_000),\n      options?.signal\n    ])\n\n    // spend a few seconds finding random peers - dial them which will run\n    // identify to trigger the topology callbacks and run AutoNAT\n    try {\n      this.log('starting random walk to find peers to run AutoNAT')\n\n      for await (const peer of this.components.randomWalk.walk({ signal })) {\n        if (!(await this.components.connectionManager.isDialable(peer.multiaddrs))) {\n          this.log.trace('random peer %p was not dialable %s', peer.id, peer.multiaddrs.map(ma => ma.toString()).join(', '))\n\n          // skip peers we can't dial\n          continue\n        }\n\n        try {\n          this.log.trace('dial random peer %p', peer.id)\n          await this.components.connectionManager.openConnection(peer.multiaddrs, {\n            signal\n          })\n        } catch {}\n\n        if (this.allAddressesAreVerified()) {\n          this.log('stopping random walk, all addresses are verified')\n          return\n        }\n\n        if (!this.hasConnectionCapacity()) {\n          this.log('stopping random walk, too close to max connections')\n          return\n        }\n      }\n    } catch {}\n  }\n\n  /**\n   * Handle an incoming AutoNAT request\n   */\n  async handleIncomingAutonatStream (data: IncomingStreamData): Promise<void> {\n    const signal = AbortSignal.timeout(this.timeout)\n    setMaxListeners(Infinity, signal)\n\n    const messages = pbStream(data.stream, {\n      maxDataLength: this.maxMessageSize\n    }).pb(Message)\n\n    try {\n      const request = await messages.read({\n        signal\n      })\n      const response = await this.handleAutonatMessage(request, data.connection, {\n        signal\n      })\n      await messages.write(response, {\n        signal\n      })\n      await messages.unwrap().unwrap().close({\n        signal\n      })\n    } catch (err: any) {\n      this.log.error('error handling incoming autonat stream - %e', err)\n      data.stream.abort(err)\n    }\n  }\n\n  private async handleAutonatMessage (message: Message, connection: Connection, options?: AbortOptions): Promise<Message> {\n    const ourHosts = this.components.addressManager.getAddresses()\n      .map(ma => ma.toOptions().host)\n\n    const dialRequest = message.dial\n\n    if (dialRequest == null) {\n      this.log.error('dial was missing from message')\n\n      return {\n        type: Message.MessageType.DIAL_RESPONSE,\n        dialResponse: {\n          status: Message.ResponseStatus.E_BAD_REQUEST,\n          statusText: 'No Dial message found in message'\n        }\n      }\n    }\n\n    let peerId: PeerId\n    const peer = dialRequest.peer\n\n    if (peer?.id == null) {\n      this.log.error('PeerId missing from message')\n\n      return {\n        type: Message.MessageType.DIAL_RESPONSE,\n        dialResponse: {\n          status: Message.ResponseStatus.E_BAD_REQUEST,\n          statusText: 'missing peer info'\n        }\n      }\n    }\n\n    try {\n      const digest = Digest.decode(peer.id)\n      peerId = peerIdFromMultihash(digest)\n    } catch (err) {\n      this.log.error('invalid PeerId - %e', err)\n\n      return {\n        type: Message.MessageType.DIAL_RESPONSE,\n        dialResponse: {\n          status: Message.ResponseStatus.E_BAD_REQUEST,\n          statusText: 'bad peer id'\n        }\n      }\n    }\n\n    this.log('incoming request from %p', peerId)\n\n    // reject any dial requests that arrive via relays\n    if (!connection.remotePeer.equals(peerId)) {\n      this.log('target peer %p did not equal sending peer %p', peerId, connection.remotePeer)\n\n      return {\n        type: Message.MessageType.DIAL_RESPONSE,\n        dialResponse: {\n          status: Message.ResponseStatus.E_BAD_REQUEST,\n          statusText: 'peer id mismatch'\n        }\n      }\n    }\n\n    // get a list of multiaddrs to dial\n    const multiaddrs = peer.addrs\n      .map(buf => multiaddr(buf))\n      .filter(ma => {\n        const options = ma.toOptions()\n\n        if (isPrivate(ma)) {\n          // don't try to dial private addresses\n          return false\n        }\n\n        if (options.host !== connection.remoteAddr.toOptions().host) {\n          // skip any Multiaddrs where the target node's IP does not match the sending node's IP\n          this.log.trace('not dialing %a - target host did not match remote host %a', ma, connection.remoteAddr)\n          return false\n        }\n\n        if (ourHosts.includes(options.host)) {\n          // don't try to dial nodes on the same host as us\n          return false\n        }\n\n        if (this.components.transportManager.dialTransportForMultiaddr(ma) == null) {\n          // skip any Multiaddrs that have transports we do not support\n          this.log.trace('not dialing %a - transport unsupported', ma)\n          return false\n        }\n\n        return true\n      })\n      .map(ma => {\n        if (ma.getPeerId() == null) {\n          // make sure we have the PeerId as part of the Multiaddr\n          ma = ma.encapsulate(`/p2p/${peerId.toString()}`)\n        }\n\n        return ma\n      })\n\n    // make sure we have something to dial\n    if (multiaddrs.length === 0) {\n      this.log('refused to dial all multiaddrs for %p from message', peerId)\n\n      return {\n        type: Message.MessageType.DIAL_RESPONSE,\n        dialResponse: {\n          status: Message.ResponseStatus.E_DIAL_REFUSED,\n          statusText: 'no dialable addresses'\n        }\n      }\n    }\n\n    this.log('dial multiaddrs %s for peer %p', multiaddrs.map(ma => ma.toString()).join(', '), peerId)\n\n    let errorMessage = ''\n    let lastMultiaddr = multiaddrs[0]\n\n    for await (const multiaddr of multiaddrs) {\n      let connection: Connection | undefined\n      lastMultiaddr = multiaddr\n\n      try {\n        connection = await this.components.connectionManager.openConnection(multiaddr, options)\n\n        if (!connection.remoteAddr.equals(multiaddr)) {\n          this.log.error('tried to dial %a but dialed %a', multiaddr, connection.remoteAddr)\n          throw new Error('Unexpected remote address')\n        }\n\n        this.log('successfully dialed %p via %a', peerId, multiaddr)\n\n        return {\n          type: Message.MessageType.DIAL_RESPONSE,\n          dialResponse: {\n            status: Message.ResponseStatus.OK,\n            addr: connection.remoteAddr.decapsulateCode(protocols('p2p').code).bytes\n          }\n        }\n      } catch (err: any) {\n        this.log.error('could not dial %p - %e', peerId, err)\n        errorMessage = err.message\n      } finally {\n        if (connection != null) {\n          await connection.close()\n        }\n      }\n    }\n\n    return {\n      type: Message.MessageType.DIAL_RESPONSE,\n      dialResponse: {\n        status: Message.ResponseStatus.E_DIAL_ERROR,\n        statusText: errorMessage,\n        addr: lastMultiaddr.bytes\n      }\n    }\n  }\n\n  /**\n   * The AutoNAT v1 server is not required to send us the address that it\n   * dialed successfully.\n   *\n   * When addresses fail, it can be because they are NATed, or because the peer\n   * did't support the transport, we have no way of knowing, so just send them\n   * one address so we can treat the response as:\n   *\n   * - OK - the dial request worked and the address is not NATed\n   * - E_DIAL_ERROR - the dial request failed and the address may be NATed\n   * - E_DIAL_REFUSED/E_BAD_REQUEST/E_INTERNAL_ERROR - the remote didn't dial the address\n   */\n  private getFirstUnverifiedMultiaddr (segment: string, supportsIPv6: boolean): DialResults | undefined {\n    const addrs = this.components.addressManager.getAddressesWithMetadata()\n      .sort((a, b) => {\n        // sort addresses, de-prioritize observed addresses\n        if (a.type === 'observed' && b.type !== 'observed') {\n          return 1\n        }\n\n        if (b.type === 'observed' && a.type !== 'observed') {\n          return -1\n        }\n\n        return 0\n      })\n      .filter(addr => {\n        const expired = addr.expires < Date.now()\n\n        if (!expired) {\n          // skip verified/non-verified addresses within their TTL\n          return false\n        }\n\n        const options = addr.multiaddr.toOptions()\n\n        if (options.family === 6) {\n          // do not send IPv6 addresses to peers without IPv6 addresses\n          if (!supportsIPv6) {\n            return false\n          }\n\n          if (!isGlobalUnicast(addr.multiaddr)) {\n            // skip non-globally routable addresses\n            return false\n          }\n        }\n\n        if (isPrivate(addr.multiaddr)) {\n          // skip private addresses\n          return false\n        }\n\n        return true\n      })\n\n    for (const addr of addrs) {\n      const addrString = addr.multiaddr.toString()\n      let results = this.dialResults.get(addrString)\n\n      if (results != null) {\n        if (results.networkSegments.includes(segment)) {\n          this.log.trace('%a already has a network segment result from %s', results.multiaddr, segment)\n          // skip this address if we already have a dial result from the\n          // network segment the peer is in\n          continue\n        }\n\n        if (results.queue.size > 10) {\n          this.log.trace('%a already has enough peers queued', results.multiaddr)\n          // already have enough peers verifying this address, skip on to the\n          // next one\n          continue\n        }\n      }\n\n      // will include this multiaddr, ensure we have a results object\n      if (results == null) {\n        const needsRevalidating = addr.expires < Date.now()\n\n        // allow re-validating addresses that worked previously\n        if (needsRevalidating) {\n          this.addressFilter.remove?.(addrString)\n        }\n\n        if (this.addressFilter.has(addrString)) {\n          continue\n        }\n\n        // only try to validate the address once\n        this.addressFilter.add(addrString)\n\n        this.log.trace('creating dial result %s %s', needsRevalidating ? 'to revalidate' : 'for', addrString)\n        results = {\n          multiaddr: addr.multiaddr,\n          success: 0,\n          failure: 0,\n          networkSegments: [],\n          verifyingPeers: peerSet(),\n          queue: new PeerQueue({\n            concurrency: 3,\n            maxSize: 50\n          }),\n          type: addr.type,\n          lastVerified: addr.lastVerified\n        }\n\n        this.dialResults.set(addrString, results)\n      }\n\n      return results\n    }\n  }\n\n  /**\n   * Removes any multiaddr result objects created for old multiaddrs that we are\n   * no longer waiting on\n   */\n  private removeOutdatedMultiaddrResults (): void {\n    const unverifiedMultiaddrs = new Set(this.components.addressManager.getAddressesWithMetadata()\n      .filter(({ expires }) => {\n        if (expires < Date.now()) {\n          return true\n        }\n\n        return false\n      })\n      .map(({ multiaddr }) => multiaddr.toString())\n    )\n\n    for (const multiaddr of this.dialResults.keys()) {\n      if (!unverifiedMultiaddrs.has(multiaddr)) {\n        this.log.trace('remove results for %a', multiaddr)\n        this.dialResults.delete(multiaddr)\n      }\n    }\n  }\n\n  /**\n   * Our multicodec topology noticed a new peer that supports autonat\n   */\n  async verifyExternalAddresses (connection: Connection): Promise<void> {\n    // do nothing if we are not running\n    if (!this.isStarted()) {\n      return\n    }\n\n    // perform cleanup\n    this.removeOutdatedMultiaddrResults()\n\n    const peer = await this.components.peerStore.get(connection.remotePeer)\n\n    // if the remote peer has IPv6 addresses, we can probably send them an IPv6\n    // address to verify, otherwise only send them IPv4 addresses\n    const supportsIPv6 = peer.addresses.some(({ multiaddr }) => {\n      return multiaddr.toOptions().family === 6\n    })\n\n    // get multiaddrs this peer is eligible to verify\n    const segment = this.getNetworkSegment(connection.remoteAddr)\n    const results = this.getFirstUnverifiedMultiaddr(segment, supportsIPv6)\n\n    if (results == null) {\n      this.log.trace('no unverified public addresses found for peer %p to verify, not requesting verification', connection.remotePeer)\n      return\n    }\n\n    if (!this.hasConnectionCapacity()) {\n      // we are near the max connection limit - any dial attempts from remote\n      // peers may be rejected which will get flagged as false dial errors and\n      // lead us to un-verify an otherwise reachable address\n\n      if (results.lastVerified != null) {\n        this.log('automatically re-verifying %a because we are too close to the connection limit', results.multiaddr)\n        this.confirmAddress(results)\n      } else {\n        this.log('skipping verifying %a because we are too close to the connection limit', results.multiaddr)\n      }\n\n      return\n    }\n\n    results.queue.add(async (options: TestAddressOptions) => {\n      await this.askPeerToVerify(connection, segment, options)\n    }, {\n      peerId: connection.remotePeer,\n      multiaddr: results.multiaddr\n    })\n      .catch(err => {\n        if (results?.result == null) {\n          this.log.error('error from %p verifying address %a - %e', connection.remotePeer, results?.multiaddr, err)\n        }\n      })\n  }\n\n  private async askPeerToVerify (connection: Connection, segment: string, options: TestAddressOptions): Promise<void> {\n    let results = this.dialResults.get(options.multiaddr.toString())\n\n    if (results == null) {\n      this.log('%a was verified while %p was queued', options.multiaddr, connection.remotePeer)\n      return\n    }\n\n    const signal = AbortSignal.timeout(this.timeout)\n    setMaxListeners(Infinity, signal)\n\n    this.log.trace('asking %p to verify multiaddr %s', connection.remotePeer, options.multiaddr)\n\n    const stream = await connection.newStream(this.protocol, {\n      signal\n    })\n\n    try {\n      const messages = pbStream(stream).pb(Message)\n      const [, response] = await Promise.all([\n        messages.write({\n          type: Message.MessageType.DIAL,\n          dial: {\n            peer: {\n              id: this.components.peerId.toMultihash().bytes,\n              addrs: [options.multiaddr.bytes]\n            }\n          }\n        }, { signal }),\n        messages.read({ signal })\n      ])\n\n      if (response.type !== Message.MessageType.DIAL_RESPONSE || response.dialResponse == null) {\n        this.log('invalid autonat response from %p - %j', connection.remotePeer, response)\n        return\n      }\n\n      const status = response.dialResponse.status\n\n      this.log.trace('autonat response from %p for %a is %s', connection.remotePeer, options.multiaddr, status)\n\n      if (status !== Message.ResponseStatus.OK && status !== Message.ResponseStatus.E_DIAL_ERROR) {\n        return\n      }\n\n      results = this.dialResults.get(options.multiaddr.toString())\n\n      if (results == null) {\n        this.log.trace('peer reported %a as %s but there is no result object', options.multiaddr, response.dialResponse.status)\n        return\n      }\n\n      if (results.networkSegments.includes(segment)) {\n        this.log.trace('%a results included network segment %s', options.multiaddr, segment)\n        return\n      }\n\n      if (results.result != null) {\n        this.log.trace('already resolved result for %a, ignoring response from', options.multiaddr, connection.remotePeer)\n        return\n      }\n\n      if (results.verifyingPeers.has(connection.remotePeer)) {\n        this.log.trace('peer %p has already verified %a, ignoring response', connection.remotePeer, options.multiaddr)\n        return\n      }\n\n      results.verifyingPeers.add(connection.remotePeer)\n      results.networkSegments.push(segment)\n\n      if (status === Message.ResponseStatus.OK) {\n        results.success++\n\n        // observed addresses require more confirmations\n        if (results.type !== 'observed') {\n          this.confirmAddress(results)\n          return\n        }\n      } else if (status === Message.ResponseStatus.E_DIAL_ERROR) {\n        results.failure++\n      }\n\n      this.log('%a success %d failure %d', results.multiaddr, results.success, results.failure)\n\n      if (results.success === REQUIRED_SUCCESSFUL_DIALS) {\n        this.confirmAddress(results)\n      }\n\n      if (results.failure === REQUIRED_FAILED_DIALS) {\n        this.unconfirmAddress(results)\n      }\n    } finally {\n      try {\n        await stream.close({\n          signal\n        })\n      } catch (err: any) {\n        stream.abort(err)\n      }\n    }\n  }\n\n  private hasConnectionCapacity (): boolean {\n    const connections = this.components.connectionManager.getConnections()\n    const currentConnectionCount = connections.length\n    const maxConnections = this.components.connectionManager.getMaxConnections()\n\n    return ((currentConnectionCount / maxConnections) * 100) < this.connectionThreshold\n  }\n\n  private confirmAddress (results: DialResults): void {\n    // we are now convinced\n    this.log('%s address %a is externally dialable', results.type, results.multiaddr)\n    this.components.addressManager.confirmObservedAddr(results.multiaddr)\n    this.dialResults.delete(results.multiaddr.toString())\n\n    // abort & remove any outstanding verification jobs for this multiaddr\n    results.result = true\n    results.queue.abort()\n  }\n\n  private unconfirmAddress (results: DialResults): void {\n    // we are now unconvinced\n    this.log('%s address %a is not externally dialable', results.type, results.multiaddr)\n    this.components.addressManager.removeObservedAddr(results.multiaddr)\n    this.dialResults.delete(results.multiaddr.toString())\n\n    // abort & remove any outstanding verification jobs for this multiaddr\n    results.result = false\n    results.queue.abort()\n  }\n\n  private getNetworkSegment (ma: Multiaddr): string {\n    // make sure we use different network segments\n    const options = ma.toOptions()\n\n    if (options.family === 4) {\n      const octets = options.host.split('.')\n      return octets[0].padStart(3, '0')\n    }\n\n    const octets = options.host.split(':')\n    return octets[0].padStart(4, '0')\n  }\n}\n", "/**\n * @packageDocumentation\n *\n * The AutoNAT service uses the [AutoNAT protocol](https://docs.libp2p.io/concepts/nat/autonat/).\n * The service confirms addresses are dialable by remote peers, and updates the list it advertises.\n *\n * The service dials randomly selected peers with a request to verify it's external addresses.\n * The request includes a list of public multiaddrs (addressManager.getObservedAddrs()).\n * The remote peers dial that list and respond with the results.\n *\n * The AutoNAT service uses those responses to either:\n * - addressManager.confirmObservedAddr(addr)\n * - addressManager.removeObservedAddr(addr)\n *\n * The result list of candidates and confirmed addresses can be found\n * at addressManager.getObservedAddrs()\n *\n * @example\n *\n * ```typescript\n * import { createLibp2p } from 'libp2p'\n * import { autoNAT } from '@libp2p/autonat'\n *\n * const node = await createLibp2p({\n *   // ...other options\n *   services: {\n *     autoNAT: autoNAT()\n *   }\n * })\n * ```\n */\n\nimport { AutoNATService } from './autonat.js'\nimport type { ComponentLogger, Libp2pEvents, PeerId, PeerStore, TypedEventTarget } from '@libp2p/interface'\nimport type { AddressManager, ConnectionManager, RandomWalk, Registrar, TransportManager } from '@libp2p/interface-internal'\n\nexport interface AutoNATServiceInit {\n  /**\n   * Allows overriding the protocol prefix used\n   */\n  protocolPrefix?: string\n\n  /**\n   * How long we should wait for a remote peer to verify our external address\n   */\n  timeout?: number\n\n  /**\n   * How long to wait after startup before trying to verify our external address\n   */\n  startupDelay?: number\n\n  /**\n   * Verify our external addresses this often\n   */\n  refreshInterval?: number\n\n  /**\n   * How many parallel inbound autoNAT streams we allow per-connection\n   */\n  maxInboundStreams?: number\n\n  /**\n   * How many parallel outbound autoNAT streams we allow per-connection\n   */\n  maxOutboundStreams?: number\n\n  /**\n   * If the number of currently open connections is higher than this value as\n   * a percentage of the maximum number of allowed connections, automatically\n   * reverify previously verified addresses since auto nat peers may find it\n   * hard to dial and will report that the address is not dialable leading this\n   * node to delist it.\n   *\n   * @default 80\n   */\n  connectionThreshold?: number\n\n  /**\n   * How large incoming autonat messages are allowed to be in bytes. If messages\n   * larger than this are received the stream will be reset.\n   *\n   * @default 8192\n   */\n  maxMessageSize?: number\n}\n\nexport interface AutoNATComponents {\n  registrar: Registrar\n  addressManager: AddressManager\n  transportManager: TransportManager\n  peerId: PeerId\n  connectionManager: ConnectionManager\n  logger: ComponentLogger\n  randomWalk: RandomWalk\n  events: TypedEventTarget<Libp2pEvents>\n  peerStore: PeerStore\n}\n\nexport function autoNAT (init: AutoNATServiceInit = {}): (components: AutoNATComponents) => unknown {\n  return (components) => {\n    return new AutoNATService(components, init)\n  }\n}\n", "import { KEEP_ALIVE } from '@libp2p/interface'\n\nconst second = 1000\nconst minute = 60 * second\n\n/**\n * Multicodec code\n */\nexport const CIRCUIT_PROTO_CODE = 290\n\n/**\n * The maximum number of relay reservations the relay server will accept\n */\nexport const DEFAULT_MAX_RESERVATION_STORE_SIZE = 15\n\n/**\n * How often to check for reservation expiry\n */\nexport const DEFAULT_MAX_RESERVATION_TTL = 2 * 60 * minute\n\n/**\n * How many reservation attempts to make in parallel\n */\nexport const DEFAULT_RESERVATION_CONCURRENCY = 1\n\n/**\n * How long to wait for a reservation attempt to finish\n */\nexport const DEFAULT_RESERVATION_COMPLETION_TIMEOUT = 2000\n\n/**\n * How long to let the reservation attempt queue to grow\n */\nexport const DEFAULT_MAX_RESERVATION_QUEUE_LENGTH = 100\n\nexport const RELAY_SOURCE_TAG = 'circuit-relay-source'\n\nexport const KEEP_ALIVE_TAG = `${KEEP_ALIVE}-circuit-relay`\nexport const KEEP_ALIVE_SOURCE_TAG = `${KEEP_ALIVE}-circuit-relay-source`\n\n// circuit v2 connection limits\n// https://github.com/libp2p/go-libp2p/blob/master/p2p/protocol/circuitv2/relay/resources.go#L61-L66\n\n// 2 min is the default connection duration\nexport const DEFAULT_DURATION_LIMIT = 2 * minute\n\n// 128k is the default data limit\nexport const DEFAULT_DATA_LIMIT = BigInt(1 << 17)\n\n/**\n * The hop protocol\n */\nexport const RELAY_V2_HOP_CODEC = '/libp2p/circuit/relay/0.2.0/hop'\n\n/**\n * the stop protocol\n */\nexport const RELAY_V2_STOP_CODEC = '/libp2p/circuit/relay/0.2.0/stop'\n\n/**\n * Hop messages must be exchanged inside this timeout\n */\nexport const DEFAULT_HOP_TIMEOUT = 30 * second\n\n/**\n * How long to wait before starting to advertise the relay service\n */\nexport const DEFAULT_ADVERT_BOOT_DELAY = 30 * second\n\nexport const MAX_CONNECTIONS = 300\n\nexport const DEFAULT_DISCOVERY_FILTER_SIZE = 4096\nexport const DEFAULT_DISCOVERY_FILTER_ERROR_RATE = 0.001\n", "/* eslint-disable import/export */\n/* eslint-disable complexity */\n/* eslint-disable @typescript-eslint/no-namespace */\n/* eslint-disable @typescript-eslint/no-unnecessary-boolean-literal-compare */\n/* eslint-disable @typescript-eslint/no-empty-interface */\n\nimport { type Codec, decodeMessage, type DecodeOptions, encodeMessage, enumeration, MaxLengthError, message } from 'protons-runtime'\nimport { alloc as uint8ArrayAlloc } from 'uint8arrays/alloc'\nimport type { Uint8ArrayList } from 'uint8arraylist'\n\nexport interface HopMessage {\n  type?: HopMessage.Type\n  peer?: Peer\n  reservation?: Reservation\n  limit?: Limit\n  status?: Status\n}\n\nexport namespace HopMessage {\n  export enum Type {\n    RESERVE = 'RESERVE',\n    CONNECT = 'CONNECT',\n    STATUS = 'STATUS'\n  }\n\n  enum __TypeValues {\n    RESERVE = 0,\n    CONNECT = 1,\n    STATUS = 2\n  }\n\n  export namespace Type {\n    export const codec = (): Codec<Type> => {\n      return enumeration<Type>(__TypeValues)\n    }\n  }\n\n  let _codec: Codec<HopMessage>\n\n  export const codec = (): Codec<HopMessage> => {\n    if (_codec == null) {\n      _codec = message<HopMessage>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if (obj.type != null) {\n          w.uint32(8)\n          HopMessage.Type.codec().encode(obj.type, w)\n        }\n\n        if (obj.peer != null) {\n          w.uint32(18)\n          Peer.codec().encode(obj.peer, w)\n        }\n\n        if (obj.reservation != null) {\n          w.uint32(26)\n          Reservation.codec().encode(obj.reservation, w)\n        }\n\n        if (obj.limit != null) {\n          w.uint32(34)\n          Limit.codec().encode(obj.limit, w)\n        }\n\n        if (obj.status != null) {\n          w.uint32(40)\n          Status.codec().encode(obj.status, w)\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {}\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.type = HopMessage.Type.codec().decode(reader)\n              break\n            }\n            case 2: {\n              obj.peer = Peer.codec().decode(reader, reader.uint32(), {\n                limits: opts.limits?.peer\n              })\n              break\n            }\n            case 3: {\n              obj.reservation = Reservation.codec().decode(reader, reader.uint32(), {\n                limits: opts.limits?.reservation\n              })\n              break\n            }\n            case 4: {\n              obj.limit = Limit.codec().decode(reader, reader.uint32(), {\n                limits: opts.limits?.limit\n              })\n              break\n            }\n            case 5: {\n              obj.status = Status.codec().decode(reader)\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<HopMessage>): Uint8Array => {\n    return encodeMessage(obj, HopMessage.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<HopMessage>): HopMessage => {\n    return decodeMessage(buf, HopMessage.codec(), opts)\n  }\n}\n\nexport interface StopMessage {\n  type?: StopMessage.Type\n  peer?: Peer\n  limit?: Limit\n  status?: Status\n}\n\nexport namespace StopMessage {\n  export enum Type {\n    CONNECT = 'CONNECT',\n    STATUS = 'STATUS'\n  }\n\n  enum __TypeValues {\n    CONNECT = 0,\n    STATUS = 1\n  }\n\n  export namespace Type {\n    export const codec = (): Codec<Type> => {\n      return enumeration<Type>(__TypeValues)\n    }\n  }\n\n  let _codec: Codec<StopMessage>\n\n  export const codec = (): Codec<StopMessage> => {\n    if (_codec == null) {\n      _codec = message<StopMessage>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if (obj.type != null) {\n          w.uint32(8)\n          StopMessage.Type.codec().encode(obj.type, w)\n        }\n\n        if (obj.peer != null) {\n          w.uint32(18)\n          Peer.codec().encode(obj.peer, w)\n        }\n\n        if (obj.limit != null) {\n          w.uint32(26)\n          Limit.codec().encode(obj.limit, w)\n        }\n\n        if (obj.status != null) {\n          w.uint32(32)\n          Status.codec().encode(obj.status, w)\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {}\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.type = StopMessage.Type.codec().decode(reader)\n              break\n            }\n            case 2: {\n              obj.peer = Peer.codec().decode(reader, reader.uint32(), {\n                limits: opts.limits?.peer\n              })\n              break\n            }\n            case 3: {\n              obj.limit = Limit.codec().decode(reader, reader.uint32(), {\n                limits: opts.limits?.limit\n              })\n              break\n            }\n            case 4: {\n              obj.status = Status.codec().decode(reader)\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<StopMessage>): Uint8Array => {\n    return encodeMessage(obj, StopMessage.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<StopMessage>): StopMessage => {\n    return decodeMessage(buf, StopMessage.codec(), opts)\n  }\n}\n\nexport interface Peer {\n  id: Uint8Array\n  addrs: Uint8Array[]\n}\n\nexport namespace Peer {\n  let _codec: Codec<Peer>\n\n  export const codec = (): Codec<Peer> => {\n    if (_codec == null) {\n      _codec = message<Peer>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if ((obj.id != null && obj.id.byteLength > 0)) {\n          w.uint32(10)\n          w.bytes(obj.id)\n        }\n\n        if (obj.addrs != null) {\n          for (const value of obj.addrs) {\n            w.uint32(18)\n            w.bytes(value)\n          }\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {\n          id: uint8ArrayAlloc(0),\n          addrs: []\n        }\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.id = reader.bytes()\n              break\n            }\n            case 2: {\n              if (opts.limits?.addrs != null && obj.addrs.length === opts.limits.addrs) {\n                throw new MaxLengthError('Decode error - map field \"addrs\" had too many elements')\n              }\n\n              obj.addrs.push(reader.bytes())\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<Peer>): Uint8Array => {\n    return encodeMessage(obj, Peer.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<Peer>): Peer => {\n    return decodeMessage(buf, Peer.codec(), opts)\n  }\n}\n\nexport interface Reservation {\n  expire: bigint\n  addrs: Uint8Array[]\n  voucher?: Envelope\n}\n\nexport namespace Reservation {\n  let _codec: Codec<Reservation>\n\n  export const codec = (): Codec<Reservation> => {\n    if (_codec == null) {\n      _codec = message<Reservation>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if ((obj.expire != null && obj.expire !== 0n)) {\n          w.uint32(8)\n          w.uint64(obj.expire)\n        }\n\n        if (obj.addrs != null) {\n          for (const value of obj.addrs) {\n            w.uint32(18)\n            w.bytes(value)\n          }\n        }\n\n        if (obj.voucher != null) {\n          w.uint32(26)\n          Envelope.codec().encode(obj.voucher, w)\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {\n          expire: 0n,\n          addrs: []\n        }\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.expire = reader.uint64()\n              break\n            }\n            case 2: {\n              if (opts.limits?.addrs != null && obj.addrs.length === opts.limits.addrs) {\n                throw new MaxLengthError('Decode error - map field \"addrs\" had too many elements')\n              }\n\n              obj.addrs.push(reader.bytes())\n              break\n            }\n            case 3: {\n              obj.voucher = Envelope.codec().decode(reader, reader.uint32(), {\n                limits: opts.limits?.voucher\n              })\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<Reservation>): Uint8Array => {\n    return encodeMessage(obj, Reservation.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<Reservation>): Reservation => {\n    return decodeMessage(buf, Reservation.codec(), opts)\n  }\n}\n\nexport interface Limit {\n  duration?: number\n  data?: bigint\n}\n\nexport namespace Limit {\n  let _codec: Codec<Limit>\n\n  export const codec = (): Codec<Limit> => {\n    if (_codec == null) {\n      _codec = message<Limit>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if (obj.duration != null) {\n          w.uint32(8)\n          w.uint32(obj.duration)\n        }\n\n        if (obj.data != null) {\n          w.uint32(16)\n          w.uint64(obj.data)\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {}\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.duration = reader.uint32()\n              break\n            }\n            case 2: {\n              obj.data = reader.uint64()\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<Limit>): Uint8Array => {\n    return encodeMessage(obj, Limit.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<Limit>): Limit => {\n    return decodeMessage(buf, Limit.codec(), opts)\n  }\n}\n\nexport enum Status {\n  UNUSED = 'UNUSED',\n  OK = 'OK',\n  RESERVATION_REFUSED = 'RESERVATION_REFUSED',\n  RESOURCE_LIMIT_EXCEEDED = 'RESOURCE_LIMIT_EXCEEDED',\n  PERMISSION_DENIED = 'PERMISSION_DENIED',\n  CONNECTION_FAILED = 'CONNECTION_FAILED',\n  NO_RESERVATION = 'NO_RESERVATION',\n  MALFORMED_MESSAGE = 'MALFORMED_MESSAGE',\n  UNEXPECTED_MESSAGE = 'UNEXPECTED_MESSAGE'\n}\n\nenum __StatusValues {\n  UNUSED = 0,\n  OK = 100,\n  RESERVATION_REFUSED = 200,\n  RESOURCE_LIMIT_EXCEEDED = 201,\n  PERMISSION_DENIED = 202,\n  CONNECTION_FAILED = 203,\n  NO_RESERVATION = 204,\n  MALFORMED_MESSAGE = 400,\n  UNEXPECTED_MESSAGE = 401\n}\n\nexport namespace Status {\n  export const codec = (): Codec<Status> => {\n    return enumeration<Status>(__StatusValues)\n  }\n}\nexport interface ReservationVoucher {\n  relay: Uint8Array\n  peer: Uint8Array\n  expiration: bigint\n}\n\nexport namespace ReservationVoucher {\n  let _codec: Codec<ReservationVoucher>\n\n  export const codec = (): Codec<ReservationVoucher> => {\n    if (_codec == null) {\n      _codec = message<ReservationVoucher>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if ((obj.relay != null && obj.relay.byteLength > 0)) {\n          w.uint32(10)\n          w.bytes(obj.relay)\n        }\n\n        if ((obj.peer != null && obj.peer.byteLength > 0)) {\n          w.uint32(18)\n          w.bytes(obj.peer)\n        }\n\n        if ((obj.expiration != null && obj.expiration !== 0n)) {\n          w.uint32(24)\n          w.uint64(obj.expiration)\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {\n          relay: uint8ArrayAlloc(0),\n          peer: uint8ArrayAlloc(0),\n          expiration: 0n\n        }\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.relay = reader.bytes()\n              break\n            }\n            case 2: {\n              obj.peer = reader.bytes()\n              break\n            }\n            case 3: {\n              obj.expiration = reader.uint64()\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<ReservationVoucher>): Uint8Array => {\n    return encodeMessage(obj, ReservationVoucher.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<ReservationVoucher>): ReservationVoucher => {\n    return decodeMessage(buf, ReservationVoucher.codec(), opts)\n  }\n}\n\nexport interface Envelope {\n  publicKey: Uint8Array\n  payloadType: Uint8Array\n  payload?: ReservationVoucher\n  signature: Uint8Array\n}\n\nexport namespace Envelope {\n  let _codec: Codec<Envelope>\n\n  export const codec = (): Codec<Envelope> => {\n    if (_codec == null) {\n      _codec = message<Envelope>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if ((obj.publicKey != null && obj.publicKey.byteLength > 0)) {\n          w.uint32(10)\n          w.bytes(obj.publicKey)\n        }\n\n        if ((obj.payloadType != null && obj.payloadType.byteLength > 0)) {\n          w.uint32(18)\n          w.bytes(obj.payloadType)\n        }\n\n        if (obj.payload != null) {\n          w.uint32(26)\n          ReservationVoucher.codec().encode(obj.payload, w)\n        }\n\n        if ((obj.signature != null && obj.signature.byteLength > 0)) {\n          w.uint32(42)\n          w.bytes(obj.signature)\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {\n          publicKey: uint8ArrayAlloc(0),\n          payloadType: uint8ArrayAlloc(0),\n          signature: uint8ArrayAlloc(0)\n        }\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.publicKey = reader.bytes()\n              break\n            }\n            case 2: {\n              obj.payloadType = reader.bytes()\n              break\n            }\n            case 3: {\n              obj.payload = ReservationVoucher.codec().decode(reader, reader.uint32(), {\n                limits: opts.limits?.payload\n              })\n              break\n            }\n            case 5: {\n              obj.signature = reader.bytes()\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<Envelope>): Uint8Array => {\n    return encodeMessage(obj, Envelope.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<Envelope>): Envelope => {\n    return decodeMessage(buf, Envelope.codec(), opts)\n  }\n}\n", "/**\n * A transfer limit was hit\n */\nexport class TransferLimitError extends Error {\n  constructor (message = 'Transfer limit error') {\n    super(message)\n    this.name = 'TransferLimitError'\n  }\n}\n\n/**\n * A duration limit was hit\n */\nexport class DurationLimitError extends Error {\n  constructor (message = 'Duration limit error') {\n    super(message)\n    this.name = 'DurationLimitError'\n  }\n}\n\n/**\n * There were enough relay reservations already\n */\nexport class HadEnoughRelaysError extends Error {\n  static name: string = 'HadEnoughRelaysError'\n  name: string = 'HadEnoughRelaysError'\n}\n\n/**\n * An attempt to open a relayed connection over a relayed connection was made\n */\nexport class DoubleRelayError extends Error {\n  static name: string = 'DoubleRelayError'\n  name: string = 'DoubleRelayError'\n}\n\n/**\n * An attempt to make a reservation on a relay was made while the reservation\n * queue was full\n */\nexport class RelayQueueFullError extends Error {\n  static name: string = 'RelayQueueFullError'\n  name: string = 'RelayQueueFullError'\n}\n", "import { P2P } from '@multiformats/multiaddr-matcher'\nimport { fmt, literal, and } from '@multiformats/multiaddr-matcher/utils'\nimport { anySignal } from 'any-signal'\nimport { CID } from 'multiformats/cid'\nimport { sha256 } from 'multiformats/hashes/sha2'\nimport { DurationLimitError, TransferLimitError } from './errors.js'\nimport type { RelayReservation } from './index.js'\nimport type { Limit } from './pb/index.js'\nimport type { ConnectionLimits, LoggerOptions, Stream } from '@libp2p/interface'\nimport type { Source } from 'it-stream-types'\nimport type { Uint8ArrayList } from 'uint8arraylist'\n\nasync function * countStreamBytes (source: Source<Uint8Array | Uint8ArrayList>, limit: { remaining: bigint }, options: LoggerOptions): AsyncGenerator<Uint8Array | Uint8ArrayList, void, unknown> {\n  const limitBytes = limit.remaining\n\n  for await (const buf of source) {\n    const len = BigInt(buf.byteLength)\n\n    if ((limit.remaining - len) < 0) {\n      // this is a safe downcast since len is guarantee to be in the range for a number\n      const remaining = Number(limit.remaining)\n      limit.remaining = 0n\n\n      try {\n        if (remaining !== 0) {\n          yield buf.subarray(0, remaining)\n        }\n      } catch (err: any) {\n        options.log.error(err)\n      }\n\n      throw new TransferLimitError(`data limit of ${limitBytes} bytes exceeded`)\n    }\n\n    limit.remaining -= len\n    yield buf\n  }\n}\n\nexport function createLimitedRelay (src: Stream, dst: Stream, abortSignal: AbortSignal, reservation: RelayReservation, options: LoggerOptions): void {\n  function abortStreams (err: Error): void {\n    src.abort(err)\n    dst.abort(err)\n  }\n\n  // combine shutdown signal and reservation expiry signal\n  const signals = [abortSignal, reservation.signal]\n\n  if (reservation.limit?.duration != null) {\n    options.log('limiting relayed connection duration to %dms', reservation.limit.duration)\n    signals.push(AbortSignal.timeout(reservation.limit.duration))\n  }\n\n  const signal = anySignal(signals)\n\n  let srcDstFinished = false\n  let dstSrcFinished = false\n\n  let dataLimit: { remaining: bigint } | undefined\n\n  if (reservation.limit?.data != null) {\n    dataLimit = {\n      remaining: reservation.limit.data\n    }\n  }\n\n  queueMicrotask(() => {\n    const onAbort = (): void => {\n      options.log('relayed connection reached time limit')\n      dst.abort(new DurationLimitError(`duration limit of ${reservation.limit?.duration} ms exceeded`))\n    }\n\n    signal.addEventListener('abort', onAbort, { once: true })\n\n    void dst.sink(dataLimit == null ? src.source : countStreamBytes(src.source, dataLimit, options))\n      .catch(err => {\n        options.log.error('error while relaying streams src -> dst', err)\n        abortStreams(err)\n      })\n      .finally(() => {\n        srcDstFinished = true\n\n        if (dstSrcFinished) {\n          signal.removeEventListener('abort', onAbort)\n          signal.clear()\n        }\n      })\n  })\n\n  queueMicrotask(() => {\n    const onAbort = (): void => {\n      options.log('relayed connection reached time limit')\n      src.abort(new DurationLimitError(`duration limit of ${reservation.limit?.duration} ms exceeded`))\n    }\n\n    signal.addEventListener('abort', onAbort, { once: true })\n\n    void src.sink(dataLimit == null ? dst.source : countStreamBytes(dst.source, dataLimit, options))\n      .catch(err => {\n        options.log.error('error while relaying streams dst -> src', err)\n        abortStreams(err)\n      })\n      .finally(() => {\n        dstSrcFinished = true\n\n        if (srcDstFinished) {\n          signal.removeEventListener('abort', onAbort)\n          signal.clear()\n        }\n      })\n  })\n}\n\n/**\n * Convert a namespace string into a cid\n */\nexport async function namespaceToCid (namespace: string): Promise<CID> {\n  const bytes = new TextEncoder().encode(namespace)\n  const hash = await sha256.digest(bytes)\n\n  return CID.createV0(hash)\n}\n\n/**\n * returns number of ms between now and expiration time\n */\nexport function getExpirationMilliseconds (expireTimeSeconds: bigint): number {\n  const expireTimeMillis = expireTimeSeconds * BigInt(1000)\n  const currentTime = new Date().getTime()\n\n  // downcast to number to use with setTimeout\n  return Number(expireTimeMillis - BigInt(currentTime))\n}\n\nexport class LimitTracker {\n  private readonly expires?: number\n  private bytes?: bigint\n\n  constructor (limits?: Limit) {\n    if (limits?.duration != null && limits?.duration !== 0) {\n      this.expires = Date.now() + (limits.duration * 1000)\n    }\n\n    this.bytes = limits?.data\n\n    if (this.bytes === 0n) {\n      this.bytes = undefined\n    }\n\n    this.onData = this.onData.bind(this)\n  }\n\n  onData (buf: Uint8ArrayList | Uint8Array): void {\n    if (this.bytes == null) {\n      return\n    }\n\n    this.bytes -= BigInt(buf.byteLength)\n\n    if (this.bytes < 0n) {\n      this.bytes = 0n\n    }\n  }\n\n  getLimits (): ConnectionLimits | undefined {\n    if (this.expires == null && this.bytes == null) {\n      return\n    }\n\n    const output = {}\n\n    if (this.bytes != null) {\n      const self = this\n\n      Object.defineProperty(output, 'bytes', {\n        get () {\n          return self.bytes\n        }\n      })\n    }\n\n    if (this.expires != null) {\n      const self = this\n\n      Object.defineProperty(output, 'seconds', {\n        get () {\n          return Math.round(((self.expires ?? 0) - Date.now()) / 1000)\n        }\n      })\n    }\n\n    return output\n  }\n}\n\n/**\n * A custom matcher that tells us to listen on a particular relay\n */\nexport const CircuitListen = fmt(\n  and(P2P.matchers[0], literal('p2p-circuit'))\n)\n\n/**\n * A custom matcher that tells us to discover available relays\n */\nexport const CircuitSearch = fmt(\n  literal('p2p-circuit')\n)\n", "/**\n * @packageDocumentation\n *\n * This module exports a `retimeableSignal` function that returns an\n * `AbortSignal` that fires an \"abort\" event after a specified number of ms.\n *\n * It has been augmented with two additional methods `reset` and `clear` which\n * change the timeout time and prevent it from firing entirely.\n *\n * @example\n *\n * ```TypeScript\n * import { retimeableSignal } from 'retimeable-signal'\n *\n * const signal = retimeableSignal(100)\n *\n * //... time passes, reset timeout to now + 100ms\n * signal.reset(100)\n *\n * // stop the signal from aborting at all\n * signal.clear()\n * ```\n *\n * ## Prior art\n *\n * This is module is inspired by the [retimer](https://www.npmjs.com/package/retimer)\n * module except that uses `setTimeout` which can cause a Node.js process to\n * stay open, this uses `AbortSignal.timeout` which does not.\n */\n\n/**\n * An abort error class that extends error\n */\nclass AbortError extends Error {\n  public type: string\n  public code: string | string\n\n  constructor (message?: string, code?: string, name?: string) {\n    super(message ?? 'The operation was aborted')\n    this.type = 'aborted'\n    this.name = name ?? 'AbortError'\n    this.code = code ?? 'ABORT_ERR'\n  }\n}\n\nexport interface RetimerSignalOptions {\n  /**\n   * The message for the error thrown if the signal aborts\n   */\n  errorMessage?: string\n\n  /**\n   * The code for the error thrown if the signal aborts\n   */\n  errorCode?: string\n\n  /**\n   * The name for the error thrown if the signal aborts\n   */\n  errorName?: string\n}\n\n/**\n * An extension to the `AbortSignal` interface that allows resetting the timer\n * after which the signal will fire it's \"abort\" event.\n */\nexport interface RetimeableAbortSignal extends AbortSignal {\n  /**\n   * Reset the timer. If `ms` is specified, the timer will fire this many ms in\n   * the future, otherwise it will fire according to the `ms` arg originally\n   * passed to `retimerSignal`.\n   */\n  reset(ms?: number): void\n\n  /**\n   * Clear the timer, the \"abort\" event will no longer be fired\n   */\n  clear(): void\n}\n\n/**\n * Return an AbortSignal that times out after a specified number of ms with an\n * internal timer that can be reset to fire further into the future or cleared\n * entirely\n */\nexport function retimeableSignal (ms: number, opts?: RetimerSignalOptions): RetimeableAbortSignal {\n  // create the error here so we have more context in the stack trace\n  const error = new AbortError(opts?.errorMessage, opts?.errorCode, opts?.errorName)\n  const controller = new AbortController()\n  const abortHandler = (): void => {\n    controller.abort(error)\n  }\n\n  let signal: AbortSignal | undefined = AbortSignal.timeout(ms)\n  signal.addEventListener('abort', abortHandler)\n\n  const retimerSignal = controller.signal as any\n  retimerSignal.reset = (newMs?: number): void => {\n    signal?.removeEventListener('abort', abortHandler)\n    signal = AbortSignal.timeout(newMs ?? ms)\n    signal.addEventListener('abort', () => {\n      controller.abort(error)\n    })\n  }\n  retimerSignal.clear = (): void => {\n    signal?.removeEventListener('abort', abortHandler)\n    signal = undefined\n  }\n\n  return retimerSignal satisfies RetimeableAbortSignal\n}\n", "import { trackedPeerMap } from '@libp2p/peer-collections'\nimport { retimeableSignal } from 'retimeable-signal'\nimport { DEFAULT_DATA_LIMIT, DEFAULT_DURATION_LIMIT, DEFAULT_MAX_RESERVATION_STORE_SIZE, DEFAULT_MAX_RESERVATION_TTL } from '../constants.js'\nimport { type Limit, Status } from '../pb/index.js'\nimport type { RelayReservation } from '../index.js'\nimport type { ComponentLogger, Logger, Metrics, PeerId } from '@libp2p/interface'\nimport type { PeerMap } from '@libp2p/peer-collections'\nimport type { Multiaddr } from '@multiformats/multiaddr'\n\nexport type ReservationStatus = Status.OK | Status.PERMISSION_DENIED | Status.RESERVATION_REFUSED\n\nexport interface ReservationStoreComponents {\n  logger: ComponentLogger\n  metrics?: Metrics\n}\n\nexport interface ReservationStoreInit {\n  /**\n   * maximum number of reservations allowed\n   *\n   * @default 15\n   */\n  maxReservations?: number\n\n  /**\n   * interval after which stale reservations are cleared\n   *\n   * @default 300000\n   */\n  reservationClearInterval?: number\n\n  /**\n   * apply default relay limits to a new reservation\n   *\n   * @default true\n   */\n  applyDefaultLimit?: boolean\n\n  /**\n   * reservation ttl\n   *\n   * @default 7200000\n   */\n  reservationTtl?: number\n\n  /**\n   * The maximum time a relayed connection can be open for\n   */\n  defaultDurationLimit?: number\n\n  /**\n   * The maximum amount of data allowed to be transferred over a relayed connection\n   */\n  defaultDataLimit?: bigint\n}\n\nexport class ReservationStore {\n  public readonly reservations: PeerMap<RelayReservation>\n  private readonly maxReservations: number\n  private readonly applyDefaultLimit: boolean\n  private readonly reservationTtl: number\n  private readonly defaultDurationLimit: number\n  private readonly defaultDataLimit: bigint\n  private readonly log: Logger\n\n  constructor (components: ReservationStoreComponents, init: ReservationStoreInit = {}) {\n    this.log = components.logger.forComponent('libp2p:circuit-relay:server:reservation-store')\n    this.maxReservations = init.maxReservations ?? DEFAULT_MAX_RESERVATION_STORE_SIZE\n    this.applyDefaultLimit = init.applyDefaultLimit !== false\n    this.reservationTtl = init.reservationTtl ?? DEFAULT_MAX_RESERVATION_TTL\n    this.defaultDurationLimit = init.defaultDurationLimit ?? DEFAULT_DURATION_LIMIT\n    this.defaultDataLimit = init.defaultDataLimit ?? DEFAULT_DATA_LIMIT\n\n    this.reservations = trackedPeerMap<RelayReservation>({\n      metrics: components.metrics,\n      name: 'libp2p_circuit_relay_server_reservations_total'\n    })\n  }\n\n  reserve (peer: PeerId, addr: Multiaddr, limit?: Limit): { status: ReservationStatus, expire?: number } {\n    let reservation = this.reservations.get(peer)\n\n    if (this.reservations.size >= this.maxReservations && reservation == null) {\n      return { status: Status.RESERVATION_REFUSED }\n    }\n\n    const expiry = new Date(Date.now() + this.reservationTtl)\n    let checkedLimit: Limit | undefined\n\n    if (this.applyDefaultLimit) {\n      checkedLimit = limit ?? {\n        data: this.defaultDataLimit,\n        duration: this.defaultDurationLimit\n      }\n    }\n\n    if (reservation != null) {\n      this.log('refreshing reservation for client %p', peer)\n      reservation.signal.reset(this.reservationTtl)\n    } else {\n      this.log('creating new reservation for client %p', peer)\n      reservation = {\n        addr,\n        expiry,\n        limit: checkedLimit,\n        signal: retimeableSignal(this.reservationTtl)\n      }\n    }\n\n    this.reservations.set(peer, reservation)\n\n    reservation.signal.addEventListener('abort', () => {\n      this.reservations.delete(peer)\n    })\n\n    // return expiry time in seconds\n    return { status: Status.OK, expire: Math.round(expiry.getTime() / 1000) }\n  }\n\n  removeReservation (peer: PeerId): void {\n    this.reservations.delete(peer)\n  }\n\n  get (peer: PeerId): RelayReservation | undefined {\n    return this.reservations.get(peer)\n  }\n\n  clear (): void {\n    this.reservations.clear()\n  }\n}\n", "import { ReservationVoucher } from '../pb/index.js'\nimport type { PeerId, Record } from '@libp2p/interface'\n\nexport interface ReservationVoucherOptions {\n  relay: PeerId\n  peer: PeerId\n  expiration: bigint\n}\n\nexport class ReservationVoucherRecord implements Record {\n  public readonly domain = 'libp2p-relay-rsvp'\n  public readonly codec = new Uint8Array([0x03, 0x02])\n\n  private readonly relay: PeerId\n  private readonly peer: PeerId\n  private readonly expiration: bigint\n\n  constructor ({ relay, peer, expiration }: ReservationVoucherOptions) {\n    this.relay = relay\n    this.peer = peer\n    this.expiration = expiration\n  }\n\n  marshal (): Uint8Array {\n    return ReservationVoucher.encode({\n      relay: this.relay.toMultihash().bytes,\n      peer: this.peer.toMultihash().bytes,\n      expiration: BigInt(this.expiration)\n    })\n  }\n\n  equals (other: Record): boolean {\n    if (!(other instanceof ReservationVoucherRecord)) {\n      return false\n    }\n    if (!this.peer.equals(other.peer)) {\n      return false\n    }\n\n    if (!this.relay.equals(other.relay)) {\n      return false\n    }\n\n    if (this.expiration !== other.expiration) {\n      return false\n    }\n\n    return true\n  }\n}\n", "import { publicKeyToProtobuf } from '@libp2p/crypto/keys'\nimport { TypedEventEmitter, setMaxListeners } from '@libp2p/interface'\nimport { peerIdFromMultihash } from '@libp2p/peer-id'\nimport { RecordEnvelope } from '@libp2p/peer-record'\nimport { type Multiaddr, multiaddr } from '@multiformats/multiaddr'\nimport { pbStream, type ProtobufStream } from 'it-protobuf-stream'\nimport * as Digest from 'multiformats/hashes/digest'\nimport {\n  CIRCUIT_PROTO_CODE,\n  DEFAULT_HOP_TIMEOUT,\n  KEEP_ALIVE_SOURCE_TAG,\n  MAX_CONNECTIONS,\n  RELAY_SOURCE_TAG,\n  RELAY_V2_HOP_CODEC,\n  RELAY_V2_STOP_CODEC\n} from '../constants.js'\nimport { HopMessage, type Reservation, Status, StopMessage } from '../pb/index.js'\nimport { createLimitedRelay } from '../utils.js'\nimport { ReservationStore, type ReservationStoreInit } from './reservation-store.js'\nimport { ReservationVoucherRecord } from './reservation-voucher.js'\nimport type { CircuitRelayService, RelayReservation } from '../index.js'\nimport type { ComponentLogger, Logger, Connection, Stream, ConnectionGater, PeerId, PeerStore, Startable, PrivateKey, Metrics, AbortOptions } from '@libp2p/interface'\nimport type { AddressManager, ConnectionManager, IncomingStreamData, Registrar } from '@libp2p/interface-internal'\nimport type { PeerMap } from '@libp2p/peer-collections'\n\nconst isRelayAddr = (ma: Multiaddr): boolean => ma.protoCodes().includes(CIRCUIT_PROTO_CODE)\n\nexport interface CircuitRelayServerInit {\n  /**\n   * Incoming hop requests must complete within this time in ms otherwise\n   * the stream will be reset\n   *\n   * @default 30000\n   */\n  hopTimeout?: number\n\n  /**\n   * Configuration of reservations\n   */\n  reservations?: ReservationStoreInit\n\n  /**\n   * The maximum number of simultaneous HOP inbound streams that can be open at once\n   */\n  maxInboundHopStreams?: number\n\n  /**\n   * The maximum number of simultaneous HOP outbound streams that can be open at once\n   */\n  maxOutboundHopStreams?: number\n\n  /**\n   * The maximum number of simultaneous STOP outbound streams that can be open at\n   * once.\n   *\n   * @default 300\n   */\n  maxOutboundStopStreams?: number\n}\n\nexport interface HopProtocolOptions {\n  connection: Connection\n  request: HopMessage\n  stream: ProtobufStream<Stream>\n}\n\nexport interface StopOptions {\n  connection: Connection\n  request: StopMessage\n}\n\nexport interface CircuitRelayServerComponents {\n  registrar: Registrar\n  peerStore: PeerStore\n  addressManager: AddressManager\n  peerId: PeerId\n  privateKey: PrivateKey\n  connectionManager: ConnectionManager\n  connectionGater: ConnectionGater\n  logger: ComponentLogger\n  metrics?: Metrics\n}\n\nexport interface RelayServerEvents {\n  'relay:reservation': CustomEvent<RelayReservation>\n  'relay:advert:success': CustomEvent<unknown>\n  'relay:advert:error': CustomEvent<Error>\n}\n\nconst defaults = {\n  maxOutboundStopStreams: MAX_CONNECTIONS\n}\n\nclass CircuitRelayServer extends TypedEventEmitter<RelayServerEvents> implements Startable, CircuitRelayService {\n  private readonly registrar: Registrar\n  private readonly peerStore: PeerStore\n  private readonly addressManager: AddressManager\n  private readonly peerId: PeerId\n  private readonly privateKey: PrivateKey\n  private readonly connectionManager: ConnectionManager\n  private readonly connectionGater: ConnectionGater\n  private readonly reservationStore: ReservationStore\n  private started: boolean\n  private readonly hopTimeout: number\n  private readonly shutdownController: AbortController\n  private readonly maxInboundHopStreams?: number\n  private readonly maxOutboundHopStreams?: number\n  private readonly maxOutboundStopStreams: number\n  private readonly log: Logger\n\n  /**\n   * Creates an instance of Relay\n   */\n  constructor (components: CircuitRelayServerComponents, init: CircuitRelayServerInit = {}) {\n    super()\n\n    this.log = components.logger.forComponent('libp2p:circuit-relay:server')\n    this.registrar = components.registrar\n    this.peerStore = components.peerStore\n    this.addressManager = components.addressManager\n    this.peerId = components.peerId\n    this.privateKey = components.privateKey\n    this.connectionManager = components.connectionManager\n    this.connectionGater = components.connectionGater\n    this.started = false\n    this.hopTimeout = init?.hopTimeout ?? DEFAULT_HOP_TIMEOUT\n    this.maxInboundHopStreams = init.maxInboundHopStreams\n    this.maxOutboundHopStreams = init.maxOutboundHopStreams\n    this.maxOutboundStopStreams = init.maxOutboundStopStreams ?? defaults.maxOutboundStopStreams\n    this.reservationStore = new ReservationStore(components, init.reservations)\n\n    this.shutdownController = new AbortController()\n    setMaxListeners(Infinity, this.shutdownController.signal)\n  }\n\n  readonly [Symbol.toStringTag] = '@libp2p/circuit-relay-v2-server'\n\n  isStarted (): boolean {\n    return this.started\n  }\n\n  /**\n   * Start Relay service\n   */\n  async start (): Promise<void> {\n    if (this.started) {\n      return\n    }\n\n    await this.registrar.handle(RELAY_V2_HOP_CODEC, (data) => {\n      void this.onHop(data).catch(err => {\n        this.log.error(err)\n      })\n    }, {\n      maxInboundStreams: this.maxInboundHopStreams,\n      maxOutboundStreams: this.maxOutboundHopStreams,\n      runOnLimitedConnection: true\n    })\n\n    this.started = true\n  }\n\n  /**\n   * Stop Relay service\n   */\n  async stop (): Promise<void> {\n    this.reservationStore.clear()\n    this.shutdownController.abort()\n    await this.registrar.unhandle(RELAY_V2_HOP_CODEC)\n\n    this.started = false\n  }\n\n  async onHop ({ connection, stream }: IncomingStreamData): Promise<void> {\n    this.log('received circuit v2 hop protocol stream from %p', connection.remotePeer)\n\n    const options = {\n      signal: AbortSignal.timeout(this.hopTimeout)\n    }\n    const pbstr = pbStream(stream)\n\n    try {\n      const request: HopMessage = await pbstr.pb(HopMessage).read(options)\n\n      if (request?.type == null) {\n        throw new Error('request was invalid, could not read from stream')\n      }\n\n      this.log('received', request.type)\n\n      await this.handleHopProtocol({\n        connection,\n        stream: pbstr,\n        request\n      }, options)\n    } catch (err: any) {\n      this.log.error('error while handling hop', err)\n      await pbstr.pb(HopMessage).write({\n        type: HopMessage.Type.STATUS,\n        status: Status.MALFORMED_MESSAGE\n      }, options)\n      stream.abort(err)\n    }\n  }\n\n  async handleHopProtocol ({ stream, request, connection }: HopProtocolOptions, options: AbortOptions): Promise<void> {\n    this.log('received hop message')\n    switch (request.type) {\n      case HopMessage.Type.RESERVE: await this.handleReserve({ stream, request, connection }, options); break\n      case HopMessage.Type.CONNECT: await this.handleConnect({ stream, request, connection }, options); break\n      default: {\n        this.log.error('invalid hop request type %s via peer %p', request.type, connection.remotePeer)\n        await stream.pb(HopMessage).write({ type: HopMessage.Type.STATUS, status: Status.UNEXPECTED_MESSAGE })\n      }\n    }\n  }\n\n  async handleReserve ({ stream, connection }: HopProtocolOptions, options: AbortOptions): Promise<void> {\n    const hopstr = stream.pb(HopMessage)\n    this.log('hop reserve request from %p', connection.remotePeer)\n\n    if (isRelayAddr(connection.remoteAddr)) {\n      this.log.error('relay reservation over circuit connection denied for peer: %p', connection.remotePeer)\n      await hopstr.write({ type: HopMessage.Type.STATUS, status: Status.PERMISSION_DENIED }, options)\n      return\n    }\n\n    if ((await this.connectionGater.denyInboundRelayReservation?.(connection.remotePeer)) === true) {\n      this.log.error('reservation for %p denied by connection gater', connection.remotePeer)\n      await hopstr.write({ type: HopMessage.Type.STATUS, status: Status.PERMISSION_DENIED }, options)\n      return\n    }\n\n    const result = this.reservationStore.reserve(connection.remotePeer, connection.remoteAddr)\n\n    try {\n      if (result.status !== Status.OK) {\n        await hopstr.write({ type: HopMessage.Type.STATUS, status: result.status }, options)\n        return\n      }\n\n      // tag relay target peer\n      // result.expire is non-null if `ReservationStore.reserve` returns with status == OK\n      if (result.expire != null) {\n        const ttl = (result.expire * 1000) - Date.now()\n        await this.peerStore.merge(connection.remotePeer, {\n          tags: {\n            [RELAY_SOURCE_TAG]: { value: 1, ttl },\n            [KEEP_ALIVE_SOURCE_TAG]: { value: 1, ttl }\n          }\n        })\n      }\n\n      await hopstr.write({\n        type: HopMessage.Type.STATUS,\n        status: Status.OK,\n        reservation: await this.makeReservation(connection.remotePeer, BigInt(result.expire ?? 0)),\n        limit: this.reservationStore.get(connection.remotePeer)?.limit\n      }, options)\n      this.log('sent confirmation response to %s', connection.remotePeer)\n    } catch (err) {\n      this.log.error('failed to send confirmation response to %p - %e', connection.remotePeer, err)\n      this.reservationStore.removeReservation(connection.remotePeer)\n\n      try {\n        await this.peerStore.merge(connection.remotePeer, {\n          tags: {\n            [RELAY_SOURCE_TAG]: undefined,\n            [KEEP_ALIVE_SOURCE_TAG]: undefined\n          }\n        })\n      } catch (err) {\n        this.log.error('failed to untag relay source peer %p - %e', connection.remotePeer, err)\n      }\n    }\n  }\n\n  async makeReservation (\n    remotePeer: PeerId,\n    expire: bigint\n  ): Promise<Reservation> {\n    const addrs = []\n\n    for (const relayAddr of this.addressManager.getAddresses()) {\n      if (relayAddr.toString().includes('/p2p-circuit')) {\n        continue\n      }\n\n      addrs.push(relayAddr.bytes)\n    }\n\n    const envelope = await RecordEnvelope.seal(new ReservationVoucherRecord({\n      peer: remotePeer,\n      relay: this.peerId,\n      expiration: expire\n    }), this.privateKey)\n\n    return {\n      addrs,\n      expire,\n      voucher: {\n        publicKey: publicKeyToProtobuf(envelope.publicKey),\n        payloadType: envelope.payloadType,\n        payload: {\n          peer: remotePeer.toMultihash().bytes,\n          relay: this.peerId.toMultihash().bytes,\n          expiration: expire\n        },\n        signature: envelope.signature\n      }\n    }\n  }\n\n  async handleConnect ({ stream, request, connection }: HopProtocolOptions, options: AbortOptions): Promise<void> {\n    const hopstr = stream.pb(HopMessage)\n\n    if (isRelayAddr(connection.remoteAddr)) {\n      this.log.error('relay reservation over circuit connection denied for peer: %p', connection.remotePeer)\n      await hopstr.write({ type: HopMessage.Type.STATUS, status: Status.PERMISSION_DENIED }, options)\n      return\n    }\n\n    this.log('hop connect request from %p', connection.remotePeer)\n\n    let dstPeer: PeerId\n\n    try {\n      if (request.peer == null) {\n        this.log.error('no peer info in hop connect request')\n        throw new Error('no peer info in request')\n      }\n\n      request.peer.addrs.forEach(multiaddr)\n      dstPeer = peerIdFromMultihash(Digest.decode(request.peer.id))\n    } catch (err) {\n      this.log.error('invalid hop connect request via peer %p %s', connection.remotePeer, err)\n      await hopstr.write({ type: HopMessage.Type.STATUS, status: Status.MALFORMED_MESSAGE }, options)\n      return\n    }\n\n    const reservation = this.reservationStore.get(dstPeer)\n\n    if (reservation == null) {\n      this.log.error('hop connect denied for destination peer %p not having a reservation for %p with status %s', dstPeer, connection.remotePeer, Status.NO_RESERVATION)\n      await hopstr.write({ type: HopMessage.Type.STATUS, status: Status.NO_RESERVATION }, options)\n      return\n    }\n\n    if ((await this.connectionGater.denyOutboundRelayedConnection?.(connection.remotePeer, dstPeer)) === true) {\n      this.log.error('hop connect for %p to %p denied by connection gater', connection.remotePeer, dstPeer)\n      await hopstr.write({ type: HopMessage.Type.STATUS, status: Status.PERMISSION_DENIED }, options)\n      return\n    }\n\n    const connections = this.connectionManager.getConnections(dstPeer)\n\n    if (connections.length === 0) {\n      this.log('hop connect denied for destination peer %p not having a connection for %p as there is no destination connection', dstPeer, connection.remotePeer)\n      await hopstr.write({ type: HopMessage.Type.STATUS, status: Status.NO_RESERVATION }, options)\n      return\n    }\n\n    const destinationConnection = connections[0]\n\n    const destinationStream = await this.stopHop({\n      connection: destinationConnection,\n      request: {\n        type: StopMessage.Type.CONNECT,\n        peer: {\n          id: connection.remotePeer.toMultihash().bytes,\n          addrs: []\n        },\n        limit: reservation?.limit\n      }\n    }, options)\n\n    if (destinationStream == null) {\n      this.log.error('failed to open stream to destination peer %p', destinationConnection?.remotePeer)\n      await hopstr.write({ type: HopMessage.Type.STATUS, status: Status.CONNECTION_FAILED }, options)\n      return\n    }\n\n    await hopstr.write({\n      type: HopMessage.Type.STATUS,\n      status: Status.OK,\n      limit: reservation?.limit\n    }, options)\n    const sourceStream = stream.unwrap()\n\n    this.log('connection from %p to %p established - merging streams', connection.remotePeer, dstPeer)\n\n    // Short circuit the two streams to create the relayed connection\n    createLimitedRelay(sourceStream, destinationStream, this.shutdownController.signal, reservation, {\n      log: this.log\n    })\n  }\n\n  /**\n   * Send a STOP request to the target peer that the dialing peer wants to contact\n   */\n  async stopHop ({ connection, request }: StopOptions, options: AbortOptions): Promise<Stream | undefined> {\n    this.log('starting circuit relay v2 stop request to %s', connection.remotePeer)\n    const stream = await connection.newStream([RELAY_V2_STOP_CODEC], {\n      maxOutboundStreams: this.maxOutboundStopStreams,\n      runOnLimitedConnection: true,\n      ...options\n    })\n    const pbstr = pbStream(stream)\n    const stopstr = pbstr.pb(StopMessage)\n    await stopstr.write(request, options)\n    let response\n\n    try {\n      response = await stopstr.read(options)\n    } catch (err) {\n      this.log.error('error parsing stop message response from %p', connection.remotePeer)\n    }\n\n    if (response == null) {\n      this.log.error('could not read response from %p', connection.remotePeer)\n      await stream.close(options)\n      return\n    }\n\n    if (response.status === Status.OK) {\n      this.log('stop request to %p was successful', connection.remotePeer)\n      return pbstr.unwrap()\n    }\n\n    this.log('stop request failed with code %d', response.status)\n    await stream.close(options)\n  }\n\n  get reservations (): PeerMap<RelayReservation> {\n    return this.reservationStore.reservations\n  }\n}\n\nexport function circuitRelayServer (init: CircuitRelayServerInit = {}): (components: CircuitRelayServerComponents) => CircuitRelayService {\n  return (components) => {\n    return new CircuitRelayServer(components, init)\n  }\n}\n", "import forEach from 'it-foreach'\nimport { pipe } from 'it-pipe'\nimport type { ComponentLogger, MultiaddrConnection, Stream } from '@libp2p/interface'\nimport type { Multiaddr } from '@multiformats/multiaddr'\nimport type { Uint8ArrayList } from 'uint8arraylist'\n\nexport interface StreamProperties {\n  stream: Stream\n  remoteAddr: Multiaddr\n  localAddr: Multiaddr\n  logger: ComponentLogger\n\n  /**\n   * A callback invoked when data is read from the stream\n   */\n  onDataRead?(buf: Uint8ArrayList | Uint8Array): void\n\n  /**\n   * A callback invoked when data is written to the stream\n   */\n  onDataWrite?(buf: Uint8ArrayList | Uint8Array): void\n}\n\n/**\n * Convert a duplex iterable into a MultiaddrConnection.\n * https://github.com/libp2p/interface-transport#multiaddrconnection\n */\nexport function streamToMaConnection (props: StreamProperties): MultiaddrConnection {\n  const { stream, remoteAddr, logger, onDataRead, onDataWrite } = props\n  const log = logger.forComponent('libp2p:stream:converter')\n\n  let closedRead = false\n  let closedWrite = false\n\n  // piggyback on `stream.close` invocations to close maconn\n  const streamClose = stream.close.bind(stream)\n  stream.close = async (options) => {\n    await streamClose(options)\n    close(true)\n  }\n\n  // piggyback on `stream.abort` invocations to close maconn\n  const streamAbort = stream.abort.bind(stream)\n  stream.abort = (err) => {\n    streamAbort(err)\n    close(true)\n  }\n\n  // piggyback on `stream.sink` invocations to close maconn\n  const streamSink = stream.sink.bind(stream)\n  stream.sink = async (source) => {\n    try {\n      await streamSink(\n        pipe(\n          source,\n          (source) => forEach(source, buf => onDataWrite?.(buf))\n        )\n      )\n    } catch (err: any) {\n      // If aborted we can safely ignore\n      if (err.type !== 'aborted') {\n        // If the source errored the socket will already have been destroyed by\n        // toIterable.duplex(). If the socket errored it will already be\n        // destroyed. There's nothing to do here except log the error & return.\n        log.error('%s error in sink', remoteAddr, err)\n      }\n    } finally {\n      closedWrite = true\n      close()\n    }\n  }\n\n  const maConn: MultiaddrConnection = {\n    log,\n    sink: stream.sink,\n    source: (async function * () {\n      try {\n        for await (const buf of stream.source) {\n          onDataRead?.(buf)\n          yield buf\n        }\n      } finally {\n        closedRead = true\n        close()\n      }\n    }()),\n    remoteAddr,\n    timeline: { open: Date.now(), close: undefined },\n    close: stream.close,\n    abort: stream.abort\n  }\n\n  function close (force?: boolean): void {\n    if (force === true) {\n      closedRead = true\n      closedWrite = true\n    }\n\n    if (closedRead && closedWrite && maConn.timeline.close == null) {\n      maConn.timeline.close = Date.now()\n    }\n  }\n\n  return maConn\n}\n", "import { TypedEventEmitter, setMaxListeners } from '@libp2p/interface'\nimport { PeerQueue } from '@libp2p/utils/peer-queue'\nimport { anySignal } from 'any-signal'\nimport { toString as uint8ArrayToString } from 'uint8arrays/to-string'\nimport {\n  RELAY_V2_HOP_CODEC\n} from '../constants.js'\nimport type { ComponentLogger, Logger, Peer, PeerId, PeerStore, Startable, TopologyFilter } from '@libp2p/interface'\nimport type { ConnectionManager, RandomWalk, Registrar, TransportManager } from '@libp2p/interface-internal'\n\nexport interface RelayDiscoveryEvents {\n  'relay:discover': CustomEvent<PeerId>\n}\n\nexport interface RelayDiscoveryComponents {\n  peerStore: PeerStore\n  connectionManager: ConnectionManager\n  transportManager: TransportManager\n  registrar: Registrar\n  logger: ComponentLogger\n  randomWalk: RandomWalk\n}\n\nexport interface RelayDiscoveryInit {\n  filter?: TopologyFilter\n}\n\n/**\n * ReservationManager automatically makes a circuit v2 reservation on any connected\n * peers that support the circuit v2 HOP protocol.\n */\nexport class RelayDiscovery extends TypedEventEmitter<RelayDiscoveryEvents> implements Startable {\n  private readonly peerStore: PeerStore\n  private readonly registrar: Registrar\n  private readonly connectionManager: ConnectionManager\n  private readonly randomWalk: RandomWalk\n  private started: boolean\n  private running: boolean\n  private topologyId?: string\n  private readonly log: Logger\n  private discoveryController: AbortController\n  private readonly filter?: TopologyFilter\n  private queue?: PeerQueue\n\n  constructor (components: RelayDiscoveryComponents, init: RelayDiscoveryInit = {}) {\n    super()\n\n    this.log = components.logger.forComponent('libp2p:circuit-relay:discover-relays')\n    this.started = false\n    this.running = false\n    this.peerStore = components.peerStore\n    this.registrar = components.registrar\n    this.connectionManager = components.connectionManager\n    this.randomWalk = components.randomWalk\n    this.filter = init.filter\n    this.discoveryController = new AbortController()\n    setMaxListeners(Infinity, this.discoveryController.signal)\n  }\n\n  isStarted (): boolean {\n    return this.started\n  }\n\n  async start (): Promise<void> {\n    // register a topology listener for when new peers are encountered\n    // that support the hop protocol\n    this.topologyId = await this.registrar.register(RELAY_V2_HOP_CODEC, {\n      filter: this.filter,\n      onConnect: (peerId) => {\n        this.log.trace('discovered relay %p queue (length: %d, active %d)', peerId, this.queue?.size, this.queue?.running)\n        this.safeDispatchEvent('relay:discover', { detail: peerId })\n      }\n    })\n\n    this.started = true\n  }\n\n  stop (): void {\n    if (this.topologyId != null) {\n      this.registrar.unregister(this.topologyId)\n    }\n\n    this.discoveryController?.abort()\n    this.started = false\n  }\n\n  /**\n   * Try to listen on available hop relay connections.\n   * The following order will happen while we do not have enough relays:\n   *\n   * 1. Check the metadata store for known relays, try to listen on the ones we are already connected to\n   * 2. Dial and try to listen on the peers we know that support hop but are not connected\n   * 3. Search the network\n   */\n  startDiscovery (): void {\n    if (this.running) {\n      return\n    }\n\n    this.log('start discovery')\n    this.running = true\n    this.discoveryController = new AbortController()\n    setMaxListeners(Infinity, this.discoveryController.signal)\n\n    Promise.resolve()\n      .then(async () => {\n        this.log('searching peer store for relays')\n\n        const peers = (await this.peerStore.all({\n          filters: [\n            // filter by a list of peers supporting RELAY_V2_HOP and ones we are not listening on\n            (peer) => {\n              return peer.protocols.includes(RELAY_V2_HOP_CODEC)\n            }\n          ],\n          orders: [\n            // randomise\n            () => Math.random() < 0.5 ? 1 : -1,\n            // prefer peers we've connected to in the past\n            (a, b) => {\n              const lastDialA = getLastDial(a)\n              const lastDialB = getLastDial(b)\n\n              if (lastDialA > lastDialB) {\n                return -1\n              }\n\n              if (lastDialB > lastDialA) {\n                return 1\n              }\n\n              return 0\n            }\n          ]\n        }))\n\n        for (const peer of peers) {\n          this.log.trace('found relay peer %p in peer store', peer.id)\n          this.safeDispatchEvent('relay:discover', { detail: peer.id })\n        }\n\n        this.log('found %d relay peers in peer store', peers.length)\n\n        // perform random walk and dial peers - after identify has run, the network\n        // topology will be notified of new relays\n        const queue = this.queue = new PeerQueue({\n          concurrency: 5\n        })\n\n        this.log('start random walk')\n\n        for await (const peer of this.randomWalk.walk({ signal: this.discoveryController.signal })) {\n          this.log.trace('found random peer %p', peer.id)\n\n          if (queue.has(peer.id)) {\n            this.log.trace('random peer %p was already in queue', peer.id)\n\n            // skip peers already in the queue\n            continue\n          }\n\n          if (this.connectionManager.getConnections(peer.id)?.length > 0) {\n            this.log.trace('random peer %p was already connected', peer.id)\n\n            // skip peers we are already connected to\n            continue\n          }\n\n          if (!(await this.connectionManager.isDialable(peer.multiaddrs))) {\n            this.log.trace('random peer %p was not dialable', peer.id, peer.multiaddrs.map(ma => ma.toString()))\n\n            // skip peers we can't dial\n            continue\n          }\n\n          if (queue.queued > 10) {\n            this.log.trace('wait for space in queue for %p', peer.id)\n\n            // pause the random walk until there is space in the queue\n            await queue.onSizeLessThan(10, {\n              signal: this.discoveryController.signal\n            })\n          }\n\n          this.log('adding random peer %p to dial queue (length: %d, active %d)', peer.id, queue.size, queue.running)\n\n          // dial the peer - this will cause identify to run and our topology to\n          // be notified and we'll attempt to create reservations\n          queue.add(async () => {\n            const signal = anySignal([this.discoveryController.signal, AbortSignal.timeout(5000)])\n            setMaxListeners(Infinity, signal)\n\n            try {\n              await this.connectionManager.openConnection(peer.id, { signal })\n            } finally {\n              signal.clear()\n            }\n          }, {\n            peerId: peer.id,\n            signal: this.discoveryController.signal\n          })\n            .catch(err => {\n              this.log.error('error opening connection to random peer %p', peer.id, err)\n            })\n        }\n\n        this.log('stop random walk')\n\n        await queue.onIdle()\n      })\n      .catch(err => {\n        if (!this.discoveryController.signal.aborted) {\n          this.log.error('failed when finding relays on the network', err)\n        }\n      })\n  }\n\n  stopDiscovery (): void {\n    this.log('stop discovery')\n    this.running = false\n    this.discoveryController?.abort()\n  }\n}\n\n/**\n * Returns the timestamp of the last time we connected to this peer, if we've\n * not connected to them before return 0\n */\nfunction getLastDial (peer: Peer): number {\n  const lastDial = peer.metadata.get('last-dial-success')\n\n  if (lastDial == null) {\n    return 0\n  }\n\n  return new Date(uint8ArrayToString(lastDial)).getTime()\n}\n", "import { ListenError, TypedEventEmitter, setMaxListeners } from '@libp2p/interface'\nimport { multiaddr } from '@multiformats/multiaddr'\nimport { DEFAULT_RESERVATION_COMPLETION_TIMEOUT } from '../constants.js'\nimport { CircuitListen, CircuitSearch } from '../utils.js'\nimport type { RelayReservation, ReservationStore } from './reservation-store.js'\nimport type { ComponentLogger, Logger, Listener, ListenerEvents, PeerId } from '@libp2p/interface'\nimport type { AddressManager, ConnectionManager } from '@libp2p/interface-internal'\nimport type { Multiaddr } from '@multiformats/multiaddr'\n\nexport interface CircuitRelayTransportListenerComponents {\n  peerId: PeerId\n  connectionManager: ConnectionManager\n  addressManager: AddressManager\n  reservationStore: ReservationStore\n  logger: ComponentLogger\n}\n\nexport interface CircuitRelayTransportListenerInit {\n  listenTimeout?: number\n}\n\nclass CircuitRelayTransportListener extends TypedEventEmitter<ListenerEvents> implements Listener {\n  private readonly peerId: PeerId\n  private readonly connectionManager: ConnectionManager\n  private readonly addressManager: AddressManager\n  private readonly reservationStore: ReservationStore\n  private listeningAddrs: Multiaddr[]\n  private readonly log: Logger\n  private readonly listenTimeout: number\n  private reservationId?: string\n  private relay?: PeerId\n\n  constructor (components: CircuitRelayTransportListenerComponents, init: CircuitRelayTransportListenerInit = {}) {\n    super()\n\n    this.log = components.logger.forComponent('libp2p:circuit-relay:transport:listener')\n    this.peerId = components.peerId\n    this.connectionManager = components.connectionManager\n    this.addressManager = components.addressManager\n    this.reservationStore = components.reservationStore\n    this.listeningAddrs = []\n    this.listenTimeout = init.listenTimeout ?? DEFAULT_RESERVATION_COMPLETION_TIMEOUT\n\n    // remove listening addrs when a relay is removed\n    this.reservationStore.addEventListener('relay:removed', this._onRemoveRelayPeer)\n    this.reservationStore.addEventListener('relay:created-reservation', this._onAddRelayPeer)\n  }\n\n  _onRemoveRelayPeer = (evt: CustomEvent<RelayReservation>): void => {\n    this.log('relay removed %p our relay %p', evt.detail.relay, this.relay, this.relay?.equals(evt.detail.relay))\n\n    if (this.relay?.equals(evt.detail.relay) !== true) {\n      return\n    }\n\n    this.log('relay peer removed %p', evt.detail.relay)\n\n    this.listeningAddrs.forEach(ma => {\n      // mark as externally dialable\n      this.addressManager.removeObservedAddr(ma)\n    })\n\n    this.listeningAddrs = []\n\n    // announce listen addresses change\n    this.safeDispatchEvent('listening')\n  }\n\n  _onAddRelayPeer = (evt: CustomEvent<RelayReservation>): void => {\n    const {\n      details\n    } = evt.detail\n\n    if (details.type === 'configured') {\n      return\n    }\n\n    if (details.id !== this.reservationId) {\n      return\n    }\n\n    this.addedRelay(evt.detail)\n  }\n\n  async listen (addr: Multiaddr): Promise<void> {\n    this.log('listen on %a', addr)\n\n    if (CircuitSearch.exactMatch(addr)) {\n      // start relay discovery\n      this.reservationId = this.reservationStore.reserveRelay()\n    } else if (CircuitListen.exactMatch(addr)) {\n      const signal = AbortSignal.timeout(this.listenTimeout)\n      setMaxListeners(Infinity, signal)\n\n      // try to make a reservation on one particular relay\n      // remove the circuit part to get the peer id of the relay\n      const relayAddr = addr.decapsulate('/p2p-circuit')\n      const relayConn = await this.connectionManager.openConnection(relayAddr, {\n        signal\n      })\n\n      if (!this.reservationStore.hasReservation(relayConn.remotePeer)) {\n        this.log('making reservation on peer %p', relayConn.remotePeer)\n        const reservation = await this.reservationStore.addRelay(relayConn.remotePeer, 'configured')\n        this.addedRelay(reservation)\n      }\n    } else {\n      throw new ListenError(`Could not listen on p2p-circuit address \"${addr}\"`)\n    }\n  }\n\n  getAddrs (): Multiaddr[] {\n    return [...this.listeningAddrs.values()].flat()\n  }\n\n  async close (): Promise<void> {\n    this.reservationStore.cancelReservations()\n    this.listeningAddrs = []\n\n    // remove listener\n    this.reservationStore.removeEventListener('relay:removed', this._onRemoveRelayPeer)\n\n    // announce listen addresses change\n    queueMicrotask(() => {\n      this.safeDispatchEvent('close')\n    })\n  }\n\n  private addedRelay (reservation: RelayReservation): void {\n    this.log('relay peer added %p', reservation.relay)\n\n    this.relay = reservation.relay\n\n    // add all addresses from the relay reservation\n    this.listeningAddrs = reservation.details.reservation.addrs\n      .map(buf => multiaddr(buf).encapsulate('/p2p-circuit'))\n\n    this.listeningAddrs.forEach(ma => {\n      // mark as externally dialable\n      this.addressManager.confirmObservedAddr(ma, {\n        type: 'transport'\n      })\n    })\n\n    // if that succeeded announce listen addresses change\n    queueMicrotask(() => {\n      this.safeDispatchEvent('listening')\n    })\n  }\n}\n\nexport function createListener (options: CircuitRelayTransportListenerComponents): Listener {\n  return new CircuitRelayTransportListener(options)\n}\n", "export const urlAlphabet =\n  'useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict'\n", "import { urlAlphabet as scopedUrlAlphabet } from './url-alphabet/index.js'\nexport { urlAlphabet } from './url-alphabet/index.js'\nexport let random = bytes => crypto.getRandomValues(new Uint8Array(bytes))\nexport let customRandom = (alphabet, defaultSize, getRandom) => {\n  let mask = (2 << Math.log2(alphabet.length - 1)) - 1\n  let step = -~((1.6 * mask * defaultSize) / alphabet.length)\n  return (size = defaultSize) => {\n    let id = ''\n    while (true) {\n      let bytes = getRandom(step)\n      let j = step | 0\n      while (j--) {\n        id += alphabet[bytes[j] & mask] || ''\n        if (id.length >= size) return id\n      }\n    }\n  }\n}\nexport let customAlphabet = (alphabet, size = 21) =>\n  customRandom(alphabet, size | 0, random)\nexport let nanoid = (size = 21) => {\n  let id = ''\n  let bytes = crypto.getRandomValues(new Uint8Array((size |= 0)))\n  while (size--) {\n    id += scopedUrlAlphabet[bytes[size] & 63]\n  }\n  return id\n}\n", "import { ListenError, TypedEventEmitter, setMaxListeners } from '@libp2p/interface'\nimport { PeerMap } from '@libp2p/peer-collections'\nimport { createScalableCuckooFilter } from '@libp2p/utils/filters'\nimport { PeerQueue } from '@libp2p/utils/peer-queue'\nimport { multiaddr } from '@multiformats/multiaddr'\nimport { Circuit } from '@multiformats/multiaddr-matcher'\nimport { pbStream } from 'it-protobuf-stream'\nimport { nanoid } from 'nanoid'\nimport { DEFAULT_MAX_RESERVATION_QUEUE_LENGTH, DEFAULT_RESERVATION_COMPLETION_TIMEOUT, DEFAULT_RESERVATION_CONCURRENCY, KEEP_ALIVE_TAG, RELAY_V2_HOP_CODEC } from '../constants.js'\nimport { DoubleRelayError, HadEnoughRelaysError, RelayQueueFullError } from '../errors.js'\nimport { HopMessage, Status } from '../pb/index.js'\nimport { getExpirationMilliseconds } from '../utils.js'\nimport type { Reservation } from '../pb/index.js'\nimport type { AbortOptions, TypedEventTarget, Libp2pEvents, ComponentLogger, Logger, PeerId, PeerStore, Startable, Metrics, Peer, Connection } from '@libp2p/interface'\nimport type { ConnectionManager } from '@libp2p/interface-internal'\nimport type { Filter } from '@libp2p/utils/filters'\n\n// allow refreshing a relay reservation if it will expire in the next 10 minutes\nconst REFRESH_WINDOW = (60 * 1000) * 10\n\n// try to refresh relay reservations 5 minutes before expiry\nconst REFRESH_TIMEOUT = (60 * 1000) * 5\n\n// minimum duration before which a reservation must not be refreshed\nconst REFRESH_TIMEOUT_MIN = 30 * 1000\n\nexport interface ReservationStoreComponents {\n  peerId: PeerId\n  connectionManager: ConnectionManager\n  peerStore: PeerStore\n  events: TypedEventTarget<Libp2pEvents>\n  logger: ComponentLogger\n  metrics?: Metrics\n}\n\nexport interface ReservationStoreInit {\n  /**\n   * Multiple relays may be discovered simultaneously - to prevent listening\n   * on too many relays, this value controls how many to attempt to reserve a\n   * slot on at once. If set to more than one, we may end up listening on\n   * more relays than the `maxReservations` value, but on networks with poor\n   * connectivity the user may wish to attempt to reserve on multiple relays\n   * simultaneously.\n   *\n   * @default 1\n   */\n  reservationConcurrency?: number\n\n  /**\n   * Limit the number of potential relays we will dial\n   *\n   * @default 100\n   */\n  maxReservationQueueLength?: number\n\n  /**\n   * When creating a reservation it must complete within this number of ms\n   *\n   * @default 5000\n   */\n  reservationCompletionTimeout?: number\n}\n\nexport type RelayType = 'discovered' | 'configured'\n\nexport interface DiscoveredRelayEntry {\n  timeout: ReturnType<typeof setTimeout>\n  type: 'discovered'\n  reservation: Reservation\n\n  /**\n   * Stores the id of the connection we have to the relay\n   */\n  connection: string\n\n  /**\n   * Stores the identifier returned when the reservation was requested\n   */\n  id: string\n}\n\nexport interface ConfiguredRelayEntry {\n  timeout: ReturnType<typeof setTimeout>\n  type: 'configured'\n  reservation: Reservation\n\n  /**\n   * Stores the id of the connection we have to the relay\n   */\n  connection: string\n}\n\nexport type RelayEntry = DiscoveredRelayEntry | ConfiguredRelayEntry\n\nexport interface RelayReservation {\n  relay: PeerId\n  details: RelayEntry\n}\n\nexport interface ReservationStoreEvents {\n  'relay:not-enough-relays': CustomEvent\n  'relay:found-enough-relays': CustomEvent\n  'relay:removed': CustomEvent<RelayReservation>\n  'relay:created-reservation': CustomEvent<RelayReservation>\n}\n\nexport class ReservationStore extends TypedEventEmitter<ReservationStoreEvents> implements Startable {\n  private readonly peerId: PeerId\n  private readonly connectionManager: ConnectionManager\n  private readonly peerStore: PeerStore\n  private readonly events: TypedEventTarget<Libp2pEvents>\n  private readonly reserveQueue: PeerQueue<RelayReservation>\n  private readonly reservations: PeerMap<RelayEntry>\n  private readonly pendingReservations: string[]\n  private readonly maxReservationQueueLength: number\n  private readonly reservationCompletionTimeout: number\n  private started: boolean\n  private readonly log: Logger\n  private relayFilter: Filter\n\n  constructor (components: ReservationStoreComponents, init?: ReservationStoreInit) {\n    super()\n\n    this.log = components.logger.forComponent('libp2p:circuit-relay:transport:reservation-store')\n    this.peerId = components.peerId\n    this.connectionManager = components.connectionManager\n    this.peerStore = components.peerStore\n    this.events = components.events\n    this.reservations = new PeerMap()\n    this.pendingReservations = []\n    this.maxReservationQueueLength = init?.maxReservationQueueLength ?? DEFAULT_MAX_RESERVATION_QUEUE_LENGTH\n    this.reservationCompletionTimeout = init?.reservationCompletionTimeout ?? DEFAULT_RESERVATION_COMPLETION_TIMEOUT\n    this.started = false\n    this.relayFilter = createScalableCuckooFilter(100)\n\n    // ensure we don't listen on multiple relays simultaneously\n    this.reserveQueue = new PeerQueue({\n      concurrency: init?.reservationConcurrency ?? DEFAULT_RESERVATION_CONCURRENCY,\n      metricName: 'libp2p_relay_reservation_queue',\n      metrics: components.metrics\n    })\n\n    // reservations are only valid while we are still connected to the relay.\n    // if we had a reservation opened via that connection, remove it and maybe\n    // trigger a search for new relays\n    this.events.addEventListener('connection:close', (evt) => {\n      const reservation = [...this.reservations.values()]\n        .find(reservation => reservation.connection === evt.detail.id)\n\n      if (reservation == null) {\n        return\n      }\n\n      this.#removeReservation(evt.detail.remotePeer)\n        .catch(err => {\n          this.log('could not remove relay %p - %e', evt.detail, err)\n        })\n    })\n  }\n\n  isStarted (): boolean {\n    return this.started\n  }\n\n  start (): void {\n    this.started = true\n  }\n\n  afterStart (): void {\n    // remove old relay tags\n    void Promise.resolve()\n      .then(async () => {\n        const relayPeers: Peer[] = await this.peerStore.all({\n          filters: [(peer) => {\n            return peer.tags.has(KEEP_ALIVE_TAG)\n          }]\n        })\n\n        this.log('removing tag from %d old relays', relayPeers.length)\n\n        // remove old relay tag and redial\n        await Promise.all(\n          relayPeers.map(async peer => {\n            await this.peerStore.merge(peer.id, {\n              tags: {\n                [KEEP_ALIVE_TAG]: undefined\n              }\n            })\n          })\n        )\n\n        this.log('redialing %d old relays', relayPeers.length)\n        await Promise.all(\n          relayPeers.map(async peer => this.addRelay(peer.id, 'discovered'))\n        )\n\n        this.#checkReservationCount()\n      })\n      .catch(err => {\n        this.log.error(err)\n      })\n  }\n\n  stop (): void {\n    this.reserveQueue.clear()\n    this.reservations.forEach(({ timeout }) => {\n      clearTimeout(timeout)\n    })\n    this.reservations.clear()\n    this.started = false\n  }\n\n  reserveRelay (): string {\n    const id = nanoid()\n\n    this.pendingReservations.push(id)\n\n    this.#checkReservationCount()\n\n    return id\n  }\n\n  /**\n   * If the number of current relays is beneath the configured `maxReservations`\n   * value, and the passed peer id is not our own, and we have a non-relayed\n   * connection to the remote, and the remote peer speaks the hop protocol, try\n   * to reserve a slot on the remote peer\n   */\n  async addRelay (peerId: PeerId, type: RelayType): Promise<RelayReservation> {\n    if (this.peerId.equals(peerId)) {\n      this.log.trace('not trying to use self as relay')\n      throw new ListenError('Cannot use self as relay')\n    }\n\n    if (this.reserveQueue.size > this.maxReservationQueueLength) {\n      throw new RelayQueueFullError('The reservation queue is full')\n    }\n\n    const existingJob = this.reserveQueue.find(peerId)\n\n    if (existingJob != null) {\n      this.log.trace('potential relay peer %p is already in the reservation queue', peerId)\n      return existingJob.join()\n    }\n\n    if (this.relayFilter.has(peerId.toMultihash().bytes)) {\n      throw new ListenError('The relay was previously invalid')\n    }\n\n    this.log.trace('try to reserve relay slot with %p', peerId)\n\n    return this.reserveQueue.add(async () => {\n      const start = Date.now()\n\n      try {\n        // allow refresh of an existing reservation if it is about to expire\n        const existingReservation = this.reservations.get(peerId)\n\n        if (existingReservation != null) {\n          const connections = this.connectionManager.getConnections(peerId)\n          let connected = false\n\n          if (connections.length === 0) {\n            this.log('already have relay reservation with %p but we are no longer connected', peerId)\n          }\n\n          if (connections.map(conn => conn.id).includes(existingReservation.connection)) {\n            this.log('already have relay reservation with %p and the original connection is still open', peerId)\n            connected = true\n          }\n\n          if (connected && getExpirationMilliseconds(existingReservation.reservation.expire) > REFRESH_WINDOW) {\n            this.log('already have relay reservation with %p but we are still connected and it does not expire soon', peerId)\n            return {\n              relay: peerId,\n              details: existingReservation\n            } satisfies RelayReservation\n          }\n\n          await this.#removeReservation(peerId)\n        }\n\n        if (type === 'discovered' && this.pendingReservations.length === 0) {\n          throw new HadEnoughRelaysError('Not making reservation on discovered relay because we do not need any more relays')\n        }\n\n        const signal = AbortSignal.timeout(this.reservationCompletionTimeout)\n        setMaxListeners(Infinity, signal)\n\n        const connection = await this.connectionManager.openConnection(peerId, {\n          signal\n        })\n\n        if (Circuit.matches(connection.remoteAddr)) {\n          throw new DoubleRelayError('not creating reservation over relayed connection')\n        }\n\n        const reservation = await this.#createReservation(connection, {\n          signal\n        })\n\n        const expiration = getExpirationMilliseconds(reservation.expire)\n\n        this.log('created reservation on relay peer %p, expiry date is %s', peerId, new Date(Date.now() + expiration).toString())\n\n        // sets a lower bound on the timeout, and also don't let it go over\n        // 2^31 - 1 (setTimeout will only accept signed 32 bit integers)\n        const timeoutDuration = Math.min(Math.max(expiration - REFRESH_TIMEOUT, REFRESH_TIMEOUT_MIN), Math.pow(2, 31) - 1)\n\n        const timeout = setTimeout(() => {\n          this.log('refresh reservation to relay %p', peerId)\n\n          this.addRelay(peerId, type)\n            .catch(async err => {\n              this.log.error('could not refresh reservation to relay %p - %e', peerId, err)\n              await this.#removeReservation(peerId)\n            })\n            .catch(err => {\n              this.log.error('could not remove expired reservation to relay %p - %e', peerId, err)\n            })\n        }, timeoutDuration)\n\n        let res: RelayEntry\n\n        // assign a reservation id if one was requested\n        if (type === 'discovered') {\n          const id = this.pendingReservations.pop()\n\n          if (id == null) {\n            throw new HadEnoughRelaysError('Made reservation on relay but did not need any more discovered relays')\n          }\n\n          res = {\n            timeout,\n            reservation,\n            type,\n            connection: connection.id,\n            id\n          }\n        } else {\n          res = {\n            timeout,\n            reservation,\n            type,\n            connection: connection.id\n          }\n        }\n\n        // we've managed to create a reservation successfully\n        this.reservations.set(peerId, res)\n\n        // ensure we don't close the connection to the relay\n        await this.peerStore.merge(peerId, {\n          tags: {\n            [KEEP_ALIVE_TAG]: {\n              value: 1,\n              ttl: expiration\n            }\n          }\n        })\n\n        // check to see if we have discovered enough relays\n        this.#checkReservationCount()\n\n        const result: RelayReservation = {\n          relay: peerId,\n          details: res\n        }\n\n        this.safeDispatchEvent('relay:created-reservation', {\n          detail: result\n        })\n\n        return result\n      } catch (err: any) {\n        if (!(type === 'discovered' && err.name === 'HadEnoughRelaysError')) {\n          this.log.error('could not reserve slot on %p after %dms - %e', peerId, Date.now() - start, err)\n        }\n\n        // don't try this peer again if dialing failed or they do not support\n        // the hop protocol\n        if (err.name === 'DialError' || err.name === 'UnsupportedProtocolError') {\n          this.relayFilter.add(peerId.toMultihash().bytes)\n        }\n\n        // if listening failed, remove the reservation\n        this.#removeReservation(peerId)\n          .catch(err => {\n            this.log.error('could not remove reservation on %p after reserving slot failed - %e', peerId, err)\n          })\n\n        throw err\n      }\n    }, {\n      peerId\n    })\n  }\n\n  hasReservation (peerId: PeerId): boolean {\n    return this.reservations.has(peerId)\n  }\n\n  getReservation (peerId: PeerId): Reservation | undefined {\n    return this.reservations.get(peerId)?.reservation\n  }\n\n  reservationCount (type?: RelayType): number {\n    if (type == null) {\n      return this.reservations.size\n    }\n\n    return [...this.reservations.values()].reduce((acc, curr) => {\n      if (curr.type === type) {\n        acc++\n      }\n\n      return acc\n    }, 0)\n  }\n\n  cancelReservations (): void {\n    [...this.reservations.values()].forEach(reservation => {\n      clearTimeout(reservation.timeout)\n    })\n\n    this.reservations.clear()\n  }\n\n  async #createReservation (connection: Connection, options: AbortOptions): Promise<Reservation> {\n    options.signal?.throwIfAborted()\n\n    this.log('requesting reservation from %p', connection.remotePeer)\n    const stream = await connection.newStream(RELAY_V2_HOP_CODEC, options)\n    const pbstr = pbStream(stream)\n    const hopstr = pbstr.pb(HopMessage)\n\n    this.log.trace('send RESERVE to %p', connection.remotePeer)\n    await hopstr.write({ type: HopMessage.Type.RESERVE }, options)\n\n    let response: HopMessage\n\n    try {\n      this.log.trace('reading response from %p', connection.remotePeer)\n      response = await hopstr.read(options)\n    } catch (err: any) {\n      stream.abort(err)\n      throw err\n    } finally {\n      if (stream.status !== 'closed') {\n        await stream.close(options)\n      }\n    }\n\n    this.log.trace('read response %o', response)\n\n    if (response.status === Status.OK && response.reservation != null) {\n      // check that the returned relay has the relay address - this can be\n      // omitted when requesting a reservation from a go-libp2p relay we\n      // already have a reservation on\n      const addresses = new Set<string>()\n      addresses.add(connection.remoteAddr.toString())\n\n      for (const buf of response.reservation.addrs) {\n        let ma = multiaddr(buf)\n\n        if (ma.getPeerId() == null) {\n          ma = ma.encapsulate(`/p2p/${connection.remotePeer}`)\n        }\n\n        // TODO: workaround for https://github.com/libp2p/go-libp2p/issues/3003\n        ma = multiaddr(ma.toString().replace(\n          `/p2p/${connection.remotePeer}/p2p/${connection.remotePeer}`,\n          `/p2p/${connection.remotePeer}`\n        ))\n\n        addresses.add(ma.toString())\n      }\n\n      response.reservation.addrs = [...addresses].map(str => multiaddr(str).bytes)\n\n      return response.reservation\n    }\n\n    const errMsg = `reservation failed with status ${response.status ?? 'undefined'}`\n    this.log.error(errMsg)\n\n    throw new Error(errMsg)\n  }\n\n  /**\n   * Remove listen relay\n   */\n  async #removeReservation (peerId: PeerId): Promise<void> {\n    const reservation = this.reservations.get(peerId)\n\n    if (reservation == null) {\n      return\n    }\n\n    this.log('removing relay reservation with %p from local store', peerId)\n    clearTimeout(reservation.timeout)\n    this.reservations.delete(peerId)\n\n    // discover a new relay for this discovery request\n    if (reservation.type === 'discovered') {\n      this.pendingReservations.push(\n        reservation.id\n      )\n    }\n\n    // untag the relay\n    await this.peerStore.merge(peerId, {\n      tags: {\n        [KEEP_ALIVE_TAG]: undefined\n      }\n    })\n\n    this.safeDispatchEvent('relay:removed', {\n      detail: {\n        relay: peerId,\n        details: reservation\n      }\n    })\n\n    // maybe trigger discovery of new relays\n    this.#checkReservationCount()\n  }\n\n  #checkReservationCount (): void {\n    if (this.pendingReservations.length === 0) {\n      this.log.trace('have discovered enough relays')\n      this.reserveQueue.clear()\n      this.safeDispatchEvent('relay:found-enough-relays')\n\n      return\n    }\n\n    this.relayFilter = createScalableCuckooFilter(100)\n    this.log('not discovered enough relays %d/%d', this.reservations.size, this.pendingReservations.length)\n    this.safeDispatchEvent('relay:not-enough-relays')\n  }\n}\n", "import { DialError, InvalidMessageError, serviceCapabilities, serviceDependencies, start, stop, transportSymbol } from '@libp2p/interface'\nimport { peerFilter } from '@libp2p/peer-collections'\nimport { peerIdFromMultihash, peerIdFromString } from '@libp2p/peer-id'\nimport { streamToMaConnection } from '@libp2p/utils/stream-to-ma-conn'\nimport { multiaddr } from '@multiformats/multiaddr'\nimport { Circuit } from '@multiformats/multiaddr-matcher'\nimport { pbStream } from 'it-protobuf-stream'\nimport * as Digest from 'multiformats/hashes/digest'\nimport { CustomProgressEvent } from 'progress-events'\nimport { CIRCUIT_PROTO_CODE, DEFAULT_DISCOVERY_FILTER_ERROR_RATE, DEFAULT_DISCOVERY_FILTER_SIZE, MAX_CONNECTIONS, RELAY_V2_HOP_CODEC, RELAY_V2_STOP_CODEC } from '../constants.js'\nimport { StopMessage, HopMessage, Status } from '../pb/index.js'\nimport { CircuitListen, CircuitSearch, LimitTracker } from '../utils.js'\nimport { RelayDiscovery } from './discovery.js'\nimport { createListener } from './listener.js'\nimport { ReservationStore } from './reservation-store.js'\nimport type { CircuitRelayTransportComponents, CircuitRelayTransportInit } from './index.js'\nimport type { Transport, CreateListenerOptions, Listener, Upgrader, ComponentLogger, Logger, Connection, Stream, ConnectionGater, PeerId, PeerStore, OutboundConnectionUpgradeEvents, DialTransportOptions, OpenConnectionProgressEvents } from '@libp2p/interface'\nimport type { AddressManager, ConnectionManager, IncomingStreamData, Registrar, TransportManager } from '@libp2p/interface-internal'\nimport type { Multiaddr } from '@multiformats/multiaddr'\nimport type { ProgressEvent } from 'progress-events'\n\nconst isValidStop = (request: StopMessage): request is Required<StopMessage> => {\n  if (request.peer == null) {\n    return false\n  }\n\n  try {\n    request.peer.addrs.forEach(multiaddr)\n  } catch {\n    return false\n  }\n\n  return true\n}\n\nconst defaults = {\n  maxInboundStopStreams: MAX_CONNECTIONS,\n  maxOutboundStopStreams: MAX_CONNECTIONS,\n  stopTimeout: 30000\n}\n\nexport type CircuitRelayDialEvents =\n  OutboundConnectionUpgradeEvents |\n  OpenConnectionProgressEvents |\n  ProgressEvent<'circuit-relay:open-connection'> |\n  ProgressEvent<'circuit-relay:reuse-connection'> |\n  ProgressEvent<'circuit-relay:open-hop-stream'> |\n  ProgressEvent<'circuit-relay:write-connect-message'> |\n  ProgressEvent<'circuit-relay:read-connect-response'>\n\nexport class CircuitRelayTransport implements Transport<CircuitRelayDialEvents> {\n  private readonly discovery?: RelayDiscovery\n  private readonly registrar: Registrar\n  private readonly peerStore: PeerStore\n  private readonly connectionManager: ConnectionManager\n  private readonly transportManager: TransportManager\n  private readonly peerId: PeerId\n  private readonly upgrader: Upgrader\n  private readonly addressManager: AddressManager\n  private readonly connectionGater: ConnectionGater\n  public readonly reservationStore: ReservationStore\n  private readonly logger: ComponentLogger\n  private readonly maxInboundStopStreams: number\n  private readonly maxOutboundStopStreams?: number\n  private readonly stopTimeout: number\n  private started: boolean\n  private readonly log: Logger\n\n  constructor (components: CircuitRelayTransportComponents, init: CircuitRelayTransportInit) {\n    this.log = components.logger.forComponent('libp2p:circuit-relay:transport')\n    this.registrar = components.registrar\n    this.peerStore = components.peerStore\n    this.connectionManager = components.connectionManager\n    this.transportManager = components.transportManager\n    this.logger = components.logger\n    this.peerId = components.peerId\n    this.upgrader = components.upgrader\n    this.addressManager = components.addressManager\n    this.connectionGater = components.connectionGater\n    this.maxInboundStopStreams = init.maxInboundStopStreams ?? defaults.maxInboundStopStreams\n    this.maxOutboundStopStreams = init.maxOutboundStopStreams ?? defaults.maxOutboundStopStreams\n    this.stopTimeout = init.stopTimeout ?? defaults.stopTimeout\n\n    this.discovery = new RelayDiscovery(components, {\n      filter: init.discoveryFilter ?? peerFilter(DEFAULT_DISCOVERY_FILTER_SIZE, DEFAULT_DISCOVERY_FILTER_ERROR_RATE)\n    })\n    this.discovery.addEventListener('relay:discover', (evt) => {\n      this.reservationStore.addRelay(evt.detail, 'discovered')\n        .catch(err => {\n          if (err.name !== 'HadEnoughRelaysError' && err.name !== 'RelayQueueFullError') {\n            this.log.error('could not add discovered relay %p', evt.detail, err)\n          }\n        })\n    })\n    this.reservationStore = new ReservationStore(components, init)\n    this.reservationStore.addEventListener('relay:not-enough-relays', () => {\n      this.discovery?.startDiscovery()\n    })\n    this.reservationStore.addEventListener('relay:found-enough-relays', () => {\n      this.discovery?.stopDiscovery()\n    })\n\n    this.started = false\n  }\n\n  readonly [Symbol.toStringTag] = '@libp2p/circuit-relay-v2-transport'\n\n  readonly [serviceCapabilities]: string[] = [\n    '@libp2p/transport',\n    '@libp2p/circuit-relay-v2-transport'\n  ]\n\n  get [serviceDependencies] (): string[] {\n    // we only need identify if discovery is enabled\n    if (this.discovery != null) {\n      return [\n        '@libp2p/identify'\n      ]\n    }\n\n    return []\n  }\n\n  readonly [transportSymbol] = true\n\n  isStarted (): boolean {\n    return this.started\n  }\n\n  async start (): Promise<void> {\n    await this.registrar.handle(RELAY_V2_STOP_CODEC, (data) => {\n      void this.onStop(data).catch(err => {\n        this.log.error('error while handling STOP protocol', err)\n        data.stream.abort(err)\n      })\n    }, {\n      maxInboundStreams: this.maxInboundStopStreams,\n      maxOutboundStreams: this.maxOutboundStopStreams,\n      runOnLimitedConnection: true\n    })\n\n    await start(this.discovery, this.reservationStore)\n\n    this.started = true\n  }\n\n  async stop (): Promise<void> {\n    await stop(this.discovery, this.reservationStore)\n    await this.registrar.unhandle(RELAY_V2_STOP_CODEC)\n\n    this.started = false\n  }\n\n  /**\n   * Dial a peer over a relay\n   */\n  async dial (ma: Multiaddr, options: DialTransportOptions<CircuitRelayDialEvents>): Promise<Connection> {\n    if (ma.protoCodes().filter(code => code === CIRCUIT_PROTO_CODE).length !== 1) {\n      const errMsg = 'Invalid circuit relay address'\n      this.log.error(errMsg, ma)\n      throw new DialError(errMsg)\n    }\n\n    // Check the multiaddr to see if it contains a relay and a destination peer\n    const addrs = ma.toString().split('/p2p-circuit')\n    const relayAddr = multiaddr(addrs[0])\n    const destinationAddr = multiaddr(addrs[addrs.length - 1])\n    const relayId = relayAddr.getPeerId()\n    const destinationId = destinationAddr.getPeerId()\n\n    if (relayId == null || destinationId == null) {\n      const errMsg = `ircuit relay dial to ${ma.toString()} failed as address did not have both relay and destination PeerIDs`\n      this.log.error(`c${errMsg}`)\n      throw new DialError(`C${errMsg}`)\n    }\n\n    const relayPeer = peerIdFromString(relayId)\n    const destinationPeer = peerIdFromString(destinationId)\n\n    const relayConnections = this.connectionManager.getConnections(relayPeer)\n    let relayConnection = relayConnections[0]\n\n    if (relayConnection == null) {\n      await this.peerStore.merge(relayPeer, {\n        multiaddrs: [relayAddr]\n      })\n\n      options.onProgress?.(new CustomProgressEvent('circuit-relay:open-connection'))\n      relayConnection = await this.connectionManager.openConnection(relayPeer, options)\n    } else {\n      options.onProgress?.(new CustomProgressEvent('circuit-relay:reuse-connection'))\n    }\n\n    let stream: Stream | undefined\n\n    try {\n      options.onProgress?.(new CustomProgressEvent('circuit-relay:open-hop-stream'))\n      stream = await relayConnection.newStream(RELAY_V2_HOP_CODEC, options)\n\n      const pbstr = pbStream(stream)\n      const hopstr = pbstr.pb(HopMessage)\n\n      options.onProgress?.(new CustomProgressEvent('circuit-relay:write-connect-message'))\n      await hopstr.write({\n        type: HopMessage.Type.CONNECT,\n        peer: {\n          id: destinationPeer.toMultihash().bytes,\n          addrs: [multiaddr(destinationAddr).bytes]\n        }\n      }, options)\n\n      options.onProgress?.(new CustomProgressEvent('circuit-relay:read-connect-response'))\n      const status = await hopstr.read(options)\n\n      if (status.status !== Status.OK) {\n        throw new InvalidMessageError(`failed to connect via relay with status ${status?.status?.toString() ?? 'undefined'}`)\n      }\n\n      const limits = new LimitTracker(status.limit)\n\n      const maConn = streamToMaConnection({\n        stream: pbstr.unwrap(),\n        remoteAddr: ma,\n        localAddr: relayAddr.encapsulate(`/p2p-circuit/p2p/${this.peerId.toString()}`),\n        logger: this.logger,\n        onDataRead: limits.onData,\n        onDataWrite: limits.onData\n      })\n\n      this.log('new outbound relayed connection %a', maConn.remoteAddr)\n\n      return await this.upgrader.upgradeOutbound(maConn, {\n        ...options,\n        limits: limits.getLimits()\n      })\n    } catch (err: any) {\n      this.log.error('circuit relay dial to destination %p via relay %p failed', destinationPeer, relayPeer, err)\n      stream?.abort(err)\n\n      throw err\n    }\n  }\n\n  /**\n   * Create a listener\n   */\n  createListener (options: CreateListenerOptions): Listener {\n    return createListener({\n      peerId: this.peerId,\n      connectionManager: this.connectionManager,\n      addressManager: this.addressManager,\n      reservationStore: this.reservationStore,\n      logger: this.logger\n    })\n  }\n\n  /**\n   * Filter check for all Multiaddrs that this transport can listen on\n   */\n  listenFilter (multiaddrs: Multiaddr[]): Multiaddr[] {\n    multiaddrs = Array.isArray(multiaddrs) ? multiaddrs : [multiaddrs]\n\n    return multiaddrs.filter((ma) => {\n      return CircuitListen.exactMatch(ma) || CircuitSearch.exactMatch(ma)\n    })\n  }\n\n  /**\n   * Filter check for all Multiaddrs that this transport can dial\n   */\n  dialFilter (multiaddrs: Multiaddr[]): Multiaddr[] {\n    multiaddrs = Array.isArray(multiaddrs) ? multiaddrs : [multiaddrs]\n\n    return multiaddrs.filter((ma) => {\n      return Circuit.exactMatch(ma)\n    })\n  }\n\n  /**\n   * An incoming STOP request means a remote peer wants to dial us via a relay\n   */\n  async onStop ({ connection, stream }: IncomingStreamData): Promise<void> {\n    if (!this.reservationStore.hasReservation(connection.remotePeer)) {\n      try {\n        this.log('dialed via relay we did not have a reservation on, start listening on that relay address')\n        await this.transportManager.listen([connection.remoteAddr.encapsulate('/p2p-circuit')])\n      } catch (err: any) {\n        // failed to refresh our hitherto unknown relay reservation but allow the connection attempt anyway\n        this.log.error('failed to listen on a relay peer we were dialed via but did not have a reservation on', err)\n      }\n    }\n\n    const signal = AbortSignal.timeout(this.stopTimeout)\n    const pbstr = pbStream(stream).pb(StopMessage)\n    const request = await pbstr.read({\n      signal\n    })\n\n    this.log('new circuit relay v2 stop stream from %p with type %s', connection.remotePeer, request.type)\n\n    if (request?.type === undefined) {\n      this.log.error('type was missing from circuit v2 stop protocol request from %s', connection.remotePeer)\n      await pbstr.write({ type: StopMessage.Type.STATUS, status: Status.MALFORMED_MESSAGE }, {\n        signal\n      })\n      await stream.close()\n      return\n    }\n\n    // Validate the STOP request has the required input\n    if (request.type !== StopMessage.Type.CONNECT) {\n      this.log.error('invalid stop connect request via peer %p', connection.remotePeer)\n      await pbstr.write({ type: StopMessage.Type.STATUS, status: Status.UNEXPECTED_MESSAGE }, {\n        signal\n      })\n      await stream.close()\n      return\n    }\n\n    if (!isValidStop(request)) {\n      this.log.error('invalid stop connect request via peer %p', connection.remotePeer)\n      await pbstr.write({ type: StopMessage.Type.STATUS, status: Status.MALFORMED_MESSAGE }, {\n        signal\n      })\n      await stream.close()\n      return\n    }\n\n    const remotePeerId = peerIdFromMultihash(Digest.decode(request.peer.id))\n\n    if ((await this.connectionGater.denyInboundRelayedConnection?.(connection.remotePeer, remotePeerId)) === true) {\n      this.log.error('connection gater denied inbound relayed connection from %p', connection.remotePeer)\n      await pbstr.write({ type: StopMessage.Type.STATUS, status: Status.PERMISSION_DENIED }, {\n        signal\n      })\n      await stream.close()\n      return\n    }\n\n    this.log.trace('sending success response to %p', connection.remotePeer)\n    await pbstr.write({ type: StopMessage.Type.STATUS, status: Status.OK }, {\n      signal\n    })\n\n    const limits = new LimitTracker(request.limit)\n    const remoteAddr = connection.remoteAddr.encapsulate(`/p2p-circuit/p2p/${remotePeerId.toString()}`)\n    const localAddr = this.addressManager.getAddresses()[0]\n    const maConn = streamToMaConnection({\n      stream: pbstr.unwrap().unwrap(),\n      remoteAddr,\n      localAddr,\n      logger: this.logger,\n      onDataRead: limits.onData,\n      onDataWrite: limits.onData\n    })\n\n    this.log('new inbound relayed connection %a', maConn.remoteAddr)\n    await this.upgrader.upgradeInbound(maConn, {\n      limits: limits.getLimits()\n    })\n    this.log('%s connection %a upgraded', 'inbound', maConn.remoteAddr)\n  }\n}\n", "import { CircuitRelayTransport } from './transport.js'\nimport type { RelayDiscoveryComponents } from './discovery.js'\nimport type { ReservationStoreInit } from './reservation-store.js'\nimport type { Transport, Upgrader, Libp2pEvents, ConnectionGater, TypedEventTarget, PeerId, TopologyFilter } from '@libp2p/interface'\nimport type { AddressManager, Registrar } from '@libp2p/interface-internal'\n\nexport interface CircuitRelayTransportComponents extends RelayDiscoveryComponents {\n  peerId: PeerId\n  registrar: Registrar\n  upgrader: Upgrader\n  addressManager: AddressManager\n  connectionGater: ConnectionGater\n  events: TypedEventTarget<Libp2pEvents>\n}\n\n/**\n * RelayConfig configures the circuit v2 relay transport.\n */\nexport interface CircuitRelayTransportInit extends ReservationStoreInit {\n  /**\n   * An optional filter used to prevent duplicate attempts to reserve relay\n   * slots on the same peer\n   */\n  discoveryFilter?: TopologyFilter\n\n  /**\n   * The maximum number of simultaneous STOP inbound streams that can be open at\n   * once - each inbound relayed connection uses a STOP stream\n   *\n   * @default 300\n   */\n  maxInboundStopStreams?: number\n\n  /**\n   * The maximum number of simultaneous STOP outbound streams that can be open\n   * at once. If this transport is used along with the relay server these\n   * settings should be set to the same value\n   *\n   * @default 300\n   */\n  maxOutboundStopStreams?: number\n\n  /**\n   * Incoming STOP requests (e.g. when a remote peer wants to dial us via a\n   * relay) must finish the initial protocol negotiation within this timeout in\n   * ms\n   *\n   * @default 30000\n   */\n  stopTimeout?: number\n\n  /**\n   * When creating a reservation it must complete within this number of ms\n   *\n   * @default 10000\n   */\n  reservationCompletionTimeout?: number\n}\n\nexport function circuitRelayTransport (init: CircuitRelayTransportInit = {}): (components: CircuitRelayTransportComponents) => Transport {\n  return (components) => {\n    return new CircuitRelayTransport(components, init)\n  }\n}\n", "/* eslint-disable import/export */\n/* eslint-disable complexity */\n/* eslint-disable @typescript-eslint/no-namespace */\n/* eslint-disable @typescript-eslint/no-unnecessary-boolean-literal-compare */\n/* eslint-disable @typescript-eslint/no-empty-interface */\n\nimport { type Codec, decodeMessage, type DecodeOptions, encodeMessage, enumeration, MaxLengthError, message } from 'protons-runtime'\nimport type { Uint8ArrayList } from 'uint8arraylist'\n\nexport interface HolePunch {\n  type?: HolePunch.Type\n  observedAddresses: Uint8Array[]\n}\n\nexport namespace HolePunch {\n  export enum Type {\n    UNUSED = 'UNUSED',\n    CONNECT = 'CONNECT',\n    SYNC = 'SYNC'\n  }\n\n  enum __TypeValues {\n    UNUSED = 0,\n    CONNECT = 100,\n    SYNC = 300\n  }\n\n  export namespace Type {\n    export const codec = (): Codec<Type> => {\n      return enumeration<Type>(__TypeValues)\n    }\n  }\n\n  let _codec: Codec<HolePunch>\n\n  export const codec = (): Codec<HolePunch> => {\n    if (_codec == null) {\n      _codec = message<HolePunch>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if (obj.type != null) {\n          w.uint32(8)\n          HolePunch.Type.codec().encode(obj.type, w)\n        }\n\n        if (obj.observedAddresses != null) {\n          for (const value of obj.observedAddresses) {\n            w.uint32(18)\n            w.bytes(value)\n          }\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {\n          observedAddresses: []\n        }\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.type = HolePunch.Type.codec().decode(reader)\n              break\n            }\n            case 2: {\n              if (opts.limits?.observedAddresses != null && obj.observedAddresses.length === opts.limits.observedAddresses) {\n                throw new MaxLengthError('Decode error - map field \"observedAddresses\" had too many elements')\n              }\n\n              obj.observedAddresses.push(reader.bytes())\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<HolePunch>): Uint8Array => {\n    return encodeMessage(obj, HolePunch.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<HolePunch>): HolePunch => {\n    return decodeMessage(buf, HolePunch.codec(), opts)\n  }\n}\n", "import { isPrivateIp } from '@libp2p/utils/private-ip'\nimport { type Multiaddr } from '@multiformats/multiaddr'\nimport { Circuit, IP, DNS } from '@multiformats/multiaddr-matcher'\nimport type { TransportManager } from '@libp2p/interface-internal'\n\n/**\n * Returns true if the passed multiaddr is public, not relayed and we have a\n * transport that can dial it\n */\nexport function isPublicAndDialable (ma: Multiaddr, transportManager: TransportManager): boolean {\n  // ignore circuit relay\n  if (Circuit.matches(ma)) {\n    return false\n  }\n\n  const transport = transportManager.dialTransportForMultiaddr(ma)\n\n  if (transport == null) {\n    return false\n  }\n\n  // dns addresses are probably public?\n  if (DNS.matches(ma)) {\n    return true\n  }\n\n  // ensure we have only IPv4/IPv6 addresses\n  if (!IP.matches(ma)) {\n    return false\n  }\n\n  return isPrivateIp(ma.toOptions().host) === false\n}\n", "import { InvalidMessageError, serviceDependencies } from '@libp2p/interface'\nimport { type Multiaddr, multiaddr } from '@multiformats/multiaddr'\nimport { Circuit } from '@multiformats/multiaddr-matcher'\nimport delay from 'delay'\nimport { pbStream } from 'it-protobuf-stream'\nimport { HolePunch } from './pb/message.js'\nimport { isPublicAndDialable } from './utils.js'\nimport { multicodec } from './index.js'\nimport type { DCUtRServiceComponents, DCUtRServiceInit } from './index.js'\nimport type { Logger, Connection, Stream, PeerStore, Startable } from '@libp2p/interface'\nimport type { AddressManager, ConnectionManager, Registrar, TransportManager } from '@libp2p/interface-internal'\n\n// https://github.com/libp2p/specs/blob/master/relay/DCUtR.md#rpc-messages\nconst MAX_DCUTR_MESSAGE_SIZE = 1024 * 4\n// ensure the dial has a high priority to jump to the head of the dial queue\nconst DCUTR_DIAL_PRIORITY = 100\n\nconst defaultValues = {\n  // https://github.com/libp2p/go-libp2p/blob/8d2e54e1637041d5cf4fac1e531287560bd1f4ac/p2p/protocol/holepunch/holepuncher.go#L27\n  timeout: 5000,\n  // https://github.com/libp2p/go-libp2p/blob/8d2e54e1637041d5cf4fac1e531287560bd1f4ac/p2p/protocol/holepunch/holepuncher.go#L28\n  retries: 3,\n  maxInboundStreams: 1,\n  maxOutboundStreams: 1\n}\n\nexport class DefaultDCUtRService implements Startable {\n  private started: boolean\n  private readonly timeout: number\n  private readonly retries: number\n  private readonly maxInboundStreams: number\n  private readonly maxOutboundStreams: number\n  private readonly peerStore: PeerStore\n  private readonly registrar: Registrar\n  private readonly connectionManager: ConnectionManager\n  private readonly addressManager: AddressManager\n  private readonly transportManager: TransportManager\n  private topologyId?: string\n  private readonly log: Logger\n\n  constructor (components: DCUtRServiceComponents, init: DCUtRServiceInit) {\n    this.log = components.logger.forComponent('libp2p:dcutr')\n    this.started = false\n    this.peerStore = components.peerStore\n    this.registrar = components.registrar\n    this.addressManager = components.addressManager\n    this.connectionManager = components.connectionManager\n    this.transportManager = components.transportManager\n\n    this.timeout = init.timeout ?? defaultValues.timeout\n    this.retries = init.retries ?? defaultValues.retries\n    this.maxInboundStreams = init.maxInboundStreams ?? defaultValues.maxInboundStreams\n    this.maxOutboundStreams = init.maxOutboundStreams ?? defaultValues.maxOutboundStreams\n  }\n\n  readonly [Symbol.toStringTag] = '@libp2p/dcutr'\n\n  readonly [serviceDependencies]: string[] = [\n    '@libp2p/identify'\n  ]\n\n  isStarted (): boolean {\n    return this.started\n  }\n\n  async start (): Promise<void> {\n    if (this.started) {\n      return\n    }\n\n    // register for notifications of when peers that support DCUtR connect\n    // nb. requires the identify service to be enabled\n    this.topologyId = await this.registrar.register(multicodec, {\n      notifyOnLimitedConnection: true,\n      onConnect: (peerId, connection) => {\n        if (!Circuit.exactMatch(connection.remoteAddr)) {\n          // the connection is already direct, no upgrade is required\n          return\n        }\n\n        // the inbound peer starts the connection upgrade\n        if (connection.direction !== 'inbound') {\n          return\n        }\n\n        this.upgradeInbound(connection)\n          .catch(err => {\n            this.log.error('error during outgoing DCUtR attempt', err)\n          })\n      }\n    })\n\n    await this.registrar.handle(multicodec, (data) => {\n      void this.handleIncomingUpgrade(data.stream, data.connection).catch(err => {\n        this.log.error('error during incoming DCUtR attempt', err)\n        data.stream.abort(err)\n      })\n    }, {\n      maxInboundStreams: this.maxInboundStreams,\n      maxOutboundStreams: this.maxOutboundStreams,\n      runOnLimitedConnection: true\n    })\n\n    this.started = true\n  }\n\n  async stop (): Promise<void> {\n    await this.registrar.unhandle(multicodec)\n\n    if (this.topologyId != null) {\n      this.registrar.unregister(this.topologyId)\n    }\n\n    this.started = false\n  }\n\n  /**\n   * Perform the inbound connection upgrade as B\n   *\n   * @see https://github.com/libp2p/specs/blob/master/relay/DCUtR.md#the-protocol\n   */\n  async upgradeInbound (relayedConnection: Connection): Promise<void> {\n    // Upon observing the new connection, the inbound peer (here B) checks the\n    // addresses advertised by A via identify.\n    //\n    // If that set includes public addresses, then A may be reachable by a direct\n    // connection, in which case B attempts a unilateral connection upgrade by\n    // initiating a direct connection to A.\n    if (await this.attemptUnilateralConnectionUpgrade(relayedConnection)) {\n      return\n    }\n\n    let stream: Stream | undefined\n\n    for (let i = 0; i < this.retries; i++) {\n      const options = {\n        signal: AbortSignal.timeout(this.timeout)\n      }\n\n      try {\n        // 1. B opens a stream to A using the /libp2p/dcutr protocol.\n        stream = await relayedConnection.newStream([multicodec], {\n          signal: options.signal,\n          runOnLimitedConnection: true\n        })\n\n        const pb = pbStream(stream, {\n          maxDataLength: MAX_DCUTR_MESSAGE_SIZE\n        }).pb(HolePunch)\n\n        // 2. B sends to A a Connect message containing its observed (and\n        // possibly predicted) addresses from identify and starts a timer\n        // to measure RTT of the relay connection.\n        this.log('B sending connect to %p', relayedConnection.remotePeer)\n        const connectTimer = Date.now()\n        await pb.write({\n          type: HolePunch.Type.CONNECT,\n          observedAddresses: this.addressManager.getAddresses().map(ma => ma.bytes)\n        }, options)\n\n        this.log('B receiving connect from %p', relayedConnection.remotePeer)\n        // 4. Upon receiving the Connect, B sends a Sync message\n        const connect = await pb.read(options)\n\n        if (connect.type !== HolePunch.Type.CONNECT) {\n          this.log('A sent wrong message type')\n          throw new InvalidMessageError('DCUtR message type was incorrect')\n        }\n\n        const multiaddrs = this.getDialableMultiaddrs(connect.observedAddresses)\n\n        if (multiaddrs.length === 0) {\n          this.log('A did not have any dialable multiaddrs')\n          throw new InvalidMessageError('DCUtR connect message had no multiaddrs')\n        }\n\n        const rtt = Date.now() - connectTimer\n\n        this.log('A sending sync, rtt %dms', rtt)\n        await pb.write({\n          type: HolePunch.Type.SYNC,\n          observedAddresses: []\n        }, options)\n\n        this.log('A waiting for half RTT')\n        // ..and starts a timer for half the RTT measured from the time between\n        // sending the initial Connect and receiving the response\n        await delay(rtt / 2)\n\n        // TODO: when we have a QUIC transport, the dial step is different - for\n        // now we only have tcp support\n        // https://github.com/libp2p/specs/blob/master/relay/DCUtR.md#the-protocol\n\n        this.log('B dialing', multiaddrs)\n        // Upon expiry of the timer, B dials the address to A.\n        const conn = await this.connectionManager.openConnection(multiaddrs, {\n          signal: options.signal,\n          priority: DCUTR_DIAL_PRIORITY\n        })\n\n        this.log('DCUtR to %p succeeded to address %a, closing relayed connection', relayedConnection.remotePeer, conn.remoteAddr)\n        await relayedConnection.close(options)\n\n        break\n      } catch (err: any) {\n        this.log.error('error while attempting DCUtR on attempt %d of %d', i + 1, this.retries, err)\n        stream?.abort(err)\n\n        if (i === this.retries) {\n          throw err\n        }\n      } finally {\n        if (stream != null) {\n          await stream.close(options)\n        }\n      }\n    }\n  }\n\n  /**\n   * This is performed when A has dialed B via a relay but A also has a public\n   * address that B can dial directly\n   */\n  async attemptUnilateralConnectionUpgrade (relayedConnection: Connection): Promise<boolean> {\n    // Upon observing the new connection, the inbound peer (here B) checks the\n    // addresses advertised by A via identify.\n    const peerInfo = await this.peerStore.get(relayedConnection.remotePeer)\n\n    // If that set includes public addresses, then A may be reachable by a direct\n    // connection, in which case B attempts a unilateral connection upgrade by\n    // initiating a direct connection to A.\n    const publicAddresses = peerInfo.addresses\n      .map(address => {\n        const ma = address.multiaddr\n\n        // ensure all multiaddrs have the peer id\n        if (ma.getPeerId() == null) {\n          return ma.encapsulate(`/p2p/${relayedConnection.remotePeer}`)\n        }\n\n        return ma\n      })\n      .filter(ma => {\n        return isPublicAndDialable(ma, this.transportManager)\n      })\n\n    if (publicAddresses.length > 0) {\n      const signal = AbortSignal.timeout(this.timeout)\n\n      try {\n        this.log('attempting unilateral connection upgrade to %a', publicAddresses)\n\n        // force-dial the multiaddr(s), otherwise `connectionManager.openConnection`\n        // will return the existing relayed connection\n        const connection = await this.connectionManager.openConnection(publicAddresses, {\n          signal,\n          force: true\n        })\n\n        if (Circuit.exactMatch(connection.remoteAddr)) {\n          throw new Error('Could not open a new, non-limited, connection')\n        }\n\n        this.log('unilateral connection upgrade to %p succeeded via %a, closing relayed connection', relayedConnection.remotePeer, connection.remoteAddr)\n\n        await relayedConnection.close({\n          signal\n        })\n\n        return true\n      } catch (err) {\n        this.log.error('unilateral connection upgrade to %p on addresses %a failed', relayedConnection.remotePeer, publicAddresses, err)\n      }\n    } else {\n      this.log('peer %p has no public addresses, not attempting unilateral connection upgrade', relayedConnection.remotePeer)\n    }\n\n    // no public addresses or failed to dial public addresses\n    return false\n  }\n\n  /**\n   * Perform the connection upgrade as A\n   *\n   * @see https://github.com/libp2p/specs/blob/master/relay/DCUtR.md#the-protocol\n   */\n  async handleIncomingUpgrade (stream: Stream, relayedConnection: Connection): Promise<void> {\n    const options = {\n      signal: AbortSignal.timeout(this.timeout)\n    }\n\n    try {\n      const pb = pbStream(stream, {\n        maxDataLength: MAX_DCUTR_MESSAGE_SIZE\n      }).pb(HolePunch)\n\n      this.log('A receiving connect')\n      // 3. Upon receiving the Connect, A responds back with a Connect message\n      // containing its observed (and possibly predicted) addresses.\n      const connect = await pb.read(options)\n\n      if (connect.type !== HolePunch.Type.CONNECT) {\n        this.log('B sent wrong message type')\n        throw new InvalidMessageError('DCUtR message type was incorrect')\n      }\n\n      if (connect.observedAddresses.length === 0) {\n        this.log('B sent no multiaddrs')\n        throw new InvalidMessageError('DCUtR connect message had no multiaddrs')\n      }\n\n      const multiaddrs = this.getDialableMultiaddrs(connect.observedAddresses)\n\n      if (multiaddrs.length === 0) {\n        this.log('B had no dialable multiaddrs')\n        throw new InvalidMessageError('DCUtR connect message had no dialable multiaddrs')\n      }\n\n      this.log('A sending connect')\n      await pb.write({\n        type: HolePunch.Type.CONNECT,\n        observedAddresses: this.addressManager.getAddresses().map(ma => ma.bytes)\n      })\n\n      this.log('A receiving sync')\n      const sync = await pb.read(options)\n\n      if (sync.type !== HolePunch.Type.SYNC) {\n        throw new InvalidMessageError('DCUtR message type was incorrect')\n      }\n\n      // TODO: when we have a QUIC transport, the dial step is different - for\n      // now we only have tcp support\n      // https://github.com/libp2p/specs/blob/master/relay/DCUtR.md#the-protocol\n\n      // Upon receiving the Sync, A immediately dials the address to B\n      this.log('A dialing', multiaddrs)\n      const connection = await this.connectionManager.openConnection(multiaddrs, {\n        signal: options.signal,\n        priority: DCUTR_DIAL_PRIORITY,\n        force: true\n      })\n\n      this.log('DCUtR to %p succeeded via %a, closing relayed connection', relayedConnection.remotePeer, connection.remoteAddr)\n      await relayedConnection.close(options)\n    } catch (err: any) {\n      this.log.error('incoming DCUtR from %p failed', relayedConnection.remotePeer, err)\n      stream.abort(err)\n    } finally {\n      await stream.close(options)\n    }\n  }\n\n  /**\n   * Takes the `addr` and converts it to a Multiaddr if possible\n   */\n  getDialableMultiaddrs (addrs: Array<Uint8Array | string | null | undefined>): Multiaddr[] {\n    const output = []\n\n    for (const addr of addrs) {\n      if (addr == null || addr.length === 0) {\n        continue\n      }\n\n      try {\n        const ma = multiaddr(addr)\n\n        if (!isPublicAndDialable(ma, this.transportManager)) {\n          continue\n        }\n\n        output.push(ma)\n      } catch {}\n    }\n\n    return output\n  }\n}\n", "/**\n * @packageDocumentation\n *\n * Direct Connection Upgrade through Relay (DCUtR) is a protocol that allows two\n * nodes to connect to each other who would otherwise be prevented doing so due\n * to being behind NATed connections or firewalls.\n *\n * The protocol involves making a relayed connection between the two peers and\n * using the relay to synchronise connection timings so that they dial each other\n * at precisely the same moment.\n *\n * @example\n *\n * ```TypeScript\n * import { createLibp2p } from 'libp2p'\n * import { circuitRelayTransport } from '@libp2p/circuit-relay-v2'\n * import { tcp } from '@libp2p/tcp'\n * import { identify } from '@libp2p/identify'\n * import { dcutr } from '@libp2p/dcutr'\n * import { multiaddr } from '@multiformats/multiaddr'\n *\n * const node = await createLibp2p({\n *   transports: [\n *     circuitRelayTransport(),\n *     tcp()\n *   ],\n *   services: {\n *     identify: identify(),\n *     dcutr: dcutr()\n *   }\n * })\n *\n * // QmTarget is a peer that is behind a NAT, supports TCP and has a relay\n * // reservation\n * const ma = multiaddr('/ip4/.../p2p/QmRelay/p2p-circuit/p2p/QmTarget')\n * await node.dial(ma)\n *\n * // after a while the connection should automatically get upgraded to a\n * // direct connection (e.g. non-limited)\n * while (true) {\n *   const connections = node.getConnections()\n *\n *   if (connections.find(conn => conn.limits == null)) {\n *     console.info('have direct connection')\n *     break\n *   } else {\n *     console.info('have relayed connection')\n *\n *     // wait a few seconds to see if it's succeeded yet\n *     await new Promise<void>((resolve) => {\n *       setTimeout(() => resolve(), 5000)\n *     })\n *   }\n * }\n * ```\n */\n\nimport { DefaultDCUtRService } from './dcutr.js'\nimport type { ComponentLogger, PeerStore } from '@libp2p/interface'\nimport type { AddressManager, ConnectionManager, Registrar, TransportManager } from '@libp2p/interface-internal'\n\nexport interface DCUtRServiceInit {\n  /**\n   * How long we should wait for the connection upgrade to complete\n   *\n   * @default 5000\n   */\n  timeout?: number\n\n  /**\n   * How many times to retry the connection upgrade\n   *\n   * @default 3\n   */\n  retries?: number\n\n  /**\n   * How many simultaneous inbound DCUtR protocol streams to allow on each\n   * connection\n   *\n   * @default 1\n   */\n  maxInboundStreams?: number\n\n  /**\n   * How many simultaneous outbound DCUtR protocol streams to allow on each\n   * connection\n   *\n   * @default 1\n   */\n  maxOutboundStreams?: number\n}\n\nexport interface DCUtRServiceComponents {\n  peerStore: PeerStore\n  connectionManager: ConnectionManager\n  registrar: Registrar\n  addressManager: AddressManager\n  transportManager: TransportManager\n  logger: ComponentLogger\n}\n\n/**\n * The DCUtR protocol\n */\nexport const multicodec = '/libp2p/dcutr'\n\nexport function dcutr (init: DCUtRServiceInit = {}): (components: DCUtRServiceComponents) => unknown {\n  return (components) => new DefaultDCUtRService(components, init)\n}\n", "export const PROTOCOL_VERSION = 'ipfs/0.1.0' // deprecated\nexport const MULTICODEC_IDENTIFY = '/ipfs/id/1.0.0' // deprecated\nexport const MULTICODEC_IDENTIFY_PUSH = '/ipfs/id/push/1.0.0' // deprecated\n\nexport const IDENTIFY_PROTOCOL_VERSION = '0.1.0'\nexport const MULTICODEC_IDENTIFY_PROTOCOL_NAME = 'id'\nexport const MULTICODEC_IDENTIFY_PUSH_PROTOCOL_NAME = 'id/push'\nexport const MULTICODEC_IDENTIFY_PROTOCOL_VERSION = '1.0.0'\nexport const MULTICODEC_IDENTIFY_PUSH_PROTOCOL_VERSION = '1.0.0'\n\n// https://github.com/libp2p/go-libp2p/blob/8d2e54e1637041d5cf4fac1e531287560bd1f4ac/p2p/protocol/identify/id.go#L52\nexport const MAX_IDENTIFY_MESSAGE_SIZE = 1024 * 8\n\n// https://github.com/libp2p/go-libp2p/blob/0385ec924bad172f74a74db09939e97c079b1420/p2p/protocol/identify/id.go#L47C7-L47C25\nexport const MAX_PUSH_CONCURRENCY = 32\n", "/* eslint-disable import/export */\n/* eslint-disable complexity */\n/* eslint-disable @typescript-eslint/no-namespace */\n/* eslint-disable @typescript-eslint/no-unnecessary-boolean-literal-compare */\n/* eslint-disable @typescript-eslint/no-empty-interface */\n\nimport { type Codec, decodeMessage, type DecodeOptions, encodeMessage, MaxLengthError, message } from 'protons-runtime'\nimport type { Uint8ArrayList } from 'uint8arraylist'\n\nexport interface Identify {\n  protocolVersion?: string\n  agentVersion?: string\n  publicKey?: Uint8Array\n  listenAddrs: Uint8Array[]\n  observedAddr?: Uint8Array\n  protocols: string[]\n  signedPeerRecord?: Uint8Array\n}\n\nexport namespace Identify {\n  let _codec: Codec<Identify>\n\n  export const codec = (): Codec<Identify> => {\n    if (_codec == null) {\n      _codec = message<Identify>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if (obj.protocolVersion != null) {\n          w.uint32(42)\n          w.string(obj.protocolVersion)\n        }\n\n        if (obj.agentVersion != null) {\n          w.uint32(50)\n          w.string(obj.agentVersion)\n        }\n\n        if (obj.publicKey != null) {\n          w.uint32(10)\n          w.bytes(obj.publicKey)\n        }\n\n        if (obj.listenAddrs != null) {\n          for (const value of obj.listenAddrs) {\n            w.uint32(18)\n            w.bytes(value)\n          }\n        }\n\n        if (obj.observedAddr != null) {\n          w.uint32(34)\n          w.bytes(obj.observedAddr)\n        }\n\n        if (obj.protocols != null) {\n          for (const value of obj.protocols) {\n            w.uint32(26)\n            w.string(value)\n          }\n        }\n\n        if (obj.signedPeerRecord != null) {\n          w.uint32(66)\n          w.bytes(obj.signedPeerRecord)\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {\n          listenAddrs: [],\n          protocols: []\n        }\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 5: {\n              obj.protocolVersion = reader.string()\n              break\n            }\n            case 6: {\n              obj.agentVersion = reader.string()\n              break\n            }\n            case 1: {\n              obj.publicKey = reader.bytes()\n              break\n            }\n            case 2: {\n              if (opts.limits?.listenAddrs != null && obj.listenAddrs.length === opts.limits.listenAddrs) {\n                throw new MaxLengthError('Decode error - map field \"listenAddrs\" had too many elements')\n              }\n\n              obj.listenAddrs.push(reader.bytes())\n              break\n            }\n            case 4: {\n              obj.observedAddr = reader.bytes()\n              break\n            }\n            case 3: {\n              if (opts.limits?.protocols != null && obj.protocols.length === opts.limits.protocols) {\n                throw new MaxLengthError('Decode error - map field \"protocols\" had too many elements')\n              }\n\n              obj.protocols.push(reader.string())\n              break\n            }\n            case 8: {\n              obj.signedPeerRecord = reader.bytes()\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<Identify>): Uint8Array => {\n    return encodeMessage(obj, Identify.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<Identify>): Identify => {\n    return decodeMessage(buf, Identify.codec(), opts)\n  }\n}\n", "import detectElectron from 'is-electron'\n\nexport const isEnvWithDom = typeof window === 'object' && typeof document === 'object' && document.nodeType === 9\nexport const isElectron = detectElectron()\n\n/**\n * Detects browser main thread  **NOT** web worker or service worker\n */\nexport const isBrowser = isEnvWithDom && !isElectron\nexport const isElectronMain = isElectron && !isEnvWithDom\nexport const isElectronRenderer = isElectron && isEnvWithDom\nexport const isNode = typeof globalThis.process !== 'undefined' && typeof globalThis.process.release !== 'undefined' && globalThis.process.release.name === 'node' && !isElectron\n// @ts-ignore\n// eslint-disable-next-line no-undef\nexport const isWebWorker = typeof importScripts === 'function' && typeof self !== 'undefined' && typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope\n\n// defeat bundlers replacing process.env.NODE_ENV with \"development\" or whatever\nexport const isTest = typeof globalThis.process !== 'undefined' && typeof globalThis.process.env !== 'undefined' && globalThis.process.env['NODE' + (() => '_')() + 'ENV'] === 'test'\nexport const isReactNative = typeof navigator !== 'undefined' && navigator.product === 'ReactNative'\n", "import { publicKeyFromProtobuf } from '@libp2p/crypto/keys'\nimport { InvalidMessageError } from '@libp2p/interface'\nimport { peerIdFromCID, peerIdFromPublicKey } from '@libp2p/peer-id'\nimport { RecordEnvelope, PeerRecord } from '@libp2p/peer-record'\nimport { type Multiaddr, multiaddr } from '@multiformats/multiaddr'\nimport { fromString as uint8ArrayFromString } from 'uint8arrays/from-string'\nimport { isNode, isBrowser, isWebWorker, isElectronMain, isElectronRenderer, isReactNative } from 'wherearewe'\nimport { IDENTIFY_PROTOCOL_VERSION, MAX_IDENTIFY_MESSAGE_SIZE, MAX_PUSH_CONCURRENCY } from './consts.js'\nimport type { IdentifyComponents, IdentifyInit } from './index.js'\nimport type { Identify as IdentifyMessage } from './pb/message.js'\nimport type { Libp2pEvents, IdentifyResult, SignedPeerRecord, Logger, Connection, TypedEventTarget, Peer, PeerData, PeerStore, NodeInfo, Startable, PeerId, IncomingStreamData, PrivateKey } from '@libp2p/interface'\nimport type { AddressManager, Registrar } from '@libp2p/interface-internal'\n\nexport const defaultValues = {\n  protocolPrefix: 'ipfs',\n  timeout: 5000,\n  maxInboundStreams: 1,\n  maxOutboundStreams: 1,\n  maxObservedAddresses: 10,\n  maxMessageSize: MAX_IDENTIFY_MESSAGE_SIZE,\n  runOnConnectionOpen: true,\n  runOnSelfUpdate: true,\n  runOnLimitedConnection: true,\n  concurrency: MAX_PUSH_CONCURRENCY\n}\n\n/**\n * Takes the `addr` and converts it to a Multiaddr if possible\n */\nexport function getCleanMultiaddr (addr: Uint8Array | string | null | undefined): Multiaddr | undefined {\n  if (addr != null && addr.length > 0) {\n    try {\n      return multiaddr(addr)\n    } catch {\n\n    }\n  }\n}\n\nexport function getAgentVersion (nodeInfo: NodeInfo, agentVersion?: string): string {\n  if (agentVersion != null) {\n    return agentVersion\n  }\n\n  agentVersion = `${nodeInfo.name}/${nodeInfo.version}`\n  // Append user agent version to default AGENT_VERSION depending on the environment\n  if (isNode || isElectronMain) {\n    agentVersion += ` UserAgent=${globalThis.process.version}`\n  } else if (isBrowser || isWebWorker || isElectronRenderer || isReactNative) {\n    agentVersion += ` UserAgent=${globalThis.navigator.userAgent}`\n  }\n\n  return agentVersion\n}\n\nexport async function consumeIdentifyMessage (peerStore: PeerStore, events: TypedEventTarget<Libp2pEvents>, log: Logger, connection: Connection, message: IdentifyMessage): Promise<IdentifyResult> {\n  log('received identify from %p', connection.remotePeer)\n\n  if (message == null) {\n    throw new InvalidMessageError('message was null or undefined')\n  }\n\n  const peer: PeerData = {}\n\n  if (message.listenAddrs.length > 0) {\n    peer.addresses = message.listenAddrs.map(buf => ({\n      isCertified: false,\n      multiaddr: multiaddr(buf)\n    }))\n  }\n\n  if (message.protocols.length > 0) {\n    peer.protocols = message.protocols\n  }\n\n  if (message.publicKey != null) {\n    const publicKey = publicKeyFromProtobuf(message.publicKey)\n    const peerId = peerIdFromPublicKey(publicKey)\n\n    if (!peerId.equals(connection.remotePeer)) {\n      throw new InvalidMessageError('public key did not match remote PeerId')\n    }\n\n    peer.publicKey = publicKey\n  }\n\n  let output: SignedPeerRecord | undefined\n\n  // if the peer record has been sent, prefer the addresses in the record as they are signed by the remote peer\n  if (message.signedPeerRecord != null) {\n    log.trace('received signedPeerRecord from %p', connection.remotePeer)\n\n    let peerRecordEnvelope = message.signedPeerRecord\n    const envelope = await RecordEnvelope.openAndCertify(peerRecordEnvelope, PeerRecord.DOMAIN)\n    let peerRecord = PeerRecord.createFromProtobuf(envelope.payload)\n    const envelopePeer = peerIdFromCID(envelope.publicKey.toCID())\n\n    // Verify peerId\n    if (!peerRecord.peerId.equals(envelopePeer)) {\n      throw new InvalidMessageError('signing key does not match PeerId in the PeerRecord')\n    }\n\n    // Make sure remote peer is the one sending the record\n    if (!connection.remotePeer.equals(peerRecord.peerId)) {\n      throw new InvalidMessageError('signing key does not match remote PeerId')\n    }\n\n    let existingPeer: Peer | undefined\n\n    try {\n      existingPeer = await peerStore.get(peerRecord.peerId)\n    } catch (err: any) {\n      if (err.name !== 'NotFoundError') {\n        throw err\n      }\n    }\n\n    if (existingPeer != null) {\n      // don't lose any existing metadata\n      peer.metadata = existingPeer.metadata\n\n      // if we have previously received a signed record for this peer, compare it to the incoming one\n      if (existingPeer.peerRecordEnvelope != null) {\n        const storedEnvelope = await RecordEnvelope.createFromProtobuf(existingPeer.peerRecordEnvelope)\n        const storedRecord = PeerRecord.createFromProtobuf(storedEnvelope.payload)\n\n        // ensure seq is greater than, or equal to, the last received\n        if (storedRecord.seqNumber >= peerRecord.seqNumber) {\n          log('sequence number was lower or equal to existing sequence number - stored: %d received: %d', storedRecord.seqNumber, peerRecord.seqNumber)\n          peerRecord = storedRecord\n          peerRecordEnvelope = existingPeer.peerRecordEnvelope\n        }\n      }\n    }\n\n    // store the signed record for next time\n    peer.peerRecordEnvelope = peerRecordEnvelope\n\n    // override the stored addresses with the signed multiaddrs\n    peer.addresses = peerRecord.multiaddrs.map(multiaddr => ({\n      isCertified: true,\n      multiaddr\n    }))\n\n    output = {\n      seq: peerRecord.seqNumber,\n      addresses: peerRecord.multiaddrs\n    }\n  } else {\n    log('%p did not send a signed peer record', connection.remotePeer)\n  }\n\n  log.trace('patching %p with', connection.remotePeer, peer)\n  await peerStore.patch(connection.remotePeer, peer)\n\n  if (message.agentVersion != null || message.protocolVersion != null) {\n    const metadata: Record<string, Uint8Array> = {}\n\n    if (message.agentVersion != null) {\n      metadata.AgentVersion = uint8ArrayFromString(message.agentVersion)\n    }\n\n    if (message.protocolVersion != null) {\n      metadata.ProtocolVersion = uint8ArrayFromString(message.protocolVersion)\n    }\n\n    log.trace('merging %p metadata', connection.remotePeer, metadata)\n    await peerStore.merge(connection.remotePeer, {\n      metadata\n    })\n  }\n\n  const result: IdentifyResult = {\n    peerId: connection.remotePeer,\n    protocolVersion: message.protocolVersion,\n    agentVersion: message.agentVersion,\n    publicKey: message.publicKey,\n    listenAddrs: message.listenAddrs.map(buf => multiaddr(buf)),\n    observedAddr: message.observedAddr == null ? undefined : multiaddr(message.observedAddr),\n    protocols: message.protocols,\n    signedPeerRecord: output,\n    connection\n  }\n\n  events.safeDispatchEvent('peer:identify', { detail: result })\n\n  return result\n}\n\nexport interface AbstractIdentifyInit extends IdentifyInit {\n  protocol: string\n  log: Logger\n}\n\nexport abstract class AbstractIdentify implements Startable {\n  public readonly host: {\n    protocolVersion: string\n    agentVersion: string\n  }\n\n  protected protocol: string\n  protected started: boolean\n  protected readonly timeout: number\n  protected readonly peerId: PeerId\n  protected readonly privateKey: PrivateKey\n  protected readonly peerStore: PeerStore\n  protected readonly registrar: Registrar\n  protected readonly addressManager: AddressManager\n  private readonly maxInboundStreams: number\n  private readonly maxOutboundStreams: number\n  protected readonly maxMessageSize: number\n  protected readonly maxObservedAddresses: number\n  protected readonly events: TypedEventTarget<Libp2pEvents>\n  protected readonly runOnLimitedConnection: boolean\n  protected readonly log: Logger\n\n  constructor (components: IdentifyComponents, init: AbstractIdentifyInit) {\n    this.protocol = init.protocol\n    this.started = false\n    this.peerId = components.peerId\n    this.privateKey = components.privateKey\n    this.peerStore = components.peerStore\n    this.registrar = components.registrar\n    this.addressManager = components.addressManager\n    this.events = components.events\n    this.log = init.log\n\n    this.timeout = init.timeout ?? defaultValues.timeout\n    this.maxInboundStreams = init.maxInboundStreams ?? defaultValues.maxInboundStreams\n    this.maxOutboundStreams = init.maxOutboundStreams ?? defaultValues.maxOutboundStreams\n    this.maxMessageSize = init.maxMessageSize ?? defaultValues.maxMessageSize\n    this.maxObservedAddresses = init.maxObservedAddresses ?? defaultValues.maxObservedAddresses\n    this.runOnLimitedConnection = init.runOnLimitedConnection ?? defaultValues.runOnLimitedConnection\n\n    // Store self host metadata\n    this.host = {\n      protocolVersion: `${init.protocolPrefix ?? defaultValues.protocolPrefix}/${IDENTIFY_PROTOCOL_VERSION}`,\n      agentVersion: getAgentVersion(components.nodeInfo, init.agentVersion)\n    }\n  }\n\n  isStarted (): boolean {\n    return this.started\n  }\n\n  async start (): Promise<void> {\n    if (this.started) {\n      return\n    }\n\n    await this.peerStore.merge(this.peerId, {\n      metadata: {\n        AgentVersion: uint8ArrayFromString(this.host.agentVersion),\n        ProtocolVersion: uint8ArrayFromString(this.host.protocolVersion)\n      }\n    })\n\n    await this.registrar.handle(this.protocol, (data) => {\n      void this.handleProtocol(data).catch(err => {\n        this.log.error(err)\n      })\n    }, {\n      maxInboundStreams: this.maxInboundStreams,\n      maxOutboundStreams: this.maxOutboundStreams,\n      runOnLimitedConnection: this.runOnLimitedConnection\n    })\n\n    this.started = true\n  }\n\n  async stop (): Promise<void> {\n    await this.registrar.unhandle(this.protocol)\n\n    this.started = false\n  }\n\n  protected abstract handleProtocol (data: IncomingStreamData): Promise<void>\n}\n", "/* eslint-disable complexity */\n\nimport { serviceCapabilities, setMaxListeners } from '@libp2p/interface'\nimport { RecordEnvelope, PeerRecord } from '@libp2p/peer-record'\nimport { protocols } from '@multiformats/multiaddr'\nimport drain from 'it-drain'\nimport parallel from 'it-parallel'\nimport { pbStream } from 'it-protobuf-stream'\nimport { fromString as uint8ArrayFromString } from 'uint8arrays/from-string'\nimport { toString as uint8ArrayToString } from 'uint8arrays/to-string'\nimport {\n  MULTICODEC_IDENTIFY_PUSH_PROTOCOL_NAME,\n  MULTICODEC_IDENTIFY_PUSH_PROTOCOL_VERSION\n} from './consts.js'\nimport { Identify as IdentifyMessage } from './pb/message.js'\nimport { AbstractIdentify, consumeIdentifyMessage, defaultValues } from './utils.js'\nimport type { IdentifyPush as IdentifyPushInterface, IdentifyPushComponents, IdentifyPushInit } from './index.js'\nimport type { Stream, Startable } from '@libp2p/interface'\nimport type { ConnectionManager, IncomingStreamData } from '@libp2p/interface-internal'\n\nexport class IdentifyPush extends AbstractIdentify implements Startable, IdentifyPushInterface {\n  private readonly connectionManager: ConnectionManager\n  private readonly concurrency: number\n\n  constructor (components: IdentifyPushComponents, init: IdentifyPushInit = {}) {\n    super(components, {\n      ...init,\n      protocol: `/${init.protocolPrefix ?? defaultValues.protocolPrefix}/${MULTICODEC_IDENTIFY_PUSH_PROTOCOL_NAME}/${MULTICODEC_IDENTIFY_PUSH_PROTOCOL_VERSION}`,\n      log: components.logger.forComponent('libp2p:identify-push')\n    })\n\n    this.connectionManager = components.connectionManager\n    this.concurrency = init.concurrency ?? defaultValues.concurrency\n\n    if ((init.runOnSelfUpdate ?? defaultValues.runOnSelfUpdate)) {\n      // When self peer record changes, trigger identify-push\n      components.events.addEventListener('self:peer:update', (evt) => {\n        void this.push().catch(err => { this.log.error(err) })\n      })\n    }\n  }\n\n  [serviceCapabilities]: string[] = [\n    '@libp2p/identify-push'\n  ]\n\n  /**\n   * Calls `push` on all peer connections\n   */\n  async push (): Promise<void> {\n    // Do not try to push if we are not running\n    if (!this.isStarted()) {\n      return\n    }\n\n    const listenAddresses = this.addressManager.getAddresses().map(ma => ma.decapsulateCode(protocols('p2p').code))\n    const peerRecord = new PeerRecord({\n      peerId: this.peerId,\n      multiaddrs: listenAddresses\n    })\n    const signedPeerRecord = await RecordEnvelope.seal(peerRecord, this.privateKey)\n    const supportedProtocols = this.registrar.getProtocols()\n    const peer = await this.peerStore.get(this.peerId)\n    const agentVersion = uint8ArrayToString(peer.metadata.get('AgentVersion') ?? uint8ArrayFromString(this.host.agentVersion))\n    const protocolVersion = uint8ArrayToString(peer.metadata.get('ProtocolVersion') ?? uint8ArrayFromString(this.host.protocolVersion))\n    const self = this\n\n    async function * pushToConnections (): AsyncGenerator<() => Promise<void>> {\n      for (const connection of self.connectionManager.getConnections()) {\n        const peer = await self.peerStore.get(connection.remotePeer)\n\n        if (!peer.protocols.includes(self.protocol)) {\n          continue\n        }\n\n        yield async () => {\n          let stream: Stream | undefined\n          const signal = AbortSignal.timeout(self.timeout)\n\n          setMaxListeners(Infinity, signal)\n\n          try {\n            stream = await connection.newStream(self.protocol, {\n              signal,\n              runOnLimitedConnection: self.runOnLimitedConnection\n            })\n\n            const pb = pbStream(stream, {\n              maxDataLength: self.maxMessageSize\n            }).pb(IdentifyMessage)\n\n            await pb.write({\n              listenAddrs: listenAddresses.map(ma => ma.bytes),\n              signedPeerRecord: signedPeerRecord.marshal(),\n              protocols: supportedProtocols,\n              agentVersion,\n              protocolVersion\n            }, {\n              signal\n            })\n\n            await stream.close({\n              signal\n            })\n          } catch (err: any) {\n            // Just log errors\n            self.log.error('could not push identify update to peer', err)\n            stream?.abort(err)\n          }\n        }\n      }\n    }\n\n    await drain(parallel(pushToConnections(), {\n      concurrency: this.concurrency\n    }))\n  }\n\n  /**\n   * Reads the Identify Push message from the given `connection`\n   */\n  async handleProtocol (data: IncomingStreamData): Promise<void> {\n    const { connection, stream } = data\n\n    try {\n      if (this.peerId.equals(connection.remotePeer)) {\n        throw new Error('received push from ourselves?')\n      }\n\n      const options = {\n        signal: AbortSignal.timeout(this.timeout)\n      }\n\n      const pb = pbStream(stream, {\n        maxDataLength: this.maxMessageSize\n      }).pb(IdentifyMessage)\n\n      const message = await pb.read(options)\n      await stream.close(options)\n\n      await consumeIdentifyMessage(this.peerStore, this.events, this.log, connection, message)\n    } catch (err: any) {\n      this.log.error('received invalid message', err)\n      stream.abort(err)\n      return\n    }\n\n    this.log.trace('handled push from %p', connection.remotePeer)\n  }\n}\n", "/* eslint-disable complexity */\n\nimport { publicKeyFromProtobuf, publicKeyToProtobuf } from '@libp2p/crypto/keys'\nimport { InvalidMessageError, UnsupportedProtocolError, serviceCapabilities, setMaxListeners } from '@libp2p/interface'\nimport { peerIdFromCID } from '@libp2p/peer-id'\nimport { RecordEnvelope, PeerRecord } from '@libp2p/peer-record'\nimport { isGlobalUnicast } from '@libp2p/utils/multiaddr/is-global-unicast'\nimport { isPrivate } from '@libp2p/utils/multiaddr/is-private'\nimport { protocols } from '@multiformats/multiaddr'\nimport { IP_OR_DOMAIN, TCP } from '@multiformats/multiaddr-matcher'\nimport { pbStream } from 'it-protobuf-stream'\nimport {\n  MULTICODEC_IDENTIFY_PROTOCOL_NAME,\n  MULTICODEC_IDENTIFY_PROTOCOL_VERSION\n} from './consts.js'\nimport { Identify as IdentifyMessage } from './pb/message.js'\nimport { AbstractIdentify, consumeIdentifyMessage, defaultValues, getCleanMultiaddr } from './utils.js'\nimport type { Identify as IdentifyInterface, IdentifyComponents, IdentifyInit } from './index.js'\nimport type { IdentifyResult, AbortOptions, Connection, Stream, Startable } from '@libp2p/interface'\nimport type { IncomingStreamData } from '@libp2p/interface-internal'\n\nconst CODEC_IP6 = 0x29\n\nexport class Identify extends AbstractIdentify implements Startable, IdentifyInterface {\n  constructor (components: IdentifyComponents, init: IdentifyInit = {}) {\n    super(components, {\n      ...init,\n      protocol: `/${init.protocolPrefix ?? defaultValues.protocolPrefix}/${MULTICODEC_IDENTIFY_PROTOCOL_NAME}/${MULTICODEC_IDENTIFY_PROTOCOL_VERSION}`,\n      log: components.logger.forComponent('libp2p:identify')\n    })\n\n    if (init.runOnConnectionOpen ?? defaultValues.runOnConnectionOpen) {\n      // When a new connection happens, trigger identify\n      components.events.addEventListener('connection:open', (evt) => {\n        const connection = evt.detail\n        this.identify(connection)\n          .catch(err => {\n            if (err.name === UnsupportedProtocolError.name) {\n              // the remote did not support identify, ignore the error\n              return\n            }\n\n            this.log.error('error during identify trigged by connection:open', err)\n          })\n      })\n    }\n  }\n\n  [serviceCapabilities]: string[] = [\n    '@libp2p/identify'\n  ]\n\n  async _identify (connection: Connection, options: AbortOptions = {}): Promise<IdentifyMessage> {\n    let stream: Stream | undefined\n\n    if (options.signal == null) {\n      const signal = AbortSignal.timeout(this.timeout)\n      setMaxListeners(Infinity, signal)\n\n      options = {\n        ...options,\n        signal\n      }\n    }\n\n    try {\n      stream = await connection.newStream(this.protocol, {\n        ...options,\n        runOnLimitedConnection: this.runOnLimitedConnection\n      })\n\n      const pb = pbStream(stream, {\n        maxDataLength: this.maxMessageSize\n      }).pb(IdentifyMessage)\n\n      const message = await pb.read(options)\n\n      await stream.close(options)\n\n      return message\n    } catch (err: any) {\n      stream?.abort(err)\n      throw err\n    }\n  }\n\n  async identify (connection: Connection, options: AbortOptions = {}): Promise<IdentifyResult> {\n    const message = await this._identify(connection, options)\n    const {\n      publicKey,\n      protocols,\n      observedAddr\n    } = message\n\n    if (publicKey == null) {\n      throw new InvalidMessageError('public key was missing from identify message')\n    }\n\n    const key = publicKeyFromProtobuf(publicKey)\n    const id = peerIdFromCID(key.toCID())\n\n    if (!connection.remotePeer.equals(id)) {\n      throw new InvalidMessageError('identified peer does not match the expected peer')\n    }\n\n    if (this.peerId.equals(id)) {\n      throw new InvalidMessageError('identified peer is our own peer id?')\n    }\n\n    // if the observed address is publicly routable, add it to the address\n    // manager for verification via AutoNAT\n    this.maybeAddObservedAddress(observedAddr)\n\n    this.log('identify completed for peer %p and protocols %o', id, protocols)\n\n    return consumeIdentifyMessage(this.peerStore, this.events, this.log, connection, message)\n  }\n\n  private maybeAddObservedAddress (observedAddr: Uint8Array | undefined): void {\n    const cleanObservedAddr = getCleanMultiaddr(observedAddr)\n\n    if (cleanObservedAddr == null) {\n      return\n    }\n\n    this.log.trace('our observed address was %a', cleanObservedAddr)\n\n    if (isPrivate(cleanObservedAddr)) {\n      this.log.trace('our observed address was private')\n      return\n    }\n\n    const tuples = cleanObservedAddr.stringTuples()\n\n    if (tuples[0][0] === CODEC_IP6 && !isGlobalUnicast(cleanObservedAddr)) {\n      this.log.trace('our observed address was IPv6 but not a global unicast address')\n      return\n    }\n\n    if (TCP.exactMatch(cleanObservedAddr)) {\n      // TODO: because socket dials can't use the same local port as the TCP\n      // listener, many unique observed addresses are reported so ignore all\n      // TCP addresses until https://github.com/libp2p/js-libp2p/issues/2620\n      // is resolved\n      return\n    }\n\n    this.log.trace('storing the observed address')\n    this.addressManager.addObservedAddr(cleanObservedAddr)\n  }\n\n  /**\n   * Sends the `Identify` response with the Signed Peer Record\n   * to the requesting peer over the given `connection`\n   */\n  async handleProtocol (data: IncomingStreamData): Promise<void> {\n    const { connection, stream } = data\n\n    const signal = AbortSignal.timeout(this.timeout)\n\n    setMaxListeners(Infinity, signal)\n\n    try {\n      const peerData = await this.peerStore.get(this.peerId)\n      const multiaddrs = this.addressManager.getAddresses().map(ma => ma.decapsulateCode(protocols('p2p').code))\n      let signedPeerRecord = peerData.peerRecordEnvelope\n\n      if (multiaddrs.length > 0 && signedPeerRecord == null) {\n        const peerRecord = new PeerRecord({\n          peerId: this.peerId,\n          multiaddrs\n        })\n\n        const envelope = await RecordEnvelope.seal(peerRecord, this.privateKey)\n        signedPeerRecord = envelope.marshal().subarray()\n      }\n\n      let observedAddr: Uint8Array | undefined = connection.remoteAddr.bytes\n\n      if (!IP_OR_DOMAIN.matches(connection.remoteAddr)) {\n        observedAddr = undefined\n      }\n\n      const pb = pbStream(stream).pb(IdentifyMessage)\n\n      await pb.write({\n        protocolVersion: this.host.protocolVersion,\n        agentVersion: this.host.agentVersion,\n        publicKey: publicKeyToProtobuf(this.privateKey.publicKey),\n        listenAddrs: multiaddrs.map(addr => addr.bytes),\n        signedPeerRecord,\n        observedAddr,\n        protocols: peerData.protocols\n      }, {\n        signal\n      })\n\n      await stream.close({\n        signal\n      })\n    } catch (err: any) {\n      this.log.error('could not respond to identify request', err)\n      stream.abort(err)\n    }\n  }\n}\n", "/**\n * @packageDocumentation\n *\n * Use the `identify` function to add support for the [Identify protocol](https://github.com/libp2p/specs/blob/master/identify/README.md) to libp2p.\n *\n * This protocol allows network peers to discover the multiaddrs the current node listens on, and the protocols it supports.\n *\n * A second function, `identifyPush` is also exported to add support for [identify/push](https://github.com/libp2p/specs/blob/master/identify/README.md#identifypush).\n *\n * This protocol will send updates to all connected peers when the multiaddrs or protocols of the current node change.\n *\n * > [!TIP]\n * > For maximum network compatibility you should configure both protocols\n *\n * @example Enabling identify\n *\n * ```typescript\n * import { createLibp2p } from 'libp2p'\n * import { identify } from '@libp2p/identify'\n *\n * const node = await createLibp2p({\n *   // ...other options\n *   services: {\n *     identify: identify()\n *   }\n * })\n * ```\n *\n * @example Enabling identify push\n *\n * ```typescript\n * import { createLibp2p } from 'libp2p'\n * import { identifyPush } from '@libp2p/identify'\n *\n * const node = await createLibp2p({\n *   // ...other options\n *   services: {\n *     identifyPush: identifyPush()\n *   }\n * })\n * ```\n */\n\nimport { IdentifyPush as IdentifyPushClass } from './identify-push.js'\nimport { Identify as IdentifyClass } from './identify.js'\nimport type { AbortOptions, IdentifyResult, Libp2pEvents, ComponentLogger, NodeInfo, TypedEventTarget, PeerId, PeerStore, Connection, PrivateKey } from '@libp2p/interface'\nimport type { AddressManager, ConnectionManager, Registrar } from '@libp2p/interface-internal'\n\nexport interface IdentifyInit {\n  /**\n   * The prefix to use for the protocol\n   *\n   * @default 'ipfs'\n   */\n  protocolPrefix?: string\n\n  /**\n   * What details we should send as part of an identify message\n   */\n  agentVersion?: string\n\n  /**\n   * How long we should wait for a remote peer to send their identify response\n   *\n   * @default 5000\n   */\n  timeout?: number\n\n  /**\n   * Identify responses larger than this in bytes will be rejected\n   *\n   * @default 8192\n   */\n  maxMessageSize?: number\n\n  /**\n   * The maximum number of inbound streams that may be open on a single\n   * connection for this protocol\n   *\n   * @default 1\n   */\n  maxInboundStreams?: number\n\n  /**\n   * The maximum number of outbound streams that may be open on a single\n   * connection for this protocol\n   *\n   * @default 1\n   */\n  maxOutboundStreams?: number\n\n  /**\n   * The maximum number of observed addresses to send in an Identify message\n   */\n  maxObservedAddresses?: number\n\n  /**\n   * Whether to run on connections with data or duration limits\n   *\n   * @default true\n   */\n  runOnLimitedConnection?: boolean\n\n  /**\n   * Whether to automatically run identify on newly opened connections\n   *\n   * @default true\n   */\n  runOnConnectionOpen?: boolean\n}\n\nexport interface IdentifyPushInit extends Omit<IdentifyInit, 'runOnConnectionOpen'> {\n  /**\n   * Whether to automatically dial identify-push on self updates\n   *\n   * @default true\n   */\n  runOnSelfUpdate?: boolean\n\n  /**\n   * Push to this many connections in parallel\n   *\n   * @default 32\n   */\n  concurrency?: number\n}\n\nexport interface IdentifyComponents {\n  peerId: PeerId\n  privateKey: PrivateKey\n  peerStore: PeerStore\n  registrar: Registrar\n  addressManager: AddressManager\n  events: TypedEventTarget<Libp2pEvents>\n  logger: ComponentLogger\n  nodeInfo: NodeInfo\n}\n\nexport interface IdentifyPushComponents extends IdentifyComponents {\n  connectionManager: ConnectionManager\n}\n\nexport interface Identify {\n  /**\n   * due to the default limits on inbound/outbound streams for this protocol,\n   * invoking this method when runOnConnectionOpen is true can lead to unpredictable results\n   * as streams may be closed by the local or the remote node.\n   * Please use with caution. If you find yourself needing to call this method to discover other peers that support your protocol,\n   * you may be better off configuring a topology to be notified instead.\n   */\n  identify(connection: Connection, options?: AbortOptions): Promise<IdentifyResult>\n}\n\nexport interface IdentifyPush {\n  push(): Promise<void>\n}\n\nexport function identify (init: IdentifyInit = {}): (components: IdentifyComponents) => Identify {\n  return (components) => new IdentifyClass(components, init)\n}\n\nexport function identifyPush (init: IdentifyPushInit = {}): (components: IdentifyPushComponents) => IdentifyPush {\n  return (components) => new IdentifyPushClass(components, init)\n}\n", "import { KEEP_ALIVE } from '@libp2p/interface'\n\nexport const second = 1000\nexport const minute = 60 * second\nexport const hour = 60 * minute\n\nexport const MAX_RECORD_AGE = 36 * hour\n\nexport const PROTOCOL = '/ipfs/kad/1.0.0'\n\n/**\n * @see https://github.com/libp2p/specs/blob/master/kad-dht/README.md#content-provider-advertisement-and-discovery\n */\nexport const PROVIDERS_VALIDITY = 48 * hour\n\nexport const PROVIDERS_CLEANUP_INTERVAL = hour\n\n// Re-run the provide operation when the expiry of our provider records is within this amount\nexport const REPROVIDE_THRESHOLD = 24 * hour\n\n// How many reprovide operations to run at once\nexport const REPROVIDE_CONCURRENCY = 10\n\n// How long to let the reprovide queue grow before we wait for capacity\nexport const REPROVIDE_MAX_QUEUE_SIZE = 16_384\n\n// How often to check if records need reproviding\nexport const REPROVIDE_INTERVAL = hour\n\nexport const READ_MESSAGE_TIMEOUT = 10 * second\n\n// The number of records that will be retrieved on a call to getMany()\nexport const GET_MANY_RECORD_COUNT = 16\n\n// K is the maximum number of requests to perform before returning failure\nexport const K = 20\n\n// Alpha is the concurrency for asynchronous requests\nexport const ALPHA = 3\n\n// How often we look for our closest DHT neighbours\nexport const QUERY_SELF_INTERVAL = 5 * minute\n\n// How often we look for the first set of our closest DHT neighbours\nexport const QUERY_SELF_INITIAL_INTERVAL = second\n\n// How long to look for our closest DHT neighbours for\nexport const QUERY_SELF_TIMEOUT = 5 * second\n\n// How often we try to find new peers\nexport const TABLE_REFRESH_INTERVAL = 5 * minute\n\n// How how long to look for new peers for\nexport const TABLE_REFRESH_QUERY_TIMEOUT = 30 * second\n\n// When a timeout is not specified, run a query for this long\nexport const DEFAULT_QUERY_TIMEOUT = 180 * second\n\n// used to ensure connections to our closest peers remain open\nexport const KEEP_ALIVE_TAG = `${KEEP_ALIVE}-kad-dht`\n", "/* eslint-disable import/export */\n/* eslint-disable complexity */\n/* eslint-disable @typescript-eslint/no-namespace */\n/* eslint-disable @typescript-eslint/no-unnecessary-boolean-literal-compare */\n/* eslint-disable @typescript-eslint/no-empty-interface */\n\nimport { type Codec, decodeMessage, type DecodeOptions, encodeMessage, message } from 'protons-runtime'\nimport { alloc as uint8ArrayAlloc } from 'uint8arrays/alloc'\nimport type { Uint8ArrayList } from 'uint8arraylist'\n\nexport interface Record {\n  key: Uint8Array\n  value: Uint8Array\n  timeReceived: string\n}\n\nexport namespace Record {\n  let _codec: Codec<Record>\n\n  export const codec = (): Codec<Record> => {\n    if (_codec == null) {\n      _codec = message<Record>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if ((obj.key != null && obj.key.byteLength > 0)) {\n          w.uint32(10)\n          w.bytes(obj.key)\n        }\n\n        if ((obj.value != null && obj.value.byteLength > 0)) {\n          w.uint32(18)\n          w.bytes(obj.value)\n        }\n\n        if ((obj.timeReceived != null && obj.timeReceived !== '')) {\n          w.uint32(42)\n          w.string(obj.timeReceived)\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {\n          key: uint8ArrayAlloc(0),\n          value: uint8ArrayAlloc(0),\n          timeReceived: ''\n        }\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.key = reader.bytes()\n              break\n            }\n            case 2: {\n              obj.value = reader.bytes()\n              break\n            }\n            case 5: {\n              obj.timeReceived = reader.string()\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<Record>): Uint8Array => {\n    return encodeMessage(obj, Record.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<Record>): Record => {\n    return decodeMessage(buf, Record.codec(), opts)\n  }\n}\n", "/**\n * Convert a JavaScript date into an `RFC3339Nano` formatted\n * string\n */\nexport function toRFC3339 (time: Date): string {\n  const year = time.getUTCFullYear()\n  const month = String(time.getUTCMonth() + 1).padStart(2, '0')\n  const day = String(time.getUTCDate()).padStart(2, '0')\n  const hour = String(time.getUTCHours()).padStart(2, '0')\n  const minute = String(time.getUTCMinutes()).padStart(2, '0')\n  const seconds = String(time.getUTCSeconds()).padStart(2, '0')\n  const milliseconds = time.getUTCMilliseconds()\n  const nanoseconds = String(milliseconds * 1000 * 1000).padStart(9, '0')\n\n  return `${year}-${month}-${day}T${hour}:${minute}:${seconds}.${nanoseconds}Z`\n}\n\n/**\n * Parses a date string formatted as `RFC3339Nano` into a\n * JavaScript Date object\n */\nexport function parseRFC3339 (time: string): Date {\n  const rfc3339Matcher = new RegExp(\n    // 2006-01-02T\n    '(\\\\d{4})-(\\\\d{2})-(\\\\d{2})T' +\n    // 15:04:05\n    '(\\\\d{2}):(\\\\d{2}):(\\\\d{2})' +\n    // .999999999Z\n    '\\\\.(\\\\d+)Z'\n  )\n  const m = String(time).trim().match(rfc3339Matcher)\n\n  if (m == null) {\n    throw new Error('Invalid format')\n  }\n\n  const year = parseInt(m[1], 10)\n  const month = parseInt(m[2], 10) - 1\n  const date = parseInt(m[3], 10)\n  const hour = parseInt(m[4], 10)\n  const minute = parseInt(m[5], 10)\n  const second = parseInt(m[6], 10)\n  const millisecond = parseInt(m[7].slice(0, -6), 10)\n\n  return new Date(Date.UTC(year, month, date, hour, minute, second, millisecond))\n}\n", "/**\n * @packageDocumentation\n *\n * This is an implementation of the [routing record format](https://github.com/libp2p/specs/blob/b9efe152c29f93f7a87931c14d78ae11e7924d5a/kad-dht/README.md?plain=1#L408-L425) used by libp2p to store data in the datastore passed to the libp2p constructor.\n *\n * @example Deserialization\n *\n * ```TypeScript\n * import { Libp2pRecord } from '@libp2p/record'\n *\n * const buf = Uint8Array.from([0, 1, 2, 3])\n * const record = Libp2pRecord.deserialize(buf)\n * ```\n *\n * @example Serialization\n *\n * ```TypeScript\n * import { Libp2pRecord } from '@libp2p/record'\n *\n * const key = Uint8Array.from([0, 1, 2, 3])\n * const value = Uint8Array.from([0, 1, 2, 3])\n * const timeReceived = new Date()\n *\n * const record = new Libp2pRecord(key, value, timeReceived)\n * const buf = record.serialize()\n * ```\n */\n\nimport {\n  Record\n} from './record.js'\nimport * as utils from './utils.js'\nimport type { Uint8ArrayList } from 'uint8arraylist'\n\nexport class Libp2pRecord {\n  public key: Uint8Array\n  public value: Uint8Array\n  public timeReceived: Date\n\n  constructor (key: Uint8Array, value: Uint8Array, timeReceived: Date) {\n    if (!(key instanceof Uint8Array)) {\n      throw new Error('key must be a Uint8Array')\n    }\n\n    if (!(value instanceof Uint8Array)) {\n      throw new Error('value must be a Uint8Array')\n    }\n\n    this.key = key\n    this.value = value\n    this.timeReceived = timeReceived\n  }\n\n  serialize (): Uint8Array {\n    return Record.encode(this.prepareSerialize())\n  }\n\n  /**\n   * Return the object format ready to be given to the protobuf library.\n   */\n  prepareSerialize (): Record {\n    return {\n      key: this.key,\n      value: this.value,\n      timeReceived: utils.toRFC3339(this.timeReceived)\n    }\n  }\n\n  /**\n   * Decode a protobuf encoded record\n   */\n  static deserialize (raw: Uint8Array | Uint8ArrayList): Libp2pRecord {\n    const rec = Record.decode(raw)\n\n    return new Libp2pRecord(rec.key, rec.value, new Date(rec.timeReceived))\n  }\n\n  /**\n   * Create a record from the raw object returned from the protobuf library\n   */\n  static fromDeserialized (obj: Record): Libp2pRecord {\n    const recvtime = utils.parseRFC3339(obj.timeReceived)\n\n    if (obj.key == null) {\n      throw new Error('key missing from deserialized object')\n    }\n\n    if (obj.value == null) {\n      throw new Error('value missing from deserialized object')\n    }\n\n    const rec = new Libp2pRecord(\n      obj.key, obj.value, recvtime\n    )\n\n    return rec\n  }\n}\n", "/**\n * An error occurred during a query\n */\nexport class QueryError extends Error {\n  constructor (message = 'Query error') {\n    super(message)\n    this.name = 'QueryError'\n  }\n}\n\n/**\n * A query was aborted\n */\nexport class QueryAbortedError extends Error {\n  constructor (message = 'Query aborted') {\n    super(message)\n    this.name = 'QueryAbortedError'\n  }\n}\n\n/**\n * An invalid record was received\n */\nexport class InvalidRecordError extends Error {\n  constructor (message = 'Invalid record') {\n    super(message)\n    this.name = 'InvalidRecordError'\n  }\n}\n\n/**\n * A selector function was missing\n */\nexport class MissingSelectorError extends Error {\n  constructor (message = 'No selector function configured for prefix') {\n    super(message)\n    this.name = 'MissingSelectorError'\n  }\n}\n", "/* eslint-disable import/export */\n/* eslint-disable complexity */\n/* eslint-disable @typescript-eslint/no-namespace */\n/* eslint-disable @typescript-eslint/no-unnecessary-boolean-literal-compare */\n/* eslint-disable @typescript-eslint/no-empty-interface */\n\nimport { type Codec, decodeMessage, type DecodeOptions, encodeMessage, enumeration, MaxLengthError, message } from 'protons-runtime'\nimport { alloc as uint8ArrayAlloc } from 'uint8arrays/alloc'\nimport type { Uint8ArrayList } from 'uint8arraylist'\n\nexport interface Record {\n  key?: Uint8Array\n  value?: Uint8Array\n  author?: Uint8Array\n  signature?: Uint8Array\n  timeReceived?: string\n}\n\nexport namespace Record {\n  let _codec: Codec<Record>\n\n  export const codec = (): Codec<Record> => {\n    if (_codec == null) {\n      _codec = message<Record>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if (obj.key != null) {\n          w.uint32(10)\n          w.bytes(obj.key)\n        }\n\n        if (obj.value != null) {\n          w.uint32(18)\n          w.bytes(obj.value)\n        }\n\n        if (obj.author != null) {\n          w.uint32(26)\n          w.bytes(obj.author)\n        }\n\n        if (obj.signature != null) {\n          w.uint32(34)\n          w.bytes(obj.signature)\n        }\n\n        if (obj.timeReceived != null) {\n          w.uint32(42)\n          w.string(obj.timeReceived)\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {}\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.key = reader.bytes()\n              break\n            }\n            case 2: {\n              obj.value = reader.bytes()\n              break\n            }\n            case 3: {\n              obj.author = reader.bytes()\n              break\n            }\n            case 4: {\n              obj.signature = reader.bytes()\n              break\n            }\n            case 5: {\n              obj.timeReceived = reader.string()\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<Record>): Uint8Array => {\n    return encodeMessage(obj, Record.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<Record>): Record => {\n    return decodeMessage(buf, Record.codec(), opts)\n  }\n}\n\nexport enum MessageType {\n  PUT_VALUE = 'PUT_VALUE',\n  GET_VALUE = 'GET_VALUE',\n  ADD_PROVIDER = 'ADD_PROVIDER',\n  GET_PROVIDERS = 'GET_PROVIDERS',\n  FIND_NODE = 'FIND_NODE',\n  PING = 'PING'\n}\n\nenum __MessageTypeValues {\n  PUT_VALUE = 0,\n  GET_VALUE = 1,\n  ADD_PROVIDER = 2,\n  GET_PROVIDERS = 3,\n  FIND_NODE = 4,\n  PING = 5\n}\n\nexport namespace MessageType {\n  export const codec = (): Codec<MessageType> => {\n    return enumeration<MessageType>(__MessageTypeValues)\n  }\n}\nexport enum ConnectionType {\n  NOT_CONNECTED = 'NOT_CONNECTED',\n  CONNECTED = 'CONNECTED',\n  CAN_CONNECT = 'CAN_CONNECT',\n  CANNOT_CONNECT = 'CANNOT_CONNECT'\n}\n\nenum __ConnectionTypeValues {\n  NOT_CONNECTED = 0,\n  CONNECTED = 1,\n  CAN_CONNECT = 2,\n  CANNOT_CONNECT = 3\n}\n\nexport namespace ConnectionType {\n  export const codec = (): Codec<ConnectionType> => {\n    return enumeration<ConnectionType>(__ConnectionTypeValues)\n  }\n}\nexport interface PeerInfo {\n  id: Uint8Array\n  multiaddrs: Uint8Array[]\n  connection?: ConnectionType\n}\n\nexport namespace PeerInfo {\n  let _codec: Codec<PeerInfo>\n\n  export const codec = (): Codec<PeerInfo> => {\n    if (_codec == null) {\n      _codec = message<PeerInfo>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if ((obj.id != null && obj.id.byteLength > 0)) {\n          w.uint32(10)\n          w.bytes(obj.id)\n        }\n\n        if (obj.multiaddrs != null) {\n          for (const value of obj.multiaddrs) {\n            w.uint32(18)\n            w.bytes(value)\n          }\n        }\n\n        if (obj.connection != null) {\n          w.uint32(24)\n          ConnectionType.codec().encode(obj.connection, w)\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {\n          id: uint8ArrayAlloc(0),\n          multiaddrs: []\n        }\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.id = reader.bytes()\n              break\n            }\n            case 2: {\n              if (opts.limits?.multiaddrs != null && obj.multiaddrs.length === opts.limits.multiaddrs) {\n                throw new MaxLengthError('Decode error - map field \"multiaddrs\" had too many elements')\n              }\n\n              obj.multiaddrs.push(reader.bytes())\n              break\n            }\n            case 3: {\n              obj.connection = ConnectionType.codec().decode(reader)\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<PeerInfo>): Uint8Array => {\n    return encodeMessage(obj, PeerInfo.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<PeerInfo>): PeerInfo => {\n    return decodeMessage(buf, PeerInfo.codec(), opts)\n  }\n}\n\nexport interface Message {\n  type: MessageType\n  clusterLevel?: number\n  key?: Uint8Array\n  record?: Uint8Array\n  closer: PeerInfo[]\n  providers: PeerInfo[]\n}\n\nexport namespace Message {\n  let _codec: Codec<Message>\n\n  export const codec = (): Codec<Message> => {\n    if (_codec == null) {\n      _codec = message<Message>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if (obj.type != null && __MessageTypeValues[obj.type] !== 0) {\n          w.uint32(8)\n          MessageType.codec().encode(obj.type, w)\n        }\n\n        if (obj.clusterLevel != null) {\n          w.uint32(80)\n          w.int32(obj.clusterLevel)\n        }\n\n        if (obj.key != null) {\n          w.uint32(18)\n          w.bytes(obj.key)\n        }\n\n        if (obj.record != null) {\n          w.uint32(26)\n          w.bytes(obj.record)\n        }\n\n        if (obj.closer != null) {\n          for (const value of obj.closer) {\n            w.uint32(66)\n            PeerInfo.codec().encode(value, w)\n          }\n        }\n\n        if (obj.providers != null) {\n          for (const value of obj.providers) {\n            w.uint32(74)\n            PeerInfo.codec().encode(value, w)\n          }\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {\n          type: MessageType.PUT_VALUE,\n          closer: [],\n          providers: []\n        }\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.type = MessageType.codec().decode(reader)\n              break\n            }\n            case 10: {\n              obj.clusterLevel = reader.int32()\n              break\n            }\n            case 2: {\n              obj.key = reader.bytes()\n              break\n            }\n            case 3: {\n              obj.record = reader.bytes()\n              break\n            }\n            case 8: {\n              if (opts.limits?.closer != null && obj.closer.length === opts.limits.closer) {\n                throw new MaxLengthError('Decode error - map field \"closer\" had too many elements')\n              }\n\n              obj.closer.push(PeerInfo.codec().decode(reader, reader.uint32(), {\n                limits: opts.limits?.closer$\n              }))\n              break\n            }\n            case 9: {\n              if (opts.limits?.providers != null && obj.providers.length === opts.limits.providers) {\n                throw new MaxLengthError('Decode error - map field \"providers\" had too many elements')\n              }\n\n              obj.providers.push(PeerInfo.codec().decode(reader, reader.uint32(), {\n                limits: opts.limits?.providers$\n              }))\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<Message>): Uint8Array => {\n    return encodeMessage(obj, Message.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<Message>): Message => {\n    return decodeMessage(buf, Message.codec(), opts)\n  }\n}\n", "import type { MessageType, SendQueryEvent, PeerResponseEvent, DialPeerEvent, AddPeerEvent, ValueEvent, ProviderEvent, QueryErrorEvent, FinalPeerEvent } from '../index.js'\nimport type { PeerId, PeerInfo } from '@libp2p/interface'\nimport type { Libp2pRecord } from '@libp2p/record'\nimport type { ProgressOptions } from 'progress-events'\n\nexport interface QueryEventFields {\n  to: PeerId\n  type: MessageType\n}\n\nexport function sendQueryEvent (fields: QueryEventFields, options: ProgressOptions = {}): SendQueryEvent {\n  const event: SendQueryEvent = {\n    ...fields,\n    name: 'SEND_QUERY',\n    type: 0,\n    messageName: fields.type,\n    messageType: fields.type\n  }\n\n  options.onProgress?.(new CustomEvent('kad-dht:query:send-query', { detail: event }))\n\n  return event\n}\n\nexport interface PeerResponseEventFields {\n  from: PeerId\n  messageType: MessageType\n  closer?: PeerInfo[]\n  providers?: PeerInfo[]\n  record?: Libp2pRecord\n}\n\nexport function peerResponseEvent (fields: PeerResponseEventFields, options: ProgressOptions = {}): PeerResponseEvent {\n  const event: PeerResponseEvent = {\n    ...fields,\n    name: 'PEER_RESPONSE',\n    type: 1,\n    messageName: fields.messageType,\n    closer: fields.closer ?? [],\n    providers: fields.providers ?? []\n  }\n\n  options.onProgress?.(new CustomEvent('kad-dht:query:peer-response', { detail: event }))\n\n  return event\n}\n\nexport interface FinalPeerEventFields {\n  from: PeerId\n  peer: PeerInfo\n}\n\nexport function finalPeerEvent (fields: FinalPeerEventFields, options: ProgressOptions = {}): FinalPeerEvent {\n  const event: FinalPeerEvent = {\n    ...fields,\n    name: 'FINAL_PEER',\n    type: 2\n  }\n\n  options.onProgress?.(new CustomEvent('kad-dht:query:final-peer', { detail: event }))\n\n  return event\n}\n\nexport interface ErrorEventFields {\n  from: PeerId\n  error: Error\n}\n\nexport function queryErrorEvent (fields: ErrorEventFields, options: ProgressOptions = {}): QueryErrorEvent {\n  const event: QueryErrorEvent = {\n    ...fields,\n    name: 'QUERY_ERROR',\n    type: 3\n  }\n\n  options.onProgress?.(new CustomEvent('kad-dht:query:query-error', { detail: event }))\n\n  return event\n}\n\nexport interface ProviderEventFields {\n  from: PeerId\n  providers: PeerInfo[]\n}\n\nexport function providerEvent (fields: ProviderEventFields, options: ProgressOptions = {}): ProviderEvent {\n  const event: ProviderEvent = {\n    ...fields,\n    name: 'PROVIDER',\n    type: 4\n  }\n\n  options.onProgress?.(new CustomEvent('kad-dht:query:provider', { detail: event }))\n\n  return event\n}\n\nexport interface ValueEventFields {\n  from: PeerId\n  value: Uint8Array\n}\n\nexport function valueEvent (fields: ValueEventFields, options: ProgressOptions = {}): ValueEvent {\n  const event: ValueEvent = {\n    ...fields,\n    name: 'VALUE',\n    type: 5\n  }\n\n  options.onProgress?.(new CustomEvent('kad-dht:query:value', { detail: event }))\n\n  return event\n}\n\nexport interface PeerEventFields {\n  peer: PeerId\n}\n\nexport function addPeerEvent (fields: PeerEventFields, options: ProgressOptions = {}): AddPeerEvent {\n  const event: AddPeerEvent = {\n    ...fields,\n    name: 'ADD_PEER',\n    type: 6\n  }\n\n  options.onProgress?.(new CustomEvent('kad-dht:query:add-peer', { detail: event }))\n\n  return event\n}\n\nexport interface DialPeerEventFields {\n  peer: PeerId\n}\n\nexport function dialPeerEvent (fields: DialPeerEventFields, options: ProgressOptions = {}): DialPeerEvent {\n  const event: DialPeerEvent = {\n    ...fields,\n    name: 'DIAL_PEER',\n    type: 7\n  }\n\n  options.onProgress?.(new CustomEvent('kad-dht:query:dial-peer', { detail: event }))\n\n  return event\n}\n", "import { InvalidParametersError } from '@libp2p/interface'\nimport { toString as uint8ArrayToString } from 'uint8arrays/to-string'\nimport { MissingSelectorError } from '../errors.js'\nimport type { Selectors } from '../index.js'\n\n/**\n * Select the best record out of the given records\n */\nexport function bestRecord (selectors: Selectors, k: Uint8Array, records: Uint8Array[]): number {\n  if (records.length === 0) {\n    throw new InvalidParametersError('No records given')\n  }\n\n  const kStr = uint8ArrayToString(k)\n  const parts = kStr.split('/')\n\n  if (parts.length < 3) {\n    throw new InvalidParametersError('Record key does not have a selector function')\n  }\n\n  const selector = selectors[parts[1].toString()]\n\n  if (selector == null) {\n    throw new MissingSelectorError(`No selector function configured for key type \"${parts[1]}\"`)\n  }\n\n  if (records.length === 1) {\n    return 0\n  }\n\n  return selector(k, records)\n}\n\n/**\n * Best record selector, for public key records.\n * Simply returns the first record, as all valid public key\n * records are equal\n */\nfunction publickKey (k: Uint8Array, records: Uint8Array[]): number {\n  return 0\n}\n\nexport const selectors: Selectors = {\n  pk: publickKey\n}\n", "import { publicKeyFromProtobuf } from '@libp2p/crypto/keys'\nimport { InvalidParametersError } from '@libp2p/interface'\nimport { equals as uint8ArrayEquals } from 'uint8arrays/equals'\nimport { toString as uint8ArrayToString } from 'uint8arrays/to-string'\nimport type { Validators } from '../index.js'\nimport type { Libp2pRecord } from '@libp2p/record'\n\n/**\n * Checks a record and ensures it is still valid.\n * It runs the needed validators.\n * If verification fails the returned Promise will reject with the error.\n */\nexport async function verifyRecord (validators: Validators, record: Libp2pRecord): Promise<void> {\n  const key = record.key\n  const keyString = uint8ArrayToString(key)\n  const parts = keyString.split('/')\n\n  if (parts.length < 3) {\n    // No validator available\n    return\n  }\n\n  const validator = validators[parts[1].toString()]\n\n  if (validator == null) {\n    throw new InvalidParametersError(`No validator available for key type \"${parts[1]}\"`)\n  }\n\n  await validator(key, record.value)\n}\n\n/**\n * Validator for public key records.\n * Verifies that the passed in record value is the PublicKey\n * that matches the passed in key.\n * If validation fails the returned Promise will reject with the error.\n *\n * @param {Uint8Array} key - A valid key is of the form `'/pk/<keymultihash>'`\n * @param {Uint8Array} publicKey - The public key to validate against (protobuf encoded).\n */\nconst validatePublicKeyRecord = async (key: Uint8Array, publicKey: Uint8Array): Promise<void> => {\n  if (!(key instanceof Uint8Array)) {\n    throw new InvalidParametersError('\"key\" must be a Uint8Array')\n  }\n\n  if (key.byteLength < 5) {\n    throw new InvalidParametersError('Invalid public key record')\n  }\n\n  const prefix = uint8ArrayToString(key.subarray(0, 4))\n\n  if (prefix !== '/pk/') {\n    throw new InvalidParametersError('key was not prefixed with /pk/')\n  }\n\n  const pubKey = publicKeyFromProtobuf(publicKey)\n  const keyhash = key.slice(4)\n\n  if (!uint8ArrayEquals(keyhash, pubKey.toMultihash().bytes)) {\n    throw new InvalidParametersError('public key does not match passed in key')\n  }\n}\n\nexport const validators: Validators = {\n  pk: validatePublicKeyRecord\n}\n", "import { peerIdFromMultihash, peerIdFromString } from '@libp2p/peer-id'\nimport { Libp2pRecord } from '@libp2p/record'\nimport { isPrivateIp } from '@libp2p/utils/private-ip'\nimport { Key } from 'interface-datastore/key'\nimport { CID } from 'multiformats/cid'\nimport * as raw from 'multiformats/codecs/raw'\nimport * as Digest from 'multiformats/hashes/digest'\nimport { sha256 } from 'multiformats/hashes/sha2'\nimport * as varint from 'uint8-varint'\nimport { concat as uint8ArrayConcat } from 'uint8arrays/concat'\nimport { fromString as uint8ArrayFromString } from 'uint8arrays/from-string'\nimport { toString as uint8ArrayToString } from 'uint8arrays/to-string'\nimport type { Operation, OperationMetrics } from './kad-dht.js'\nimport type { PeerId, PeerInfo } from '@libp2p/interface'\nimport type { Multiaddr } from '@multiformats/multiaddr'\n\n// const IPNS_PREFIX = uint8ArrayFromString('/ipns/')\nconst PK_PREFIX = uint8ArrayFromString('/pk/')\n\nexport function removePrivateAddressesMapper (peer: PeerInfo): PeerInfo {\n  return {\n    ...peer,\n    multiaddrs: peer.multiaddrs.filter(multiaddr => {\n      const [[type, addr]] = multiaddr.stringTuples()\n\n      // treat /dns, /dns4, and /dns6 addrs as public\n      if (type === 53 || type === 54 || type === 55) {\n        // localhost can be a dns address but it's private\n        if (addr === 'localhost') {\n          return false\n        }\n\n        return true\n      }\n\n      if (type !== 4 && type !== 6) {\n        return false\n      }\n\n      if (addr == null) {\n        return false\n      }\n\n      const isPrivate = isPrivateIp(addr)\n\n      if (isPrivate == null) {\n        // not an ip address\n        return true\n      }\n\n      return !isPrivate\n    })\n  }\n}\n\nexport function removePublicAddressesMapper (peer: PeerInfo): PeerInfo {\n  return {\n    ...peer,\n    multiaddrs: peer.multiaddrs.filter(multiaddr => {\n      const [[type, addr]] = multiaddr.stringTuples()\n\n      if (addr === 'localhost') {\n        return true\n      }\n\n      if (type !== 4 && type !== 6) {\n        return false\n      }\n\n      if (addr == null) {\n        return false\n      }\n\n      const isPrivate = isPrivateIp(addr)\n\n      if (isPrivate == null) {\n        // not an ip address\n        return false\n      }\n\n      return isPrivate\n    })\n  }\n}\n\nexport function passthroughMapper (info: PeerInfo): PeerInfo {\n  return info\n}\n\n/**\n * Creates a DHT ID by hashing a given Uint8Array\n */\nexport async function convertBuffer (buf: Uint8Array): Promise<Uint8Array> {\n  const multihash = await sha256.digest(buf)\n\n  return multihash.digest\n}\n\n/**\n * Creates a DHT ID by hashing a Peer ID\n */\nexport async function convertPeerId (peerId: PeerId): Promise<Uint8Array> {\n  return convertBuffer(peerId.toMultihash().bytes)\n}\n\n/**\n * Convert a Uint8Array to their SHA2-256 hash\n */\nexport function bufferToKey (buf: Uint8Array): Key {\n  return new Key('/' + uint8ArrayToString(buf, 'base32'), false)\n}\n\n/**\n * Convert a Uint8Array to their SHA2-256 hash\n */\nexport function bufferToRecordKey (prefix: string, buf: Uint8Array): Key {\n  return new Key(`${prefix}/${uint8ArrayToString(buf, 'base32')}`, false)\n}\n\n/**\n * Generate the key for a public key.\n */\nexport function keyForPublicKey (peerId: PeerId): Uint8Array {\n  return uint8ArrayConcat([\n    PK_PREFIX,\n    peerId.toMultihash().bytes\n  ])\n}\n\nexport function isPublicKeyKey (key: Uint8Array): boolean {\n  return uint8ArrayToString(key.subarray(0, 4)) === '/pk/'\n}\n\nexport function isIPNSKey (key: Uint8Array): boolean {\n  return uint8ArrayToString(key.subarray(0, 4)) === '/ipns/'\n}\n\nexport function fromPublicKeyKey (key: Uint8Array): PeerId {\n  const multihash = Digest.decode(key.subarray(4))\n  return peerIdFromMultihash(multihash)\n}\n\n/**\n * Create a new put record, encodes and signs it if enabled\n */\nexport function createPutRecord (key: Uint8Array, value: Uint8Array): Uint8Array {\n  const timeReceived = new Date()\n  const rec = new Libp2pRecord(key, value, timeReceived)\n\n  return rec.serialize()\n}\n\nexport function debounce (callback: () => void, wait: number = 100): () => void {\n  let timeout: ReturnType<typeof setTimeout>\n\n  return (): void => {\n    clearTimeout(timeout)\n    timeout = setTimeout(() => { callback() }, wait)\n  }\n}\n\n// see https://github.com/multiformats/multiaddr/blob/master/protocols.csv\nconst P2P_CIRCUIT_CODE = 290\nconst DNS4_CODE = 54\nconst DNS6_CODE = 55\nconst DNSADDR_CODE = 56\nconst IP4_CODE = 4\nconst IP6_CODE = 41\n\nexport function multiaddrIsPublic (multiaddr: Multiaddr): boolean {\n  const tuples = multiaddr.stringTuples()\n\n  // p2p-circuit should not enable server mode\n  for (const tuple of tuples) {\n    if (tuple[0] === P2P_CIRCUIT_CODE) {\n      return false\n    }\n  }\n\n  // dns4 or dns6 or dnsaddr\n  if (tuples[0][0] === DNS4_CODE || tuples[0][0] === DNS6_CODE || tuples[0][0] === DNSADDR_CODE) {\n    return true\n  }\n\n  // ip4 or ip6\n  if (tuples[0][0] === IP4_CODE || tuples[0][0] === IP6_CODE) {\n    const result = isPrivateIp(`${tuples[0][1]}`)\n    const isPublic = result == null || !result\n\n    return isPublic\n  }\n\n  return false\n}\n\n/**\n * Parse the CID and provider peer id from the key\n */\nexport function parseProviderKey (key: Key): { cid: CID, peerId: PeerId } {\n  const parts = key.toString().split('/')\n  const peerIdStr = parts.pop()\n  const cidStr = parts.pop()\n\n  if (peerIdStr == null || cidStr == null) {\n    throw new Error(`incorrectly formatted provider entry key in datastore: ${key.toString()}`)\n  }\n\n  return {\n    cid: CID.createV1(raw.code, Digest.decode(uint8ArrayFromString(cidStr, 'base32'))),\n    peerId: peerIdFromString(peerIdStr)\n  }\n}\n\n/**\n * Encode the given key its matching datastore key\n */\nexport function toProviderKey (prefix: string, cid: CID | string, peerId?: PeerId): Key {\n  const cidStr = typeof cid === 'string' ? cid : uint8ArrayToString(cid.multihash.bytes, 'base32')\n\n  const parts = [\n    prefix,\n    cidStr\n  ]\n\n  if (peerId != null) {\n    parts.push(peerId.toString())\n  }\n\n  return new Key(parts.join('/'))\n}\n\nexport function readProviderTime (buf: Uint8Array): Date {\n  return new Date(varint.decode(buf))\n}\n\n/**\n * Wraps the passed generator function with timing metrics\n */\nexport function timeOperationGenerator (fn: (...args: any[]) => AsyncGenerator<any>, operationMetrics: OperationMetrics, type: Operation): (...args: any[]) => AsyncGenerator<any> {\n  return async function * (...args: any[]): AsyncGenerator<any> {\n    const stopSuccessTimer = operationMetrics.queryTime?.timer(type)\n    const stopErrorTimer = operationMetrics.errorTime?.timer(type)\n    let errored = false\n\n    try {\n      operationMetrics.queries?.increment({ [type]: true })\n\n      yield * fn(...args)\n    } catch (err) {\n      errored = true\n      stopErrorTimer?.()\n      operationMetrics.errors?.increment({ [type]: true })\n\n      throw err\n    } finally {\n      operationMetrics.queries?.decrement({ [type]: true })\n\n      if (!errored) {\n        stopSuccessTimer?.()\n      }\n    }\n  }\n}\n\nexport function timeOperationMethod (fn: (...args: any[]) => Promise<any>, operationMetrics: OperationMetrics, type: Operation): (...args: any[]) => Promise<any> {\n  return async function (...args: any[]): Promise<any> {\n    const stopSuccessTimer = operationMetrics?.queryTime?.timer(type)\n    const stopErrorTimer = operationMetrics?.errorTime?.timer(type)\n    let errored = false\n\n    try {\n      operationMetrics.queries?.increment({ [type]: true })\n\n      return await fn(...args)\n    } catch (err) {\n      errored = true\n      stopErrorTimer?.()\n      operationMetrics.errors?.increment({ [type]: true })\n\n      throw err\n    } finally {\n      operationMetrics.queries?.decrement({ [type]: true })\n\n      if (!errored) {\n        stopSuccessTimer?.()\n      }\n    }\n  }\n}\n", "import { NotFoundError } from '@libp2p/interface'\nimport { Libp2pRecord } from '@libp2p/record'\nimport map from 'it-map'\nimport parallel from 'it-parallel'\nimport { pipe } from 'it-pipe'\nimport { equals as uint8ArrayEquals } from 'uint8arrays/equals'\nimport {\n  ALPHA\n} from '../constants.js'\nimport { QueryError } from '../errors.js'\nimport { MessageType } from '../message/dht.js'\nimport {\n  valueEvent,\n  queryErrorEvent\n} from '../query/events.js'\nimport { bestRecord } from '../record/selectors.js'\nimport { verifyRecord } from '../record/validators.js'\nimport { createPutRecord, bufferToRecordKey } from '../utils.js'\nimport type { KadDHTComponents, Validators, Selectors, ValueEvent, QueryEvent } from '../index.js'\nimport type { Message } from '../message/dht.js'\nimport type { Network } from '../network.js'\nimport type { PeerRouting } from '../peer-routing/index.js'\nimport type { QueryManager } from '../query/manager.js'\nimport type { QueryFunc } from '../query/types.js'\nimport type { Logger, RoutingOptions } from '@libp2p/interface'\n\nexport interface ContentFetchingInit {\n  validators: Validators\n  selectors: Selectors\n  peerRouting: PeerRouting\n  queryManager: QueryManager\n  network: Network\n  logPrefix: string\n  datastorePrefix: string\n}\n\nexport class ContentFetching {\n  private readonly log: Logger\n  private readonly components: KadDHTComponents\n  private readonly validators: Validators\n  private readonly selectors: Selectors\n  private readonly peerRouting: PeerRouting\n  private readonly queryManager: QueryManager\n  private readonly network: Network\n  private readonly datastorePrefix: string\n\n  constructor (components: KadDHTComponents, init: ContentFetchingInit) {\n    const { validators, selectors, peerRouting, queryManager, network, logPrefix } = init\n\n    this.components = components\n    this.log = components.logger.forComponent(`${logPrefix}:content-fetching`)\n    this.datastorePrefix = `${init.datastorePrefix}/record`\n    this.validators = validators\n    this.selectors = selectors\n    this.peerRouting = peerRouting\n    this.queryManager = queryManager\n    this.network = network\n\n    this.get = components.metrics?.traceFunction('libp2p.kadDHT.get', this.get.bind(this), {\n      optionsIndex: 1\n    }) ?? this.get\n    this.put = components.metrics?.traceFunction('libp2p.kadDHT.put', this.put.bind(this), {\n      optionsIndex: 2\n    }) ?? this.put\n  }\n\n  /**\n   * Attempt to retrieve the value for the given key from\n   * the local datastore\n   */\n  async getLocal (key: Uint8Array): Promise<Libp2pRecord> {\n    this.log('getLocal %b', key)\n\n    const dsKey = bufferToRecordKey(this.datastorePrefix, key)\n\n    this.log('fetching record for key %k', dsKey)\n\n    const raw = await this.components.datastore.get(dsKey)\n    this.log('found %k in local datastore', dsKey)\n\n    const rec = Libp2pRecord.deserialize(raw)\n\n    await verifyRecord(this.validators, rec)\n\n    return rec\n  }\n\n  /**\n   * Send the best record found to any peers that have an out of date record\n   */\n  async * sendCorrectionRecord (key: Uint8Array, vals: ValueEvent[], best: Uint8Array, options: RoutingOptions = {}): AsyncGenerator<QueryEvent> {\n    this.log('sendCorrection for %b', key)\n    const fixupRec = createPutRecord(key, best)\n\n    for (const { value, from } of vals) {\n      // no need to do anything\n      if (uint8ArrayEquals(value, best)) {\n        this.log('record was ok')\n        continue\n      }\n\n      // correct ourself\n      if (this.components.peerId.equals(from)) {\n        try {\n          const dsKey = bufferToRecordKey(this.datastorePrefix, key)\n          this.log(`Storing corrected record for key ${dsKey.toString()}`)\n          await this.components.datastore.put(dsKey, fixupRec.subarray())\n        } catch (err: any) {\n          this.log.error('Failed error correcting self', err)\n        }\n\n        continue\n      }\n\n      // send correction\n      let sentCorrection = false\n      const request: Partial<Message> = {\n        type: MessageType.PUT_VALUE,\n        key,\n        record: fixupRec\n      }\n\n      for await (const event of this.network.sendRequest(from, request, options)) {\n        if (event.name === 'PEER_RESPONSE' && (event.record != null) && uint8ArrayEquals(event.record.value, Libp2pRecord.deserialize(fixupRec).value)) {\n          sentCorrection = true\n        }\n\n        yield event\n      }\n\n      if (!sentCorrection) {\n        yield queryErrorEvent({ from, error: new QueryError('Value not put correctly') }, options)\n      }\n\n      this.log.error('Failed error correcting entry')\n    }\n  }\n\n  /**\n   * Store the given key/value pair in the DHT\n   */\n  async * put (key: Uint8Array, value: Uint8Array, options: RoutingOptions = {}): AsyncGenerator<unknown, void, undefined> {\n    this.log('put key %b value %b', key, value)\n\n    // create record in the dht format\n    const record = createPutRecord(key, value)\n\n    // store the record locally\n    const dsKey = bufferToRecordKey(this.datastorePrefix, key)\n    this.log(`storing record for key ${dsKey.toString()}`)\n    await this.components.datastore.put(dsKey, record.subarray())\n\n    // put record to the closest peers\n    yield * pipe(\n      this.peerRouting.getClosestPeers(key, {\n        ...options,\n        signal: options.signal\n      }),\n      (source) => map(source, (event) => {\n        return async () => {\n          if (event.name !== 'FINAL_PEER') {\n            return [event]\n          }\n\n          const events = []\n\n          const msg: Partial<Message> = {\n            type: MessageType.PUT_VALUE,\n            key,\n            record\n          }\n\n          this.log('send put to %p', event.peer.id)\n          for await (const putEvent of this.network.sendRequest(event.peer.id, msg, options)) {\n            events.push(putEvent)\n\n            if (putEvent.name !== 'PEER_RESPONSE') {\n              continue\n            }\n\n            if (!(putEvent.record != null && uint8ArrayEquals(putEvent.record.value, Libp2pRecord.deserialize(record).value))) {\n              events.push(queryErrorEvent({ from: event.peer.id, error: new QueryError('Value not put correctly') }, options))\n            }\n          }\n\n          return events\n        }\n      }),\n      (source) => parallel(source, {\n        ordered: false,\n        concurrency: ALPHA\n      }),\n      async function * (source) {\n        for await (const events of source) {\n          yield * events\n        }\n      }\n    )\n  }\n\n  /**\n   * Get the value to the given key\n   */\n  async * get (key: Uint8Array, options: RoutingOptions = {}): AsyncGenerator<QueryEvent | ValueEvent> {\n    this.log('get %b', key)\n\n    const vals: ValueEvent[] = []\n\n    for await (const event of this.getMany(key, options)) {\n      if (event.name === 'VALUE') {\n        vals.push(event)\n      }\n\n      yield event\n    }\n\n    if (vals.length === 0) {\n      return\n    }\n\n    const records = vals.map((v) => v.value)\n    let i = 0\n\n    try {\n      i = bestRecord(this.selectors, key, records)\n    } catch (err: any) {\n      // Assume the first record if no selector available\n      if (err.name !== 'InvalidParametersError') {\n        throw err\n      }\n    }\n\n    const best = records[i]\n    this.log('GetValue %b %b', key, best)\n\n    if (best == null) {\n      throw new NotFoundError('Best value was not found')\n    }\n\n    yield * this.sendCorrectionRecord(key, vals, best, options)\n\n    yield vals[i]\n  }\n\n  /**\n   * Get the `n` values to the given key without sorting\n   */\n  async * getMany (key: Uint8Array, options: RoutingOptions = {}): AsyncGenerator<QueryEvent> {\n    this.log('getMany values for %b', key)\n\n    try {\n      const localRec = await this.getLocal(key)\n\n      yield valueEvent({\n        value: localRec.value,\n        from: this.components.peerId\n      }, options)\n    } catch (err: any) {\n      this.log('error getting local value for %b', key, err)\n    }\n\n    const self = this // eslint-disable-line @typescript-eslint/no-this-alias\n\n    const getValueQuery: QueryFunc = async function * ({ peer, signal }) {\n      for await (const event of self.peerRouting.getValueOrPeers(peer, key, {\n        ...options,\n        signal\n      })) {\n        yield event\n\n        if (event.name === 'PEER_RESPONSE' && (event.record != null)) {\n          yield valueEvent({ from: peer, value: event.record.value }, options)\n        }\n      }\n    }\n\n    // we have peers, lets send the actual query to them\n    yield * this.queryManager.run(key, getValueQuery, options)\n  }\n}\n", "import { peerIdFromMultihash } from '@libp2p/peer-id'\nimport { multiaddr } from '@multiformats/multiaddr'\nimport * as Digest from 'multiformats/hashes/digest'\nimport type { PeerInfo as PBPeerInfo, ConnectionType } from './dht.js'\nimport type { PeerInfo } from '@libp2p/interface'\n\nexport function toPbPeerInfo (peer: PeerInfo, connection?: ConnectionType): PBPeerInfo {\n  const output: PBPeerInfo = {\n    id: peer.id.toMultihash().bytes,\n    multiaddrs: (peer.multiaddrs ?? []).map((m) => m.bytes),\n    connection\n  }\n\n  return output\n}\n\nexport function fromPbPeerInfo (peer: PBPeerInfo): PeerInfo {\n  if (peer.id == null) {\n    throw new Error('Invalid peer in message')\n  }\n\n  const multihash = Digest.decode(peer.id)\n\n  return {\n    id: peerIdFromMultihash(multihash),\n    multiaddrs: (peer.multiaddrs ?? []).map((a) => multiaddr(a))\n  }\n}\n", "import { PeerSet } from '@libp2p/peer-collections'\nimport map from 'it-map'\nimport parallel from 'it-parallel'\nimport { pipe } from 'it-pipe'\nimport { ALPHA } from '../constants.js'\nimport { MessageType } from '../message/dht.js'\nimport { toPbPeerInfo } from '../message/utils.js'\nimport {\n  queryErrorEvent,\n  peerResponseEvent,\n  providerEvent\n} from '../query/events.js'\nimport type { KadDHTComponents, PeerResponseEvent, ProviderEvent, QueryEvent } from '../index.js'\nimport type { Message } from '../message/dht.js'\nimport type { Network } from '../network.js'\nimport type { PeerRouting } from '../peer-routing/index.js'\nimport type { Providers } from '../providers.js'\nimport type { QueryManager } from '../query/manager.js'\nimport type { QueryFunc } from '../query/types.js'\nimport type { RoutingTable } from '../routing-table/index.js'\nimport type { Logger, PeerInfo, RoutingOptions } from '@libp2p/interface'\nimport type { Multiaddr } from '@multiformats/multiaddr'\nimport type { CID } from 'multiformats/cid'\n\nexport interface ContentRoutingInit {\n  network: Network\n  peerRouting: PeerRouting\n  queryManager: QueryManager\n  routingTable: RoutingTable\n  providers: Providers\n  logPrefix: string\n}\n\nexport class ContentRouting {\n  private readonly log: Logger\n  private readonly components: KadDHTComponents\n  private readonly network: Network\n  private readonly peerRouting: PeerRouting\n  private readonly queryManager: QueryManager\n  private readonly routingTable: RoutingTable\n  private readonly providers: Providers\n\n  constructor (components: KadDHTComponents, init: ContentRoutingInit) {\n    const { network, peerRouting, queryManager, routingTable, providers, logPrefix } = init\n\n    this.components = components\n    this.log = components.logger.forComponent(`${logPrefix}:content-routing`)\n    this.network = network\n    this.peerRouting = peerRouting\n    this.queryManager = queryManager\n    this.routingTable = routingTable\n    this.providers = providers\n\n    this.findProviders = components.metrics?.traceFunction('libp2p.kadDHT.findProviders', this.findProviders.bind(this), {\n      optionsIndex: 1,\n      getAttributesFromYieldedValue: (event, attrs: { providers?: string[] }) => {\n        if (event.name === 'PROVIDER') {\n          attrs.providers ??= []\n          attrs.providers.push(...event.providers.map(info => info.id.toString()))\n        }\n\n        return attrs\n      }\n    }) ?? this.findProviders\n    this.provide = components.metrics?.traceFunction('libp2p.kadDHT.provide', this.provide.bind(this), {\n      optionsIndex: 1,\n      getAttributesFromYieldedValue: (event, attrs: { providers?: string[] }) => {\n        if (event.name === 'PEER_RESPONSE' && event.messageName === 'ADD_PROVIDER') {\n          attrs.providers ??= []\n          attrs.providers.push(event.from.toString())\n        }\n\n        return attrs\n      }\n    }) ?? this.provide\n  }\n\n  /**\n   * Announce to the network that we can provide the value for a given key and\n   * are contactable on the given multiaddrs\n   */\n  async * provide (key: CID, multiaddrs: Multiaddr[], options: RoutingOptions = {}): AsyncGenerator<QueryEvent, void, undefined> {\n    this.log('provide %s', key)\n    const target = key.multihash.bytes\n\n    // Add peer as provider\n    await this.providers.addProvider(key, this.components.peerId)\n\n    const msg: Partial<Message> = {\n      type: MessageType.ADD_PROVIDER,\n      key: target,\n      providers: [\n        toPbPeerInfo({\n          id: this.components.peerId,\n          multiaddrs\n        })\n      ]\n    }\n\n    let sent = 0\n\n    const maybeNotifyPeer = (event: QueryEvent) => {\n      return async () => {\n        if (event.name !== 'FINAL_PEER') {\n          return [event]\n        }\n\n        const events = []\n\n        this.log('putProvider %s to %p', key, event.peer.id)\n\n        try {\n          this.log('sending provider record for %s to %p', key, event.peer.id)\n\n          for await (const sendEvent of this.network.sendMessage(event.peer.id, msg, options)) {\n            if (sendEvent.name === 'PEER_RESPONSE') {\n              this.log('sent provider record for %s to %p', key, event.peer.id)\n              sent++\n            }\n\n            events.push(sendEvent)\n          }\n        } catch (err: any) {\n          this.log.error('error sending provide record to peer %p', event.peer.id, err)\n          events.push(queryErrorEvent({ from: event.peer.id, error: err }, options))\n        }\n\n        return events\n      }\n    }\n\n    // Notify closest peers\n    yield * pipe(\n      this.peerRouting.getClosestPeers(target, options),\n      (source) => map(source, (event) => maybeNotifyPeer(event)),\n      (source) => parallel(source, {\n        ordered: false,\n        concurrency: ALPHA\n      }),\n      async function * (source) {\n        for await (const events of source) {\n          yield * events\n        }\n      }\n    )\n\n    this.log('sent provider records to %d peers', sent)\n  }\n\n  /**\n   * Search the dht for up to `K` providers of the given CID.\n   */\n  async * findProviders (key: CID, options: RoutingOptions): AsyncGenerator<PeerResponseEvent | ProviderEvent | QueryEvent> {\n    const toFind = this.routingTable.kBucketSize\n    let found = 0\n    const target = key.multihash.bytes\n    const self = this // eslint-disable-line @typescript-eslint/no-this-alias\n\n    this.log('findProviders %c', key)\n\n    const provs = await this.providers.getProviders(key)\n\n    // yield values if we have some, also slice because maybe we got lucky and already have too many?\n    if (provs.length > 0) {\n      const providers: PeerInfo[] = []\n\n      for (const peerId of provs.slice(0, toFind)) {\n        try {\n          const peer = await this.components.peerStore.get(peerId)\n\n          providers.push({\n            id: peerId,\n            multiaddrs: peer.addresses.map(({ multiaddr }) => multiaddr)\n          })\n        } catch (err: any) {\n          if (err.name !== 'NotFoundError') {\n            throw err\n          }\n\n          this.log('no peer store entry for %p', peerId)\n        }\n      }\n\n      yield peerResponseEvent({ from: this.components.peerId, messageType: MessageType.GET_PROVIDERS, providers }, options)\n      yield providerEvent({ from: this.components.peerId, providers }, options)\n\n      found += providers.length\n\n      if (found >= toFind) {\n        return\n      }\n    }\n\n    /**\n     * The query function to use on this particular disjoint path\n     */\n    const findProvidersQuery: QueryFunc = async function * ({ peer, signal }) {\n      const request = {\n        type: MessageType.GET_PROVIDERS,\n        key: target\n      }\n\n      yield * self.network.sendRequest(peer, request, {\n        ...options,\n        signal\n      })\n    }\n\n    const providers = new PeerSet(provs)\n\n    for await (const event of this.queryManager.run(target, findProvidersQuery, options)) {\n      yield event\n\n      if (event.name === 'PEER_RESPONSE') {\n        this.log('Found %d provider entries for %c and %d closer peers', event.providers.length, key, event.closer.length)\n\n        const newProviders = []\n\n        for (const peer of event.providers) {\n          if (providers.has(peer.id)) {\n            continue\n          }\n\n          providers.add(peer.id)\n          newProviders.push(peer)\n        }\n\n        if (newProviders.length > 0) {\n          yield providerEvent({ from: event.from, providers: newProviders }, options)\n\n          found += newProviders.length\n\n          if (found >= toFind) {\n            return\n          }\n        }\n      }\n    }\n  }\n}\n", "import { InvalidParametersError, TypedEventEmitter } from '@libp2p/interface'\nimport { Libp2pRecord } from '@libp2p/record'\nimport { AdaptiveTimeout, type AdaptiveTimeoutInit } from '@libp2p/utils/adaptive-timeout'\nimport { pbStream } from 'it-protobuf-stream'\nimport { Message } from './message/dht.js'\nimport { fromPbPeerInfo } from './message/utils.js'\nimport {\n  dialPeerEvent,\n  sendQueryEvent,\n  peerResponseEvent,\n  queryErrorEvent\n} from './query/events.js'\nimport type { KadDHTComponents, QueryEvent } from './index.js'\nimport type { AbortOptions, Logger, Stream, PeerId, PeerInfo, Startable, RoutingOptions, CounterGroup } from '@libp2p/interface'\n\nexport interface NetworkInit {\n  protocol: string\n  logPrefix: string\n  metricsPrefix: string\n  timeout?: Omit<AdaptiveTimeoutInit, 'metricsName' | 'metrics'>\n}\n\ninterface NetworkEvents {\n  'peer': CustomEvent<PeerInfo>\n}\n\n/**\n * Handle network operations for the dht\n */\nexport class Network extends TypedEventEmitter<NetworkEvents> implements Startable {\n  private readonly log: Logger\n  private readonly protocol: string\n  private running: boolean\n  private readonly components: KadDHTComponents\n  private readonly timeout: AdaptiveTimeout\n  private readonly metrics: {\n    operations?: CounterGroup\n    errors?: CounterGroup\n  }\n\n  /**\n   * Create a new network\n   */\n  constructor (components: KadDHTComponents, init: NetworkInit) {\n    super()\n\n    this.components = components\n    this.log = components.logger.forComponent(`${init.logPrefix}:network`)\n    this.running = false\n    this.protocol = init.protocol\n    this.timeout = new AdaptiveTimeout({\n      ...(init.timeout ?? {}),\n      metrics: components.metrics,\n      metricName: `${init.metricsPrefix}_network_message_send_times_milliseconds`\n    })\n    this.metrics = {\n      operations: components.metrics?.registerCounterGroup(`${init.metricsPrefix}_outbound_rpc_requests_total`),\n      errors: components.metrics?.registerCounterGroup(`${init.metricsPrefix}_outbound_rpc_errors_total`)\n    }\n\n    this.sendRequest = components.metrics?.traceFunction('libp2p.kadDHT.sendRequest', this.sendRequest.bind(this), {\n      optionsIndex: 2,\n      getAttributesFromArgs ([to, message], attrs) {\n        return {\n          ...attrs,\n          to: to.toString(),\n          'message type': `${message.type}`\n        }\n      },\n      getAttributesFromYieldedValue: (event, attrs) => {\n        if (event.name === 'PEER_RESPONSE') {\n          if (event.providers.length > 0) {\n            event.providers.forEach((value, index) => {\n              attrs[`providers-${index}`] = value.id.toString()\n            })\n          }\n\n          if (event.closer.length > 0) {\n            event.closer.forEach((value, index) => {\n              attrs[`closer-${index}`] = value.id.toString()\n            })\n          }\n        }\n\n        return attrs\n      }\n    }) ?? this.sendRequest\n    this.sendMessage = components.metrics?.traceFunction('libp2p.kadDHT.sendMessage', this.sendMessage.bind(this), {\n      optionsIndex: 2,\n      getAttributesFromArgs ([to, message], attrs) {\n        return {\n          ...attrs,\n          to: to.toString(),\n          'message type': `${message.type}`\n        }\n      },\n      getAttributesFromYieldedValue: (event, attrs) => {\n        if (event.name === 'PEER_RESPONSE') {\n          if (event.providers.length > 0) {\n            event.providers.forEach((value, index) => {\n              attrs[`providers-${index}`] = value.id.toString()\n            })\n          }\n\n          if (event.closer.length > 0) {\n            event.closer.forEach((value, index) => {\n              attrs[`closer-${index}`] = value.id.toString()\n            })\n          }\n        }\n\n        return attrs\n      }\n    }) ?? this.sendMessage\n  }\n\n  /**\n   * Start the network\n   */\n  async start (): Promise<void> {\n    if (this.running) {\n      return\n    }\n\n    this.running = true\n  }\n\n  /**\n   * Stop all network activity\n   */\n  async stop (): Promise<void> {\n    this.running = false\n  }\n\n  /**\n   * Is the network online?\n   */\n  isStarted (): boolean {\n    return this.running\n  }\n\n  /**\n   * Send a request and read a response\n   */\n  async * sendRequest (to: PeerId, msg: Partial<Message>, options: RoutingOptions = {}): AsyncGenerator<QueryEvent> {\n    if (!this.running) {\n      return\n    }\n\n    const type = msg.type\n\n    if (type == null) {\n      throw new InvalidParametersError('Message type was missing')\n    }\n\n    this.log('sending %s to %p', msg.type, to)\n    yield dialPeerEvent({ peer: to }, options)\n    yield sendQueryEvent({ to, type }, options)\n\n    let stream: Stream | undefined\n    const signal = this.timeout.getTimeoutSignal(options)\n\n    options = {\n      ...options,\n      signal\n    }\n\n    try {\n      this.metrics.operations?.increment({ [type]: true })\n\n      const connection = await this.components.connectionManager.openConnection(to, options)\n      stream = await connection.newStream(this.protocol, options)\n      const response = await this._writeReadMessage(stream, msg, options)\n\n      stream.close(options)\n        .catch(err => {\n          this.log.error('error closing stream to %p', to, err)\n          stream?.abort(err)\n        })\n\n      yield peerResponseEvent({\n        from: to,\n        messageType: response.type,\n        closer: response.closer.map(fromPbPeerInfo),\n        providers: response.providers.map(fromPbPeerInfo),\n        record: response.record == null ? undefined : Libp2pRecord.deserialize(response.record)\n      }, options)\n    } catch (err: any) {\n      this.metrics.errors?.increment({ [type]: true })\n\n      stream?.abort(err)\n\n      // only log if the incoming signal was not aborted - this means we were\n      // no longer interested in the query result\n      if (options.signal?.aborted !== true) {\n        this.log.error('could not send %s to %p - %e', msg.type, to, err)\n      }\n\n      yield queryErrorEvent({ from: to, error: err }, options)\n    } finally {\n      this.timeout.cleanUp(signal)\n    }\n  }\n\n  /**\n   * Sends a message without expecting an answer\n   */\n  async * sendMessage (to: PeerId, msg: Partial<Message>, options: RoutingOptions = {}): AsyncGenerator<QueryEvent> {\n    if (!this.running) {\n      return\n    }\n\n    const type = msg.type\n\n    if (type == null) {\n      throw new InvalidParametersError('Message type was missing')\n    }\n\n    this.log('sending %s to %p', msg.type, to)\n    yield dialPeerEvent({ peer: to }, options)\n    yield sendQueryEvent({ to, type }, options)\n\n    let stream: Stream | undefined\n    const signal = this.timeout.getTimeoutSignal(options)\n\n    options = {\n      ...options,\n      signal\n    }\n\n    try {\n      this.metrics.operations?.increment({ [type]: true })\n\n      const connection = await this.components.connectionManager.openConnection(to, options)\n      stream = await connection.newStream(this.protocol, options)\n\n      await this._writeMessage(stream, msg, options)\n\n      stream.close(options)\n        .catch(err => {\n          this.log.error('error closing stream to %p', to, err)\n          stream?.abort(err)\n        })\n\n      yield peerResponseEvent({ from: to, messageType: type }, options)\n    } catch (err: any) {\n      this.metrics.errors?.increment({ [type]: true })\n\n      stream?.abort(err)\n      yield queryErrorEvent({ from: to, error: err }, options)\n    } finally {\n      this.timeout.cleanUp(signal)\n    }\n  }\n\n  /**\n   * Write a message to the given stream\n   */\n  async _writeMessage (stream: Stream, msg: Partial<Message>, options: AbortOptions): Promise<void> {\n    const pb = pbStream(stream)\n    await pb.write(msg, Message, options)\n  }\n\n  /**\n   * Write a message and read its response.\n   * If no response is received after the specified timeout\n   * this will error out.\n   */\n  async _writeReadMessage (stream: Stream, msg: Partial<Message>, options: AbortOptions): Promise<Message> {\n    const pb = pbStream(stream)\n\n    await pb.write(msg, Message, options)\n\n    const message = await pb.read(Message, options)\n\n    // tell any listeners about new peers we've seen\n    message.closer.forEach(peerData => {\n      this.safeDispatchEvent<PeerInfo>('peer', {\n        detail: fromPbPeerInfo(peerData)\n      })\n    })\n    message.providers.forEach(peerData => {\n      this.safeDispatchEvent<PeerInfo>('peer', {\n        detail: fromPbPeerInfo(peerData)\n      })\n    })\n\n    return message\n  }\n}\n", "/**\n * Compares two Uint8Arrays representing two xor distances. Returns `-1` if `a`\n * is a lower distance, `1` if `b` is a lower distance or `0` if the distances\n * are equal.\n */\nexport function xorCompare (a: Uint8Array, b: Uint8Array): -1 | 0 | 1 {\n  if (a.byteLength !== b.byteLength) {\n    throw new Error('Inputs should have the same length')\n  }\n\n  for (let i = 0; i < a.byteLength; i++) {\n    if (a[i] === b[i]) {\n      continue\n    }\n\n    return a[i] < b[i] ? -1 : 1\n  }\n\n  return 0\n}\n", "import { xor as uint8ArrayXor } from 'uint8arrays/xor'\nimport { xorCompare as uint8ArrayXorCompare } from 'uint8arrays/xor-compare'\nimport { convertPeerId } from './utils.js'\nimport type { PeerId, PeerInfo } from '@libp2p/interface'\n\ninterface PeerDistance {\n  peer: PeerInfo\n  distance: Uint8Array\n}\n\n/**\n * Maintains a list of peerIds sorted by distance from a DHT key.\n */\nexport class PeerDistanceList {\n  /**\n   * The DHT key from which distance is calculated\n   */\n  private readonly originDhtKey: Uint8Array\n\n  /**\n   * The maximum size of the list\n   */\n  private readonly capacity: number\n\n  private peerDistances: PeerDistance[]\n\n  constructor (originDhtKey: Uint8Array, capacity: number) {\n    this.originDhtKey = originDhtKey\n    this.capacity = capacity\n    this.peerDistances = []\n  }\n\n  /**\n   * The length of the list\n   */\n  get length (): number {\n    return this.peerDistances.length\n  }\n\n  /**\n   * The peers in the list, in order of distance from the origin key\n   */\n  get peers (): PeerInfo[] {\n    return this.peerDistances.map(pd => pd.peer)\n  }\n\n  /**\n   * Add a peerId to the list.\n   */\n  async add (peer: PeerInfo): Promise<void> {\n    const dhtKey = await convertPeerId(peer.id)\n\n    this.addWitKadId(peer, dhtKey)\n  }\n\n  /**\n   * Add a peerId to the list.\n   */\n  addWitKadId (peer: PeerInfo, kadId: Uint8Array): void {\n    if (this.peerDistances.find(pd => pd.peer.id.equals(peer.id)) != null) {\n      return\n    }\n\n    const el = {\n      peer,\n      distance: uint8ArrayXor(this.originDhtKey, kadId)\n    }\n\n    this.peerDistances.push(el)\n    this.peerDistances.sort((a, b) => uint8ArrayXorCompare(a.distance, b.distance))\n    this.peerDistances = this.peerDistances.slice(0, this.capacity)\n  }\n\n  /**\n   * Indicates whether any of the peerIds passed as a parameter are closer\n   * to the origin key than the furthest peerId in the PeerDistanceList.\n   */\n  async isCloser (peerId: PeerId): Promise<boolean> {\n    if (this.length === 0) {\n      return true\n    }\n\n    const dhtKey = await convertPeerId(peerId)\n    const dhtKeyXor = uint8ArrayXor(dhtKey, this.originDhtKey)\n    const furthestDistance = this.peerDistances[this.peerDistances.length - 1].distance\n\n    return uint8ArrayXorCompare(dhtKeyXor, furthestDistance) === -1\n  }\n\n  /**\n   * Indicates whether any of the peerIds passed as a parameter are closer\n   * to the origin key than the furthest peerId in the PeerDistanceList.\n   */\n  async anyCloser (peerIds: PeerId[]): Promise<boolean> {\n    if (peerIds.length === 0) {\n      return false\n    }\n\n    return Promise.any(\n      peerIds.map(async peerId => this.isCloser(peerId))\n    )\n  }\n}\n", "import { publicKeyFromProtobuf } from '@libp2p/crypto/keys'\nimport { InvalidPublicKeyError, NotFoundError } from '@libp2p/interface'\nimport { peerIdFromPublicKey, peerIdFromMultihash } from '@libp2p/peer-id'\nimport { Libp2pRecord } from '@libp2p/record'\nimport * as Digest from 'multiformats/hashes/digest'\nimport { toString as uint8ArrayToString } from 'uint8arrays/to-string'\nimport { xor as uint8ArrayXor } from 'uint8arrays/xor'\nimport { xorCompare as uint8ArrayXorCompare } from 'uint8arrays/xor-compare'\nimport { QueryError, InvalidRecordError } from '../errors.js'\nimport { MessageType } from '../message/dht.js'\nimport { PeerDistanceList } from '../peer-distance-list.js'\nimport {\n  queryErrorEvent,\n  finalPeerEvent,\n  valueEvent\n} from '../query/events.js'\nimport { verifyRecord } from '../record/validators.js'\nimport { convertBuffer, convertPeerId, keyForPublicKey } from '../utils.js'\nimport type { DHTRecord, FinalPeerEvent, QueryEvent, Validators } from '../index.js'\nimport type { Message } from '../message/dht.js'\nimport type { Network } from '../network.js'\nimport type { QueryManager, QueryOptions } from '../query/manager.js'\nimport type { QueryFunc } from '../query/types.js'\nimport type { RoutingTable } from '../routing-table/index.js'\nimport type { ComponentLogger, Logger, Metrics, PeerId, PeerInfo, PeerStore, RoutingOptions } from '@libp2p/interface'\n\nexport interface PeerRoutingComponents {\n  peerId: PeerId\n  peerStore: PeerStore\n  logger: ComponentLogger\n  metrics?: Metrics\n}\n\nexport interface PeerRoutingInit {\n  routingTable: RoutingTable\n  network: Network\n  validators: Validators\n  queryManager: QueryManager\n  logPrefix: string\n}\n\nexport class PeerRouting {\n  private readonly log: Logger\n  private readonly routingTable: RoutingTable\n  private readonly network: Network\n  private readonly validators: Validators\n  private readonly queryManager: QueryManager\n  private readonly peerStore: PeerStore\n  private readonly peerId: PeerId\n\n  constructor (components: PeerRoutingComponents, init: PeerRoutingInit) {\n    this.routingTable = init.routingTable\n    this.network = init.network\n    this.validators = init.validators\n    this.queryManager = init.queryManager\n    this.peerStore = components.peerStore\n    this.peerId = components.peerId\n    this.log = components.logger.forComponent(`${init.logPrefix}:peer-routing`)\n\n    this.findPeer = components.metrics?.traceFunction('libp2p.kadDHT.findPeer', this.findPeer.bind(this), {\n      optionsIndex: 1\n    }) ?? this.findPeer\n    this.getClosestPeers = components.metrics?.traceFunction('libp2p.kadDHT.getClosestPeers', this.getClosestPeers.bind(this), {\n      optionsIndex: 1\n    }) ?? this.getClosestPeers\n  }\n\n  /**\n   * Look if we are connected to a peer with the given id.\n   * Returns its id and addresses, if found, otherwise `undefined`.\n   */\n  async findPeerLocal (peer: PeerId): Promise<PeerInfo | undefined> {\n    let peerData\n    const p = await this.routingTable.find(peer)\n\n    if (p != null) {\n      this.log('findPeerLocal found %p in routing table', peer)\n\n      try {\n        peerData = await this.peerStore.get(p)\n      } catch (err: any) {\n        if (err.name !== 'NotFoundError') {\n          throw err\n        }\n      }\n    }\n\n    if (peerData == null) {\n      try {\n        peerData = await this.peerStore.get(peer)\n      } catch (err: any) {\n        if (err.name !== 'NotFoundError') {\n          throw err\n        }\n      }\n    }\n\n    if (peerData != null) {\n      this.log('findPeerLocal found %p in peer store', peer)\n\n      return {\n        id: peerData.id,\n        multiaddrs: peerData.addresses.map((address) => address.multiaddr)\n      }\n    }\n\n    return undefined\n  }\n\n  /**\n   * Get a value via rpc call for the given parameters\n   */\n  async * _getValueSingle (peer: PeerId, key: Uint8Array, options: RoutingOptions = {}): AsyncGenerator<QueryEvent> {\n    const msg: Partial<Message> = {\n      type: MessageType.GET_VALUE,\n      key\n    }\n\n    yield * this.network.sendRequest(peer, msg, options)\n  }\n\n  /**\n   * Get the public key directly from a node\n   */\n  async * getPublicKeyFromNode (peer: PeerId, options: RoutingOptions = {}): AsyncGenerator<QueryEvent> {\n    const pkKey = keyForPublicKey(peer)\n\n    for await (const event of this._getValueSingle(peer, pkKey, options)) {\n      yield event\n\n      if (event.name === 'PEER_RESPONSE' && event.record != null) {\n        const publicKey = publicKeyFromProtobuf(event.record.value)\n        const recPeer = peerIdFromPublicKey(publicKey)\n\n        // compare hashes of the pub key\n        if (!recPeer.equals(peer)) {\n          throw new InvalidPublicKeyError('public key does not match id')\n        }\n\n        if (recPeer.publicKey == null) {\n          throw new InvalidPublicKeyError('public key missing')\n        }\n\n        yield valueEvent({\n          from: peer,\n          value: event.record.value\n        }, options)\n      }\n    }\n\n    throw new QueryError(`Node not responding with its public key: ${peer.toString()}`)\n  }\n\n  /**\n   * Search for a peer with the given ID\n   */\n  async * findPeer (id: PeerId, options: RoutingOptions = {}): AsyncGenerator<FinalPeerEvent | QueryEvent> {\n    this.log('findPeer %p', id)\n\n    if (options.useCache !== false) {\n      // Try to find locally\n      const pi = await this.findPeerLocal(id)\n\n      // already got it\n      if (pi != null) {\n        this.log('found local')\n        yield finalPeerEvent({\n          from: this.peerId,\n          peer: pi\n        }, options)\n        return\n      }\n    }\n\n    let foundPeer = false\n\n    if (options.useNetwork !== false) {\n      const self = this // eslint-disable-line @typescript-eslint/no-this-alias\n\n      const findPeerQuery: QueryFunc = async function * ({ peer, signal }) {\n        const request: Partial<Message> = {\n          type: MessageType.FIND_NODE,\n          key: id.toMultihash().bytes\n        }\n\n        for await (const event of self.network.sendRequest(peer, request, {\n          ...options,\n          signal\n        })) {\n          yield event\n\n          if (event.name === 'PEER_RESPONSE') {\n            const match = event.closer.find((p) => p.id.equals(id))\n\n            // found the peer\n            if (match != null) {\n              yield finalPeerEvent({ from: event.from, peer: match }, options)\n            }\n          }\n        }\n      }\n\n      for await (const event of this.queryManager.run(id.toMultihash().bytes, findPeerQuery, options)) {\n        if (event.name === 'FINAL_PEER') {\n          foundPeer = true\n        }\n\n        yield event\n      }\n    }\n\n    if (!foundPeer) {\n      yield queryErrorEvent({ from: this.peerId, error: new NotFoundError('Not found') }, options)\n    }\n  }\n\n  /**\n   * Kademlia 'FIND_NODE' operation on a key, which could be the bytes from\n   * a multihash or a peer ID\n   */\n  async * getClosestPeers (key: Uint8Array, options: QueryOptions = {}): AsyncGenerator<QueryEvent> {\n    this.log('getClosestPeers to %b', key)\n    const kadId = await convertBuffer(key)\n    const tablePeers = this.routingTable.closestPeers(kadId)\n    const self = this // eslint-disable-line @typescript-eslint/no-this-alias\n\n    const peers = new PeerDistanceList(kadId, this.routingTable.kBucketSize)\n    await Promise.all(tablePeers.map(async peer => { await peers.add({ id: peer, multiaddrs: [] }) }))\n\n    const getCloserPeersQuery: QueryFunc = async function * ({ peer, signal }) {\n      self.log('closerPeersSingle %s from %p', uint8ArrayToString(key, 'base32'), peer)\n      const request: Partial<Message> = {\n        type: MessageType.FIND_NODE,\n        key\n      }\n\n      yield * self.network.sendRequest(peer, request, {\n        ...options,\n        signal\n      })\n    }\n\n    for await (const event of this.queryManager.run(key, getCloserPeersQuery, options)) {\n      if (event.name === 'PEER_RESPONSE') {\n        await Promise.all(event.closer.map(async peerData => {\n          await peers.add(peerData)\n        }))\n      }\n\n      yield event\n    }\n\n    this.log('found %d peers close to %b', peers.length, key)\n\n    for (const peer of peers.peers) {\n      yield finalPeerEvent({\n        from: this.peerId,\n        peer\n      }, options)\n    }\n  }\n\n  /**\n   * Query a particular peer for the value for the given key.\n   * It will either return the value or a list of closer peers.\n   *\n   * Note: The peerStore is updated with new addresses found for the given peer.\n   */\n  async * getValueOrPeers (peer: PeerId, key: Uint8Array, options: RoutingOptions = {}): AsyncGenerator<QueryEvent> {\n    for await (const event of this._getValueSingle(peer, key, options)) {\n      if (event.name === 'PEER_RESPONSE') {\n        if (event.record != null) {\n          // We have a record\n          try {\n            await this._verifyRecordOnline(event.record)\n          } catch (err: any) {\n            const errMsg = 'invalid record received, discarded'\n            this.log(errMsg)\n\n            yield queryErrorEvent({ from: event.from, error: new QueryError(errMsg) }, options)\n            continue\n          }\n        }\n      }\n\n      yield event\n    }\n  }\n\n  /**\n   * Verify a record, fetching missing public keys from the network.\n   * Throws an error if the record is invalid.\n   */\n  async _verifyRecordOnline (record: DHTRecord): Promise<void> {\n    if (record.timeReceived == null) {\n      throw new InvalidRecordError('invalid record received')\n    }\n\n    await verifyRecord(this.validators, new Libp2pRecord(record.key, record.value, record.timeReceived))\n  }\n\n  /**\n   * Get the nearest peers to the given query, but if closer than self\n   */\n  async getCloserPeersOffline (key: Uint8Array, closerThan: PeerId): Promise<PeerInfo[]> {\n    const output: PeerInfo[] = []\n\n    // try getting the peer directly\n    try {\n      const multihash = Digest.decode(key)\n      const targetPeerId = peerIdFromMultihash(multihash)\n\n      const peer = await this.peerStore.get(targetPeerId)\n\n      output.push({\n        id: peer.id,\n        multiaddrs: peer.addresses.map(({ multiaddr }) => multiaddr)\n      })\n    } catch {}\n\n    const keyKadId = await convertBuffer(key)\n    const ids = this.routingTable.closestPeers(keyKadId)\n    const closerThanKadId = await convertPeerId(closerThan)\n    const requesterXor = uint8ArrayXor(closerThanKadId, keyKadId)\n\n    for (const peerId of ids) {\n      const peerKadId = await convertPeerId(peerId)\n      const peerXor = uint8ArrayXor(peerKadId, keyKadId)\n\n      // only include if peer is closer than requester\n      if (uint8ArrayXorCompare(peerXor, requesterXor) !== -1) {\n        continue\n      }\n\n      try {\n        const peer = await this.peerStore.get(peerId)\n\n        output.push({\n          id: peerId,\n          multiaddrs: peer.addresses.map(({ multiaddr }) => multiaddr)\n        })\n      } catch (err: any) {\n        if (err.name !== 'NotFoundError') {\n          throw err\n        }\n      }\n    }\n\n    if (output.length > 0) {\n      this.log('getCloserPeersOffline found %d peer(s) closer to %b than %p', output.length, key, closerThan)\n    } else {\n      this.log('getCloserPeersOffline could not find peer closer to %b than %p with %d peers in the routing table', key, closerThan, this.routingTable.size)\n    }\n\n    return output\n  }\n}\n", "import { PeerMap } from '@libp2p/peer-collections'\nimport * as varint from 'uint8-varint'\nimport { parseProviderKey, readProviderTime, toProviderKey } from './utils.js'\nimport type { ComponentLogger, Logger, Metrics, PeerId } from '@libp2p/interface'\nimport type { Datastore } from 'interface-datastore'\nimport type { Mortice } from 'mortice'\nimport type { CID } from 'multiformats'\n\nexport interface ProvidersInit {\n  logPrefix: string\n  datastorePrefix: string\n  lock: Mortice\n}\n\nexport interface ProvidersComponents {\n  datastore: Datastore\n  logger: ComponentLogger\n  metrics?: Metrics\n}\n\n/**\n * Provides a mechanism to add and remove provider records from the datastore\n */\nexport class Providers {\n  private readonly log: Logger\n  private readonly datastore: Datastore\n  private readonly datastorePrefix: string\n  private readonly lock: Mortice\n\n  constructor (components: ProvidersComponents, init: ProvidersInit) {\n    this.log = components.logger.forComponent(`${init.logPrefix}:providers`)\n    this.datastorePrefix = `${init.datastorePrefix}/provider`\n    this.datastore = components.datastore\n    this.lock = init.lock\n  }\n\n  /**\n   * Add a new provider for the given CID\n   */\n  async addProvider (cid: CID, provider: PeerId): Promise<void> {\n    const release = await this.lock.readLock()\n\n    try {\n      this.log('%p provides %s', provider, cid)\n      await this.writeProviderEntry(cid, provider)\n    } finally {\n      release()\n    }\n  }\n\n  /**\n   * Remove a provider for the given CID\n   */\n  async removeProvider (cid: CID, provider: PeerId): Promise<void> {\n    const release = await this.lock.writeLock()\n\n    try {\n      const key = toProviderKey(this.datastorePrefix, cid, provider)\n      this.log('%p no longer provides %s', provider, cid)\n      await this.datastore.delete(key)\n    } finally {\n      release()\n    }\n  }\n\n  /**\n   * Get a list of providers for the given CID\n   */\n  async getProviders (cid: CID): Promise<PeerId[]> {\n    const release = await this.lock.readLock()\n\n    try {\n      this.log('get providers for %c', cid)\n      const provs = await this.loadProviders(cid)\n      this.log('got %d providers for %c', provs.size, cid)\n\n      return [...provs.keys()]\n    } finally {\n      release()\n    }\n  }\n\n  /**\n   * Write a provider into the given store\n   */\n  private async writeProviderEntry (cid: CID, peerId: PeerId, time: Date = new Date()): Promise<void> {\n    const key = toProviderKey(this.datastorePrefix, cid, peerId)\n    const buffer = varint.encode(time.getTime())\n\n    await this.datastore.put(key, buffer)\n  }\n\n  /**\n   * Load providers for the given CID from the store\n   */\n  private async loadProviders (cid: CID): Promise<PeerMap<Date>> {\n    const providers = new PeerMap<Date>()\n    const key = toProviderKey(this.datastorePrefix, cid)\n\n    for await (const entry of this.datastore.query({ prefix: key.toString() })) {\n      const { peerId } = parseProviderKey(entry.key)\n      providers.set(peerId, readProviderTime(entry.value))\n    }\n\n    return providers\n  }\n}\n", "import { setMaxListeners } from '@libp2p/interface'\nimport { Queue } from '@libp2p/utils/queue'\nimport { anySignal } from 'any-signal'\nimport { xor as uint8ArrayXor } from 'uint8arrays/xor'\nimport { xorCompare as uint8ArrayXorCompare } from 'uint8arrays/xor-compare'\nimport { QueryAbortedError } from '../errors.js'\nimport { convertPeerId, convertBuffer } from '../utils.js'\nimport { queryErrorEvent } from './events.js'\nimport type { QueryEvent } from '../index.js'\nimport type { QueryFunc } from '../query/types.js'\nimport type { Logger, PeerId, RoutingOptions, AbortOptions } from '@libp2p/interface'\nimport type { ConnectionManager } from '@libp2p/interface-internal'\nimport type { PeerSet } from '@libp2p/peer-collections'\n\nexport interface QueryPathOptions extends RoutingOptions {\n  /**\n   * What are we trying to find\n   */\n  key: Uint8Array\n\n  /**\n   * Where we start our query\n   */\n  startingPeer: PeerId\n\n  /**\n   * Who we are\n   */\n  ourPeerId: PeerId\n\n  /**\n   * When to stop querying\n   */\n  signal: AbortSignal\n\n  /**\n   * The query function to run with each peer\n   */\n  query: QueryFunc\n\n  /**\n   * How many concurrent node/value lookups to run\n   */\n  alpha: number\n\n  /**\n   * How many concurrent node/value lookups to run\n   */\n  pathIndex: number\n\n  /**\n   * How many concurrent node/value lookups to run\n   */\n  numPaths: number\n\n  /**\n   * A timeout for queryFunc in ms\n   */\n  queryFuncTimeout?: number\n\n  /**\n   * Query log\n   */\n  log: Logger\n\n  /**\n   * Set of peers seen by this and other paths\n   */\n  peersSeen: PeerSet\n\n  /**\n   * The libp2p connection manager\n   */\n  connectionManager: ConnectionManager\n}\n\ninterface QueryQueueOptions extends AbortOptions {\n  distance: Uint8Array\n}\n\n/**\n * Walks a path through the DHT, calling the passed query function for\n * every peer encountered that we have not seen before\n */\nexport async function * queryPath (options: QueryPathOptions): AsyncGenerator<QueryEvent, void, undefined> {\n  const { key, startingPeer, ourPeerId, signal, query, alpha, pathIndex, numPaths, queryFuncTimeout, log, peersSeen, connectionManager } = options\n  // Only ALPHA node/value lookups are allowed at any given time for each process\n  // https://github.com/libp2p/specs/tree/master/kad-dht#alpha-concurrency-parameter-%CE%B1\n  const queue = new Queue<QueryEvent | undefined, QueryQueueOptions>({\n    concurrency: alpha,\n    sort: (a, b) => uint8ArrayXorCompare(a.options.distance, b.options.distance)\n  })\n\n  // perform lookups on kadId, not the actual value\n  const kadId = await convertBuffer(key)\n\n  /**\n   * Adds the passed peer to the query queue if it's not us and no\n   * other path has passed through this peer\n   */\n  function queryPeer (peer: PeerId, peerKadId: Uint8Array): void {\n    if (peer == null) {\n      return\n    }\n\n    peersSeen.add(peer)\n\n    const peerXor = uint8ArrayXor(peerKadId, kadId)\n\n    queue.add(async () => {\n      const signals = [signal]\n\n      if (queryFuncTimeout != null) {\n        signals.push(AbortSignal.timeout(queryFuncTimeout))\n      }\n\n      const compoundSignal = anySignal(signals)\n\n      // this signal can get listened to a lot\n      setMaxListeners(Infinity, compoundSignal)\n\n      try {\n        for await (const event of query({\n          ...options,\n          key,\n          peer,\n          signal: compoundSignal,\n          pathIndex,\n          numPaths\n        })) {\n          if (compoundSignal.aborted) {\n            return\n          }\n\n          // if there are closer peers and the query has not completed, continue the query\n          if (event.name === 'PEER_RESPONSE') {\n            for (const closerPeer of event.closer) {\n              if (peersSeen.has(closerPeer.id)) { // eslint-disable-line max-depth\n                log.trace('already seen %p in query', closerPeer.id)\n                continue\n              }\n\n              if (ourPeerId.equals(closerPeer.id)) { // eslint-disable-line max-depth\n                log('not querying ourselves')\n                continue\n              }\n\n              if (!(await connectionManager.isDialable(closerPeer.multiaddrs))) { // eslint-disable-line max-depth\n                log('not querying undialable peer')\n                continue\n              }\n\n              const closerPeerKadId = await convertPeerId(closerPeer.id)\n              const closerPeerXor = uint8ArrayXor(closerPeerKadId, kadId)\n\n              // only continue query if closer peer is actually closer\n              if (uint8ArrayXorCompare(closerPeerXor, peerXor) !== -1) { // eslint-disable-line max-depth\n                log.trace('skipping %p as they are not closer to %b than %p', closerPeer.id, key, peer)\n                continue\n              }\n\n              log.trace('querying closer peer %p', closerPeer.id)\n              queryPeer(closerPeer.id, closerPeerKadId)\n            }\n          }\n\n          queue.safeDispatchEvent('completed', {\n            detail: event\n          })\n        }\n      } catch (err: any) {\n        if (!signal.aborted) {\n          return queryErrorEvent({\n            from: peer,\n            error: err\n          }, options)\n        }\n      } finally {\n        compoundSignal.clear()\n      }\n    }, {\n      distance: peerXor\n    }).catch(err => {\n      log.error(err)\n    })\n  }\n\n  // begin the query with the starting peer\n  queryPeer(startingPeer, await convertPeerId(startingPeer))\n\n  try {\n    // yield results as they come in\n    for await (const event of queue.toGenerator({ signal })) {\n      if (event != null) {\n        yield event\n      }\n    }\n  } catch (err) {\n    if (signal.aborted) {\n      throw new QueryAbortedError('Query aborted')\n    }\n\n    throw err\n  }\n}\n", "import { setMaxListeners } from '@libp2p/interface'\nimport { PeerSet } from '@libp2p/peer-collections'\nimport { anySignal } from 'any-signal'\nimport merge from 'it-merge'\nimport { raceSignal } from 'race-signal'\nimport { toString as uint8ArrayToString } from 'uint8arrays/to-string'\nimport {\n  ALPHA, K, DEFAULT_QUERY_TIMEOUT\n} from '../constants.js'\nimport { convertBuffer } from '../utils.js'\nimport { queryPath } from './query-path.js'\nimport type { QueryFunc } from './types.js'\nimport type { QueryEvent } from '../index.js'\nimport type { RoutingTable } from '../routing-table/index.js'\nimport type { ComponentLogger, Metrics, PeerId, RoutingOptions, Startable } from '@libp2p/interface'\nimport type { ConnectionManager } from '@libp2p/interface-internal'\nimport type { DeferredPromise } from 'p-defer'\n\nexport interface CleanUpEvents {\n  'cleanup': CustomEvent\n}\n\nexport interface QueryManagerInit {\n  logPrefix: string\n  metricsPrefix: string\n  disjointPaths?: number\n  alpha?: number\n  initialQuerySelfHasRun: DeferredPromise<void>\n  routingTable: RoutingTable\n}\n\nexport interface QueryManagerComponents {\n  peerId: PeerId\n  metrics?: Metrics\n  logger: ComponentLogger\n  connectionManager: ConnectionManager\n}\n\nexport interface QueryOptions extends RoutingOptions {\n  /**\n   * A timeout for subqueries executed as part of the main query\n   */\n  queryFuncTimeout?: number\n\n  isSelfQuery?: boolean\n}\n\n/**\n * Keeps track of all running queries\n */\nexport class QueryManager implements Startable {\n  public disjointPaths: number\n  private readonly alpha: number\n  private shutDownController: AbortController\n  private running: boolean\n  private readonly logger: ComponentLogger\n  private readonly peerId: PeerId\n  private readonly connectionManager: ConnectionManager\n  private readonly routingTable: RoutingTable\n  private initialQuerySelfHasRun?: DeferredPromise<void>\n  private readonly logPrefix: string\n\n  constructor (components: QueryManagerComponents, init: QueryManagerInit) {\n    this.logPrefix = init.logPrefix\n    this.disjointPaths = init.disjointPaths ?? K\n    this.alpha = init.alpha ?? ALPHA\n    this.initialQuerySelfHasRun = init.initialQuerySelfHasRun\n    this.routingTable = init.routingTable\n    this.logger = components.logger\n    this.peerId = components.peerId\n    this.connectionManager = components.connectionManager\n\n    // allow us to stop queries on shut down\n    this.shutDownController = new AbortController()\n    // make sure we don't make a lot of noise in the logs\n    setMaxListeners(Infinity, this.shutDownController.signal)\n\n    this.running = false\n  }\n\n  isStarted (): boolean {\n    return this.running\n  }\n\n  /**\n   * Starts the query manager\n   */\n  async start (): Promise<void> {\n    if (this.running) {\n      return\n    }\n\n    this.running = true\n\n    // allow us to stop queries on shut down\n    this.shutDownController = new AbortController()\n    // make sure we don't make a lot of noise in the logs\n    setMaxListeners(Infinity, this.shutDownController.signal)\n  }\n\n  /**\n   * Stops all queries\n   */\n  async stop (): Promise<void> {\n    this.running = false\n\n    this.shutDownController.abort()\n  }\n\n  async * run (key: Uint8Array, queryFunc: QueryFunc, options: QueryOptions = {}): AsyncGenerator<QueryEvent> {\n    if (!this.running) {\n      throw new Error('QueryManager not started')\n    }\n\n    if (options.signal == null) {\n      // don't let queries run forever\n      const signal = AbortSignal.timeout(DEFAULT_QUERY_TIMEOUT)\n\n      // this signal will get listened to for network requests, etc\n      // so make sure we don't make a lot of noise in the logs\n      setMaxListeners(Infinity, signal)\n\n      options = {\n        ...options,\n        signal\n      }\n    }\n\n    // if the user breaks out of a for..await of loop iterating over query\n    // results we need to cancel any in-flight network requests\n    const queryEarlyExitController = new AbortController()\n\n    const signal = anySignal([\n      this.shutDownController.signal,\n      queryEarlyExitController.signal,\n      options.signal\n    ])\n\n    // this signal will get listened to for every invocation of queryFunc\n    // so make sure we don't make a lot of noise in the logs\n    setMaxListeners(Infinity, signal, queryEarlyExitController.signal)\n\n    const log = this.logger.forComponent(`${this.logPrefix}:query:` + uint8ArrayToString(key, 'base58btc'))\n\n    // query a subset of peers up to `kBucketSize / 2` in length\n    let queryFinished = false\n\n    try {\n      if (options.isSelfQuery !== true && this.initialQuerySelfHasRun != null) {\n        log('waiting for initial query-self query before continuing')\n\n        await raceSignal(this.initialQuerySelfHasRun.promise, signal)\n\n        this.initialQuerySelfHasRun = undefined\n      }\n\n      log('query:start')\n\n      const id = await convertBuffer(key)\n      const peers = this.routingTable.closestPeers(id)\n      const peersToQuery = peers.slice(0, Math.min(this.disjointPaths, peers.length))\n\n      if (peers.length === 0) {\n        log.error('Running query with no peers')\n        return\n      }\n\n      // make sure we don't get trapped in a loop\n      const peersSeen = new PeerSet()\n\n      // Create query paths from the starting peers\n      const paths = peersToQuery.map((peer, index) => {\n        return queryPath({\n          ...options,\n          key,\n          startingPeer: peer,\n          ourPeerId: this.peerId,\n          signal,\n          query: queryFunc,\n          pathIndex: index,\n          numPaths: peersToQuery.length,\n          alpha: this.alpha,\n          queryFuncTimeout: options.queryFuncTimeout,\n          log,\n          peersSeen,\n          onProgress: options.onProgress,\n          connectionManager: this.connectionManager\n        })\n      })\n\n      // Execute the query along each disjoint path and yield their results as they become available\n      for await (const event of merge(...paths)) {\n        if (event.name === 'QUERY_ERROR') {\n          log.error('query error', event.error)\n        }\n\n        if (event.name === 'PEER_RESPONSE') {\n          for (const peer of [...event.closer, ...event.providers]) {\n            // eslint-disable-next-line max-depth\n            if (!(await this.connectionManager.isDialable(peer.multiaddrs))) {\n              continue\n            }\n\n            await this.routingTable.add(peer.id)\n          }\n        }\n\n        yield event\n      }\n\n      queryFinished = true\n    } catch (err: any) {\n      if (!this.running && err.name === 'QueryAbortedError') {\n        // ignore query aborted errors that were thrown during query manager shutdown\n      } else {\n        throw err\n      }\n    } finally {\n      if (!queryFinished) {\n        log('query exited early')\n        queryEarlyExitController.abort()\n      }\n\n      signal.clear()\n\n      log('query:done')\n    }\n  }\n}\n", "/**\n * @packageDocumentation\n *\n * Counts the number of items in an (async)iterable.\n *\n * N.b. will consume the iterable\n *\n * @example\n *\n * ```javascript\n * import length from 'it-length'\n *\n * // This can also be an iterator, generator, etc\n * const values = [0, 1, 2, 3, 4]\n *\n * const res = length(values)\n *\n * console.info(res) // 5\n * ```\n *\n * Async sources must be awaited:\n *\n * ```javascript\n * import length from 'it-length'\n *\n * const values = async function * () {\n *   yield * [0, 1, 2, 3, 4]\n * }\n *\n * const res = await length(values())\n *\n * console.info(res) // 5\n * ```\n */\n\nfunction isAsyncIterable <T> (thing: any): thing is AsyncIterable<T> {\n  return thing[Symbol.asyncIterator] != null\n}\n\n/**\n * Consumes the passed iterator and returns the number of items it contained\n */\nfunction length (source: Iterable<unknown>): number\nfunction length (source: Iterable<unknown> | AsyncIterable<unknown>): Promise<number>\nfunction length (source: Iterable<unknown> | AsyncIterable<unknown>): Promise<number> | number {\n  if (isAsyncIterable(source)) {\n    return (async () => {\n      let count = 0\n\n      for await (const _ of source) { // eslint-disable-line no-unused-vars,@typescript-eslint/no-unused-vars\n        count++\n      }\n\n      return count\n    })()\n  } else {\n    let count = 0\n\n    for (const _ of source) { // eslint-disable-line no-unused-vars,@typescript-eslint/no-unused-vars\n      count++\n    }\n\n    return count\n  }\n}\n\nexport default length\n", "import pTimeout from 'p-timeout';\n\nconst normalizeEmitter = emitter => {\n\tconst addListener = emitter.addEventListener || emitter.on || emitter.addListener;\n\tconst removeListener = emitter.removeEventListener || emitter.off || emitter.removeListener;\n\n\tif (!addListener || !removeListener) {\n\t\tthrow new TypeError('Emitter is not compatible');\n\t}\n\n\treturn {\n\t\taddListener: addListener.bind(emitter),\n\t\tremoveListener: removeListener.bind(emitter),\n\t};\n};\n\nexport function pEventMultiple(emitter, event, options) {\n\tlet cancel;\n\tconst returnValue = new Promise((resolve, reject) => {\n\t\toptions = {\n\t\t\trejectionEvents: ['error'],\n\t\t\tmultiArgs: false,\n\t\t\tresolveImmediately: false,\n\t\t\t...options,\n\t\t};\n\n\t\tif (!(options.count >= 0 && (options.count === Number.POSITIVE_INFINITY || Number.isInteger(options.count)))) {\n\t\t\tthrow new TypeError('The `count` option should be at least 0 or more');\n\t\t}\n\n\t\toptions.signal?.throwIfAborted();\n\n\t\t// Allow multiple events\n\t\tconst events = [event].flat();\n\n\t\tconst items = [];\n\t\tconst {addListener, removeListener} = normalizeEmitter(emitter);\n\n\t\tconst onItem = (...arguments_) => {\n\t\t\tconst value = options.multiArgs ? arguments_ : arguments_[0];\n\n\t\t\t// eslint-disable-next-line unicorn/no-array-callback-reference\n\t\t\tif (options.filter && !options.filter(value)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\titems.push(value);\n\n\t\t\tif (options.count === items.length) {\n\t\t\t\tcancel();\n\t\t\t\tresolve(items);\n\t\t\t}\n\t\t};\n\n\t\tconst rejectHandler = error => {\n\t\t\tcancel();\n\t\t\treject(error);\n\t\t};\n\n\t\tcancel = () => {\n\t\t\tfor (const event of events) {\n\t\t\t\tremoveListener(event, onItem);\n\t\t\t}\n\n\t\t\tfor (const rejectionEvent of options.rejectionEvents) {\n\t\t\t\tremoveListener(rejectionEvent, rejectHandler);\n\t\t\t}\n\t\t};\n\n\t\tfor (const event of events) {\n\t\t\taddListener(event, onItem);\n\t\t}\n\n\t\tfor (const rejectionEvent of options.rejectionEvents) {\n\t\t\taddListener(rejectionEvent, rejectHandler);\n\t\t}\n\n\t\tif (options.signal) {\n\t\t\toptions.signal.addEventListener('abort', () => {\n\t\t\t\trejectHandler(options.signal.reason);\n\t\t\t}, {once: true});\n\t\t}\n\n\t\tif (options.resolveImmediately) {\n\t\t\tresolve(items);\n\t\t}\n\t});\n\n\treturnValue.cancel = cancel;\n\n\tif (typeof options.timeout === 'number') {\n\t\tconst timeout = pTimeout(returnValue, {milliseconds: options.timeout});\n\t\ttimeout.cancel = cancel;\n\t\treturn timeout;\n\t}\n\n\treturn returnValue;\n}\n\nexport function pEvent(emitter, event, options) {\n\tif (typeof options === 'function') {\n\t\toptions = {filter: options};\n\t}\n\n\toptions = {\n\t\t...options,\n\t\tcount: 1,\n\t\tresolveImmediately: false,\n\t};\n\n\tconst arrayPromise = pEventMultiple(emitter, event, options);\n\tconst promise = arrayPromise.then(array => array[0]);\n\tpromise.cancel = arrayPromise.cancel;\n\n\treturn promise;\n}\n\nexport function pEventIterator(emitter, event, options) {\n\tif (typeof options === 'function') {\n\t\toptions = {filter: options};\n\t}\n\n\t// Allow multiple events\n\tconst events = [event].flat();\n\n\toptions = {\n\t\trejectionEvents: ['error'],\n\t\tresolutionEvents: [],\n\t\tlimit: Number.POSITIVE_INFINITY,\n\t\tmultiArgs: false,\n\t\t...options,\n\t};\n\n\tconst {limit} = options;\n\tconst isValidLimit = limit >= 0 && (limit === Number.POSITIVE_INFINITY || Number.isInteger(limit));\n\tif (!isValidLimit) {\n\t\tthrow new TypeError('The `limit` option should be a non-negative integer or Infinity');\n\t}\n\n\toptions.signal?.throwIfAborted();\n\n\tif (limit === 0) {\n\t\t// Return an empty async iterator to avoid any further cost\n\t\treturn {\n\t\t\t[Symbol.asyncIterator]() {\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tasync next() {\n\t\t\t\treturn {\n\t\t\t\t\tdone: true,\n\t\t\t\t\tvalue: undefined,\n\t\t\t\t};\n\t\t\t},\n\t\t};\n\t}\n\n\tconst {addListener, removeListener} = normalizeEmitter(emitter);\n\n\tlet isDone = false;\n\tlet error;\n\tlet hasPendingError = false;\n\tconst nextQueue = [];\n\tconst valueQueue = [];\n\tlet eventCount = 0;\n\tlet isLimitReached = false;\n\n\tconst valueHandler = (...arguments_) => {\n\t\teventCount++;\n\t\tisLimitReached = eventCount === limit;\n\n\t\tconst value = options.multiArgs ? arguments_ : arguments_[0];\n\n\t\tif (nextQueue.length > 0) {\n\t\t\tconst {resolve} = nextQueue.shift();\n\n\t\t\tresolve({done: false, value});\n\n\t\t\tif (isLimitReached) {\n\t\t\t\tcancel();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tvalueQueue.push(value);\n\n\t\tif (isLimitReached) {\n\t\t\tcancel();\n\t\t}\n\t};\n\n\tconst cancel = () => {\n\t\tisDone = true;\n\n\t\tfor (const event of events) {\n\t\t\tremoveListener(event, valueHandler);\n\t\t}\n\n\t\tfor (const rejectionEvent of options.rejectionEvents) {\n\t\t\tremoveListener(rejectionEvent, rejectHandler);\n\t\t}\n\n\t\tfor (const resolutionEvent of options.resolutionEvents) {\n\t\t\tremoveListener(resolutionEvent, resolveHandler);\n\t\t}\n\n\t\twhile (nextQueue.length > 0) {\n\t\t\tconst {resolve} = nextQueue.shift();\n\t\t\tresolve({done: true, value: undefined});\n\t\t}\n\t};\n\n\tconst rejectHandler = (...arguments_) => {\n\t\terror = options.multiArgs ? arguments_ : arguments_[0];\n\n\t\tif (nextQueue.length > 0) {\n\t\t\tconst {reject} = nextQueue.shift();\n\t\t\treject(error);\n\t\t} else {\n\t\t\thasPendingError = true;\n\t\t}\n\n\t\tcancel();\n\t};\n\n\tconst resolveHandler = (...arguments_) => {\n\t\tconst value = options.multiArgs ? arguments_ : arguments_[0];\n\n\t\t// eslint-disable-next-line unicorn/no-array-callback-reference\n\t\tif (options.filter && !options.filter(value)) {\n\t\t\tcancel();\n\t\t\treturn;\n\t\t}\n\n\t\tif (nextQueue.length > 0) {\n\t\t\tconst {resolve} = nextQueue.shift();\n\t\t\tresolve({done: true, value});\n\t\t} else {\n\t\t\tvalueQueue.push(value);\n\t\t}\n\n\t\tcancel();\n\t};\n\n\tfor (const event of events) {\n\t\taddListener(event, valueHandler);\n\t}\n\n\tfor (const rejectionEvent of options.rejectionEvents) {\n\t\taddListener(rejectionEvent, rejectHandler);\n\t}\n\n\tfor (const resolutionEvent of options.resolutionEvents) {\n\t\taddListener(resolutionEvent, resolveHandler);\n\t}\n\n\tif (options.signal) {\n\t\toptions.signal.addEventListener('abort', () => {\n\t\t\trejectHandler(options.signal.reason);\n\t\t}, {once: true});\n\t}\n\n\treturn {\n\t\t[Symbol.asyncIterator]() {\n\t\t\treturn this;\n\t\t},\n\t\tasync next() {\n\t\t\tif (valueQueue.length > 0) {\n\t\t\t\tconst value = valueQueue.shift();\n\t\t\t\treturn {\n\t\t\t\t\tdone: isDone && valueQueue.length === 0 && !isLimitReached,\n\t\t\t\t\tvalue,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (hasPendingError) {\n\t\t\t\thasPendingError = false;\n\t\t\t\tthrow error;\n\t\t\t}\n\n\t\t\tif (isDone) {\n\t\t\t\treturn {\n\t\t\t\t\tdone: true,\n\t\t\t\t\tvalue: undefined,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tnextQueue.push({resolve, reject});\n\t\t\t});\n\t\t},\n\t\tasync return(value) {\n\t\t\tcancel();\n\t\t\treturn {\n\t\t\t\tdone: isDone,\n\t\t\t\tvalue,\n\t\t\t};\n\t\t},\n\t};\n}\n\nexport {TimeoutError} from 'p-timeout';\n", "import { setMaxListeners } from '@libp2p/interface'\nimport { anySignal } from 'any-signal'\nimport length from 'it-length'\nimport { pipe } from 'it-pipe'\nimport take from 'it-take'\nimport pDefer from 'p-defer'\nimport { pEvent } from 'p-event'\nimport { QUERY_SELF_INTERVAL, QUERY_SELF_TIMEOUT, K, QUERY_SELF_INITIAL_INTERVAL } from './constants.js'\nimport { timeOperationMethod } from './utils.js'\nimport type { OperationMetrics } from './kad-dht.js'\nimport type { PeerRouting } from './peer-routing/index.js'\nimport type { RoutingTable } from './routing-table/index.js'\nimport type { ComponentLogger, Logger, Metrics, PeerId, Startable } from '@libp2p/interface'\nimport type { DeferredPromise } from 'p-defer'\nexport interface QuerySelfInit {\n  logPrefix: string\n  peerRouting: PeerRouting\n  routingTable: RoutingTable\n  count?: number\n  interval?: number\n  initialInterval?: number\n  queryTimeout?: number\n  initialQuerySelfHasRun: DeferredPromise<void>\n  operationMetrics: OperationMetrics\n}\n\nexport interface QuerySelfComponents {\n  peerId: PeerId\n  logger: ComponentLogger\n  metrics?: Metrics\n}\n\n/**\n * Receives notifications of new peers joining the network that support the DHT protocol\n */\nexport class QuerySelf implements Startable {\n  private readonly log: Logger\n  private readonly peerId: PeerId\n  private readonly peerRouting: PeerRouting\n  private readonly routingTable: RoutingTable\n  private readonly count: number\n  private readonly interval: number\n  private readonly initialInterval: number\n  private readonly queryTimeout: number\n  private running: boolean\n  private timeoutId?: ReturnType<typeof setTimeout>\n  private controller?: AbortController\n  private initialQuerySelfHasRun?: DeferredPromise<void>\n  private querySelfPromise?: DeferredPromise<void>\n\n  constructor (components: QuerySelfComponents, init: QuerySelfInit) {\n    this.peerId = components.peerId\n    this.log = components.logger.forComponent(`${init.logPrefix}:query-self`)\n    this.running = false\n    this.peerRouting = init.peerRouting\n    this.routingTable = init.routingTable\n    this.count = init.count ?? K\n    this.interval = init.interval ?? QUERY_SELF_INTERVAL\n    this.initialInterval = init.initialInterval ?? QUERY_SELF_INITIAL_INTERVAL\n    this.queryTimeout = init.queryTimeout ?? QUERY_SELF_TIMEOUT\n    this.initialQuerySelfHasRun = init.initialQuerySelfHasRun\n\n    this.querySelf = timeOperationMethod(this.querySelf.bind(this), init.operationMetrics, 'SELF_QUERY')\n  }\n\n  isStarted (): boolean {\n    return this.running\n  }\n\n  start (): void {\n    if (this.running) {\n      return\n    }\n\n    this.running = true\n    clearTimeout(this.timeoutId)\n    this.timeoutId = setTimeout(() => {\n      this.querySelf()\n        .catch(err => {\n          this.log.error('error running self-query', err)\n        })\n    }, this.initialInterval)\n  }\n\n  stop (): void {\n    this.running = false\n\n    if (this.timeoutId != null) {\n      clearTimeout(this.timeoutId)\n    }\n\n    if (this.controller != null) {\n      this.controller.abort()\n    }\n  }\n\n  async querySelf (): Promise<void> {\n    if (!this.running) {\n      this.log('skip self-query because we are not started')\n      return\n    }\n\n    if (this.querySelfPromise != null) {\n      this.log('joining existing self query')\n      return this.querySelfPromise.promise\n    }\n\n    this.querySelfPromise = pDefer()\n\n    if (this.running) {\n      this.controller = new AbortController()\n      const signals = [this.controller.signal]\n\n      // add a shorter timeout if we've already run our initial self query\n      if (this.initialQuerySelfHasRun == null) {\n        const timeoutSignal = AbortSignal.timeout(this.queryTimeout)\n        setMaxListeners(Infinity, timeoutSignal)\n        signals.push(timeoutSignal)\n      }\n\n      const signal = anySignal(signals)\n      setMaxListeners(Infinity, signal, this.controller.signal)\n\n      try {\n        if (this.routingTable.size === 0) {\n          this.log('routing table was empty, waiting for some peers before running query')\n          // wait to discover at least one DHT peer that isn't us\n          await pEvent(this.routingTable, 'peer:add', {\n            signal,\n            filter: (event) => !this.peerId.equals(event.detail)\n          })\n          this.log('routing table has peers, continuing with query')\n        }\n\n        this.log('run self-query, look for %d peers timing out after %dms', this.count, this.queryTimeout)\n        const start = Date.now()\n\n        const found = await pipe(\n          this.peerRouting.getClosestPeers(this.peerId.toMultihash().bytes, {\n            signal,\n            isSelfQuery: true\n          }),\n          (source) => take(source, this.count),\n          async (source) => length(source)\n        )\n\n        this.log('self-query found %d peers in %dms', found, Date.now() - start)\n      } catch (err: any) {\n        this.log.error('self-query error', err)\n      } finally {\n        signal.clear()\n\n        if (this.initialQuerySelfHasRun != null) {\n          this.initialQuerySelfHasRun.resolve()\n          this.initialQuerySelfHasRun = undefined\n        }\n      }\n    }\n\n    this.querySelfPromise.resolve()\n    this.querySelfPromise = undefined\n\n    if (!this.running) {\n      return\n    }\n\n    this.timeoutId = setTimeout(() => {\n      this.querySelf()\n        .catch(err => {\n          this.log.error('error running self-query', err)\n        })\n    }, this.interval)\n  }\n}\n", "import { TypedEventEmitter, setMaxListeners } from '@libp2p/interface'\nimport { AdaptiveTimeout } from '@libp2p/utils/adaptive-timeout'\nimport { Queue } from '@libp2p/utils/queue'\nimport drain from 'it-drain'\nimport { PROVIDERS_VALIDITY, REPROVIDE_CONCURRENCY, REPROVIDE_INTERVAL, REPROVIDE_MAX_QUEUE_SIZE, REPROVIDE_THRESHOLD } from './constants.js'\nimport { parseProviderKey, readProviderTime, timeOperationMethod } from './utils.js'\nimport type { ContentRouting } from './content-routing/index.js'\nimport type { OperationMetrics } from './kad-dht.js'\nimport type { AbortOptions, ComponentLogger, Logger, Metrics, PeerId } from '@libp2p/interface'\nimport type { AddressManager } from '@libp2p/interface-internal'\nimport type { AdaptiveTimeoutInit } from '@libp2p/utils/adaptive-timeout'\nimport type { Datastore } from 'interface-datastore'\nimport type { Mortice } from 'mortice'\nimport type { CID } from 'multiformats/cid'\n\nexport interface ReproviderComponents {\n  peerId: PeerId\n  datastore: Datastore\n  logger: ComponentLogger\n  addressManager: AddressManager\n  metrics?: Metrics\n}\n\nexport interface ReproviderInit {\n  logPrefix: string\n  metricsPrefix: string\n  datastorePrefix: string\n  contentRouting: ContentRouting\n  lock: Mortice\n  operationMetrics: OperationMetrics\n  concurrency?: number\n  maxQueueSize?: number\n  threshold?: number\n  validity?: number\n  interval?: number\n  timeout?: Omit<AdaptiveTimeoutInit, 'metricsName' | 'metrics'>\n}\n\ninterface QueueJobOptions extends AbortOptions {\n  cid: CID\n}\n\ninterface ReprovideEvents {\n  'reprovide:start': CustomEvent\n  'reprovide:end': CustomEvent\n}\n\nexport class Reprovider extends TypedEventEmitter<ReprovideEvents> {\n  private readonly log: Logger\n  private readonly reprovideQueue: Queue<void, QueueJobOptions>\n  private readonly maxQueueSize: number\n  private readonly datastore: Datastore\n  private timeout?: ReturnType<typeof setTimeout>\n  private readonly reprovideTimeout: AdaptiveTimeout\n  private running: boolean\n  private shutdownController?: AbortController\n  private readonly reprovideThreshold: number\n  private readonly contentRouting: ContentRouting\n  private readonly datastorePrefix: string\n  private readonly addressManager: AddressManager\n  private readonly validity: number\n  private readonly interval: number\n  private readonly lock: Mortice\n  private readonly peerId: PeerId\n\n  constructor (components: ReproviderComponents, init: ReproviderInit) {\n    super()\n\n    this.log = components.logger.forComponent(`${init.logPrefix}:reprovider`)\n    this.peerId = components.peerId\n    this.reprovideQueue = new Queue({\n      concurrency: init.concurrency ?? REPROVIDE_CONCURRENCY,\n      metrics: components.metrics,\n      metricName: `${init.metricsPrefix}_reprovide_queue`\n    })\n    this.reprovideTimeout = new AdaptiveTimeout({\n      ...(init.timeout ?? {}),\n      metrics: components.metrics,\n      metricName: `${init.metricsPrefix}_reprovide_timeout_milliseconds`\n    })\n    this.datastore = components.datastore\n    this.addressManager = components.addressManager\n    this.datastorePrefix = `${init.datastorePrefix}/provider`\n    this.reprovideThreshold = init.threshold ?? REPROVIDE_THRESHOLD\n    this.maxQueueSize = init.maxQueueSize ?? REPROVIDE_MAX_QUEUE_SIZE\n    this.validity = init.validity ?? PROVIDERS_VALIDITY\n    this.interval = init.interval ?? REPROVIDE_INTERVAL\n    this.contentRouting = init.contentRouting\n    this.lock = init.lock\n    this.running = false\n\n    this.reprovide = timeOperationMethod(this.reprovide.bind(this), init.operationMetrics, 'PROVIDE')\n  }\n\n  start (): void {\n    if (this.running) {\n      return\n    }\n\n    this.running = true\n\n    this.shutdownController = new AbortController()\n    setMaxListeners(Infinity, this.shutdownController.signal)\n\n    this.timeout = setTimeout(() => {\n      this.cleanUp().catch(err => {\n        this.log.error('error running reprovide/cleanup - %e', err)\n      })\n    }, this.interval)\n  }\n\n  stop (): void {\n    this.running = false\n    this.reprovideQueue.clear()\n    clearTimeout(this.timeout)\n    this.shutdownController?.abort()\n  }\n\n  /**\n   * Check all provider records. Delete them if they have expired, reprovide\n   * them if the provider is us and the expiry is within the reprovide window.\n   */\n  private async cleanUp (): Promise<void> {\n    const release = await this.lock.writeLock()\n\n    try {\n      this.safeDispatchEvent('reprovide:start')\n\n      // Get all provider entries from the datastore\n      for await (const entry of this.datastore.query({\n        prefix: this.datastorePrefix\n      })) {\n        try {\n          // Add a delete to the batch for each expired entry\n          const { cid, peerId } = parseProviderKey(entry.key)\n          const created = readProviderTime(entry.value).getTime()\n          const expires = created + this.validity\n          const now = Date.now()\n          const expired = now > expires\n\n          this.log.trace('comparing: %d < %d = %s %s', created, now - this.validity, expired, expired ? '(expired)' : '')\n\n          // delete the record if it has expired\n          if (expired) {\n            await this.datastore.delete(entry.key)\n          }\n\n          // if the provider is us and we are within the reprovide threshold,\n          // reprovide the record\n          if (this.peerId.equals(peerId) && (now - expires) < this.reprovideThreshold) {\n            this.queueReprovide(cid)\n              .catch(err => {\n                this.log.error('could not reprovide %c - %e', cid, err)\n              })\n          }\n        } catch (err: any) {\n          this.log.error('error processing datastore key %s - %e', entry.key, err.message)\n        }\n      }\n\n      this.log('reprovide/cleanup successful')\n    } finally {\n      release()\n      this.safeDispatchEvent('reprovide:end')\n\n      if (this.running) {\n        this.timeout = setTimeout(() => {\n          this.cleanUp().catch(err => {\n            this.log.error('error running re-provide - %e', err)\n          })\n        }, this.interval)\n      }\n    }\n  }\n\n  private async queueReprovide (cid: CID): Promise<void> {\n    if (!this.running) {\n      return\n    }\n\n    this.log.trace('waiting for queue capacity before adding %c to re-provide queue', cid)\n    await this.reprovideQueue.onSizeLessThan(this.maxQueueSize)\n\n    const existingJob = this.reprovideQueue.queue.find(job => job.options.cid.equals(cid))\n\n    if (existingJob != null) {\n      this.log.trace('not adding %c to re-provide queue - already in queue', cid)\n      return existingJob.join()\n    }\n\n    this.log.trace('adding %c to re-provide queue', cid)\n\n    this.reprovideQueue.add(async (options): Promise<void> => {\n      options.signal?.throwIfAborted()\n\n      if (!this.running) {\n        return\n      }\n\n      this.log.trace('re-providing %c', cid)\n\n      // use adaptive timeout\n      const signal = this.reprovideTimeout.getTimeoutSignal(options)\n\n      try {\n        // reprovide\n        await this.reprovide(options.cid, options)\n      } finally {\n        this.reprovideTimeout.cleanUp(signal)\n      }\n\n      this.log.trace('re-provided %c', cid)\n    }, {\n      signal: this.shutdownController?.signal,\n      cid\n    })\n      .catch(err => {\n        this.log.error('could not re-provide key %c - %e', cid, err)\n      })\n  }\n\n  private async reprovide (cid: CID, options?: AbortOptions): Promise<void> {\n    // reprovide\n    await drain(this.contentRouting.provide(cid, this.addressManager.getAddresses(), options))\n  }\n}\n", "import { PeerSet } from '@libp2p/peer-collections'\nimport { KEEP_ALIVE_TAG } from '../constants.js'\nimport { PeerDistanceList } from '../peer-distance-list.js'\nimport { convertPeerId } from '../utils.js'\nimport type { RoutingTable } from './index.js'\nimport type { ComponentLogger, Logger, Metrics, PeerId, PeerStore, Startable } from '@libp2p/interface'\n\nexport const PEER_SET_SIZE = 20\nexport const REFRESH_INTERVAL = 5000\nexport const KAD_CLOSE_TAG_NAME = 'kad-close'\nexport const KAD_CLOSE_TAG_VALUE = 50\n\nexport interface ClosestPeersInit {\n  logPrefix: string\n  routingTable: RoutingTable\n  peerSetSize?: number\n  refreshInterval?: number\n  closeTagName?: string\n  closeTagValue?: number\n}\n\nexport interface ClosestPeersComponents {\n  peerId: PeerId\n  peerStore: PeerStore\n  metrics?: Metrics\n  logger: ComponentLogger\n}\n\n/**\n * Contains a list of the kad-closest peers encountered on the network.\n *\n * Once every few seconds, if the list has changed, it tags the closest peers.\n */\nexport class ClosestPeers implements Startable {\n  private readonly routingTable: RoutingTable\n  private readonly components: ClosestPeersComponents\n  private closestPeers: PeerSet\n  private newPeers?: PeerDistanceList\n  private readonly refreshInterval: number\n  private readonly peerSetSize: number\n  private timeout?: ReturnType<typeof setTimeout>\n  private readonly closeTagName: string\n  private readonly closeTagValue: number\n  private readonly log: Logger\n  private running: boolean\n\n  constructor (components: ClosestPeersComponents, init: ClosestPeersInit) {\n    this.components = components\n    this.log = components.logger.forComponent(`${init.logPrefix}:routing-table`)\n    this.routingTable = init.routingTable\n    this.refreshInterval = init.refreshInterval ?? REFRESH_INTERVAL\n    this.peerSetSize = init.peerSetSize ?? PEER_SET_SIZE\n    this.closeTagName = init.closeTagName ?? KAD_CLOSE_TAG_NAME\n    this.closeTagValue = init.closeTagValue ?? KAD_CLOSE_TAG_VALUE\n\n    this.closestPeers = new PeerSet()\n    this.onPeerPing = this.onPeerPing.bind(this)\n    this.running = false\n  }\n\n  async start (): Promise<void> {\n    if (this.running) {\n      return\n    }\n\n    this.running = true\n\n    const targetKadId = await convertPeerId(this.components.peerId)\n    this.newPeers = new PeerDistanceList(targetKadId, this.peerSetSize)\n    this.routingTable.addEventListener('peer:ping', this.onPeerPing)\n\n    this.timeout = setInterval(() => {\n      this.updatePeerTags()\n        .catch(err => {\n          this.log.error('error updating peer tags - %e', err)\n        })\n    }, this.refreshInterval)\n  }\n\n  stop (): void {\n    this.running = false\n    this.routingTable.removeEventListener('peer:ping', this.onPeerPing)\n    clearTimeout(this.timeout)\n  }\n\n  onPeerPing (event: CustomEvent<PeerId>): void {\n    this.newPeers?.add({ id: event.detail, multiaddrs: [] })\n      .catch(err => {\n        this.log.error('error adding peer to distance list - %e', err)\n      })\n  }\n\n  async updatePeerTags (): Promise<void> {\n    const newClosest = new PeerSet(this.newPeers?.peers.map(peer => peer.id))\n    const added = newClosest.difference(this.closestPeers)\n    const removed = this.closestPeers.difference(newClosest)\n    this.closestPeers = newClosest\n\n    await Promise.all([\n      ...[...added].map(async peerId => {\n        await this.components.peerStore.merge(peerId, {\n          tags: {\n            [this.closeTagName]: {\n              value: this.closeTagValue\n            },\n            [KEEP_ALIVE_TAG]: {\n              value: 1\n            }\n          }\n        })\n      }),\n      ...[...removed].map(async peerId => {\n        await this.components.peerStore.merge(peerId, {\n          tags: {\n            [this.closeTagName]: undefined,\n            [KEEP_ALIVE_TAG]: undefined\n          }\n        })\n      })\n    ])\n  }\n}\n", "import { PeerMap } from '@libp2p/peer-collections'\nimport map from 'it-map'\nimport { equals as uint8ArrayEquals } from 'uint8arrays/equals'\nimport { toString as uint8ArrayToString } from 'uint8arrays/to-string'\nimport { xor as uint8ArrayXor } from 'uint8arrays/xor'\nimport { PeerDistanceList } from '../peer-distance-list.js'\nimport { convertPeerId } from '../utils.js'\nimport { KBUCKET_SIZE, LAST_PING_THRESHOLD, PING_OLD_CONTACT_COUNT, PREFIX_LENGTH } from './index.js'\nimport type { PeerId } from '@libp2p/interface'\nimport type { AbortOptions } from 'it-protobuf-stream'\n\nexport interface PingFunction {\n  /**\n   * Return either none or at least one contact that does not respond to a ping\n   * message\n   */\n  (oldContacts: Peer[], options?: AbortOptions): AsyncGenerator<Peer>\n}\n\n/**\n * Before a peer can be added to the table, verify that it is online and working\n * correctly\n */\nexport interface VerifyFunction {\n  (contact: Peer, options?: AbortOptions): Promise<boolean>\n}\n\nexport interface OnAddCallback {\n  /**\n   * Invoked when a new peer is added to the routing tables\n   */\n  (peer: Peer, bucket: LeafBucket): Promise<void>\n}\n\nexport interface OnRemoveCallback {\n  /**\n   * Invoked when a peer is evicted from the routing tables\n   */\n  (peer: Peer, bucket: LeafBucket): Promise<void>\n}\n\nexport interface OnMoveCallback {\n  /**\n   * Invoked when a peer is moved between buckets in the routing tables\n   */\n  (peer: Peer, oldBucket: LeafBucket, newBucket: LeafBucket): Promise<void>\n}\n\nexport interface KBucketOptions {\n  /**\n   * The current peer. All subsequently added peers must have a KadID that is\n   * the same length as this peer.\n   */\n  // localPeer: Peer\n\n  /**\n   * How many bits of the key to use when forming the bucket trie. The larger\n   * this value, the deeper the tree will grow and the slower the lookups will\n   * be but the peers returned will be more specific to the key.\n   *\n   * @default 8\n   */\n  prefixLength?: number\n\n  /**\n   * The number of nodes that a max-depth k-bucket can contain before being\n   * full.\n   *\n   * @default 20\n   */\n  kBucketSize?: number\n\n  /**\n   * The number of nodes that an intermediate k-bucket can contain before being\n   * split.\n   *\n   * @default kBucketSize\n   */\n  splitThreshold?: number\n\n  /**\n   * The number of nodes to ping when a bucket that should not be split becomes\n   * full. KBucket will emit a `ping` event that contains\n   * `numberOfOldContactsToPing` nodes that have not been contacted the longest.\n   *\n   * @default 3\n   */\n  numberOfOldContactsToPing?: number\n\n  /**\n   * Do not re-ping a peer during this time window in ms\n   *\n   * @default 600000\n   */\n  lastPingThreshold?: number\n\n  ping: PingFunction\n  verify: VerifyFunction\n  onAdd?: OnAddCallback\n  onRemove?: OnRemoveCallback\n}\n\nexport interface Peer {\n  kadId: Uint8Array\n  peerId: PeerId\n  lastPing: number\n}\n\nexport interface LeafBucket {\n  prefix: string\n  depth: number\n  peers: Peer[]\n}\n\nexport interface InternalBucket {\n  prefix: string\n  depth: number\n  left: Bucket\n  right: Bucket\n}\n\nexport type Bucket = LeafBucket | InternalBucket\n\nexport function isLeafBucket (obj: any): obj is LeafBucket {\n  return Array.isArray(obj?.peers)\n}\n\n/**\n * Implementation of a Kademlia DHT routing table as a prefix binary trie with\n * configurable prefix length, bucket split threshold and size.\n */\nexport class KBucket {\n  public root: Bucket\n  public localPeer?: Peer\n  private readonly prefixLength: number\n  private readonly splitThreshold: number\n  private readonly kBucketSize: number\n  private readonly numberOfNodesToPing: number\n  private readonly lastPingThreshold: number\n  public ping: PingFunction\n  public verify: VerifyFunction\n  private readonly onAdd?: OnAddCallback\n  private readonly onRemove?: OnRemoveCallback\n  private readonly onMove?: OnMoveCallback\n  private readonly addingPeerMap: PeerMap<Promise<void>>\n\n  constructor (options: KBucketOptions) {\n    this.prefixLength = options.prefixLength ?? PREFIX_LENGTH\n    this.kBucketSize = options.kBucketSize ?? KBUCKET_SIZE\n    this.splitThreshold = options.splitThreshold ?? this.kBucketSize\n    this.numberOfNodesToPing = options.numberOfOldContactsToPing ?? PING_OLD_CONTACT_COUNT\n    this.lastPingThreshold = options.lastPingThreshold ?? LAST_PING_THRESHOLD\n    this.ping = options.ping\n    this.verify = options.verify\n    this.onAdd = options.onAdd\n    this.onRemove = options.onRemove\n    this.addingPeerMap = new PeerMap()\n\n    this.root = {\n      prefix: '',\n      depth: 0,\n      peers: []\n    }\n  }\n\n  async addSelfPeer (peerId: PeerId): Promise<void> {\n    this.localPeer = {\n      peerId,\n      kadId: await convertPeerId(peerId),\n      lastPing: Date.now()\n    }\n  }\n\n  /**\n   * Adds a contact to the trie\n   */\n  async add (peerId: PeerId, options?: AbortOptions): Promise<void> {\n    const peer = {\n      peerId,\n      kadId: await convertPeerId(peerId),\n      lastPing: 0\n    }\n\n    const existingPromise = this.addingPeerMap.get(peerId)\n\n    if (existingPromise != null) {\n      return existingPromise\n    }\n\n    try {\n      const p = this._add(peer, options)\n      this.addingPeerMap.set(peerId, p)\n      await p\n    } finally {\n      this.addingPeerMap.delete(peerId)\n    }\n  }\n\n  private async _add (peer: Peer, options?: AbortOptions): Promise<void> {\n    const bucket = this._determineBucket(peer.kadId)\n\n    // check if the contact already exists\n    if (this._indexOf(bucket, peer.kadId) > -1) {\n      return\n    }\n\n    // are there too many peers in the bucket and can we make the trie deeper?\n    if (bucket.peers.length === this.splitThreshold && bucket.depth < this.prefixLength) {\n      // split the bucket\n      await this._split(bucket)\n\n      // try again\n      await this._add(peer, options)\n\n      return\n    }\n\n    // is there space in the bucket?\n    if (bucket.peers.length < this.kBucketSize) {\n      // we've ping this peer previously, just add them to the bucket\n      if (!needsPing(peer, this.lastPingThreshold)) {\n        bucket.peers.push(peer)\n        await this.onAdd?.(peer, bucket)\n        return\n      }\n\n      const result = await this.verify(peer, options)\n\n      // only add if peer is online and functioning correctly\n      if (result) {\n        peer.lastPing = Date.now()\n\n        // try again - buckets may have changed during ping\n        await this._add(peer, options)\n      }\n\n      return\n    }\n\n    // we are at the bottom of the trie and the bucket is full so we can't add\n    // any more peers.\n    //\n    // instead ping the first `this.numberOfNodesToPing` in order to determine\n    // if they are still online.\n    //\n    // only add the new peer if one of the pinged nodes does not respond, this\n    // prevents DoS flooding with new invalid contacts.\n    const toPing = bucket.peers\n      .filter(peer => {\n        if (peer.peerId.equals(this.localPeer?.peerId)) {\n          return false\n        }\n\n        if (peer.lastPing > (Date.now() - this.lastPingThreshold)) {\n          return false\n        }\n\n        return true\n      })\n      .sort((a, b) => {\n        // sort oldest ping -> newest\n        if (a.lastPing < b.lastPing) {\n          return -1\n        }\n\n        if (a.lastPing > b.lastPing) {\n          return 1\n        }\n\n        return 0\n      })\n      .slice(0, this.numberOfNodesToPing)\n\n    let evicted = false\n\n    for await (const toEvict of this.ping(toPing, options)) {\n      evicted = true\n      await this.remove(toEvict.kadId)\n    }\n\n    // did not evict any peers, cannot add new contact\n    if (!evicted) {\n      return\n    }\n\n    // try again - buckets may have changed during ping\n    await this._add(peer, options)\n  }\n\n  /**\n   * Get 0-n closest contacts to the provided node id. \"Closest\" here means:\n   * closest according to the XOR metric of the contact node id.\n   *\n   * @param {Uint8Array} id - Contact node id\n   * @returns {Generator<Peer, void, undefined>} Array Maximum of n closest contacts to the node id\n   */\n  * closest (id: Uint8Array, n: number = this.kBucketSize): Generator<PeerId, void, undefined> {\n    const list = new PeerDistanceList(id, n)\n\n    for (const peer of this.toIterable()) {\n      list.addWitKadId({ id: peer.peerId, multiaddrs: [] }, peer.kadId)\n    }\n\n    yield * map(list.peers, info => info.id)\n  }\n\n  /**\n   * Counts the total number of contacts in the tree.\n   *\n   * @returns {number} The number of contacts held in the tree\n   */\n  count (): number {\n    function countBucket (bucket: Bucket): number {\n      if (isLeafBucket(bucket)) {\n        return bucket.peers.length\n      }\n\n      let count = 0\n\n      if (bucket.left != null) {\n        count += countBucket(bucket.left)\n      }\n\n      if (bucket.right != null) {\n        count += countBucket(bucket.right)\n      }\n\n      return count\n    }\n\n    return countBucket(this.root)\n  }\n\n  /**\n   * Get a contact by its exact ID.\n   * If this is a leaf, loop through the bucket contents and return the correct\n   * contact if we have it or null if not. If this is an inner node, determine\n   * which branch of the tree to traverse and repeat.\n   *\n   * @param {Uint8Array} kadId - The ID of the contact to fetch.\n   * @returns {Peer | undefined} The contact if available, otherwise null\n   */\n  get (kadId: Uint8Array): Peer | undefined {\n    const bucket = this._determineBucket(kadId)\n    const index = this._indexOf(bucket, kadId)\n\n    return bucket.peers[index]\n  }\n\n  /**\n   * Removes contact with the provided id.\n   *\n   * @param {Uint8Array} kadId - The ID of the contact to remove\n   */\n  async remove (kadId: Uint8Array): Promise<void> {\n    const bucket = this._determineBucket(kadId)\n    const index = this._indexOf(bucket, kadId)\n\n    if (index > -1) {\n      const peer = bucket.peers.splice(index, 1)[0]\n\n      await this.onRemove?.(peer, bucket)\n    }\n  }\n\n  /**\n   * Similar to `toArray()` but instead of buffering everything up into an\n   * array before returning it, yields contacts as they are encountered while\n   * walking the tree.\n   *\n   * @returns {Iterable} All of the contacts in the tree, as an iterable\n   */\n  * toIterable (): Generator<Peer, void, undefined> {\n    function * iterate (bucket: Bucket): Generator<Peer, void, undefined> {\n      if (isLeafBucket(bucket)) {\n        yield * bucket.peers\n        return\n      }\n\n      yield * iterate(bucket.left)\n      yield * iterate(bucket.right)\n    }\n\n    yield * iterate(this.root)\n  }\n\n  /**\n   * Default distance function. Finds the XOR distance between firstId and\n   * secondId.\n   *\n   * @param  {Uint8Array} firstId - Uint8Array containing first id.\n   * @param  {Uint8Array} secondId - Uint8Array containing second id.\n   * @returns {number} Integer The XOR distance between firstId and secondId.\n   */\n  distance (firstId: Uint8Array, secondId: Uint8Array): bigint {\n    return BigInt('0x' + uint8ArrayToString(uint8ArrayXor(firstId, secondId), 'base16'))\n  }\n\n  /**\n   * Determines whether the id at the bitIndex is 0 or 1\n   * Return left leaf if `id` at `bitIndex` is 0, right leaf otherwise\n   *\n   * @param {Uint8Array} kadId - Id to compare localNodeId with\n   * @returns {LeafBucket} left leaf if id at bitIndex is 0, right leaf otherwise.\n   */\n  private _determineBucket (kadId: Uint8Array): LeafBucket {\n    const bitString = uint8ArrayToString(kadId, 'base2')\n\n    function findBucket (bucket: Bucket, bitIndex: number = 0): LeafBucket {\n      if (isLeafBucket(bucket)) {\n        return bucket\n      }\n\n      const bit = bitString[bitIndex]\n\n      if (bit === '0') {\n        return findBucket(bucket.left, bitIndex + 1)\n      }\n\n      return findBucket(bucket.right, bitIndex + 1)\n    }\n\n    return findBucket(this.root)\n  }\n\n  /**\n   * Returns the index of the contact with provided\n   * id if it exists, returns -1 otherwise.\n   *\n   * @param {object} bucket - internal object that has 2 leafs: left and right\n   * @param {Uint8Array} kadId - KadId of peer\n   * @returns {number} Integer Index of contact with provided id if it exists, -1 otherwise.\n   */\n  private _indexOf (bucket: LeafBucket, kadId: Uint8Array): number {\n    return bucket.peers.findIndex(peer => uint8ArrayEquals(peer.kadId, kadId))\n  }\n\n  /**\n   * Modify the bucket, turn it from a leaf bucket to an internal bucket\n   *\n   * @param {any} bucket - bucket for splitting\n   */\n  private async _split (bucket: LeafBucket): Promise<void> {\n    // create child buckets\n    const left: LeafBucket = {\n      prefix: '0',\n      depth: bucket.depth + 1,\n      peers: []\n    }\n    const right: LeafBucket = {\n      prefix: '1',\n      depth: bucket.depth + 1,\n      peers: []\n    }\n\n    // redistribute peers\n    for (const peer of bucket.peers) {\n      const bitString = uint8ArrayToString(peer.kadId, 'base2')\n\n      if (bitString[bucket.depth] === '0') {\n        left.peers.push(peer)\n        await this.onMove?.(peer, bucket, left)\n      } else {\n        right.peers.push(peer)\n        await this.onMove?.(peer, bucket, right)\n      }\n    }\n\n    // convert old leaf bucket to internal bucket\n    convertToInternalBucket(bucket, left, right)\n  }\n}\n\nfunction convertToInternalBucket (bucket: any, left: any, right: any): bucket is InternalBucket {\n  delete bucket.peers\n  bucket.left = left\n  bucket.right = right\n\n  if (bucket.prefix === '') {\n    delete bucket.depth\n    delete bucket.prefix\n  }\n\n  return true\n}\n\nfunction needsPing (peer: Peer, threshold: number): boolean {\n  return peer.lastPing < (Date.now() - threshold)\n}\n", "import { TypedEventEmitter, setMaxListeners, start, stop } from '@libp2p/interface'\nimport { AdaptiveTimeout } from '@libp2p/utils/adaptive-timeout'\nimport { PeerQueue } from '@libp2p/utils/peer-queue'\nimport { anySignal } from 'any-signal'\nimport parallel from 'it-parallel'\nimport { EventTypes } from '../index.js'\nimport { MessageType } from '../message/dht.js'\nimport * as utils from '../utils.js'\nimport { ClosestPeers } from './closest-peers.js'\nimport { KBucket, isLeafBucket } from './k-bucket.js'\nimport type { Bucket, LeafBucket, Peer } from './k-bucket.js'\nimport type { Network } from '../network.js'\nimport type { AbortOptions, ComponentLogger, CounterGroup, Logger, Metric, Metrics, PeerId, PeerStore, Startable, Stream } from '@libp2p/interface'\nimport type { AdaptiveTimeoutInit } from '@libp2p/utils/adaptive-timeout'\n\nexport const KBUCKET_SIZE = 20\nexport const PREFIX_LENGTH = 8\nexport const PING_NEW_CONTACT_TIMEOUT = 2000\nexport const PING_NEW_CONTACT_CONCURRENCY = 20\nexport const PING_NEW_CONTACT_MAX_QUEUE_SIZE = 100\nexport const PING_OLD_CONTACT_COUNT = 3\nexport const PING_OLD_CONTACT_TIMEOUT = 2000\nexport const PING_OLD_CONTACT_CONCURRENCY = 20\nexport const PING_OLD_CONTACT_MAX_QUEUE_SIZE = 100\nexport const KAD_PEER_TAG_NAME = 'kad-peer'\nexport const KAD_PEER_TAG_VALUE = 1\nexport const LAST_PING_THRESHOLD = 600000\nexport const POPULATE_FROM_DATASTORE_ON_START = true\nexport const POPULATE_FROM_DATASTORE_LIMIT = 1000\n\nexport interface RoutingTableInit {\n  logPrefix: string\n  metricsPrefix: string\n  protocol: string\n  prefixLength?: number\n  splitThreshold?: number\n  kBucketSize?: number\n  pingNewContactTimeout?: AdaptiveTimeoutInit\n  pingNewContactConcurrency?: number\n  pingNewContactMaxQueueSize?: number\n  pingOldContactTimeout?: AdaptiveTimeoutInit\n  pingOldContactConcurrency?: number\n  pingOldContactMaxQueueSize?: number\n  numberOfOldContactsToPing?: number\n  peerTagName?: string\n  peerTagValue?: number\n  closeTagName?: string\n  closeTagValue?: number\n  network: Network\n  populateFromDatastoreOnStart?: boolean\n  populateFromDatastoreLimit?: number\n  lastPingThreshold?: number\n  closestPeerSetSize?: number\n  closestPeerSetRefreshInterval?: number\n}\n\nexport interface RoutingTableComponents {\n  peerId: PeerId\n  peerStore: PeerStore\n  metrics?: Metrics\n  logger: ComponentLogger\n}\n\nexport interface RoutingTableEvents {\n  'peer:add': CustomEvent<PeerId>\n  'peer:remove': CustomEvent<PeerId>\n  'peer:ping': CustomEvent<PeerId>\n}\n\n/**\n * A wrapper around `k-bucket`, to provide easy store and retrieval for peers.\n */\nexport class RoutingTable extends TypedEventEmitter<RoutingTableEvents> implements Startable {\n  public kBucketSize: number\n  public kb: KBucket\n  public network: Network\n  private readonly closestPeerTagger: ClosestPeers\n  private readonly log: Logger\n  private readonly components: RoutingTableComponents\n  private running: boolean\n  private readonly pingNewContactTimeout: AdaptiveTimeout\n  private readonly pingNewContactQueue: PeerQueue<boolean>\n  private readonly pingOldContactTimeout: AdaptiveTimeout\n  private readonly pingOldContactQueue: PeerQueue<boolean>\n  private readonly populateFromDatastoreOnStart: boolean\n  private readonly populateFromDatastoreLimit: number\n  private readonly protocol: string\n  private readonly peerTagName: string\n  private readonly peerTagValue: number\n  private readonly metrics?: {\n    routingTableSize: Metric\n    routingTableKadBucketTotal: Metric\n    routingTableKadBucketAverageOccupancy: Metric\n    routingTableKadBucketMaxDepth: Metric\n    routingTableKadBucketMinOccupancy: Metric\n    routingTableKadBucketMaxOccupancy: Metric\n    kadBucketEvents: CounterGroup<'ping_old_contact' | 'ping_old_contact_error' | 'ping_new_contact' | 'ping_new_contact_error' | 'peer_added' | 'peer_removed'>\n  }\n\n  constructor (components: RoutingTableComponents, init: RoutingTableInit) {\n    super()\n\n    this.components = components\n    this.log = components.logger.forComponent(`${init.logPrefix}:routing-table`)\n    this.kBucketSize = init.kBucketSize ?? KBUCKET_SIZE\n    this.running = false\n    this.protocol = init.protocol\n    this.network = init.network\n    this.peerTagName = init.peerTagName ?? KAD_PEER_TAG_NAME\n    this.peerTagValue = init.peerTagValue ?? KAD_PEER_TAG_VALUE\n    this.pingOldContacts = this.pingOldContacts.bind(this)\n    this.verifyNewContact = this.verifyNewContact.bind(this)\n    this.peerAdded = this.peerAdded.bind(this)\n    this.peerRemoved = this.peerRemoved.bind(this)\n    this.populateFromDatastoreOnStart = init.populateFromDatastoreOnStart ?? POPULATE_FROM_DATASTORE_ON_START\n    this.populateFromDatastoreLimit = init.populateFromDatastoreLimit ?? POPULATE_FROM_DATASTORE_LIMIT\n\n    this.pingOldContactQueue = new PeerQueue({\n      concurrency: init.pingOldContactConcurrency ?? PING_OLD_CONTACT_CONCURRENCY,\n      metricName: `${init.metricsPrefix}_ping_old_contact_queue`,\n      metrics: this.components.metrics,\n      maxSize: init.pingOldContactMaxQueueSize ?? PING_OLD_CONTACT_MAX_QUEUE_SIZE\n    })\n    this.pingOldContactTimeout = new AdaptiveTimeout({\n      ...(init.pingOldContactTimeout ?? {}),\n      metrics: this.components.metrics,\n      metricName: `${init.metricsPrefix}_routing_table_ping_old_contact_time_milliseconds`\n    })\n\n    this.pingNewContactQueue = new PeerQueue({\n      concurrency: init.pingNewContactConcurrency ?? PING_NEW_CONTACT_CONCURRENCY,\n      metricName: `${init.metricsPrefix}_ping_new_contact_queue`,\n      metrics: this.components.metrics,\n      maxSize: init.pingNewContactMaxQueueSize ?? PING_NEW_CONTACT_MAX_QUEUE_SIZE\n    })\n    this.pingNewContactTimeout = new AdaptiveTimeout({\n      ...(init.pingNewContactTimeout ?? {}),\n      metrics: this.components.metrics,\n      metricName: `${init.metricsPrefix}_routing_table_ping_new_contact_time_milliseconds`\n    })\n\n    this.kb = new KBucket({\n      kBucketSize: init.kBucketSize,\n      prefixLength: init.prefixLength,\n      splitThreshold: init.splitThreshold,\n      numberOfOldContactsToPing: init.numberOfOldContactsToPing,\n      lastPingThreshold: init.lastPingThreshold,\n      ping: this.pingOldContacts,\n      verify: this.verifyNewContact,\n      onAdd: this.peerAdded,\n      onRemove: this.peerRemoved\n    })\n\n    this.closestPeerTagger = new ClosestPeers(this.components, {\n      logPrefix: init.logPrefix,\n      routingTable: this,\n      peerSetSize: init.closestPeerSetSize,\n      refreshInterval: init.closestPeerSetRefreshInterval,\n      closeTagName: init.closeTagName,\n      closeTagValue: init.closeTagValue\n    })\n\n    if (this.components.metrics != null) {\n      this.metrics = {\n        routingTableSize: this.components.metrics.registerMetric(`${init.metricsPrefix}_routing_table_size`),\n        routingTableKadBucketTotal: this.components.metrics.registerMetric(`${init.metricsPrefix}_routing_table_kad_bucket_total`),\n        routingTableKadBucketAverageOccupancy: this.components.metrics.registerMetric(`${init.metricsPrefix}_routing_table_kad_bucket_average_occupancy`),\n        routingTableKadBucketMinOccupancy: this.components.metrics.registerMetric(`${init.metricsPrefix}_routing_table_kad_bucket_min_occupancy`),\n        routingTableKadBucketMaxOccupancy: this.components.metrics.registerMetric(`${init.metricsPrefix}_routing_table_kad_bucket_max_occupancy`),\n        routingTableKadBucketMaxDepth: this.components.metrics.registerMetric(`${init.metricsPrefix}_routing_table_kad_bucket_max_depth`),\n        kadBucketEvents: this.components.metrics.registerCounterGroup(`${init.metricsPrefix}_kad_bucket_events_total`)\n      }\n    }\n  }\n\n  isStarted (): boolean {\n    return this.running\n  }\n\n  async start (): Promise<void> {\n    if (this.running) {\n      return\n    }\n\n    this.running = true\n\n    await start(this.closestPeerTagger)\n    await this.kb.addSelfPeer(this.components.peerId)\n  }\n\n  async afterStart (): Promise<void> {\n    // do this async to not block startup but iterate serially to not overwhelm\n    // the ping queue\n    Promise.resolve().then(async () => {\n      if (!this.populateFromDatastoreOnStart) {\n        return\n      }\n\n      let peerStorePeers = 0\n\n      // add existing peers from the peer store to routing table\n      for (const peer of await this.components.peerStore.all({\n        filters: [(peer) => {\n          return peer.protocols.includes(this.protocol) && peer.tags.has(KAD_PEER_TAG_NAME)\n        }],\n        limit: this.populateFromDatastoreLimit\n      })) {\n        if (!this.running) {\n          // bail if we've been shut down\n          return\n        }\n\n        try {\n          await this.add(peer.id)\n          peerStorePeers++\n        } catch (err) {\n          this.log('failed to add peer %p to routing table, removing kad-dht peer tags - %e')\n          await this.components.peerStore.merge(peer.id, {\n            tags: {\n              [this.peerTagName]: undefined\n            }\n          })\n        }\n      }\n\n      this.log('added %d peer store peers to the routing table', peerStorePeers)\n    })\n      .catch(err => {\n        this.log.error('error adding peer store peers to the routing table %e', err)\n      })\n  }\n\n  async stop (): Promise<void> {\n    this.running = false\n    await stop(this.closestPeerTagger)\n    this.pingOldContactQueue.abort()\n    this.pingNewContactQueue.abort()\n  }\n\n  private async peerAdded (peer: Peer, bucket: LeafBucket): Promise<void> {\n    if (!this.components.peerId.equals(peer.peerId)) {\n      await this.components.peerStore.merge(peer.peerId, {\n        tags: {\n          [this.peerTagName]: {\n            value: this.peerTagValue\n          }\n        }\n      })\n    }\n\n    this.updateMetrics()\n    this.metrics?.kadBucketEvents.increment({ peer_added: true })\n    this.safeDispatchEvent('peer:add', { detail: peer.peerId })\n  }\n\n  private async peerRemoved (peer: Peer, bucket: LeafBucket): Promise<void> {\n    if (!this.components.peerId.equals(peer.peerId)) {\n      await this.components.peerStore.merge(peer.peerId, {\n        tags: {\n          [this.peerTagName]: undefined\n        }\n      })\n    }\n\n    this.updateMetrics()\n    this.metrics?.kadBucketEvents.increment({ peer_removed: true })\n    this.safeDispatchEvent('peer:remove', { detail: peer.peerId })\n  }\n\n  /**\n   * Called on the `ping` event from `k-bucket` when a bucket is full\n   * and cannot split.\n   *\n   * `oldContacts.length` is defined by the `numberOfNodesToPing` param\n   * passed to the `k-bucket` constructor.\n   *\n   * `oldContacts` will not be empty and is the list of contacts that\n   * have not been contacted for the longest.\n   */\n  async * pingOldContacts (oldContacts: Peer[], options?: AbortOptions): AsyncGenerator<Peer> {\n    if (!this.running) {\n      return\n    }\n\n    const jobs: Array<() => Promise<Peer | undefined>> = []\n\n    for (const oldContact of oldContacts) {\n      if (this.kb.get(oldContact.kadId) == null) {\n        this.log('asked to ping contact %p that was not in routing table', oldContact.peerId)\n        continue\n      }\n\n      this.metrics?.kadBucketEvents.increment({ ping_old_contact: true })\n\n      jobs.push(async () => {\n        // if a previous ping wants us to ping this contact, re-use the result\n        const existingJob = this.pingOldContactQueue.find(oldContact.peerId)\n\n        if (existingJob != null) {\n          this.log('asked to ping contact %p was already being pinged', oldContact.peerId)\n          const result = await existingJob.join(options)\n\n          if (!result) {\n            return oldContact\n          }\n\n          return\n        }\n\n        const result = await this.pingOldContactQueue.add(async (options) => {\n          const signal = this.pingOldContactTimeout.getTimeoutSignal()\n          const signals = anySignal([signal, options?.signal])\n          setMaxListeners(Infinity, signal, signals)\n\n          try {\n            return await this.pingContact(oldContact, options)\n          } catch {\n            this.metrics?.kadBucketEvents.increment({ ping_old_contact_error: true })\n            return true\n          } finally {\n            this.pingOldContactTimeout.cleanUp(signal)\n            signals.clear()\n          }\n        }, {\n          peerId: oldContact.peerId,\n          signal: options?.signal\n        })\n\n        if (!result) {\n          return oldContact\n        }\n      })\n    }\n\n    for await (const peer of parallel(jobs)) {\n      if (peer != null) {\n        yield peer\n      }\n    }\n  }\n\n  async verifyNewContact (contact: Peer, options?: AbortOptions): Promise<boolean> {\n    const signal = this.pingNewContactTimeout.getTimeoutSignal()\n    const signals = anySignal([signal, options?.signal])\n    setMaxListeners(Infinity, signal, signals)\n\n    try {\n      const job = this.pingNewContactQueue.find(contact.peerId)\n\n      if (job != null) {\n        this.log('joining existing ping to add new peer %p to routing table', contact.peerId)\n        return await job.join({\n          signal: signals\n        })\n      } else {\n        return await this.pingNewContactQueue.add(async (options) => {\n          this.metrics?.kadBucketEvents.increment({ ping_new_contact: true })\n\n          this.log('pinging new peer %p before adding to routing table', contact.peerId)\n          return this.pingContact(contact, options)\n        }, {\n          peerId: contact.peerId,\n          signal: signals\n        })\n      }\n    } catch (err) {\n      this.log.trace('tried to add peer %p but they were not online', contact.peerId)\n      this.metrics?.kadBucketEvents.increment({ ping_new_contact_error: true })\n\n      return false\n    } finally {\n      this.pingNewContactTimeout.cleanUp(signal)\n      signals.clear()\n    }\n  }\n\n  async pingContact (contact: Peer, options?: AbortOptions): Promise<boolean> {\n    let stream: Stream | undefined\n\n    try {\n      this.log('pinging contact %p', contact.peerId)\n\n      for await (const event of this.network.sendRequest(contact.peerId, { type: MessageType.PING }, options)) {\n        if (event.type === EventTypes.PEER_RESPONSE) {\n          if (event.messageType === MessageType.PING) {\n            this.log('contact %p ping ok', contact.peerId)\n\n            this.safeDispatchEvent('peer:ping', {\n              detail: contact.peerId\n            })\n\n            return true\n          }\n\n          return false\n        }\n      }\n\n      return false\n    } catch (err: any) {\n      this.log('error pinging old contact %p - %e', contact.peerId, err)\n      stream?.abort(err)\n      return false\n    }\n  }\n\n  /**\n   * Amount of currently stored peers\n   */\n  get size (): number {\n    if (this.kb == null) {\n      return 0\n    }\n\n    return this.kb.count()\n  }\n\n  /**\n   * Find a specific peer by id\n   */\n  async find (peer: PeerId): Promise<PeerId | undefined> {\n    const kadId = await utils.convertPeerId(peer)\n    return this.kb.get(kadId)?.peerId\n  }\n\n  /**\n   * Retrieve the closest peers to the given kadId\n   */\n  closestPeer (kadId: Uint8Array): PeerId | undefined {\n    const res = this.closestPeers(kadId, 1)\n\n    if (res.length > 0) {\n      return res[0]\n    }\n\n    return undefined\n  }\n\n  /**\n   * Retrieve the `count`-closest peers to the given kadId\n   */\n  closestPeers (kadId: Uint8Array, count = this.kBucketSize): PeerId[] {\n    if (this.kb == null) {\n      return []\n    }\n\n    return [...this.kb.closest(kadId, count)]\n  }\n\n  /**\n   * Add or update the routing table with the given peer\n   */\n  async add (peerId: PeerId, options?: AbortOptions): Promise<void> {\n    if (this.kb == null) {\n      throw new Error('RoutingTable is not started')\n    }\n\n    await this.kb.add(peerId, options)\n  }\n\n  /**\n   * Remove a given peer from the table\n   */\n  async remove (peer: PeerId): Promise<void> {\n    if (this.kb == null) {\n      throw new Error('RoutingTable is not started')\n    }\n\n    const kadId = await utils.convertPeerId(peer)\n\n    await this.kb.remove(kadId)\n  }\n\n  private updateMetrics (): void {\n    if (this.metrics == null || this.kb == null) {\n      return\n    }\n\n    let size = 0\n    let buckets = 0\n    let maxDepth = 0\n    let minOccupancy = 20\n    let maxOccupancy = 0\n\n    function count (bucket: Bucket): void {\n      if (isLeafBucket(bucket)) {\n        if (bucket.depth > maxDepth) {\n          maxDepth = bucket.depth\n        }\n\n        buckets++\n        size += bucket.peers.length\n\n        if (bucket.peers.length < minOccupancy) {\n          minOccupancy = bucket.peers.length\n        }\n\n        if (bucket.peers.length > maxOccupancy) {\n          maxOccupancy = bucket.peers.length\n        }\n\n        return\n      }\n\n      count(bucket.left)\n      count(bucket.right)\n    }\n\n    count(this.kb.root)\n\n    this.metrics.routingTableSize.update(size)\n    this.metrics.routingTableKadBucketTotal.update(buckets)\n    this.metrics.routingTableKadBucketAverageOccupancy.update(Math.round(size / buckets))\n    this.metrics.routingTableKadBucketMinOccupancy.update(minOccupancy)\n    this.metrics.routingTableKadBucketMaxOccupancy.update(maxOccupancy)\n    this.metrics.routingTableKadBucketMaxDepth.update(maxDepth)\n  }\n}\n", "export default [\n  77591, 22417, 43971, 28421, 740, 29829, 71467, 228973, 196661, 78537, 27689, 36431, 44415, 14362, 19456, 106025,\n  96308, 2882, 49509, 21149, 87173, 131409, 75844, 23676, 121838, 30291, 17492, 2953, 7564, 110620, 129477, 127283,\n  53113, 72417, 165166, 109690, 21200, 102125, 24049, 71504, 90342, 25307, 72039, 26812, 26715, 32264, 133800, 71161,\n  88956, 171987, 51779, 24425, 16671, 30251, 186294, 247761, 14202, 2121, 8465, 35024, 4876, 85917, 169730, 3638,\n  256836, 96184, 943, 18678, 6583, 52907, 35807, 112254, 214097, 18796, 11595, 9243, 23554, 887, 268203, 382004,\n  24590, 111335, 11625, 16619, 29039, 102425, 69006, 97976, 92362, 32552, 63717, 41433, 128974, 137630, 59943, 10019,\n  13986, 35430, 33665, 108037, 43799, 43280, 38195, 29078, 58629, 18265, 14425, 46832, 235538, 40830, 77881, 110717,\n  58937, 3463, 325358, 51300, 47623, 117252, 19007, 10170, 20540, 91237, 294813, 4951, 79841, 56232, 36270, 128547,\n  69209, 66275, 100156, 32063, 73531, 34439, 80937, 28892, 44466, 88595, 216307, 32583, 49620, 16605, 82127, 45807,\n  21630, 78726, 20235, 40163, 111007, 96926, 5567, 72083, 21665, 58844, 39419, 179767, 48328, 42662, 51550, 5251,\n  37811, 49608, 81056, 50854, 55513, 20922, 18891, 197409, 164656, 32593, 71449, 220474, 58919, 85682, 67854, 13758,\n  35066, 3565, 61905, 214793, 119572, 141419, 21504, 10302, 27354, 67003, 46131, 32668, 15165, 64871, 34450, 17821,\n  2757, 11452, 34189, 5160, 12257, 85523, 560, 53385, 65887, 119549, 135620, 312353, 115979, 122356, 10867, 193231,\n  124537, 54783, 90675, 120791, 4715, 142253, 50943, 17271, 43358, 25331, 4917, 120566, 34580, 12878, 33786, 160528,\n  32523, 4869, 301307, 104817, 81491, 23276, 8832, 97911, 31265, 52065, 7998, 49622, 9715, 43998, 34091, 84587,\n  20664, 69041, 29419, 53205, 10838, 58288, 116145, 6185, 5154, 141795, 35924, 21307, 144738, 43730, 12085, 8279,\n  10002, 119, 133779, 199668, 72938, 31768, 39176, 67875, 38453, 9700, 44144, 4121, 116048, 41733, 12868, 82669,\n  92308, 128, 34262, 11332, 7712, 90764, 36141, 13553, 71312, 77470, 117314, 96549, 49135, 23602, 54468, 28605,\n  6327, 62308, 17171, 67531, 21319, 14105, 894, 107722, 46157, 8503, 51069, 100472, 45138, 15246, 14577, 35609,\n  191464, 1757, 13364, 161349, 32067, 91705, 81144, 52339, 5408, 91066, 21983, 14157, 100545, 4372, 26630, 129112,\n  1423, 29676, 213626, 4397, 88436, 99190, 6877, 49958, 26122, 114348, 60661, 29818, 293118, 50042, 179738, 16400,\n  163423, 89627, 31040, 43973, 36638, 45952, 5153, 1894, 109322, 1898, 134021, 12402, 112077, 68309, 190269, 69866,\n  31938, 107383, 11522, 105232, 11248, 14868, 39852, 71707, 186525, 16530, 38162, 106212, 11700, 5130, 16608, 26998,\n  59586, 108399, 230033, 43683, 48135, 82179, 2073, 5015, 196684, 189293, 16378, 23452, 8301, 35640, 11632, 214551,\n  29240, 57644, 33137, 91949, 55157, 52384, 117313, 5090, 17717, 89668, 49363, 82238, 241035, 66216, 29066, 184088,\n  97206, 62820, 26595, 4241, 135635, 173672, 8202, 459, 71355, 146294, 29587, 3008, 135385, 141203, 14803, 6634,\n  45094, 69362, 50925, 546, 51884, 62011, 83296, 234584, 44515, 56050, 89476, 87751, 19373, 12691, 149923, 19794,\n  13833, 35846, 87557, 58339, 2884, 19145, 25647, 12224, 11024, 77338, 64608, 122297, 53025, 7205, 36189, 36294,\n  170779, 21750, 7739, 173883, 75192, 35664, 224240, 113121, 30181, 26267, 27036, 117827, 92015, 106516, 55628, 203549,\n  67949, 60462, 60844, 35911, 20457, 1820, 920, 19773, 8738, 73173, 181993, 38521, 98254, 76257, 46008, 92796,\n  5384, 26868, 151566, 22124, 2411, 15919, 186872, 180021, 28099, 152961, 78811, 80237, 62352, 102653, 74259, 184890,\n  16792, 123702, 224945, 29940, 19512, 75283, 14059, 112691, 92811, 233329, 20411, 138569, 53341, 109802, 50600, 134528,\n  66747, 5529, 166531, 31578, 64732, 67189, 1596, 126357, 967, 167999, 206598, 109752, 119431, 207825, 78791, 91938,\n  10301, 27311, 24233, 252343, 28831, 32812, 66002, 112267, 90895, 8786, 8095, 16824, 22866, 21813, 60507, 174833,\n  19549, 130985, 117051, 52110, 6938, 81923, 123864, 38061, 919, 18680, 53534, 46739, 112893, 161529, 85429, 26761,\n  11900, 81121, 91968, 15390, 217947, 56524, 1713, 6654, 37089, 85630, 138866, 61850, 16491, 75577, 16884, 98296,\n  73523, 6140, 44645, 6062, 36366, 29844, 57946, 37932, 42472, 5266, 20834, 19309, 33753, 127182, 134259, 35810,\n  41805, 45878, 312001, 14881, 47757, 49251, 120050, 44252, 3708, 25856, 107864, 120347, 1228, 36550, 41682, 34496,\n  47025, 8393, 173365, 246526, 12894, 161607, 35670, 90785, 126572, 2095, 124731, 157033, 58694, 554, 12786, 9642,\n  4817, 16136, 47864, 174698, 66992, 4639, 69284, 10625, 40710, 27763, 51738, 30404, 264105, 137904, 109882, 52487,\n  42824, 57514, 2740, 10479, 146799, 107390, 16586, 88038, 174951, 9410, 16185, 44158, 5568, 40658, 46108, 12763,\n  97385, 26175, 108859, 664, 230732, 67470, 46663, 14395, 50750, 141320, 93140, 15361, 47997, 55784, 6791, 307840,\n  118569, 107326, 18056, 58281, 260415, 54691, 8790, 73332, 45633, 7511, 45674, 143373, 14031, 11799, 94491, 35646,\n  96544, 14560, 26049, 32983, 25791, 83814, 42094, 231370, 63955, 139212, 2359, 169908, 3108, 183486, 105867, 28197,\n  32941, 124968, 26402, 88267, 149768, 23053, 3078, 19091, 52924, 25383, 19209, 111548, 97361, 3959, 24880, 235061,\n  9099, 24921, 161254, 151405, 20508, 7159, 34381, 20133, 11434, 74036, 19974, 34769, 36585, 1076, 22454, 17354,\n  38727, 235160, 111547, 96454, 117448, 156940, 91330, 37299, 7310, 26915, 117060, 51369, 22620, 61861, 322264, 106850,\n  111694, 15091, 2624, 40345, 300446, 177064, 1707, 27389, 54792, 327783, 132669, 183543, 59003, 17744, 20603, 151134,\n  106923, 53084, 71803, 279424, 319816, 11579, 21946, 16728, 38274, 72711, 5085, 83391, 88646, 40159, 25027, 34680,\n  10752, 12988, 54126, 30365, 18338, 100445, 230674, 44874, 84974, 143877, 123253, 139372, 28082, 91477, 144002, 13096,\n  219729, 46016, 50029, 42377, 14601, 6660, 58244, 58978, 23918, 88206, 113611, 64452, 17541, 41032, 10942, 12021,\n  49189, 10978, 40175, 37156, 10947, 71709, 106894, 112538, 57007, 137486, 150608, 152719, 40615, 7746, 279716, 13101,\n  19524, 28708, 40578, 72320, 1096, 182051, 94527, 51275, 22833, 45164, 81917, 77519, 48508, 5421, 140302, 37845,\n  149830, 5587, 27579, 5357, 428725, 248187, 6326, 206760, 39814, 32585, 89923, 44341, 288753, 284443, 96368, 31201,\n  94189, 119504, 20359, 52073, 103216, 179, 27934, 32801, 96035, 34111, 34309, 101326, 18198, 20704, 210266, 37643,\n  27880, 141873, 106000, 19414, 56614, 167714, 66483, 107885, 86602, 4379, 20796, 75467, 4987, 5017, 118857, 26003,\n  34308, 114428, 29198, 6686, 29697, 73632, 3739, 69795, 16798, 41504, 7207, 30722, 21436, 36735, 28067, 28545,\n  3239, 11221, 36031, 41889, 100010, 19247, 317673, 29495, 174554, 6424, 129725, 53845, 94986, 7955, 59676, 2604,\n  191497, 19735, 102214, 62954, 23844, 11872, 179525, 261436, 34492, 428, 78404, 142035, 16747, 17246, 27578, 37021,\n  33672, 57944, 26056, 135760, 2369, 61674, 122066, 31327, 19374, 157065, 40553, 130982, 69619, 71290, 38855, 72100,\n  92903, 95940, 51422, 165999, 65713, 57873, 50726, 7288, 20272, 2081, 42326, 22624, 81120, 57914, 79352, 19447,\n  1684, 72302, 11774, 302559, 161481, 96396, 13692, 414988, 3721, 79066, 56627, 46883, 21150, 11747, 12184, 5856,\n  113458, 176117, 84416, 52079, 27933, 3354, 59765, 141359, 2212, 216309, 2555, 23458, 196722, 142463, 45701, 44548,\n  28798, 19418, 215, 29916, 9396, 10574, 114226, 84475, 13520, 18694, 34056, 4524, 90302, 62930, 13539, 19407,\n  77209, 7728, 38088, 9535, 2263, 23875, 183945, 17750, 26274, 67172, 10585, 28042, 22199, 7478, 51331, 66030,\n  26774, 192929, 31434, 25850, 50197, 52926, 178158, 4679, 181256, 70184, 229600, 9959, 105594, 72158, 73974, 2726,\n  35085, 78087, 23284, 35568, 51713, 155676, 5401, 27254, 11966, 17569, 223253, 71993, 103357, 111477, 55722, 30504,\n  26034, 46774, 35392, 36285, 214814, 41143, 163465, 1051, 16094, 81044, 6636, 76489, 179102, 20712, 39178, 35683,\n  125177, 54219, 30617, 52994, 25324, 50123, 2543, 87529, 58995, 10688, 125199, 12388, 60158, 125481, 131646, 7642,\n  133350, 65874, 3438, 97277, 101450, 10075, 56344, 116821, 50778, 60547, 98016, 106135, 13859, 14255, 16300, 77373,\n  173521, 8285, 45932, 37426, 4054, 114295, 55947, 7703, 39114, 52, 51119, 128135, 19714, 60715, 9554, 50492,\n  88180, 2823, 118271, 52993, 122625, 97919, 23859, 37895, 25040, 33614, 32102, 20431, 3577, 9275, 15686, 43031,\n  157741, 110358, 1884, 40291, 125391, 13736, 5008, 64881, 87336, 77381, 70711, 43032, 49155, 118587, 70494, 4318,\n  10168, 30126, 12580, 10524, 280104, 104001, 145413, 2862, 84140, 6603, 106005, 13566, 12780, 11251, 42830, 571,\n  179910, 82443, 13146, 469, 42714, 32591, 265217, 424024, 92553, 54721, 134100, 6007, 15242, 114681, 59030, 16718,\n  85465, 200214, 85982, 55174, 165013, 23493, 56964, 82529, 109150, 32706, 27568, 82442, 5350, 14976, 13165, 44890,\n  60021, 21343, 33978, 17264, 4655, 22328, 27819, 75730, 16567, 55483, 14510, 17926, 45827, 150609, 3704, 7385,\n  272531, 161543, 76904, 122163, 52405, 2039, 19165, 41623, 14423, 228354, 3369, 176360, 85491, 7122, 35789, 303724,\n  4465, 13628, 2233, 55311, 118771, 20713, 10006, 221519, 45115, 71021, 35650, 29775, 7337, 10864, 20665, 21142,\n  1746, 15080, 1624, 32449, 10905, 105743, 229797, 7701, 3940, 22997, 178467, 57208, 389057, 39683, 59403, 63344,\n  63125, 54847, 69691, 18336, 56448, 3362, 37202, 18282, 29648, 138224, 35867, 10495, 5911, 28814, 26653, 31514,\n  176702, 26550, 45621, 11734, 4525, 40543, 73944, 121080, 27858, 155561, 14887, 44670, 30742, 8796, 107455, 113472,\n  56369, 75581, 183777, 240095, 133699, 153299, 8768, 160464, 26058, 49078, 103971, 21875, 71486, 44888, 17156, 9678,\n  89541, 123019, 102337, 3972, 83930, 21245, 87852, 109660, 287918, 183019, 686, 10100, 39177, 283941, 11274, 24736,\n  26793, 26214, 25995, 77011, 141580, 4070, 23742, 46285, 46632, 30700, 26669, 19056, 35951, 115575, 174034, 56097,\n  35463, 87425, 24575, 44245, 38701, 82317, 85922, 281616, 100333, 147697, 61503, 7730, 84330, 8530, 59917, 61597,\n  17173, 9092, 32658, 90288, 193136, 39023, 20381, 56654, 31132, 7779, 1919, 1375, 117128, 30819, 11169, 40938,\n  23935, 115201, 101155, 151034, 4835, 11231, 74550, 89388, 59951, 91704, 107312, 167882, 115062, 12732, 72738, 88703,\n  464019, 158267, 57995, 60496, 737, 14371, 123867, 4174, 243339, 159946, 7568, 16025, 134556, 110916, 38103, 191,\n  80226, 88794, 29688, 27230, 10454, 76308, 57647, 77409, 113483, 66864, 14745, 19808, 12023, 46583, 84805, 16015,\n  17102, 2231, 20611, 3547, 95740, 250131, 34559, 108894, 8498, 15853, 159169, 148920, 20942, 2813, 93160, 45188,\n  210613, 45531, 52587, 149062, 39782, 28194, 57849, 60965, 84954, 89766, 84453, 100927, 16501, 27658, 165311, 103841,\n  54192, 207341, 19558, 20084, 319622, 5672, 205467, 98462, 61849, 36279, 13609, 147177, 24726, 165015, 209489, 59591,\n  31157, 6551, 117580, 75060, 141146, 277310, 21072, 22023, 106474, 63041, 137443, 122965, 68371, 5383, 42146, 98961,\n  113467, 30863, 23794, 4843, 99630, 30392, 82679, 13699, 241612, 33601, 93146, 24319, 18643, 32155, 95669, 40440,\n  15333, 34089, 67799, 142144, 58245, 38633, 114531, 117400, 77861, 188726, 5507, 2568, 8853, 10987, 107222, 2663,\n  2421, 11530, 13345, 30075, 41785, 118661, 104786, 17459, 12490, 16281, 71936, 193555, 17431, 5944, 71758, 26485,\n  77317, 20803, 367167, 158, 7362, 93430, 11735, 172445, 46002, 11532, 54482, 930, 62911, 2235, 23004, 179236,\n  4764, 101859, 208113, 22477, 55163, 95579, 14098, 67320, 162556, 90709, 156949, 3826, 57492, 4025, 34092, 87442,\n  104565, 6718, 186015, 28214, 14209, 10039, 107186, 233912, 58877, 81637, 55265, 39828, 6194, 145813, 50831, 105849,\n  4974, 88319, 122296, 10272, 197216, 95714, 51540, 72418, 23324, 91555, 8743, 140452, 250249, 51666, 34124, 7229,\n  38592, 129641, 78169, 174242, 22464, 149964, 51450, 14034, 10026, 95376, 26190, 120062, 14401, 8700, 265, 31386,\n  143573, 7203, 229889, 61567, 4227, 140981, 2466, 72052, 10787, 10062, 30958, 6099, 38471, 30103, 23202, 208101,\n  70847, 467, 58934, 32271, 32984, 36637, 24107, 30771, 17109, 73353, 13650, 2098, 157040, 67366, 66904, 106018,\n  265380, 107238, 18535, 44025, 32681, 144983, 62505, 91295, 56120, 3082, 77508, 10322, 63023, 36700, 81885, 224127,\n  16721, 45023, 239261, 111272, 13852, 7866, 149243, 204199, 32309, 22084, 42029, 38316, 126644, 104973, 14406, 43454,\n  67322, 61310, 15789, 40285, 24026, 181047, 6301, 70927, 23319, 115823, 27248, 66693, 115875, 278566, 63007, 146844,\n  56841, 59007, 87368, 180001, 22370, 42114, 80605, 12022, 10374, 308, 25079, 14689, 12618, 63368, 7936, 264973,\n  212291, 136713, 95999, 105801, 18965, 32075, 48700, 52230, 35119, 96912, 32992, 8586, 16606, 101333, 101812, 14969,\n  39930, 759, 193090, 27387, 42914, 12937, 5058, 62646, 64528, 38624, 25743, 37502, 3716, 4435, 30352, 178687,\n  26461, 132611, 42002, 138442, 35833, 59582, 16345, 8048, 60319, 49349, 309, 47800, 49739, 90482, 26405, 34470,\n  63786, 32479, 85028, 39866, 47846, 11649, 23934, 29466, 2816, 42864, 31828, 7410, 74885, 49632, 47629, 111801,\n  90749, 19536, 18767, 105764, 59606, 21223, 10746, 76298, 22220, 39408, 7190, 79654, 64856, 11602, 82156, 272765,\n  17079, 70089, 245473, 51813, 184407, 384678, 1576, 122249, 5064, 27481, 6188, 25790, 74361, 27541, 318284, 45430,\n  31488, 620, 93579, 45723, 192118, 22670, 51913, 4162, 70244, 35966, 26397, 16199, 50899, 209613, 121702, 287507,\n  2993, 36101, 132229, 67345, 33062, 76295, 118628, 78705, 52316, 34375, 107083, 107454, 44863, 127561, 33964, 3073,\n  154010, 190914, 55967, 39074, 6272, 31047, 5550, 41123, 26154, 98638, 47110, 19998, 148091, 50229, 31329, 59900,\n  195442, 19106, 61347, 73497, 70015, 682, 45850, 25776, 38022, 148951, 6288, 37411, 232526, 109277, 27286, 32342,\n  9262, 5220, 16651, 23175, 46740, 129438, 78614, 121925, 66914, 88710, 127952, 5563, 21500, 34521, 10739, 14863,\n  191006, 62956, 17359, 16749, 67027, 56284, 69134, 43301, 35039, 58883, 54466, 60823, 404451, 75743, 59856, 86979,\n  7923, 34273, 83785, 32142, 7693, 268986, 197428, 282681, 17049, 22346, 22990, 92245, 107180, 3357, 37104, 96724,\n  49153, 7683, 31197, 43267, 82231, 164276, 23696, 20848, 188364, 22309, 24821, 158707, 1018, 22514, 70922, 27792,\n  45589, 59709, 10765, 736, 35218, 63479, 51987, 24275, 63588, 55361, 92929, 81964, 4658, 20122, 12330, 44058,\n  13065, 311456, 72224, 8337, 211229, 38979, 22590, 138478, 52757, 32595, 133600, 8838, 31549, 94412, 43391, 90056,\n  1585, 94802, 127271, 6223, 31889, 137038, 132910, 2165, 57616, 230152, 6080, 10748, 36737, 74579, 134062, 50525,\n  180532, 119270, 34556, 76155, 82394, 52595, 29258, 31435, 87820, 67996, 26943, 183878, 38007, 2410, 13526, 180297,\n  69856, 3503, 187396, 167700, 7838, 16701, 9199, 56267, 3661, 37407, 65994, 23767, 5708, 62508, 221700, 67088,\n  86978, 46776, 84434, 32088, 5612, 9149, 88244, 21685, 95151, 46750, 189612, 2979, 506311, 2594, 3628, 40074,\n  105039, 78243, 28523, 6651, 38058, 71999, 30992, 12764, 68261, 108991, 6165, 26450, 61961, 13400, 22426, 7490,\n  60890, 109623, 2070, 12958, 50355, 67979, 257096, 7213, 42578, 52121, 35716, 65461, 7516, 124758, 39268, 302,\n  64712, 14977, 1467, 219452, 2840, 34229, 11121, 21602, 19270, 63574, 8024, 1532, 17331, 79839, 78885, 52029,\n  180767, 57957, 6069, 91265, 61380, 55767, 8927, 32881, 287603, 22149, 35029, 68876, 6428, 199567, 46926, 13412,\n  104132, 21434, 366616, 45060, 110046, 81924, 128910, 45886, 52821, 130416, 29416, 77342, 21762, 67329, 121432, 79924,\n  11724, 38625, 81006, 102033, 28338, 13326, 3250, 82056, 82526, 38212, 21112, 12382, 111495, 3263, 7414, 86274,\n  93490, 40844, 30224, 45212, 24019, 48411, 71367, 24941, 76729, 57776, 3769, 38114, 202019, 197745, 31953, 237533,\n  33270, 201580, 255648, 100798, 44741, 32241, 98468, 106931, 10085, 15090, 170358, 33154, 66787, 18819, 69760, 25061,\n  234005, 82660, 6295, 131975, 16874, 9076, 4094, 25005, 17740, 40908, 19533, 220019, 44330, 99792, 50040, 19619,\n  13950, 55228, 24423, 31253, 95308, 103177, 184795, 28590, 82285, 5059, 3210, 75525, 49894, 70007, 56178, 10580,\n  36051, 139681, 21617, 98736, 3555, 106306, 164189, 37352, 63915, 47824, 24883, 145530, 61904, 28444, 11483, 19837,\n  145446, 30420, 112972, 85939, 11835, 191233, 2262, 20705, 58630, 1753, 148334, 1197, 144714, 6887, 11223, 107667,\n  60879, 77914, 4151, 57417, 81594, 96681, 169430, 1784, 20444, 95138, 254041, 27038, 596, 7117, 72808, 13759,\n  3353, 126776, 21074, 55322, 27081, 36942, 39547, 139830, 179275, 4453, 713, 8722, 71399, 19204, 25785, 22794,\n  23923, 104114, 11291, 25458, 102309, 88396, 75288, 230440, 206396, 104551, 58447, 130857, 37247, 94734, 31548, 176529,\n  226077, 65159, 20104, 10096, 66881, 94191, 237909, 27109, 37404, 1520, 27421, 25220, 113003, 23423, 24884, 50585,\n  6286, 231877, 150800, 11789, 3226, 90004, 60642, 5053, 202400, 61442, 132531, 175329, 57138, 30116, 103847, 9973,\n  75367, 16452, 32360, 59119, 21246, 10191, 164804, 23305, 61051, 37348, 154530, 13214, 5468, 50403, 66754, 130976,\n  50559, 80515, 14436, 155492, 84017, 5472, 43107, 41240, 2890, 90431, 70188, 382, 76234, 48040, 50211, 281038,\n  237007, 32115, 142178, 1536, 22761, 96429, 1811, 31243, 1679, 49143, 55209, 17402, 235054, 61494, 7462, 77030,\n  34925, 87609, 78002, 9499, 9027, 73289, 201078, 101379, 63544, 27666, 5469, 10642, 30029, 49816, 132979, 95620,\n  58086, 351930, 116300, 2110, 2043, 30845, 6154, 11279, 16727, 4122, 2277, 27281, 4971, 3650, 39060, 61970,\n  65951, 39674, 75686, 38151, 11370, 130809, 177895, 32665, 63725, 122267, 7857, 39618, 118483, 44792, 157755, 178624,\n  136994, 24260, 41308, 22471, 12404, 21707, 12486, 30473, 52781, 50246, 20247, 39065, 909, 56825, 103158, 128603,\n  31542, 1089, 41935, 32744, 12428, 37963, 84420, 33134, 72921, 208449, 42622, 168151, 127335, 147107, 46699, 38216,\n  12591, 94342, 85814, 31423, 24944, 2605, 87542, 67473, 192551, 4496, 56321, 91819, 17630, 6300, 256183, 114569,\n  202090, 33209, 35289, 34897, 24967, 40520, 43470, 5344, 10199, 34810, 14283, 10381, 10017, 62923, 49924, 23233,\n  64539, 13051, 35686, 19698, 11570, 135555, 120868, 44924, 87065, 52318, 52335, 47586, 140906, 245885, 109834, 78668,\n  9065, 46990, 25258, 72022, 61243, 40838, 4545, 146387, 10537, 11557, 17470, 36930, 68104, 46711, 24264, 79401,\n  81043, 18225, 120488, 24746, 84338, 81652, 28266, 13776, 21878, 46973, 1047, 230465, 73357, 95777, 24973, 210160,\n  62210, 58404, 110633, 169651, 6937, 41870, 9909, 26822, 191062, 76553, 27519, 96256, 239070, 2478, 205678, 67955,\n  58532, 20601, 50120, 19148, 78501, 195724, 110740, 8249, 109665, 27446, 30568, 57631, 31425, 49752, 32820, 65504,\n  50079, 3663, 102256, 219898, 23849, 211315, 14645, 4359, 91767, 9528, 12449, 49366, 7941, 49763, 107848, 8930,\n  27086, 50686, 9744, 10447, 81935, 39513, 46514, 1670, 29229, 6172, 22312, 137280, 97759, 9806, 14445, 22976,\n  56458, 73391, 34983, 93760, 174219, 52573, 33149, 59747, 2429, 136277, 75123, 165263, 91040, 7446, 57632, 48633,\n  97140, 246081, 84766, 151684, 79918, 93268, 120346, 54059, 54875, 77858, 32996, 103590, 45276, 11968, 19600, 25849,\n  17159, 132907, 42828, 16817, 4913, 99462, 103303, 27395, 5737, 74184, 20749, 21160, 14377, 77062, 131403, 158735,\n  10999, 27799, 77785, 9320, 34366, 51593, 61070, 33746, 47048, 29268, 36675, 30262, 53297, 9832, 82000, 20188,\n  122292, 39917, 7331, 18160, 68301, 185935, 134830, 15031, 4935, 10004, 165845, 185534, 46923, 30109, 44134, 122631,\n  18874, 22903, 112790, 26561, 18549, 348902, 82871, 140345, 255565, 135390, 63556, 103747, 145055, 179600, 145662, 296111,\n  61661, 211987, 23952, 52342, 126343, 48450, 32919, 44277, 82185, 9591, 62139, 205363, 376969, 394874, 108461, 18040,\n  120885, 14798, 39863, 16571, 16794, 58271, 81025, 55206, 14640, 118656, 6361, 44092, 85970, 6262, 153863, 108244,\n  180200, 72264, 79947, 38044, 10050, 5735, 61221, 80712, 5471, 115689, 11391, 11661, 184257, 20010, 60116, 30320,\n  19327, 134598, 45455, 27542, 18004, 125092, 452272, 1549, 91523, 46567, 180063, 156026, 2608, 11174, 58848, 37788,\n  65907, 80194, 30490, 5786, 40775, 119519, 106241, 11323, 156297, 8425, 61495, 2617, 29675, 2425, 59886, 112582,\n  49142, 59618, 4863, 50597, 86710, 50650, 168632, 27693, 85641, 83643, 18993, 25768, 84284, 28090, 93592, 36627,\n  312804, 43381, 9887, 9402, 100931, 97165, 3311, 173330, 66805, 28935, 4963, 184460, 3201, 78102, 19126, 21607,\n  37496, 24938, 22615, 16153, 32862, 134792, 153318, 61120, 6067, 2812, 12826, 12792, 23825, 37559, 64662, 202250,\n  102694, 155488, 85881, 149193, 46233, 65383, 15521, 106982, 11358, 176786, 25752, 39717, 34208, 24510, 32464, 77742,\n  39371, 72028, 138229, 60688, 71386, 102834, 132477, 2208, 11548, 63670, 271279, 28351, 30338, 38620, 32491, 99845,\n  143885, 152266, 13252, 2825, 178663, 108097, 1775, 78201, 14897, 113573, 163346, 62292, 171129, 22183, 96598, 38733,\n  64971, 166776, 117445, 9968, 146393, 44677, 74867, 20908, 97328, 12761, 25656, 26785, 9148, 112344, 26115, 99176,\n  110121, 22437, 49547, 6180, 79320, 5835, 31392, 43328, 33377, 75870, 119860, 69497, 80273, 7325, 155219, 43167,\n  111173, 28347, 20222, 3763, 71752, 55041, 47252, 14618, 28088, 15012, 97805, 194698, 54636, 2036, 41349, 6173,\n  96604, 61530, 51859, 43782, 13361, 24334, 22668, 24792, 7070, 23441, 16789, 3209, 36211, 208475, 26242, 32880,\n  122181, 182407, 21444, 31060, 88459, 29929, 77907, 12716, 10934, 97005, 20599, 31690, 8403, 58445, 30303, 22700,\n  10336, 86731, 103115, 337709, 72556, 46788, 112566, 47684, 67089, 53548, 36874, 56487, 41387, 125985, 26893, 40071,\n  106683, 73712, 18787, 40105, 72992, 67246, 137276, 50802, 36790, 70328, 138827, 22466, 39263, 183295, 29858, 50975,\n  9322, 57397, 10654, 24364, 30383, 55799, 41600, 23584, 127295, 296610, 129078, 143558, 244131, 86397, 36049, 1085,\n  80677, 3820, 108139, 5476, 34767, 24683, 7758, 13060, 7239, 131671, 250593, 59556, 103392, 29810, 4188, 252323,\n  39404, 116877, 7651, 43600, 40338, 13554, 157253, 39196, 25978, 144387, 61211, 234, 50104, 6129, 10449, 93777,\n  9240, 356378, 274148, 4439, 72970, 3724, 147770, 78680, 62570, 115877, 40027, 40547, 36817, 224392, 64609, 34795,\n  165027, 67440, 2477, 37206, 23431, 50754, 164797, 46018, 94995, 170982, 27051, 7957, 22767, 3674, 27900, 56419,\n  18930, 60701, 41302, 2692, 84749, 339721, 61996, 111094, 80221, 50129, 1045, 8153, 62945, 19202, 8250, 37208,\n  37418, 32560, 79477, 41106, 88569, 33963, 36693, 5892, 30570, 1581, 66471, 49647, 11922, 160717, 29442, 5643,\n  114865, 82962, 95982, 132098, 22633, 22838, 94726, 54556, 28566, 205039, 162340, 33216, 16849, 35847, 221339, 94851,\n  26533, 71469, 1805, 3804, 12935, 45483, 71020, 36310, 65381, 192960, 34240, 35165, 59773, 1248, 46954, 155332,\n  96864, 4246, 388800, 16129, 57133, 74592, 44807, 442014, 38203, 42574, 80818, 91592, 26377, 36424, 65760, 977,\n  77387, 22628, 147610, 28018, 30561, 98454, 6969, 119628, 63648, 18170, 36854, 26601, 64018, 22027, 37279, 51395,\n  152934, 21153, 9430, 58760, 194742, 5330, 55115, 34158, 28917, 174111, 13171, 122326, 1526, 43896, 66094, 25325,\n  4234, 148354, 11450, 275, 18999, 112191, 44365, 22723, 68409, 8733, 57746, 96565, 75007, 14196, 108844, 29475,\n  88599, 177563, 100792, 106156, 86323, 93726, 14248, 135341, 194131, 40126, 47099, 14779, 8272, 39597, 95983, 171398,\n  65882, 28052, 10393, 47213, 40689, 22120, 72212, 106829, 34964, 109146, 753, 648, 21660, 30047, 17527, 181025,\n  5619, 145357, 4085, 216883, 9359, 186951, 24779, 53931, 24545, 36197, 223296, 62628, 168101, 4243, 107313, 30321,\n  26642, 13049, 51059, 31027, 107912, 807, 73550, 26551, 84369, 122422, 165872, 49754, 74213, 234264, 33151, 52014,\n  33100, 87183, 22365, 52500, 40013, 23302, 5652, 72723, 21404, 26107, 48434, 587, 94049, 168493, 96418, 32871,\n  70860, 31709, 25128, 443, 71597, 166253, 15670, 70994, 26341, 133675, 28280, 75491, 54756, 47955, 56028, 26182,\n  11952, 113272, 472197, 64640, 110753, 17919, 337, 50642, 22576, 142, 87371, 53391, 93210, 126694, 15285, 19642,\n  85667, 14148, 1506, 42092, 52962, 33243, 11970, 20734, 135843, 57044, 58880, 13002, 219134, 22876, 64754, 232519,\n  4257, 43120, 321573, 24799, 64526, 124728, 52579, 81472, 70831, 276848, 17403, 74359, 23021, 182101, 74597, 23744,\n  148267, 12055, 7976, 5349, 11772, 67540, 167347, 65318, 18720, 127832, 108238, 22828, 90233, 9987, 259080, 118185,\n  73209, 79270, 13775, 90100, 137742, 90799, 70569, 15699, 19961, 9087, 67475, 57872, 39731, 8810, 134897, 131868,\n  146849, 19898, 3334, 2281, 167061, 91073, 60356, 467742, 74712, 188, 53179, 137679, 92769, 29241, 9537, 132595,\n  80119, 1041, 88962, 5976, 40171, 44911, 102859, 139059, 104558, 98987, 47761, 19272, 71472, 113864, 175377, 73338,\n  10857, 23402, 23758, 1591, 139864, 5644, 4076, 118760, 16427, 134198, 18853, 20291, 100849, 37423, 22038, 36677,\n  19071, 195521, 57445, 11069, 31869, 55718, 66882, 148490, 44, 41296, 75242, 49704, 166810, 9906, 20943, 122258,\n  49112, 105667, 15969, 10344, 6408, 187694, 21399, 72742, 58970, 14867, 14376, 81889, 41856, 23225, 15042, 56993,\n  16074, 131389, 74276, 72407, 53875, 383108, 53597, 37363, 68993, 44854, 122548, 430927, 198279, 38430, 80409, 12245,\n  2981, 628, 2818, 17760, 37437, 238229, 7968, 46892, 2200, 3730, 34190, 65983, 37959, 112291, 87850, 70827,\n  6522, 20750, 73913, 111621, 41652, 19587, 2780, 58668, 25916, 85259, 18200, 168962, 95781, 42445, 102050, 7776,\n  57662, 103313, 47742, 96358, 41964, 66174, 100396, 29069, 204735, 19679, 27978, 7479, 40264, 22534, 61183, 36081,\n  107436, 58223, 14680, 23002, 101311, 24716, 124108, 12908, 5646, 31750, 40380, 14215, 232799, 102772, 14122, 96775,\n  61398, 50917, 12096, 149880, 67833, 598749, 124194, 155871, 49216, 790, 14677, 65319, 56917, 7440, 145744, 95701,\n  12206, 49405, 129269, 76199, 45732, 9767, 11058, 9047, 210885, 11051, 7392, 26307, 2130, 8132, 147526, 20802,\n  232698, 115660, 50060, 59789, 57344, 107623, 80343, 112676, 23291, 9866, 160971, 34032, 118291, 15719, 59730, 164911,\n  28975, 2659, 58046, 78480, 21854, 66209, 53863, 109085, 116045, 29021, 46481, 107552, 22130, 18764, 70254, 31272,\n  11300, 52460, 43933, 84738, 20721, 53869, 190840, 79673, 105300, 7561, 321817, 66924, 13940, 33281, 101046, 183181,\n  32176, 71878, 5678, 62924, 79535, 56646, 40303, 19559, 27703, 93042, 73368, 42187, 3670, 37376, 46440, 7023,\n  36816, 109628, 20680, 5940, 276440, 275233, 170848, 112093, 136996, 14984, 20226, 111441, 77693, 112960, 48577, 39370,\n  55707, 50314, 123404, 26570, 54281, 61372, 123391, 4857, 35928, 246740, 132507, 106646, 44241, 7196, 92258, 9825,\n  37688, 51197, 303141, 5590, 15476, 132986, 10955, 85782, 34486, 26696, 7991, 28813, 18858, 39546, 11703, 11365,\n  38185, 5716, 93555, 11925, 40121, 60002, 6985, 10976, 171384, 3887, 43394, 13337, 56346, 6381, 252336, 39573,\n  75042, 53711, 1028, 31781, 44295, 95925, 131713, 7214, 68125, 43571, 70954, 213234, 1628, 8760, 13391, 65485,\n  17320, 56038, 1710, 25248, 60803, 57399, 19839, 3870, 326, 281556, 50945, 72400, 21460, 316244, 75619, 56246,\n  98775, 481, 13513, 55765, 50427, 7388, 123519, 32929, 57908, 27124, 61316, 101097, 57467, 30228, 48792, 10788,\n  20402, 37318, 50526, 155730, 34456, 158065, 145305, 17832, 43733, 64052, 4506, 35072, 205355, 177028, 184004, 187081,\n  68616, 35938, 83703, 10367, 36892, 93186, 260137, 51934, 89970, 4985, 23445, 26755, 21558, 7948, 78741, 23376,\n  124405, 85594, 68596, 57536, 49351, 12619, 56593, 132668, 99924, 109728, 71844, 71935, 196018, 65464, 17617, 14987,\n  89701, 143773, 33997, 8687, 22701, 33258, 2914, 4436, 72108, 85610, 9671, 49067, 2327, 82988, 1361, 1672,\n  44033, 35777, 30269, 24057, 10605, 82236, 616, 15793, 13919, 47249, 112086, 116698, 9484, 80207, 90574, 33304,\n  68624, 93127, 56101, 42210, 160929, 4827, 38995, 38095, 4701, 125119, 5027, 33680, 9236, 231236, 14135, 87837,\n  23318, 70261, 78893, 30151, 81482, 14332, 1084, 74256, 27532, 46644, 79185, 3148, 62615, 6981, 55672, 31668,\n  36825, 1849, 14536, 37446, 14738, 23779, 43058, 162749, 72199, 1168, 21346, 5592, 85932, 85302, 9668, 18351,\n  57135, 150360, 2080, 228015, 77953, 34670, 119302, 151751, 31009, 106725, 84265, 45214, 59289, 74178, 113071, 263206,\n  111009, 4021, 44449, 188119, 192629, 123592, 392506, 292847, 114487, 12831, 205858, 9852, 20780, 79648, 75767, 357014,\n  97721, 18166, 21005, 67950, 33226, 204009, 16536, 2987, 11335, 66717, 144910, 47950, 17262, 55060, 15063, 2934,\n  51038, 26775, 178497, 66008, 3427, 49433, 128592, 20036, 157553, 63861, 3089, 23015, 51210, 28696, 35933, 49942,\n  71135, 231518, 99620, 17248, 21835, 176536, 20676, 16944, 38700, 165831, 233253, 295625, 36723, 13023, 52745, 10907,\n  19423, 67972, 125868, 95473, 82875, 1183, 108455, 52685, 33417, 64095, 21433, 52438, 33191, 127809, 44505, 211823,\n  7810, 2752, 95548, 162031, 7185, 91196, 47563, 61721, 33359, 17897, 23682, 42806, 178101, 22874, 49707, 199897,\n  75419, 82456, 8618, 11171, 79712, 116847, 18783, 44190, 46564, 5346, 59046, 95032, 7893, 14916, 3214, 26800,\n  24172, 121453, 34362, 10250, 17408, 18888, 4840, 68696, 22831, 13162, 36005, 32512, 14800, 62357, 41723, 45046,\n  27247, 37486, 5372, 2564, 34261, 298500, 66509, 133920, 89138, 31305, 117697, 19097, 108304, 81386, 84106, 23802,\n  46411, 63304, 946, 51417, 41777, 41041, 19501, 115864, 60743, 294354, 37955, 94165, 18116, 1156, 17937, 20645,\n  57114, 90804, 58042, 48643, 92288, 9861, 2557, 88546, 61333, 101008, 12853, 5148, 87856, 4152, 144503, 73841,\n  18718, 9789, 147565, 10846, 42085, 12789, 30223, 8993, 56352, 67203, 2448, 28215, 6052, 23540, 126319, 75933,\n  36689, 80235, 23231, 23561, 21383, 38800, 77548, 102798, 21234, 31468, 158608, 46188, 63960, 191679, 8051, 67014,\n  11185, 170078, 42186, 28827, 34777, 41930, 212079, 12421, 34750, 24111, 110344, 73918, 45171, 70826, 141949, 40063,\n  23979, 24254, 37309, 26724, 27179, 24718, 83648, 54938, 14591, 17425, 29525, 102675, 48975, 48654, 12316, 8929,\n  60640, 41709, 50168, 63264, 89812, 50716, 48632, 38755, 138583, 160123, 55579, 71829, 24230, 233277, 46322, 39650,\n  166388, 34718, 24108, 98252, 7031, 106695, 62498, 18258, 35062, 217827, 78731, 34824, 33354, 19520, 60852, 2432,\n  60224, 8587, 2836, 62955, 702, 20227, 42285, 40560, 95592, 62486, 11094, 53035, 143291, 18842, 46177, 77994,\n  1770, 9657, 107422, 172915, 32655, 128716, 25886, 25164, 156740, 119928, 165875, 85817, 11007, 89110, 33956, 12652,\n  65156, 180266, 8494, 36889, 19958, 20955, 96, 1264, 118288, 135769, 44754, 86671, 5632, 19026, 168220, 289120,\n  33569, 93821, 66144, 70635, 7687, 5642, 2714, 55445, 56636, 71545, 184182, 93133, 7332, 37389, 12643, 52315,\n  22729, 11014, 158742, 17050, 152889, 50178, 34601, 41945, 52136, 9948, 26914, 63548, 95721, 115951, 40759, 8960,\n  158258, 38938, 49232, 48325, 42234, 81523, 253019, 66128, 40978, 20048, 238048, 38760, 62928, 122560, 118532, 43687,\n  137472, 163689, 26680, 9878, 17448, 51035, 16211, 60834, 36749, 29178, 14241, 59868, 150086, 2305, 26477, 42422,\n  34342, 165341, 83279, 33894, 14257, 29928, 12743, 13957, 125571, 89134, 66712, 10952, 16507, 147839, 30146, 7249,\n  16565, 45399, 39874, 114565, 215780, 31990, 230881, 171477, 102, 196546, 44538, 10880, 84948, 281705, 86651, 10617,\n  31395, 2342, 453658, 43569, 60561, 132901, 21845, 17727, 58556, 258242, 22262, 58728, 4008, 77997, 11806, 37431,\n  30599, 81375, 109137, 185787, 114085, 217292, 97453, 169085, 30593, 60212, 11544, 102056, 65580, 2384, 91655, 4855,\n  95725, 7295, 157994, 16228, 20669, 53276, 141590, 105246, 17334, 25440, 76067, 17967, 39321, 38911, 11362, 28559,\n  63807, 21627, 26468, 85816, 40120, 1025, 15234, 58319, 69516, 66512, 124548, 75845, 78873, 22137, 46681, 51242,\n  85683, 32909, 76747, 35555, 43396, 101465, 1765, 73094, 1077, 2962, 39028, 66777, 57831, 42048, 15828, 13962,\n  36041, 63657, 52412, 5242, 58846, 2141, 5506, 219012, 134451, 3936, 182230, 17558, 17153, 152237, 22621, 49377,\n  170216, 35257, 68233, 65374, 6510, 11126, 212151, 7184, 2480, 22517, 3437, 33073, 30156, 16557, 3768, 55067,\n  86829, 91000, 12350, 148650, 66017, 79424, 70885, 49066, 28250, 21369, 51213, 34533, 11510, 3258, 18176, 18465,\n  84413, 6315, 36411, 163765, 4346, 356, 107618, 598, 13727, 285026, 162695, 8749, 14583, 7132, 63521, 184253,\n  32378, 25991, 5604, 30961, 53675, 4874, 84693, 5086, 34811, 26978, 56564, 7904, 33519, 51221, 113942, 69253,\n  6664, 125563, 22055, 220680, 102008, 742, 51930, 19494, 176108, 44424, 35123, 13025, 75685, 11759, 74335, 22250,\n  181453, 131147, 16984, 132115, 154311, 11991, 76452, 52609, 85351, 196, 30969, 9198, 74919, 2529, 56838, 71779,\n  29187, 116304, 3504, 62330, 41190, 86153, 28393, 254926, 104228, 105189, 13264, 84359, 3574, 12415, 8534, 57147,\n  10175, 188174, 59504, 60932, 66318, 16407, 107921, 17638, 99103, 49278, 28403, 39786, 145865, 8462, 3558, 43406,\n  142271, 29139, 21989, 36552, 93955, 72365, 7176, 13556, 106185, 37957, 321774, 17782, 129017, 51154, 27938, 24952,\n  1935, 39366, 2791, 33489, 41582, 56078, 24558, 9311, 5449, 218786, 27808, 190429, 68013, 36020, 86003, 29735,\n  3404, 87348, 119357, 115714, 2324, 86796, 81973, 40992, 43376, 93621, 28784, 16808, 36367, 2517, 2909, 191926,\n  24978, 55303, 53308, 205724, 60068, 3098, 21375, 64784, 23949, 26579, 63121, 12319, 80145, 39967, 97861, 6757,\n  70143, 67642, 37082, 34698, 69140, 122883, 46151, 62187, 80934, 429, 19437, 135071, 137885, 222647, 13331, 154065,\n  327, 61778, 74257, 40116, 37493, 14855, 85079, 237641, 42342, 102164, 199965, 71204, 4662, 29368, 5042, 113914,\n  122214, 8955, 13149, 102503, 43173, 5659, 163787, 69003, 307084, 63392, 171080, 21390, 81918, 86666, 36622, 24126,\n  28887, 5736, 28054, 207170, 163428, 79891, 346467, 95363, 38980, 111806, 80828, 9200, 19288, 294896, 114468, 87405,\n  111715, 141705, 7015, 72754, 68463, 48738, 243147, 33397, 101210, 37051, 98801, 82847, 20397, 4940, 185559, 18716,\n  54718, 83491, 11725, 40803, 1128, 12128, 23060, 5174, 7745, 67007, 46701, 1571, 27807, 180186, 256996, 18975,\n  16837, 7877, 212758, 250379, 15440, 87954, 57755, 24719, 124057, 83461, 258, 50864, 8874, 29038, 71289, 31627,\n  15429, 9005, 4061, 113851, 107716, 82819, 13651, 79656, 117851, 17539, 111446, 12938, 39724, 190787, 4352, 15402,\n  21070, 62708, 8539, 23777, 73853, 13552, 38810, 86117, 16285, 56400, 1718, 75342, 142863, 29033, 378, 110113,\n  180321, 32586, 23606, 26393, 160984, 207987, 23783, 8406, 16904, 24596, 47274, 11693, 46539, 60524, 78595, 48423,\n  31718, 20170, 9009, 146268, 15183, 191060, 172765, 1349, 138436, 37365, 10970, 40509, 225817, 20021, 70394, 152138,\n  21541, 66559, 66544, 89352, 2725, 17258, 91345, 7313, 3815, 115868, 8660, 40362, 4071, 103524, 39388, 118275,\n  21950, 6549, 38226, 32754, 209574, 29201, 43495, 18028, 20296, 40597, 18370, 47520, 202450, 24134, 2219, 8195,\n  69545, 38041, 136934, 46374, 19041, 159811, 84865, 58620, 846, 98749, 13569, 30714, 97246, 32186, 4479, 27355,\n  92973, 35214, 151491, 75963, 37631, 1561, 27200, 238083, 23182, 60756, 12291, 25766, 39355, 102333, 87362, 65741,\n  59906, 19538, 201575, 48772, 102938, 24438, 292580, 39964, 66366, 9004, 61379, 50548, 37622, 38732, 28379, 68180,\n  76622, 17488, 69849, 5963, 7219, 48143, 43413, 55358, 540, 58691, 29506, 19245, 52193, 48621, 5518, 13048,\n  118625, 44755, 191081, 42061, 89197, 2259, 60665, 66994, 71210, 51232, 3585, 142096, 55024, 7892, 8345, 58653,\n  463307, 65658, 64319, 137941, 136323, 53499, 12746, 43492, 6978, 95163, 29925, 60175, 5128, 7352, 41463, 184756,\n  121146, 20473, 18426, 4598, 5309, 54580, 14277, 121151, 10691, 56711, 43880, 63409, 76682, 11830, 172218, 264898,\n  32632, 66536, 81062, 31649, 25788, 92774, 60222, 11100, 63159, 9432, 224657, 25240, 53613, 152, 138620, 163829,\n  2397, 85345, 12501, 37507, 64932, 38575, 43522, 65789, 80198, 78796, 35226, 3851, 108891, 73311, 3060, 28391,\n  93671, 39663, 46142, 30982, 66041, 37281, 68157, 26553, 71872, 81142, 211527, 39747, 118119, 22695, 2859, 11066,\n  20232, 168911, 7933, 197005, 17066, 111071, 44434, 133994, 120798, 12766, 227798, 45756, 132852, 29917, 36076, 55352,\n  65281, 129800, 41958, 18944, 84678, 18580, 168093, 132621, 39997, 54092, 27740, 32354, 3770, 114118, 103242, 43918,\n  15899, 18574, 145944, 3190, 123469, 219903, 24169, 100571, 62403, 16776, 92779, 14535, 17168, 16475, 14304, 37231,\n  1712, 28218, 242754, 61688, 28980, 1318, 51359, 222657, 99200, 67989, 31772, 23932, 35351, 201251, 49041, 27306,\n  19128, 40135, 3986, 77333, 19649, 120683, 151927, 21081, 7076, 78375, 77501, 101599, 8011, 89585, 96715, 58179,\n  5378, 102138, 106793, 26051, 217276, 4197, 16297, 27014, 46721, 13322, 22806, 5278, 29629, 70632, 9647, 71519,\n  58818, 40603, 128530, 8903, 36770, 56900, 31483, 26935, 43845, 34265, 34920, 87658, 6114, 84767, 64250, 47318,\n  50720, 19264, 162514, 33357, 13117, 6705, 46696, 75032, 71054, 87004, 42035, 69138, 11903, 99854, 102328, 19611,\n  34525, 69312, 6431, 49842, 101600, 133178, 108751, 41829, 89939, 225664, 48916, 99556, 9195, 130387, 5960, 36857,\n  116724, 53518, 94002, 39077, 53996, 6945, 22261, 64291, 8314, 152785, 57588, 16522, 9091, 5048, 87671, 35441,\n  39509, 1945, 12423, 158923, 178413, 37549, 14095, 1475, 73188, 62878, 4819, 24012, 68534, 42606, 4010, 120809,\n  57497, 59564, 101758, 103718, 32701, 80116, 12345, 95834, 46918, 21468, 53213, 15665, 31200, 3867, 5140, 96013,\n  250744, 21016, 10069, 13968, 35449, 180829, 27683, 39704, 59956, 22893, 3115, 26293, 32785, 75934, 62445, 141162,\n  62720, 2018, 83638, 19949, 114012, 95006, 3330, 99829, 130935, 309272, 9565, 55874, 121727, 37017, 23586, 319858,\n  40970, 27602, 8625, 112329, 61060, 100088, 118525, 25922, 16232, 1907, 60671, 51583, 44553, 80993, 5262, 94679,\n  8676, 940, 20736, 11823, 3020, 16476, 12340, 152600, 97416, 3703, 25744, 66826, 16245, 16876, 46446, 84798,\n  74227, 176020, 45192, 61955, 75496, 23946, 23626, 40372, 26036, 6149, 11822, 30582, 16541, 41914, 82385, 232823,\n  40921, 80773, 14930, 3631, 7517, 39619, 4348, 36180, 126106, 138939, 62611, 1477, 113512, 47321, 25052, 14546,\n  118881, 29060, 23589, 128322, 36795, 18401, 137921, 104699, 267929, 36194, 172791, 18113, 4766, 188215, 30083, 332586,\n  94089, 5805, 77909, 22194, 68234, 154976, 43220, 40660, 70001, 184893, 138095, 11128, 103010, 22663, 5108, 212615,\n  8485, 5565, 49222, 54614, 26530, 42639, 16319, 55062, 152662, 105595, 21114, 22216, 10294, 68158, 10436, 86950,\n  7206, 62115, 3977, 3657, 59874, 456, 118617, 18156, 106663, 112229, 80992, 17442, 8217, 55551, 5133, 34344,\n  251927, 51153, 39364, 201321, 7816, 66803, 23057, 156724, 145664, 14276, 95705, 979, 2796, 6875, 13429, 212525,\n  50602, 26276, 28284, 3424, 19465, 52397, 46963, 31420, 51399, 206476, 92317, 48851, 637, 100820, 83349, 10317,\n  60227, 21972, 6908, 282439, 32857, 224767, 95629, 83882, 42106, 87338, 69757, 29840, 68709, 37665, 45244, 114577,\n  49188, 175943, 54009, 186746, 106158, 70168, 3358, 234002, 50555, 9221, 129338, 9562, 20118, 32923, 78479, 118280,\n  65752, 4977, 10474, 102174, 60947, 129006, 10570, 83451, 8598, 8078, 159367, 123785, 80438, 16742, 5905, 5281,\n  181513, 42402, 6977, 163136, 93179, 42191, 14968, 50421, 112401, 105440, 33456, 57347, 121611, 4221, 94954, 36517,\n  24046, 27796, 6255, 33394, 72990, 135408, 116627, 1233, 57874, 25654, 95419, 68156, 401399, 313338, 55208, 45573,\n  93124, 119251, 47200, 38196, 11909, 130667, 45391, 73904, 64964, 167846, 4137, 115606, 52036, 62214, 7969, 160925,\n  7187, 1132, 134835, 40309, 73195, 64494, 80472, 444841, 61111, 26500, 45323, 40743, 53625, 52797, 22659, 15631,\n  29739, 36706, 28841, 39147, 102836, 26794, 10536, 14845, 87305, 45874, 12241, 127587, 83833, 57183, 79722, 30844,\n  41304, 84655, 20825, 92500, 3722, 25655, 27811, 10157, 81634, 31362, 34088, 92487, 70123, 22190, 185100, 72658,\n  139035, 192523, 88241, 2078, 230490, 44528, 85638, 100198, 22088, 29982, 291233, 241062, 13865, 4445, 137791, 37835,\n  107218, 31726, 19718, 38234, 72528, 23046, 19177, 66695, 5109, 17251, 28077, 5617, 21554, 47839, 72425, 133825,\n  1486, 73065, 181275, 141508, 21768, 62971, 63082, 2512, 34200, 9904, 120309, 6392, 91243, 68416, 268253, 41199,\n  116757, 138551, 185526, 41246, 28986, 4093, 19057, 17295, 4148, 245766, 122360, 35356, 112075, 20301, 75441, 10998,\n  7977, 19769, 62922, 937, 63547, 100196, 26427, 157820, 20983, 236696, 22935, 8140, 90315, 156004, 47204, 140973,\n  7726, 45097, 52725, 22636, 23436, 257282, 105247, 522, 88389, 216031, 202204, 46812, 211666, 19693, 68828, 81691,\n  45925, 11256, 30292, 372, 5236, 167826, 88328, 232776, 151611, 5360, 82104, 18841, 80393, 25465, 18285, 20320,\n  72377, 31730, 33160, 45803, 38715, 27705, 37379, 24163, 18360, 103586, 4015, 32305, 269494, 91252, 20080, 36567,\n  54650, 7797, 57073, 12650, 31164, 42209, 6375, 261663, 105528, 81661, 106002, 2800, 5375, 17247, 43151, 4442,\n  15727, 194619, 100855, 144898, 62320, 78465, 39929, 16454, 1967, 28311, 61363, 17219, 9395, 8745, 121445, 76939,\n  80385, 162380, 22009, 54191, 44248, 16299, 122830, 48151, 74429, 78291, 64755, 14238, 44966, 2511, 17712, 67954,\n  93583, 829, 105899, 49935, 84750, 11591, 33185, 85447, 42717, 27409, 208542, 28965, 62052, 52525, 5597, 25694,\n  65594, 16343, 63224, 276188, 12475, 9331, 127507, 38522, 57287, 24128, 133161, 79723, 105548, 133695, 48917, 27558,\n  43278, 46520, 13778, 141954, 110785, 83366, 17715, 46317, 105763, 66298, 147013, 41086, 94180, 16478, 220447, 44611,\n  730, 19722, 78975, 117889, 125643, 26254, 16574, 18480, 65006, 15806, 38549, 246418, 46052, 36056, 8440, 34984,\n  30170, 3163, 59800, 4458, 115442, 4283, 41970, 33507, 104078, 1653, 22, 121158, 276486, 3655, 6338, 24048,\n  133421, 23641, 2161, 24422, 36006, 8086, 10675, 181474, 12307, 29514, 59143, 14729, 52509, 87128, 122470, 19446,\n  80852, 33314, 24573, 119864, 14237, 9652, 57779, 6612, 51851, 15284, 98871, 90581, 124466, 156831, 21190, 22015,\n  71380, 161906, 87247, 69201, 18392, 17908, 108470, 72962, 40719, 14338, 17911, 95260, 43339, 20610, 78916, 20710,\n  72451, 11315, 31448, 17263, 58853, 178878, 48111, 116002, 45497, 80506, 82605, 85880, 36300, 121755, 25215, 36118,\n  301929, 88728, 405223, 276136, 553, 34704, 212438, 49970, 78329, 922, 20711, 25036, 257130, 38295, 145369, 18128,\n  15385, 30829, 55656, 48345, 8012, 3561, 28004, 122041, 192900, 58338, 112508, 41085, 29976, 87040, 47117, 23905,\n  4336, 92061, 138880, 97407, 42083, 172121, 6256, 25192, 172671, 5, 93568, 1420, 12677, 31605, 56743, 40620,\n  6015, 78415, 231077, 31298, 80026, 13902, 19048, 24924, 170586, 32955, 176119, 87859, 36731, 6773, 27711, 24658,\n  26475, 115216, 133207, 93250, 95820, 88522, 8317, 5714, 124047, 55219, 86860, 19677, 23961, 22928, 162209, 8904,\n  225992, 359835, 56084, 96201, 29392, 96558, 86071, 93643, 55114, 13347, 8183, 95129, 82012, 2017, 123336, 34219,\n  115554, 157159, 47747, 101684, 41008, 18735, 193781, 104151, 226906, 7552, 179874, 124113, 31159, 21162, 44010, 14771,\n  51268, 166128, 31382, 73124, 77438, 92830, 205709, 12113, 1292, 38937, 13114, 1334, 2118, 15597, 69581, 14449,\n  21934, 76618, 48728, 67038, 14967, 51495, 24243, 87736, 147249, 26720, 11119, 46063, 43749, 5843, 44147, 152629,\n  133428, 65703, 14269, 45604, 57982, 28672, 55616, 45957, 8438, 95433, 37698, 220862, 132034, 39456, 61870, 4161,\n  26501, 73560, 56418, 9845, 4654, 20916, 10456, 88920, 119358, 9015, 65931, 96507, 48029, 38534, 21676, 109081,\n  43078, 34943, 25089, 6131, 28766, 23665, 5477, 10255, 16695, 67, 45778, 42443, 42770, 29534, 23733, 100513,\n  62617, 42630, 48746, 14191, 43753, 50295, 26007, 8792, 57243, 43119, 54725, 164253, 58250, 112304, 131796, 25165,\n  4651, 3188, 24831, 47748, 3705, 19540, 13211, 102095, 5593, 18699, 23666, 32005, 117571, 33541, 60584, 74573,\n  86311, 99443, 25172, 27222, 168938, 7143, 11853, 53560, 18834, 19960, 86522, 28217, 53266, 117700, 72989, 34323,\n  18721, 66450, 34346, 74056, 47217, 202002, 46269, 9429, 68582, 75458, 37823, 82843, 96652, 32549, 145144, 27958,\n  19820, 158086, 31955, 201406, 135379, 31207, 192545, 12950, 51704, 9094, 248263, 76147, 64028, 110009, 79407, 89345,\n  99284, 223492, 47966, 26848, 15359, 201137, 2861, 110507, 71231, 72297, 31851, 118777, 71039, 151051, 240855, 16333,\n  50766, 14727, 7939, 4149, 80908, 418780, 88378, 59276, 1327, 7284, 38576, 79814, 65820, 42199, 84860, 49574,\n  62596, 12396, 70598, 40117, 8648, 7994, 16836, 7630, 14047, 359699, 106878, 525, 29037, 28064, 13380, 11675,\n  50669, 74216, 103539, 180314, 27449, 56299, 172344, 19274, 7301, 246099, 32043, 19422, 36506, 129317, 6806, 30140,\n  4614, 46639, 66926, 932, 86600, 6322, 27847, 233103, 10541, 39025, 34887, 3517, 12972, 26220, 2031, 66561,\n  115015, 48658, 47596, 12714, 33845, 3893, 16165, 35237, 89983, 14769, 11962, 147224, 47018, 29977, 27979, 5552,\n  82338, 86023, 131368, 1218, 24853, 237840, 132193, 15455, 40873, 3668, 65351, 53388, 15229, 59889, 272245, 47934,\n  11858, 34347, 18038, 90853, 86981, 300602, 19343, 114181, 29362, 84921, 6095, 106059, 79472, 38015, 1206, 48741,\n  6208, 80000, 21916, 17423, 6002, 108083, 24479, 34931, 56661, 9511, 26995, 100694, 163853, 35997, 81254, 58321,\n  18919, 171890, 86877, 91341, 74503, 70477, 53412, 7027, 59281, 39892, 131302, 5864, 15947, 61301, 67466, 162369,\n  47956, 27874, 35624, 282324, 21270, 111847, 102548, 41482, 30955, 116737, 28264, 8592, 55458, 22301, 75090, 29821,\n  30697, 51709, 3041, 19208, 8038, 24634, 30467, 87509, 126428, 19389, 18814, 152686, 20701, 83474, 45832, 80891,\n  105808, 11378, 153223, 120770, 98186, 150633, 49838, 9141, 12755, 30962, 5260, 74490, 21256, 31678, 65062, 33326,\n  289838, 187831, 20595, 89768, 2805, 58535, 10844, 70085, 12090, 2451, 138068, 98544, 24461, 4511, 6754, 41684,\n  28203, 3383, 65355, 82833, 30161, 83924, 234361, 128424, 28921, 222594, 33975, 125491, 34069, 11508, 67464, 144226,\n  41850, 98703, 34371, 7901, 21254, 38398, 65651, 23549, 53883, 213340, 123269, 12028, 71764, 177701, 28758, 2623,\n  68395, 11549, 15232, 68603, 9660, 63116, 36079, 57093, 31198, 20475, 48467, 89984, 35619, 186847, 107469, 31389,\n  43631, 73867, 41949, 68841, 114250, 1605, 30564, 63403, 17588, 27680, 99533, 12641, 70325, 50428, 73426, 78379,\n  11855, 91651, 72081, 91720, 60198, 15743, 12065, 83398, 140046, 6761, 46598, 45900, 5068, 886, 62448, 148968,\n  37347, 19405, 9680, 15819, 43496, 63370, 75667, 163700, 37639, 3633, 22774, 34341, 183131, 134335, 37200, 23915,\n  7054, 14194, 12970, 26438, 13350, 285521, 25594, 8219, 104410, 91039, 168804, 138480, 149734, 15907, 33818, 61132,\n  60082, 4622, 110187, 56736, 13551, 73571, 3945, 73463, 65498, 17758, 263266, 17593, 2710, 27585, 54469, 38200,\n  45367, 63754, 28881, 3473, 12791, 98287, 31895, 65787, 4463, 94536, 24951, 36332, 59901, 28803, 52130, 86403,\n  7668, 181822, 74831, 18977, 9850, 177206, 145485, 109798, 7292, 31421, 26280, 77211, 58511, 12507, 127004, 11113,\n  147, 8729, 56208, 43066, 79926, 129937, 31345, 83947, 39915, 46146, 98763, 42566, 1337, 13192, 18323, 105163,\n  80570, 117753, 16555, 72883, 11077, 159438, 40764, 70933, 83329, 26066, 12276, 72059, 21655, 173836, 126713, 69454,\n  153482, 91585, 70644, 102558, 110483, 6764, 127864, 190133, 3961, 101798, 20945, 71138, 82402, 90884, 69669, 44753,\n  923, 16939, 59700, 164258, 25969, 27082, 31399, 43846, 6306, 246093, 51342, 6153, 151581, 202801, 182731, 56475,\n  162188, 89426, 141356, 14355, 121815, 27536, 28023, 65257, 77523, 106668, 127314, 24947, 12790, 38796, 169698, 23555,\n  10725, 44573, 183083, 42088, 62716, 43265, 105958, 32050, 44067, 50118, 1668, 3874, 6243, 318411, 16599, 1691,\n  94999, 52378, 28671, 216728, 123258, 2059, 34969, 69225, 5913, 136280, 171443, 141515, 91662, 22175, 135282, 80020,\n  92270, 1663, 4808, 4482, 3495, 34691, 5226, 109830, 108512, 17342, 107488, 11606, 123190, 100247, 29666, 146527,\n  113014, 15794, 30894, 13224, 39585, 243192, 22351, 9903, 7836, 47699, 11078, 25468, 122291, 48821, 26780, 122679,\n  75521, 81450, 630, 4895, 92900, 55074, 74293, 17441, 3563, 111657, 103102, 51613, 12318, 52370, 36191, 68245,\n  34269, 40445, 41354, 122901, 168604, 182500, 62012, 42557, 11259, 24428, 115113, 86345, 12362, 3909, 78430, 86852,\n  134602, 20459, 47853, 93879, 22577, 7659, 3688, 38555, 13349, 17381, 56715, 91639, 12493, 10895, 92438, 3142,\n  37057, 28928, 2004, 36427, 32268, 34222, 209974, 10432, 67436, 41989, 173518, 107930, 27079, 62729, 30908, 55558,\n  5828, 45031, 14902, 53546, 8204, 144263, 60255, 14520, 88212, 86582, 109589, 69356, 8064, 47449, 8505, 66558,\n  16886, 4844, 52817, 111260, 215129, 12941, 91118, 650, 20770, 6273, 73089, 40618, 62790, 2873, 35002, 14023,\n  97208, 19386, 102646, 36993, 143736, 135457, 35385, 113601, 17893, 32627, 84439, 100619, 56016, 6581, 57264, 172160,\n  45452, 111710, 203627, 70131, 24100, 322787, 1996, 35665, 70078, 22358, 90922, 83658, 4097, 63200, 58499, 14542,\n  99153, 52159, 6615, 12414, 63415, 31986, 16823, 1579, 65405, 137809, 8841, 16898, 48082, 259, 33014, 42375,\n  12260, 179850, 73667, 91389, 98882, 29532, 17311, 326251, 41092, 5928, 20742, 44964, 48019, 43505, 9317, 49265,\n  6643, 192712, 48424, 163487, 19861, 20113, 70848, 31928, 105333, 23685, 78563, 14638, 54755, 7158, 24142, 44018,\n  20774, 125255, 20331, 24280, 10163, 1285, 2336, 39851, 4299, 117269, 46714, 63816, 87779, 159624, 11731, 9971,\n  990, 137317, 108831, 50994, 74554, 162680, 23640, 131597, 146962, 170620, 34829, 91205, 21184, 1913, 63616, 18427,\n  93136, 156592, 17519, 67565, 115882, 138220, 78622, 88535, 18115, 2711, 33554, 109492, 54298, 971, 24914, 25863,\n  36363, 45715, 27099, 194995, 14299, 178181, 111488, 72395, 322385, 157719, 130787, 11897, 81843, 83999, 11369, 49280,\n  118604, 40922, 61332, 110343, 53407, 75639, 40582, 300440, 54722, 25637, 13694, 48248, 48278, 194521, 56203, 52779,\n  48783, 72627, 10953, 376, 16733, 280238, 26351, 230789, 15132, 25168, 137270, 3588, 63704, 73376, 94031, 74284,\n  19443, 159557, 9697, 39901, 13351, 119050, 15406, 146455, 3460, 29556, 75195, 37673, 102524, 92329, 47289, 98413,\n  15311, 100684, 56345, 7116, 95480, 11590, 7200, 167, 23610, 58426, 17730, 136656, 27944, 53151, 2701, 8824,\n  103124, 3017, 90744, 113588, 53216, 79736, 65940, 26931, 498, 29568, 80540, 143543, 21292, 1740, 59268, 16561,\n  180816, 42323, 50174, 40890, 52866, 10703, 57169, 4700, 17191, 4424, 93511, 49698, 166650, 26972, 48631, 165169,\n  82879, 69326, 202970, 4007, 2376, 231325, 139592, 22119, 62851, 37504, 68816, 58345, 67398, 186643, 43331, 277416,\n  53749, 15746, 23102, 17432, 4793, 151138, 48822, 54265, 48203, 198688, 14305, 54287, 2291, 18018, 113378, 123260,\n  7180, 97549, 87027, 120085, 2920, 76080, 8190, 102005, 5641, 64580, 14955, 59802, 54028, 58884, 19367, 81779,\n  412567, 85957, 97053, 103637, 78871, 29364, 27637, 141728, 4767, 30686, 112738, 130146, 42745, 12730, 105040, 14844,\n  232, 210944, 36581, 152317, 135543, 29744, 3129, 55647, 58149, 46319, 27265, 17499, 28005, 59948, 7170, 34138,\n  5702, 293047, 110892, 408, 91760, 218674, 18469, 46095, 81403, 14389, 4610, 35672, 73060, 11006, 74848, 104820,\n  118143, 190357, 20043, 105358, 141735, 5115, 27093, 45924, 123073, 52599, 29433, 9616, 238350, 78610, 24851, 58858,\n  26769, 31969, 24613, 18294, 4982, 32735, 39639, 143563, 112073, 202205, 12567, 4873, 88601, 44897, 81503, 101648,\n  81362, 34662, 85277, 17574, 48173, 21435, 221188, 40215, 39576, 80786, 26544, 64668, 81841, 10731, 37733, 247986,\n  149188, 127703, 495, 18382, 54388, 72446, 43071, 30974, 198723, 89608, 41360, 190, 33045, 8386, 31658, 19992,\n  237838, 119015, 137622, 50890, 100913, 6460, 116233, 267230, 26621, 104129, 65114, 14190, 41542, 14888, 85962, 23342,\n  23041, 26453, 43725, 71809, 45186, 4770, 46452, 53894, 56616, 221286, 18973, 9038, 109299, 55365, 19366, 26863,\n  18808, 60909, 69353, 41738, 83463, 12100, 68561, 72860, 3980, 13796, 49340, 12332, 31311, 27418, 4255, 53430,\n  18976, 45523, 510, 14224, 30477, 26581, 4530, 3651, 101663, 139840, 22709, 150861, 31996, 63923, 120623, 262522,\n  3076, 10528, 2929, 14672, 130238, 18087, 9816, 121894, 100308, 25085, 55111, 14565, 18952, 53293, 2042, 369988,\n  23674, 61789, 133529, 28783, 108293, 35477, 47119, 36448, 71049, 40015, 33055, 78598, 198442, 1833, 159937, 40654,\n  77444, 189245, 113153, 8621, 18599, 38553, 35223, 166072, 2375, 11659, 21786, 89523, 6032, 12116, 63046, 159398,\n  18454, 3678, 32521, 47626, 11411, 103527, 38896, 42946, 15696, 26370, 10185, 8413, 37080, 165583, 4331, 63555,\n  14907, 72220, 50056, 6623, 62236, 36565, 49783, 10049, 17503, 100581, 55951, 146244, 24724, 9626, 17969, 25524,\n  109300, 173965, 99994, 101056, 46459, 43647, 53737, 277968, 8347, 123521, 74858, 33829, 44762, 77574, 877, 81377,\n  222525, 123532, 30602, 43881, 53145, 2973, 16284, 81940, 61281, 127044, 63620, 9875, 14756, 114829, 19032, 9202,\n  52759, 119141, 23928, 120551, 19607, 3599, 33401, 76821, 73233, 117430, 39968, 36539, 7071, 5446, 121735, 194059,\n  15206, 45283, 6706, 15603, 65615, 1207, 165723, 92275, 34773, 104447, 8396, 32353, 205240, 164323, 13600, 60555,\n  79205, 25532, 22907, 33410, 57480, 107111, 69630, 32137, 47832, 70913, 33161, 20321, 2371, 117348, 10714, 86246,\n  1625, 11763, 17900, 268, 78457, 99175, 97940, 101092, 86660, 32221, 14041, 128504, 125080, 53744, 124263, 31017,\n  13897, 403, 31859, 21964, 5633, 111630, 5547, 77329, 17961, 18241, 84995, 25984, 12983, 67491, 62168, 47262,\n  5241, 297, 51191, 7351, 8967, 147212, 82060, 16821, 782, 11033, 82431, 62957, 5026, 43459, 77963, 203477,\n  53528, 6247, 191852, 87774, 74164, 215654, 13467, 1522, 219964, 28589, 244104, 16242, 117821, 67725, 72570, 156792,\n  17186, 15979, 26990, 44128, 193014, 35276, 57125, 16212, 166451, 68017, 6905, 77608, 16364, 53777, 75921, 76426,\n  37975, 26203, 269296, 64099, 84122, 12077, 38533, 830, 4407, 20139, 963, 43028, 38902, 42911, 37503, 83343,\n  85045, 16979, 1165, 60835, 137387, 58380, 86990, 110066, 134540, 56331, 193845, 81238, 17922, 163093, 38744, 110641,\n  12502, 56404, 34862, 26865, 125964, 12965, 111648, 25547, 7771, 27196, 136980, 9555, 29551, 107158, 57885, 18831,\n  37705, 35505, 101742, 13970, 102109, 62548, 124657, 23328, 11124, 89592, 146376, 248050, 6241, 22033, 18337, 80685,\n  29898, 11908, 216623, 67721, 106162, 146610, 21377, 15085, 91552, 42041, 62560, 122532, 125336, 102365, 121537, 142559,\n  29693, 223919, 11515, 110495, 18776, 22494, 5895, 185059, 103592, 229351, 51220, 100102, 37027, 257855, 29359, 54123,\n  36066, 106493, 12244, 79258, 32002, 432, 56205, 94836, 90182, 6726, 14762, 29391, 48938, 26864, 38083, 60364,\n  3310, 60192, 14766, 205567, 57504, 110760, 22649, 24666, 46333, 21517, 3430, 13135, 28873, 27052, 158809, 11597,\n  20529, 6695, 23138, 22960, 37137, 45574, 6545, 305877, 43423, 26153, 24769, 59844, 14501, 10430, 134352, 56169,\n  13213, 103432, 49523, 35181, 13435, 12408, 129475, 64620, 230854, 77390, 51990, 15653, 83248, 33466, 44571, 117828,\n  51481, 2187, 10559, 68019, 18021, 54895, 48247, 18354, 33737, 4554, 108595, 37288, 39767, 116707, 9175, 3726,\n  108877, 21616, 83684, 49862, 1938, 8543, 276466, 20134, 108498, 48770, 102254, 31914, 131520, 185291, 100559, 51890,\n  209, 19526, 76471, 50544, 71814, 99351, 8172, 198526, 28816, 20419, 9109, 98389, 136777, 76479, 75596, 30635,\n  165417, 48216, 120220, 25955, 211071, 39314, 24308, 32164, 2559, 146280, 43403, 9233, 17947, 90585, 1786, 86920,\n  125662, 2457, 64741, 32152, 32918, 122882, 78538, 44001, 31723, 56426, 23375, 103172, 88177, 145697, 52506, 49319,\n  68016, 31664, 41488, 18486, 110400, 7030, 28241, 986, 109199, 19900, 42147, 56864, 65287, 49183, 7858, 24000,\n  30453, 840, 16673, 25907, 68916, 89927, 6309, 158335, 36407, 199737, 130464, 13137, 59603, 201778, 195292, 21015,\n  42466, 179062, 172561, 89492, 11075, 180407, 31868, 72493, 20998, 60217, 9865, 19530, 39274, 130266, 54539, 21623,\n  12535, 13505, 40641, 73375, 4087, 85633, 2153, 3117, 70680, 55788, 92096, 47509, 98493, 37490, 271936, 151475,\n  3032, 16171, 96642, 34106, 78425, 125761, 19591, 3366, 19316, 54508, 24183, 50786, 194248, 91528, 33253, 34622,\n  108355, 41741, 705, 3814, 3883, 108929, 13203, 67831, 10142, 59754, 68208, 29128, 84820, 56880, 38794, 24972,\n  48571, 40821, 40476, 18137, 164254, 24064, 236309, 79181, 11282, 395, 39169, 2013, 51587, 28551, 9645, 701,\n  109513, 115899, 113566, 12762, 62045, 58322, 103726, 41343, 40866, 244102, 143816, 2490, 70346, 40973, 52618, 15412,\n  30720, 104315, 38917, 42027, 93676, 17513, 107418, 20706, 123890, 13399, 97727, 24044, 87962, 65606, 44250, 98044,\n  65276, 74790, 101473, 19350, 91570, 1326, 87790, 172042, 7577, 100813, 86896, 85891, 41512, 108130, 27794, 14875,\n  71431, 12835, 156250, 58135, 3759, 22476, 42176, 115873, 34686, 56523, 73643, 108505, 51491, 20838, 12721, 32863,\n  45700, 29496, 13700, 34294, 55360, 29206, 155942, 123812, 7706, 163234, 203, 132720, 49358, 144431, 8130, 175788,\n  35818, 3270, 76832, 25710, 54095, 97274, 28779, 94621, 74396, 19092, 128242, 58067, 20885, 14670, 93255, 15107,\n  63291, 23654, 126900, 129421, 59294, 262659, 9798, 3251, 67344, 28600, 44629, 50672, 29072, 26999, 31526, 23183,\n  49175, 165843, 175455, 17282, 175411, 32022, 45989, 30298, 90690, 78118, 83156, 23749, 35636, 31317, 7069, 80381,\n  94561, 133756, 14960, 97404, 6138, 41065, 78041, 32843, 16601, 34123, 9559, 146529, 123377, 96395, 54441, 42012,\n  84257, 123541, 10745, 22139, 106459, 11720, 150883, 172651, 154996, 110538, 4728, 53447, 25704, 2009, 71152, 119354,\n  21166, 66604, 1429, 216162, 8637, 122250, 63520, 27180, 29172, 36124, 276428, 107787, 77184, 4680, 14952, 104903,\n  24418, 14793, 51561, 52931, 8371, 26342, 48526, 7118, 92066, 67280, 40653, 8847, 34597, 105438, 14198, 50163,\n  61188, 146286, 50315, 41205, 170829, 161496, 585, 197359, 95056, 1687, 365794, 91349, 48507, 5804, 49263, 5146,\n  104902, 96365, 117343, 132222, 46084, 96919, 16875, 8073, 262381, 79982, 52663, 13928, 16056, 153908, 15145, 109256,\n  132308, 18763, 24904, 167644, 13618, 40750, 18686, 147124, 114709, 150038, 52849, 2938, 12568, 48617, 8778, 5459,\n  44202, 44591, 74914, 17183, 248689, 13878, 7822, 80060, 23116, 194037, 18487, 2067, 7798, 43077, 33678, 244028,\n  31320, 74273, 2794, 19466, 8218, 36280, 183997, 48124, 19416, 29656, 19280, 98734, 7715, 18311, 30701, 133602,\n  150307, 126956, 7378, 2933, 79903, 13178, 12593, 86571, 26604, 92446, 13574, 44205, 65699, 427599, 21118, 8245,\n  14407, 27877, 47936, 33542, 7916, 26460, 117762, 21596, 37818, 2249, 127359, 209394, 60044, 47677, 308089, 36791,\n  154971, 31417, 6998, 150042, 174360, 12255, 43009, 29335, 48739, 3912, 101398, 53340, 2580, 146939, 151295, 45360,\n  125275, 15273, 45383, 27456, 48761, 23314, 8750, 60801, 85823, 104759, 27894, 123685, 66968, 39480, 26917, 55290,\n  83305, 2696, 98390, 57569, 145853, 340733, 4919, 20024, 52268, 30884, 7413, 203685, 70989, 112855, 4129, 50536,\n  349518, 68205, 332641, 159581, 135361, 236026, 37563, 176404, 64899, 6578, 122033, 63871, 1850, 85234, 82089, 66124,\n  74145, 121098, 107351, 12687, 36881, 117334, 13136, 14698, 85933, 93866, 18047, 32620, 310, 15094, 46000, 88451,\n  23632, 36645, 27940, 87618, 80520, 58892, 20976, 27702, 140090, 96075, 67841, 103292, 238964, 87778, 107338, 17019,\n  83427, 67522, 7302, 8261, 47570, 116787, 8730, 80484, 61772, 174422, 56005, 131193, 52875, 14588, 28471, 59817,\n  9586, 15720, 158155, 51307, 109734, 15196, 11025, 59331, 3884, 52626, 102602, 84797, 25158, 27314, 4437, 20488,\n  76214, 189248, 35023, 114952, 157376, 2827, 62439, 102878, 129749, 36405, 10329, 109339, 108633, 36662, 1254, 13267,\n  5470, 87105, 58004, 15397, 10434, 159667, 21864, 52022, 179464, 3013, 32147, 31496, 116832, 18494, 105502, 129227,\n  107267, 50033, 13481, 9954, 24267, 22141, 16257, 116154, 36185, 950, 115685, 11305, 176708, 2048, 178671, 112573,\n  287867, 162328, 497663, 95170, 50979, 193861, 50987, 30368, 136257, 31830, 46549, 15119, 169876, 23788, 17462, 249887,\n  57377, 1949, 35448, 14791, 43769, 210091, 3783, 34612, 282103, 88380, 245190, 5457, 20491, 98908, 11402, 86899,\n  117916, 16028, 162584, 60644, 320177, 156096, 31065, 55876, 22000, 77655, 9992, 23397, 13757, 317623, 63978, 215255,\n  2443, 17648, 93231, 27388, 104529, 93807, 55505, 140477, 12046, 112040, 70887, 40152, 94365, 112353, 25063, 114679,\n  266061, 71248, 119555, 15589, 2244, 617, 14129, 211431, 70110, 100652, 7777, 4383, 85911, 89221, 21010, 120615,\n  58357, 86405, 37554, 41647, 18, 15143, 69662, 60491, 14714, 186134, 148344, 42347, 5410, 168175, 44535, 42449,\n  343894, 129417, 99682, 20659, 27272, 140483, 63455, 222159, 17536, 13722, 42637, 62324, 11976, 114691, 148109, 2283,\n  32057, 182393, 4295, 147364, 33705, 2075, 44303, 30274, 28331, 63740, 69740, 29148, 10346, 44862, 33716, 73937,\n  153333, 12930, 38784, 247159, 2515, 41053, 20256, 83368, 256189, 54639, 115240, 5096, 24661, 175419, 153552, 26516,\n  141, 138176, 63885, 34115, 47222, 55709, 2765, 28479, 38875, 236608, 12229, 22921, 77291, 54426, 45388, 2860,\n  57787, 114579, 295139, 105782, 17826, 71066, 19119, 54364, 69385, 16568, 12323, 28057, 33346, 34919, 124763, 155533,\n  101386, 31644, 8627, 49001, 303600, 29868, 63213, 9103, 77280, 71333, 9696, 138789, 37059, 24823, 5057, 21352,\n  32368, 114208, 56803, 19424, 10445, 58514, 8661, 209508, 26187, 171838, 10460, 63454, 14016, 122504, 41328, 21329,\n  46618, 32493, 38225, 7855, 31763, 7945, 29876, 8734, 6438, 24205, 97490, 139977, 130740, 47323, 33195, 85390,\n  57194, 13813, 60600, 21313, 96251, 7699, 27584, 170521, 139271, 1363, 4402, 336738, 129223, 84983, 69150, 13147,\n  3590, 163929, 207225, 155260, 55916, 20288, 4503, 8398, 98490, 11773, 27512, 37113, 84976, 86558, 28365, 11756,\n  116005, 182148, 13733, 115313, 47644, 67208, 85069, 9347, 14995, 226141, 14704, 101835, 41159, 35314, 13113, 63526,\n  214039, 29978, 50446, 83339, 17440, 129441, 72522, 118641, 97816, 24907, 73844, 15717, 118884, 167255, 96509, 162793,\n  30847, 36849, 51297, 78974, 77793, 10427, 1873, 2972, 9999, 35074, 28190, 64297, 146836, 46298, 60038, 163007,\n  108919, 61219, 2403, 75022, 127339, 4233, 110389, 69022, 9833, 128097, 88016, 79390, 222936, 22570, 94657, 28462,\n  56956, 38803, 81536, 30474, 152794, 19566, 16481, 147408, 74574, 81895, 20731, 1918, 1366, 76367, 187321, 54494,\n  24366, 21690, 61696, 33283, 107477, 77499, 31112, 414383, 74362, 18463, 218441, 120929, 59848, 258629, 201924, 69269,\n  454, 19989, 13054, 59894, 3623, 58908, 20681, 35723, 78523, 102680, 38988, 184112, 108087, 50944, 132704, 52966,\n  21699, 18860, 96349, 201411, 82697, 85395, 95658, 5093, 6427, 177894, 44191, 32755, 26961, 155739, 6249, 31310,\n  81030, 26574, 84311, 120155, 86730, 113535, 7424, 48888, 13516, 45747, 98098, 20077, 183995, 81945, 43210, 26704,\n  40420, 75831, 45648, 11180, 6855, 57927, 65528, 124096, 34851, 2598, 156633, 107572, 127352, 38169, 123845, 60142,\n  62722, 105584, 232364, 23211, 68120, 1601, 22169, 89299, 747, 258039, 80572, 7258, 152249, 11862, 101204, 8834,\n  121434, 33761, 19175, 133142, 46343, 40178, 48723, 3589, 41977, 30210, 38868, 62257, 10087, 82658, 87827, 90646,\n  16415, 47552, 351723, 28298, 72225, 91146, 272760, 1701, 11295, 1652, 109651, 300747, 51863, 198800, 29446, 11794,\n  32345, 37538, 22356, 33102, 37590, 113544, 37970, 11478, 179743, 25454, 103417, 59905, 221970, 105196, 145604, 7817,\n  164809, 102360, 16974, 75840, 255333, 56902, 6659, 1954, 645, 59400, 67769, 7689, 18675, 5215, 13793, 20536,\n  27852, 3387, 29523, 259718, 16860, 94625, 43143, 29245, 15848, 233581, 22685, 63631, 78557, 22836, 133302, 84513,\n  1348, 51826, 47129, 98836, 58284, 1830, 1749, 94642, 10933, 6145, 12506, 10975, 13879, 103781, 144434, 10268,\n  28409, 32346, 52968, 121567, 107374, 77268, 23686, 35097, 10501, 155275, 15303, 47136, 21102, 168741, 55332, 90385,\n  15996, 84817, 681, 137803, 25054, 142275, 6163, 38175, 8056, 124296, 240642, 65621, 4934, 178205, 16101, 62803,\n  60964, 18230, 100622, 76465, 44689, 14545, 9543, 47514, 16852, 93380, 28048, 12047, 107106, 37575, 101485, 77047,\n  57326, 34819, 96137, 76916, 6469, 46264, 115983, 75768, 87668, 69942, 13027, 165, 8373, 114231, 26434, 52844,\n  42799, 182044, 23580, 146254, 38081, 43236, 33883, 146220, 382894, 14606, 46035, 36481, 166621, 35417, 95382, 2957,\n  59384, 60428, 36358, 66343, 75378, 22267, 22950, 83528, 17577, 56474, 25285, 4619, 179691, 75355, 95836, 53295,\n  34588, 171410, 4487, 14679, 84208, 44015, 18562, 109133, 54101, 11531, 86052, 174479, 303157, 28095, 9953, 35642,\n  14564, 39802, 16145, 77606, 117406, 53038, 121117, 53624, 22062, 1212, 7632, 127157, 237292, 189087, 10478, 127345,\n  102515, 181997, 86752, 87623, 10966, 121602, 68783, 68681, 83042, 114380, 138349, 191305, 67176, 50085, 39016, 1427,\n  42384, 1412, 67118, 122616, 72389, 25260, 2237, 13576, 137346, 19938, 20304, 2191, 68759, 5373, 61364, 238507,\n  75814, 23931, 69565, 38993, 131741, 38364, 12528, 87762, 5679, 129853, 5310, 186831, 32653, 90338, 260176, 389531,\n  108118, 26843, 43985, 50175, 30563, 25106, 56965, 18130, 140428, 4542, 165503, 117991, 24219, 229605, 1819, 129663,\n  1240, 3797, 76093, 18398, 71339, 51919, 93043, 27175, 47060, 216257, 6483, 35051, 1217, 16512, 80798, 129064,\n  13225, 69339, 8548, 237079, 72298, 2575, 34280, 51379, 117910, 55671, 53345, 247552, 29486, 39328, 140821, 34681,\n  57045, 60177, 5004, 90269, 78522, 2479, 322607, 48474, 61296, 13057, 31558, 4678, 59271, 6699, 27044, 31988,\n  35944, 12503, 83480, 4389, 136508, 3781, 114121, 70279, 4488, 155829, 42214, 2898, 68191, 75695, 305850, 45041,\n  74344, 106509, 30087, 17429, 93292, 12477, 290, 23080, 114802, 35714, 18751, 26554, 105424, 17775, 2144, 2412,\n  100610, 65192, 113975, 52975, 180272, 135050, 129815, 76238, 106483, 21440, 63186, 4260, 46189, 9711, 28249, 4169,\n  23429, 23390, 8324, 141585, 63809, 67668, 38457, 38063, 39226, 59972, 1189, 203916, 62368, 14403, 16949, 61767,\n  85801, 1739, 40147, 35049, 76757, 33124, 62102, 15780, 103593, 103009, 53484, 22952, 67973, 114645, 6566, 5245,\n  50462, 7601, 8288, 3513, 194571, 80276, 1908, 54592, 5124, 58571, 2513, 6800, 273997, 193904, 1119, 17991,\n  117245, 2508, 129156, 82366, 26278, 71465, 63341, 56943, 39662, 106116, 94966, 156875, 9736, 2204, 122308, 94418,\n  27134, 1280, 24539, 49022, 45314, 3764, 50904, 46424, 30699, 28087, 293839, 9400, 33646, 40165, 822, 147499,\n  50263, 116179, 29085, 11863, 31314, 5578, 17797, 5104, 12454, 1604, 15342, 219206, 10232, 67800, 94261, 25872,\n  13565, 90339, 78971, 75377, 26649, 41184, 47695, 11514, 35369, 20767, 14227, 41953, 309396, 148270, 147938, 33074,\n  14453, 27499, 109019, 39018, 25738, 240196, 158931, 52820, 8612, 95853, 21524, 137010, 84901, 70869, 70021, 116794,\n  48404, 38771, 6732, 1070, 70990, 187297, 49140, 5238, 576, 3564, 253975, 16027, 16483, 2811, 37775, 19034,\n  25259, 4053, 2000, 70083, 95774, 19713, 33431, 92703, 91314, 42381, 288770, 48194, 95985, 3991, 77418, 13406,\n  241328, 245086, 56533, 35275, 62725, 9246, 51924, 70181, 95331, 16163, 31410, 79016, 39312, 120878, 119371, 275987,\n  80124, 27712, 9186, 220, 23598, 146167, 85209, 68238, 282190, 57048, 31273, 30555, 80913, 17594, 75779, 59160,\n  135002, 101219, 189377, 29225, 96735, 60126, 62522, 104000, 27620, 86814, 17240, 147533, 11001, 5425, 43682, 410,\n  49460, 87270, 69480, 46315, 59448, 1816, 76201, 9431, 11788, 87960, 29063, 65539, 47347, 11678, 33846, 7008,\n  196704, 9895, 6753, 8633, 120892, 59970, 572824, 115934, 6646, 202559, 892, 48351, 37611, 251282, 57823, 67263,\n  57750, 26527, 34485, 90747, 7685, 88370, 6144, 64182, 1709, 41969, 21458, 62327, 181657, 49247, 225330, 122600,\n  114574, 107124, 85361, 111833, 63243, 71420, 15655, 191178, 72430, 18063, 51425, 54002, 12364, 53225, 86557, 18193,\n  97580, 41232, 138398, 67821, 128724, 8944, 233212, 101353, 52099, 42127, 14006, 120107, 32789, 32132, 3498, 18123,\n  33758, 56058, 5779, 128760, 59888, 98869, 18445, 84702, 51911, 13234, 218379, 20093, 39031, 8074, 70195, 20708,\n  23462, 24355, 131384, 60189, 26390, 10403, 41060, 7140, 10781, 49410, 42261, 87202, 82566, 41663, 43105, 60276,\n  2768, 5733, 74176, 28329, 2297, 145430, 131632, 83615, 122915, 105441, 655, 224102, 5284, 136426, 67763, 16294,\n  188511, 32538, 61049, 27893, 3394, 13951, 159099, 28542, 17930, 145360, 9492, 190122, 32285, 78855, 26440, 13570,\n  58648, 73908, 4239, 124561, 2444, 74172, 53131, 11468, 10794, 73566, 11623, 35343, 64710, 30481, 4163, 10328,\n  38309, 29901, 10538, 154377, 76132, 92405, 24839, 11679, 3465, 13449, 11637, 7824, 2337, 57754, 1260, 14458,\n  41118, 19878, 38661, 13416, 159180, 37074, 163164, 54137, 28627, 52134, 184900, 8520, 40385, 29546, 30502, 22386,\n  66527, 107458, 6850, 24022, 47983, 30603, 35083, 8934, 304066, 39500, 9, 28261, 33026, 77251, 9374, 44833,\n  116312, 34990, 29236, 63563, 125639, 135405, 165398, 159055, 55690, 88141, 69643, 236964, 31983, 25572, 20436, 36746,\n  60896, 31850, 16179, 11828, 5888, 3043, 66368, 9750, 31167, 7915, 53111, 36430, 1333, 64344, 93659, 20061,\n  60596, 180191, 51630, 6792, 30244, 43509, 101058, 22409, 420, 44210, 109783, 43223, 27030, 72477, 72831, 32679,\n  29235, 7675, 47556, 12258, 39907, 149412, 84926, 118247, 24692, 71717, 105038, 86009, 45941, 41189, 89453, 29856,\n  52543, 30627, 226798, 67303, 59230, 67415, 34408, 1367, 99685, 16867, 128419, 52147, 4111, 125381, 117881, 16173,\n  44093, 102224, 31575, 23234, 24870, 83790, 127407, 239098, 3200, 994, 1255, 100903, 242275, 117266, 55116, 38205,\n  16140, 29662, 11307, 40414, 208793, 123355, 56470, 4862, 75600, 30119, 58218, 70828, 24075, 26974, 7802, 192353,\n  4851, 5475, 78720, 66596, 3409, 28573, 64396, 30381, 30690, 59859, 88256, 5406, 99945, 103064, 34463, 37727,\n  24238, 86643, 60088, 4057, 23741, 5967, 162904, 38240, 28356, 93858, 25510, 122879, 6897, 3278, 7057, 11971,\n  4400, 35461, 211413, 21395, 59615, 39471, 87233, 55795, 128426, 3051, 22470, 41950, 14705, 3974, 180108, 80476,\n  78442, 204996, 91987, 15634, 67610, 139015, 142373, 35611, 51134, 10387, 4353, 153456, 57749, 181039, 14183, 68447,\n  151532, 21107, 36452, 20551, 3186, 46247, 46383, 129666, 88736, 140662, 146243, 2066, 8360, 7978, 64818, 106963,\n  17896, 47801, 10723, 114821, 223295, 74192, 3293, 3393, 16987, 74064, 11277, 91622, 4270, 29828, 27951, 387869,\n  103235, 1374, 61988, 120083, 477, 145892, 128378, 11779, 211263, 61354, 18221, 17869, 46530, 83061, 108538, 157981,\n  90608, 67199, 95080, 49064, 195814, 12302, 66307, 10348, 231346, 160732, 112859, 63633, 146558, 21271, 31037, 198802,\n  47622, 12862, 95710, 3910, 77850, 73961, 85585, 34752, 61000, 4082, 24595, 103679, 71107, 8208, 79568, 150019,\n  16615, 24961, 139857, 32664, 197366, 4559, 54735, 32696, 4126, 162019, 75698, 13916, 70108, 159638, 19834, 9349,\n  24675, 175560, 49643, 18206, 52459, 27992, 10809, 88865, 401975, 133172, 29000, 34558, 30915, 3658, 25834, 42430,\n  36562, 125265, 18182, 10155, 40149, 97082, 208980, 19575, 60853, 90529, 66545, 9600, 789, 46420, 2317, 88593,\n  55595, 98980, 115302, 5742, 169155, 1073, 177901, 3472, 11189, 63711, 78643, 65472, 50459, 127979, 93, 42202,\n  67053, 21720, 157650, 11145, 141378, 42033, 22824, 85705, 79114, 35584, 15974, 1510, 54172, 28562, 12451, 104226,\n  19190, 97151, 73024, 20948, 5151, 81741, 21499, 29006, 84183, 198074, 54003, 45120, 170125, 26240, 35177, 28389,\n  64863, 79974, 60778, 176915, 232183, 45342, 2038, 80253, 41564, 40703, 32689, 5430, 100689, 5366, 23007, 134279,\n  14266, 26712, 73993, 24934, 64242, 52113, 102887, 61801, 46415, 201049, 54251, 62133, 122757, 164883, 30815, 139966,\n  2319, 30842, 766, 13362, 10287, 134518, 86111, 81665, 82440, 28333, 43019, 18963, 8804, 161944, 23439, 102144,\n  101145, 80029, 39052, 248708, 30350, 117340, 11878, 128467, 974, 138625, 63961, 5237, 74778, 61834, 67040, 43814,\n  13690, 65947, 33809, 232476, 115258, 181745, 28824, 94013, 9510, 10246, 93722, 81976, 7217, 114383, 3493, 16014,\n  69045, 72692, 12145, 80981, 9507, 6692, 1620, 60820, 330444, 35474, 33962, 4797, 7053, 295463, 46445, 27026,\n  12491, 77988, 49524, 35675, 90947, 29114, 166705, 101385, 133782, 32704, 6186, 84595, 176031, 185623, 45966, 151302,\n  63069, 1699, 107491, 947, 15458, 74452, 196212, 6046, 10498, 12163, 10239, 35191, 243951, 9277, 9090, 29539,\n  54460, 22820, 26514, 112549, 60372, 51753, 48756, 21812, 70861, 260326, 41, 44222, 10441, 16961, 48148, 138771,\n  216194, 5914, 52153, 53400, 212036, 56519, 26245, 10117, 45888, 15294, 138019, 90913, 26368, 43842, 42111, 23348,\n  6082, 194845, 161089, 156206, 51546, 11647, 30759, 302912, 262094, 8635, 78876, 26535, 35283, 54183, 31183, 85484,\n  147873, 12989, 5197, 6356, 72894, 65347, 20150, 27370, 73787, 1493, 45918, 12366, 190217, 20724, 13858, 10981,\n  67449, 81213, 7553, 14115, 72242, 271517, 11842, 48310, 88743, 143726, 22177, 3290, 243231, 58452, 62937, 12592,\n  1654, 40066, 33477, 13751, 9921, 128442, 15868, 7106, 75236, 83773, 10775, 36938, 10482, 170465, 17368, 17469,\n  161508, 32752, 98340, 800, 19824, 264456, 3901, 87319, 2867, 26782, 9630, 113102, 185815, 24197, 44584, 86366,\n  40224, 3636, 140916, 31731, 267731, 9567, 53678, 72984, 29389, 27963, 17106, 50282, 284911, 60170, 8322, 12608,\n  23374, 89652, 5268, 39044, 229766, 8869, 151350, 31436, 177342, 12269, 183212, 120418, 116270, 2843, 78888, 69192,\n  7865, 184099, 1086, 129897, 18383, 70508, 20242, 18508, 229924, 124569, 35749, 50589, 55626, 9884, 83115, 40971,\n  30671, 18135, 14452, 38861, 17844, 201826, 5549, 26413, 17189, 13561, 38539, 10679, 143331, 3314, 36785, 171194,\n  49685, 187713, 67506, 4618, 104039, 17060, 195080, 50648, 33159, 19238, 67559, 134840, 28599, 157523, 17130, 38064,\n  117398, 94355, 31918, 13575, 34538, 40326, 13997, 3494, 348283, 62481, 26862, 3603, 104426, 244363, 153709, 112487,\n  304612, 199674, 41239, 35545, 54869, 293005, 28223, 26277, 26899, 4533, 18518, 15492, 38587, 80488, 70485, 160395,\n  263, 60162, 11382, 222152, 4696, 250751, 51921, 182609, 10707, 48463, 46243, 1227, 49111, 111564, 46502, 33342,\n  56846, 68541, 63559, 858, 139927, 16654, 229375, 76759, 26478, 33205, 95828, 23399, 92945, 2637, 35630, 28470,\n  143992, 50214, 14174, 21456, 166191, 65665, 1711, 21594, 78019, 97599, 111701, 36, 147151, 110246, 189022, 43021,\n  30397, 40757, 131935, 42065, 73335, 48039, 26596, 28984, 15102, 2361, 7421, 202167, 69744, 43766, 52826, 3642,\n  83304, 33873, 75140, 63169, 192389, 36551, 92748, 13039, 123959, 233220, 21738, 84447, 77230, 20228, 187852, 19095,\n  25799, 92136, 108774, 29237, 53947, 2299, 118106, 2687, 8830, 42331, 202924, 33667, 2023, 73763, 30704, 19363,\n  19779, 16737, 35629, 48081, 24068, 101013, 162338, 291912, 13749, 24745, 328289, 167679, 70086, 48299, 23306, 16732,\n  17801, 43322, 54589, 3586, 63653, 43624, 53474, 925, 109177, 251316, 43805, 13082, 19511, 86565, 142182, 92461,\n  17117, 101033, 103319, 64589, 4022, 4351, 235897, 5352, 82705, 107142, 46391, 156084, 5860, 61365, 10558, 13045,\n  7717, 18357, 33922, 12590, 33065, 6928, 46993, 783, 46937, 67846, 8952, 26295, 6107, 119656, 18799, 17458,\n  50747, 4229, 179559, 112727, 118080, 20683, 41464, 125468, 51560, 49749, 44231, 7359, 35339, 62988, 136487, 67015,\n  5208, 29150, 24956, 105186, 48858, 6143, 18097, 6972, 16404, 73489, 58742, 97196, 36357, 164616, 5834, 32267,\n  13746, 147733, 15113, 132091, 34127, 106298, 39729, 106426, 22294, 9780, 15602, 36213, 71502, 42808, 66802, 599,\n  60755, 5851, 39120, 67363, 108623, 126368, 72770, 91263, 32486, 30596, 151717, 7951, 52002, 43103, 11768, 68942,\n  40901, 39344, 24037, 127500, 116890, 48403, 16926, 86750, 17745, 48648, 159545, 34460, 58419, 5634, 114317, 67865,\n  31462, 23352, 24010, 98185, 125708, 69686, 68337, 13610, 26271, 70691, 2980, 4768, 27225, 102402, 75453, 28106,\n  8104, 6931, 1176, 6274, 6475, 112635, 22498, 6176, 238686, 26832, 28893, 90319, 14441, 15682, 15087, 39517,\n  45270, 109134, 104440, 45965, 47645, 81772, 7876, 52683, 87720, 12898, 4505, 185665, 2769, 113401, 15664, 57592,\n  105229, 137381, 97059, 119268, 6876, 43309, 33886, 128363, 35476, 144249, 67013, 143587, 83367, 25703, 91436, 59347,\n  53236, 2289, 16519, 19844, 46309, 58558, 99834, 23313, 218816, 231303, 36388, 51333, 183535, 109792, 139277, 54306,\n  90139, 18235, 8275, 32710, 37677, 82464, 86025, 92204, 88842, 117723, 37570, 128723, 234242, 76350, 73795, 34896,\n  148247, 58424, 11105, 11744, 45746, 63372, 17118, 49772, 199520, 81902, 38004, 22911, 33752, 3125, 1995, 53792,\n  4689, 26909, 108150, 146062, 69674, 41811, 161444, 84855, 8999, 28561, 16731, 93937, 3189, 21967, 24890, 22943,\n  1356, 145300, 51569, 28802, 517, 118679, 31703, 40607, 48098, 108854, 25003, 10233, 73969, 177495, 5248, 24516,\n  215347, 146192, 48712, 60626, 69188, 40735, 5866, 586, 101541, 6509, 47590, 52129, 5969, 222045, 110933, 25733,\n  24223, 65339, 62812, 2414, 155418, 35819, 16022, 78423, 43138, 20995, 128255, 240673, 46745, 236093, 72176, 57085,\n  97841, 61248, 107, 36068, 193177, 105427, 55726, 215229, 20446, 47228, 100420, 87091, 14429, 121708, 23605, 21157,\n  187721, 21880, 2997, 203976, 99166, 95068, 25877, 7724, 98925, 83401, 4829, 13182, 18229, 13718, 239662, 38653,\n  116505, 153497, 30589, 89029, 38962, 181302, 43853, 78872, 180301, 4786, 248240, 7401, 106136, 112590, 77745, 19731,\n  60880, 77789, 125748, 135487, 5975, 48627, 34084, 12419, 215770, 47557, 254582, 10364, 106495, 21856, 67539, 88981,\n  38805, 21428, 48732, 42316, 12149, 16078, 52808, 25327, 51322, 33850, 51147, 12253, 122354, 46077, 56483, 254553,\n  115417, 81834, 150991, 94662, 86668, 7381, 12841, 100650, 18218, 15741, 22372, 68294, 50705, 15535, 84660, 61887,\n  22553, 72299, 31361, 24824, 17743, 46820, 64288, 31582, 77006, 111674, 116384, 30760, 80920, 86149, 77192, 51979,\n  79691, 60342, 122805, 103800, 240873, 160744, 233114, 78962, 54920, 8608, 3484, 316104, 72548, 24337, 5088, 230040,\n  21926, 10172, 36838, 26, 86221, 83458, 102176, 12062, 17571, 41929, 41170, 28428, 68239, 41750, 103930, 2634,\n  18313, 53019, 34825, 97837, 63115, 24606, 73157, 152474, 14715, 91439, 37033, 109806, 140259, 30668, 174760, 380,\n  135597, 95673, 136073, 65073, 134249, 13829, 17279, 122305, 4420, 46444, 10237, 64848, 203623, 70728, 10349, 182885,\n  65075, 24519, 25783, 40318, 34139, 22222, 63394, 55266, 102764, 41422, 20126, 65100, 90408, 53640, 35128, 48932,\n  11192, 38935, 96839, 34782, 39492, 19396, 41332, 6250, 5511, 19492, 51304, 25936, 104466, 54099, 73771, 86115,\n  5080, 7669, 30891, 111700, 13931, 25276, 72289, 135447, 14820, 258641, 25265, 31005, 281179, 75286, 393, 95359,\n  14623, 13584, 6680, 101227, 80173, 44933, 76666, 54542, 13244, 39348, 458, 25379, 109451, 134348, 81143, 6959,\n  65554, 12027, 51311, 8716, 57589, 140731, 28467, 23316, 17272, 30458, 25980, 55229, 77197, 83798, 28302, 114784,\n  7428, 34548, 26241, 14712, 39336, 103304, 18928, 54080, 12870, 334, 87722, 15208, 16895, 142098, 114262, 39820,\n  83913, 57817, 28682, 7721, 14900, 108672, 11250, 62246, 42849, 415188, 1724, 26555, 24549, 25505, 26443, 107450,\n  145899, 61035, 43528, 6901, 60726, 65906, 267741, 21338, 147590, 42079, 18924, 73017, 135236, 15393, 5206, 4026,\n  84185, 1531, 5988, 113890, 82647, 303391, 7386, 69844, 71611, 189865, 76523, 31877, 13315, 19314, 198575, 32821,\n  1928, 67641, 25913, 104475, 103489, 3297, 70391, 18406, 15446, 113347, 19295, 93790, 27856, 1792, 167471, 116449,\n  8541, 4408, 41757, 63233, 25765, 86680, 64501, 27034, 24816, 34975, 6079, 4486, 49693, 36229, 16917, 21581,\n  62426, 27862, 11612, 54284, 35702, 194034, 355, 24277, 48262, 87411, 70504, 310164, 118018, 12516, 47559, 43502,\n  57433, 107139, 9290, 66533, 80863, 14634, 34312, 91725, 28606, 21342, 67241, 72355, 43244, 375789, 37402, 174015,\n  105070, 8342, 44167, 67494, 1890, 16365, 11723, 271002, 1865, 47918, 8350, 45564, 27742, 25110, 125803, 8553,\n  49504, 81925, 62211, 4534, 15491, 19011, 80373, 206920, 667, 102405, 128623, 245524, 5553, 113309, 192739, 65766,\n  19567, 22832, 261958, 29679, 21293, 71134, 20962, 105123, 24721, 860, 21752, 33448, 18372, 157167, 94822, 35770,\n  173224, 232737, 75729, 28937, 46828, 28062, 25453, 5207, 140366, 36665, 30652, 6169, 67920, 150458, 92040, 23186,\n  184604, 92330, 20891, 176492, 49427, 27828, 38305, 42495, 143982, 49560, 25503, 90043, 29747, 65328, 47830, 12932,\n  11068, 77721, 9003, 25213, 94205, 140426, 46090, 89945, 138173, 192691, 33329, 112232, 129905, 35709, 27514, 1841,\n  19957, 31411, 127476, 53572, 17497, 173549, 55063, 175135, 19841, 69314, 5192, 237921, 117660, 150697, 4060, 273045,\n  50414, 98940, 65348, 153665, 164423, 58804, 156695, 48994, 213928, 86036, 28608, 8355, 39574, 34540, 16927, 135680,\n  18374, 151587, 10830, 53805, 16878, 16623, 4282, 48030, 8537, 14986, 46102, 13062, 72897, 72, 33050, 108227,\n  39451, 45935, 651, 113320, 40535, 95176, 57450, 48843, 5003, 19019, 10407, 211163, 3848, 1068, 4988, 32091,\n  30095, 41692, 15099, 43602, 107434, 50744, 7627, 171349, 16313, 150832, 352665, 207750, 33937, 38256, 51091, 156000,\n  87889, 90663, 84175, 24908, 114900, 50365, 31494, 83829, 5398, 169342, 47521, 54818, 18935, 8356, 43094, 41212,\n  174536, 10082, 92550, 6678, 60614, 23355, 69721, 14796, 34149, 128830, 58187, 3179, 208, 40325, 28399, 225029,\n  401412, 51150, 31580, 207268, 6657, 10993, 69818, 64282, 289845, 23308, 12961, 38447, 6681, 52944, 31855, 2572,\n  47646, 120728, 179148, 37240, 45196, 218274, 4816, 3695, 21961, 50084, 35209, 18073, 51452, 27004, 6100, 33941,\n  1377, 84831, 171214, 85, 141510, 9078, 99227, 32610, 6417, 11718, 49868, 65579, 87902, 73018, 49062, 46280,\n  61742, 21512, 40862, 107733, 15941, 29168, 157765, 144919, 14487, 5767, 158014, 140070, 7241, 573, 71584, 16921,\n  223566, 40331, 179473, 35081, 47926, 140885, 41508, 52104, 59180, 42310, 32811, 29048, 123517, 102413, 80208, 10104,\n  14746, 12649, 153641, 126022, 37965, 113017, 4171, 83, 142592, 2809, 6362, 50416, 71323, 116894, 260776, 16204,\n  1524, 5760, 30351, 12658, 20703, 54403, 36083, 45408, 74772, 4946, 14485, 50759, 111222, 10890, 2195, 167147,\n  92962, 130534, 16283, 177256, 35016, 15472, 210156, 151187, 73922, 117691, 43250, 52051, 37392, 24811, 24358, 30830,\n  5775, 818, 21969, 1476, 127322, 151783, 58392, 31021, 106913, 65215, 89407, 90802, 28531, 11690, 20234, 95249,\n  44602, 37256, 18707, 11928, 5161, 4410, 26571, 51903, 49768, 22008, 25252, 65780, 209499, 68769, 203726, 13249,\n  137363, 48845, 86823, 6658, 5674, 31881, 1083, 1823, 108676, 34518, 166752, 13791, 14287, 91576, 91429, 8665,\n  11529, 26401, 16191, 91972, 30964, 5254, 28486, 54697, 79613, 66520, 18447, 22870, 45203, 194466, 22822, 51703,\n  12278, 76716, 44595, 73455, 33546, 12235, 144843, 36154, 51247, 11116, 33040, 3180, 225753, 60864, 1972, 28469,\n  12891, 28879, 10338, 144157, 56294, 353058, 38302, 41447, 87532, 110616, 27065, 168438, 6557, 1213, 50804, 144643,\n  24817, 2390, 136531, 38174, 247513, 16190, 4059, 122791, 131994, 137430, 39506, 57650, 16305, 5188, 54309, 106128,\n  20628, 88071, 67394, 395446, 250285, 66176, 91254, 1399, 114196, 43915, 60230, 44853, 27206, 106353, 43013, 18733,\n  345105, 226453, 51202, 16607, 57106, 117175, 35492, 10476, 89598, 127439, 15187, 39624, 13688, 61570, 10615, 31111,\n  59370, 6238, 175252, 32143, 224492, 41388, 95408, 34384, 148238, 78307, 38959, 9340, 160091, 61443, 15737, 11216,\n  41244, 170, 38299, 102443, 113097, 26382, 14027, 33707, 3957, 76300, 66160, 19431, 18900, 6952, 1717, 108656,\n  82206, 188021, 257335, 27295, 43999, 41210, 31777, 46956, 57457, 12657, 11489, 15697, 48060, 204748, 53583, 82422,\n  284790, 30503, 137341, 8120, 19615, 220311, 15991, 10217, 63424, 9808, 67431, 70976, 98221, 4491, 15177, 28535,\n  144789, 751, 13230, 2394, 1504, 33977, 132104, 30316, 22230, 931, 97193, 185240, 24826, 22687, 174322, 15307,\n  22988, 1390, 188745, 180325, 29580, 59068, 74903, 18994, 29195, 79, 15436, 7622, 38462, 11566, 138710, 44828,\n  45774, 37768, 99236, 68137, 84083, 19282, 22698, 17134, 74807, 126662, 173497, 46248, 16938, 119735, 3212, 28292,\n  213652, 49013, 9975, 32180, 45660, 86250, 4801, 68788, 95490, 77482, 113751, 11994, 44624, 94452, 46839, 128497,\n  100316, 5798, 58588, 73184, 202987, 65417, 37790, 88524, 1606, 43156, 97964, 105717, 34947, 11203, 100060, 37742,\n  130074, 93653, 107799, 94311, 196106, 41347, 8035, 10780, 16390, 27883, 118236, 167395, 1979, 25006, 19375, 31628,\n  18916, 144723, 78502, 114047, 103107, 86492, 107686, 5844, 20934, 206963, 23556, 22591, 16562, 146333, 20167, 10471,\n  117434, 33085, 2863, 9740, 36669, 41849, 37271, 22790, 18209, 28979, 8231, 12952, 54408, 21731, 25130, 45208,\n  55748, 138120, 75826, 414, 29593, 9925, 292865, 25999, 683, 123149, 7036, 92159, 86055, 61827, 103680, 23176,\n  54918, 58466, 57578, 13305, 5709, 86479, 16697, 31064, 17660, 200919, 10770, 49793, 33423, 32370, 52047, 16488,\n  62555, 6459, 8426, 83493, 7763, 59725, 82812, 18628, 67760, 79405, 68557, 9612, 7673, 28102, 56517, 69620,\n  171797, 32458, 29541, 15870, 81109, 32080, 207644, 71495, 21202, 11039, 91036, 61230, 2810, 130800, 32260, 4613,\n  60590, 37112, 75214, 33979, 126402, 155062, 30642, 63875, 12810, 194463, 82799, 47664, 16725, 36685, 43367, 61099,\n  449, 172150, 102867, 21691, 301838, 36745, 7130, 18671, 57316, 34852, 38034, 54182, 35578, 65900, 99486, 19771,\n  3456, 2658, 16914, 99866, 28390, 28109, 8262, 21147, 34353, 20006, 4228, 137085, 1675, 203023, 283196, 198286,\n  214375, 163329, 290603, 152574, 40471, 83506, 30068, 14730, 23177, 131539, 34759, 27668, 32178, 71896, 104799, 116305,\n  85430, 119262, 42860, 25160, 8911, 23428, 49437, 105322, 6519, 16203, 6349, 74711, 1230, 38045, 8540, 75165,\n  44736, 25909, 51026, 317034, 4984, 32281, 91312, 27060, 44431, 17817, 45363, 155937, 239085, 35697, 59784, 91993,\n  29531, 126740, 213757, 76560, 167776, 285273, 24262, 8237, 65030, 41160, 74437, 48804, 118916, 13159, 37842, 1031,\n  75349, 1478, 11655, 108777, 23435, 277425, 101734, 67469, 70231, 124711, 43532, 28514, 65526, 54956, 1000, 21882,\n  17728, 25302, 40952, 52214, 149632, 1999, 2111, 3259, 63362, 89961, 220561, 39777, 26335, 9063, 10572, 12416,\n  34551, 34623, 38604, 24723, 5947, 15588, 69927, 66252, 119177, 69173, 46629, 28714, 70715, 212408, 20521, 406913,\n  74380, 11716, 50659, 50862, 37009, 88460, 130101, 7210, 53853, 538, 65120, 151950, 55806, 163748, 52837, 13153,\n  21100, 16674, 64536, 6091, 138201, 44837, 58547, 3723, 163, 2177, 32288, 85454, 34033, 8497, 14282, 25742,\n  10535, 10741, 79559, 117493, 243787, 49337, 100718, 79495, 40139, 42956, 7551, 55433, 15421, 31509, 23034, 45081,\n  547, 61176, 53434, 328001, 8470, 36263, 30145, 4519, 74173, 53935, 11845, 73774, 60211, 78025, 3, 4102,\n  73782, 109293, 315332, 48412, 26683, 13714, 6865, 20128, 18490, 104141, 325, 39470, 171970, 115860, 15707, 7268,\n  73301, 74336, 31370, 2368, 111827, 107757, 136231, 142844, 97138, 96638, 84053, 38691, 23801, 1588, 10573, 122098,\n  77039, 240, 186135, 146101, 11996, 18143, 112963, 46171, 155836, 348769, 47795, 121213, 116266, 132515, 3344, 144804,\n  31286, 99187, 255838, 129694, 35894, 48779, 55235, 148582, 71967, 65282, 15174, 13920, 47080, 6147, 108242, 157593,\n  125025, 7136, 1286, 28957, 127956, 28402, 98813, 20805, 7532, 109417, 40610, 5041, 32958, 15142, 18408, 108596,\n  33543, 50517, 27748, 80114, 233434, 91447, 487, 37094, 100048, 30541, 43477, 10639, 89862, 155868, 37667, 8726,\n  60684, 237903, 73408, 99589, 12190, 38739, 97348, 3914, 13594, 2680, 149016, 13907, 30171, 28343, 23530, 115225,\n  61104, 35821, 147679, 14337, 4297, 244282, 24085, 326976, 56428, 7851, 21303, 131620, 71446, 83253, 68692, 111870,\n  5224, 15813, 38197, 49026, 45057, 13660, 3306, 76345, 40671, 27905, 91072, 996, 68527, 62085, 91351, 122634,\n  55109, 168209, 2024, 27560, 112707, 17352, 8306, 167115, 169921, 166958, 5031, 46020, 11844, 67284, 19130, 76185,\n  6920, 32849, 5450, 14610, 22451, 21002, 17392, 31872, 66682, 84796, 13709, 40210, 59898, 12029, 8719, 53564,\n  21462, 91884, 21647, 88379, 194428, 12754, 37797, 132826, 160016, 22567, 54383, 53186, 77611, 31107, 8339, 4694,\n  19185, 90355, 23597, 17222, 140675, 28442, 23668, 55977, 9128, 61555, 28774, 155229, 17658, 9390, 24379, 69357,\n  15752, 127381, 239631, 62460, 93181, 55913, 45133, 140155, 18676, 25249, 33164, 29581, 82837, 67223, 22362, 29975,\n  7317, 52813, 1943, 29613, 20012, 207130, 49617, 49651, 5636, 15334, 36313, 29226, 28084, 95247, 72072, 19000,\n  224932, 15811, 114, 32127, 38097, 37508, 88507, 37225, 27359, 91626, 12193, 69279, 20608, 11055, 88156, 92808,\n  2152, 57259, 55275, 72789, 24475, 104414, 1708, 9882, 3818, 48661, 66897, 1631, 34806, 227930, 85815, 87753,\n  18321, 250664, 72733, 25107, 206797, 50891, 8082, 196411, 92596, 96764, 152823, 65514, 22819, 387277, 62176, 51225,\n  40329, 15563, 189, 3659, 73670, 64357, 51793, 275136, 33482, 86653, 74615, 67058, 11318, 125720, 15388, 22388,\n  8267, 1730, 102663, 170910, 40784, 7144, 85373, 13040, 7088, 94309, 583, 44224, 140424, 77439, 18496, 164026,\n  36578, 4722, 9151, 5824, 63365, 26510, 35199, 40500, 79277, 32495, 44614, 35233, 9566, 203293, 152144, 7097,\n  2330, 183480, 98629, 13423, 330887, 44130, 68600, 30939, 97829, 31012, 345465, 56747, 94879, 4939, 160027, 149761,\n  99423, 46099, 32251, 15332, 8761, 96094, 128555, 5763, 235318, 222223, 55729, 30241, 55420, 201746, 3987, 81382,\n  8259, 49325, 23287, 7719, 24633, 251100, 92311, 18591, 110533, 64759, 170260, 393860, 7175, 21144, 132887, 3593,\n  75346, 101277, 91109, 16387, 259187, 11627, 57459, 173829, 44694, 55780, 49797, 89192, 120443, 62622, 3904, 14814,\n  23887, 1027, 112258, 64955, 99800, 11132, 66353, 36202, 48624, 18158, 88481, 96882, 43059, 11040, 2455, 7077,\n  21651, 181159, 99126, 100434, 61388, 68186, 19161, 110468, 120052, 8819, 55324, 41494, 7014, 37689, 3618, 87729,\n  92615, 207943, 9823, 128657, 12587, 15857, 6379, 67628, 51216, 71775, 157617, 63244, 1503, 3864, 218754, 110864,\n  5769, 21492, 7243, 1192, 87921, 85529, 31512, 18537, 42698, 35350, 73510, 84474, 34301, 8991, 21013, 35034,\n  566, 38832, 19838, 35586, 37216, 39413, 55006, 12178, 59742, 856, 84563, 6900, 25632, 17437, 49786, 30723,\n  13847, 70845, 4044, 7843, 23944, 235976, 55530, 48942, 6518, 20939, 73769, 192653, 52936, 95207, 23895, 132542,\n  142982, 22632, 87452, 48042, 54018, 178468, 10728, 26230, 23559, 363, 81269, 142012, 5718, 346258, 31456, 84333,\n  246476, 51018, 66692, 101804, 120570, 39962, 30373, 70593, 2864, 60541, 19425, 54209, 104092, 7201, 31545, 48018,\n  25865, 15442, 46257, 40443, 8328, 6451, 111782, 47527, 97754, 33046, 470, 245116, 31095, 39, 91934, 87208,\n  73470, 36708, 36521, 12801, 70624, 36272, 8892, 79768, 12427, 55454, 103756, 5908, 52390, 62962, 22720, 141138,\n  94634, 41689, 128402, 126390, 6628, 106394, 35527, 134394, 82727, 254651, 194502, 148064, 89549, 3202, 28359, 957,\n  21954, 27906, 49840, 142747, 8307, 24206, 48978, 1186, 71728, 133038, 71474, 91306, 6333, 110959, 74600, 70387,\n  18983, 62609, 56057, 22970, 1147, 135850, 1321, 28834, 3578, 59715, 102227, 32827, 81415, 99952, 55636, 257598,\n  390, 22702, 35701, 85872, 402916, 39216, 189795, 14929, 19467, 10112, 144422, 61514, 5279, 63421, 134686, 41436,\n  8424, 51925, 10598, 132295, 124416, 4604, 194739, 210929, 57866, 31829, 51626, 50007, 9976, 91878, 61906, 56168,\n  81906, 60918, 61859, 40017, 23059, 16887, 40927, 62064, 12785, 32893, 32913, 21782, 93965, 20169, 44387, 79084,\n  38463, 11457, 93950, 27127, 157050, 2697, 337088, 5116, 54128, 48255, 33279, 8821, 27352, 25515, 124022, 65710,\n  28906, 38557, 33390, 1722, 104435, 72215, 38551, 12094, 30978, 25113, 6671, 37355, 175109, 42862, 98024, 65406,\n  221276, 59624, 118012, 64637, 78760, 86697, 21426, 1639, 40350, 12584, 67193, 84144, 31396, 7863, 143011, 69629,\n  63112, 9454, 28666, 65798, 46372, 134721, 6314, 51402, 30837, 151922, 2847, 38676, 38008, 92823, 136245, 17540,\n  5504, 109295, 205242, 37606, 5211, 214892, 1586, 20670, 208711, 137743, 19328, 40652, 16995, 20023, 14657, 154919,\n  34422, 12996, 13918, 38221, 47690, 16398, 2959, 37680, 89122, 6721, 198469, 91876, 172043, 83898, 101992, 26084,\n  94570, 3635, 76958, 22853, 76497, 38266, 176590, 168403, 44464, 142840, 79180, 184594, 1984, 41806, 83147, 11985,\n  6546, 366068, 59732, 24533, 271505, 8736, 39084, 222992, 93429, 28962, 58985, 86665, 8432, 30028, 14548, 32439,\n  54424, 165029, 55175, 27458, 69046, 121277, 46168, 33732, 20661, 24581, 135574, 123110, 37556, 79260, 72611, 16957,\n  12939, 46162, 58238, 44907, 72936, 253758, 41324, 32518, 96480, 11949, 124438, 65280, 43256, 34107, 53533, 43531,\n  37037, 28366, 45970, 32741, 173438, 6121, 194202, 62969, 26355, 30314, 58370, 28455, 1848, 50519, 82830, 90393,\n  21761, 295490, 10936, 256940, 133568, 44050, 20269, 4089, 27457, 21610, 219460, 36743, 14821, 101388, 52005, 13124,\n  30979, 140816, 167362, 26054, 18458, 60789, 34917, 40447, 26606, 33422, 9066, 3452, 83614, 5761, 20263, 137238,\n  25038, 91310, 101, 52322, 74548, 42572, 38084, 214054, 186568, 31802, 17665, 30620, 141936, 37730, 14420, 4265,\n  187218, 49640, 188208, 51441, 55388, 96452, 66659, 40869, 42039, 60967, 221027, 19234, 178581, 29105, 96050, 9165,\n  196118, 157335, 3738, 40354, 117436, 2965, 34136, 59659, 15570, 50843, 230035, 31444, 71260, 43886, 18316, 5387,\n  38500, 168508, 17406, 32174, 8828, 103373, 143806, 90367, 3560, 18719, 122310, 16508, 26719, 2541, 105429, 6645,\n  37998, 73190, 10591, 235916, 49737, 87112, 233941, 53188, 32193, 79154, 4544, 52905, 126477, 7580, 63501, 57314,\n  3216, 31337, 6541, 103083, 60846, 49, 9756, 15481, 1355, 43840, 14319, 13743, 27486, 10222, 73114, 230718,\n  418644, 16706, 6674, 279748, 23058, 45273, 295831, 86306, 2743, 5535, 88773, 21829, 35253, 120938, 31153, 3169,\n  16839, 42847, 8751, 80974, 33942, 36867, 35514, 16485, 26474, 77775, 56877, 5391, 48346, 3882, 108713, 31403,\n  27804, 55248, 26235, 43821, 136104, 40118, 175507, 28034, 203908, 18732, 1788, 34030, 106427, 36958, 54359, 7251,\n  44936, 15356, 69139, 455, 157915, 22173, 140291, 50348, 43275, 82066, 49621, 54952, 15216, 36226, 96695, 66855,\n  6936, 1987, 8227, 196087, 4631, 68827, 99004, 47541, 110265, 17953, 147605, 110242, 58520, 31312, 38724, 329975,\n  642, 3155, 34497, 75937, 6207, 73843, 6120, 17249, 51429, 117746, 3218, 910, 68961, 319671, 14938, 29555,\n  34700, 1649, 66673, 72268, 9655, 76800, 153087, 6941, 210168, 27130, 35398, 1780, 73242, 3135, 56689, 19556,\n  165307, 8765, 35967, 121458, 13333, 70453, 17350, 117253, 22265, 13340, 44265, 39869, 441, 3742, 135025, 23581,\n  33309, 16543, 17731, 13291, 157637, 283005, 21408, 101360, 63887, 52312, 83873, 5338, 233779, 23759, 186949, 34531,\n  177320, 38069, 156465, 91004, 19353, 59852, 68160, 14891, 1338, 1072, 29823, 1950, 28901, 81407, 313445, 73038,\n  84807, 162348, 240257, 37162, 138934, 16111, 58013, 41253, 102951, 16457, 96056, 19541, 56402, 67217, 41638, 94381,\n  89674, 29481, 37456, 80815, 151579, 13937, 13683, 132537, 19699, 134545, 67020, 29816, 222341, 141235, 427578, 48868,\n  129557, 233342, 23077, 87871, 16213, 18728, 16184, 9469, 37913, 19680, 2798, 171356, 178328, 13216, 50049, 72690,\n  71904, 124644, 55455, 7504, 29052, 41036, 266546, 19899, 30391, 188755, 8659, 59469, 16, 104298, 112943, 53865,\n  76203, 138226, 68857, 139953, 14125, 107625, 119795, 173133, 4398, 50273, 48808, 54390, 16466, 122086, 31835, 67035,\n  50971, 48859, 7508, 46427, 66477, 73021, 84615, 39985, 83076, 46779, 201569, 53336, 36443, 60865, 168164, 143810,\n  51393, 25548, 169307, 32896, 24485, 38424, 21837, 29087, 275813, 51674, 6714, 64883, 46169, 187369, 55186, 76192,\n  12852, 12018, 62134, 31067, 118303, 16542, 12125, 10579, 4928, 26291, 43854, 7091, 10946, 253716, 109062, 39283,\n  17261, 113012, 258512, 47764, 125126, 32646, 55892, 80279, 201623, 149872, 3192, 385, 1208, 48750, 5376, 58738,\n  22335, 5427, 82416, 47811, 32435, 143086, 38930, 94128, 59975, 156037, 37977, 38224, 62485, 7698, 50405, 71027,\n  16462, 21559, 136153, 34131, 107506, 162069, 63703, 3101, 215029, 40407, 4178, 3774, 9187, 80019, 17880, 97926,\n  67579, 2600, 18405, 8351, 47924, 86638, 70820, 92206, 86453, 29610, 42241, 119200, 3198, 15466, 67813, 57863,\n  35454, 4779, 99518, 4649, 104641, 144269, 33730, 38073, 65864, 6838, 109456, 193298, 154007, 5623, 45741, 30846,\n  182578, 25573, 157224, 1543, 58575, 138703, 146140, 44971, 49356, 18275, 59064, 20300, 13122, 11848, 24453, 11973,\n  9797, 86843, 2919, 25530, 49210, 1130, 161220, 76788, 75373, 85604, 34926, 36014, 17777, 17255, 51533, 11676,\n  92226, 51845, 119859, 21525, 5936, 18507, 28050, 1140, 31418, 14857, 34207, 47859, 10750, 36382, 32079, 106909,\n  59426, 87757, 38393, 110042, 15965, 97104, 33757, 35344, 97993, 53979, 33651, 45407, 41884, 82515, 173089, 7177,\n  58371, 35365, 47543, 51927, 35587, 10670, 23544, 29306, 84233, 39976, 76076, 62097, 9007, 8668, 28119, 78281,\n  120790, 19835, 143020, 54968, 18670, 64959, 20649, 34469, 42570, 33001, 136570, 87796, 120044, 1106, 58700, 63951,\n  127623, 12805, 83057, 40212, 31773, 49850, 7361, 54336, 347524, 101314, 23751, 19569, 48791, 29174, 49369, 20467,\n  7465, 75842, 38281, 623, 112457, 60210, 28849, 51003, 94720, 6426, 90047, 85560, 43761, 3579, 85105, 34607,\n  90410, 118528, 7224, 42907, 111163, 18168, 6960, 161135, 191298, 5247, 100584, 127552, 171568, 20121, 91173, 12636,\n  54615, 20199, 63730, 98105, 2396, 40387, 14438, 125012, 4765, 33235, 12865, 45299, 37728, 82098, 77872, 114037,\n  59253, 19675, 24838, 398016, 102561, 11446, 17069, 57508, 178277, 65836, 99941, 26114, 2585, 271882, 136866, 50126,\n  11027, 155648, 118367, 14585, 8910, 123015, 335383, 40434, 41016, 53021, 14439, 87098, 176860, 201543, 121888, 2358,\n  9286, 5739, 22666, 54270, 37884, 169381, 33984, 93859, 16124, 89364, 72207, 51639, 76366, 99029, 65812, 2198,\n  12147, 174891, 194289, 6986, 30252, 88822, 21284, 11445, 288337, 160821, 33034, 100869, 43852, 25761, 52882, 1144,\n  103809, 1924, 84458, 86079, 43411, 13542, 139276, 18141, 34978, 41298, 7276, 26481, 173800, 33210, 17951, 142652,\n  33616, 33677, 2210, 19941, 98568, 2486, 192414, 80136, 12058, 235883, 50963, 249638, 29572, 27221, 47034, 6124,\n  72107, 63346, 97620, 158513, 299699, 40388, 23235, 37176, 224244, 198386, 121323, 67992, 23827, 63170, 17838, 106622,\n  158590, 26807, 5345, 23489, 91891, 55474, 74834, 37981, 13058, 5977, 72552, 34706, 26828, 145172, 19904, 21367,\n  34043, 960, 77092, 91381, 4733, 47446, 7680, 41697, 5170, 16960, 14741, 46101, 13656, 473, 51842, 37433,\n  11103, 11551, 121951, 13191, 97536, 165932, 50397, 51628, 129028, 9069, 44885, 6590, 59195, 47045, 32940, 225472,\n  90345, 21833, 13303, 29407, 96615, 141951, 5198, 6028, 18395, 7181, 3861, 14966, 156358, 167182, 36529, 55253,\n  25942, 173153, 30959, 27261, 50691, 150176, 162201, 38467, 48462, 80602, 42163, 118482, 168, 108756, 26011, 17166,\n  54149, 456538, 22512, 91374, 13816, 90358, 131615, 18132, 226707, 1824, 28139, 26860, 42253, 93877, 77351, 65575,\n  8980, 80574, 22020, 27948, 40422, 91324, 76376, 13528, 39281, 91685, 82215, 122541, 144066, 1983, 193851, 17283,\n  26320, 2739, 194978, 4790, 26845, 42627, 61300, 65815, 174612, 55133, 4200, 191130, 79771, 158321, 52280, 166796,\n  221620, 62461, 11278, 4067, 88152, 83409, 31717, 121367, 13522, 47325, 37945, 10406, 174348, 249321, 154101, 64912,\n  29938, 51775, 17220, 15776, 166138, 78890, 84425, 54121, 42861, 16368, 24572, 291647, 10197, 32073, 22651, 11677,\n  97509, 26952, 35787, 18424, 41910, 71614, 94977, 72318, 41594, 70024, 275419, 37702, 60199, 7335, 39107, 61315,\n  18271, 18394, 33768, 87884, 104277, 123724, 7277, 56288, 71981, 189803, 49320, 3352, 6798, 14240, 8954, 69220,\n  94433, 57372, 28620, 68863, 193727, 85575, 42309, 41667, 67689, 42081, 22543, 44824, 12719, 28540, 114236, 101553,\n  27638, 27296, 4300, 5353, 4663, 19379, 94098, 3758, 95888, 95144, 80344, 87320, 28447, 259518, 12718, 71391,\n  152731, 37063, 24132, 31911, 104896, 15672, 103782, 1521, 4945, 72541, 23717, 122632, 15619, 87175, 206120, 29428,\n  189780, 61416, 28350, 44457, 972, 1175, 47233, 198738, 95789, 41907, 21953, 97034, 59341, 22864, 53713, 16873,\n  32971, 20693, 20954, 31336, 21477, 16169, 38370, 16412, 9019, 3841, 24599, 21938, 17085, 6484, 81198, 76413,\n  5849, 72514, 12320, 65247, 276175, 37234, 59796, 52642, 16312, 57349, 198507, 94148, 46134, 18958, 125552, 1747,\n  18725, 151873, 14901, 5490, 68287, 29470, 3689, 64794, 40814, 26018, 25692, 54450, 2703, 88278, 124886, 173087,\n  174000, 24159, 179477, 24276, 46004, 201876, 209202, 445, 52876, 31948, 30206, 157610, 39180, 18439, 44124, 50469,\n  5774, 96278, 222758, 200216, 50290, 45486, 20435, 46986, 46276, 140133, 142326, 15569, 13363, 47522, 92583, 2182,\n  7135, 16853, 22998, 30272, 4952, 63263, 35623, 39096, 53789, 44864, 20053, 110392, 124213, 4630, 16087, 28221,\n  127787, 25839, 77481, 44693, 13464, 113146, 6983, 27069, 55717, 50102, 4760, 7107, 26186, 66507, 59145, 36032,\n  104182, 71328, 29425, 64317, 50781, 47465, 94298, 69706, 74899, 22754, 120756, 25108, 93077, 56834, 73286, 39928,\n  16218, 41699, 176763, 7555, 70819, 50083, 26895, 23315, 26014, 16773, 123079, 41712, 5719, 31516, 90427, 158540,\n  85051, 183128, 40864, 27505, 55392, 9058, 45224, 96857, 30901, 136622, 96557, 56304, 120061, 11501, 151448, 5773,\n  89743, 7769, 86069, 2935, 18471, 41628, 10114, 33660, 110170, 49479, 26745, 92846, 33221, 26731, 18795, 87076,\n  8550, 2100, 29972, 120289, 3077, 72490, 33784, 2630, 208722, 50861, 63483, 79029, 6419, 39467, 14302, 45286,\n  64207, 9686, 67513, 44170, 1050, 77246, 59266, 17055, 53801, 7150, 11111, 42432, 4278, 94579, 362117, 36175,\n  42902, 41933, 39002, 98489, 22913, 74161, 84773, 57036, 17556, 162288, 74485, 178760, 93867, 73635, 128860, 50362,\n  261, 67455, 80001, 46080, 35662, 4368, 25247, 19230, 74393, 22588, 1822, 27682, 235324, 13798, 85998, 13194,\n  235067, 23514, 71669, 147632, 23191, 134748, 214683, 105101, 1518, 25489, 247114, 7380, 54842, 26922, 3971, 26361,\n  20844, 68642, 170517, 77339, 123255, 8963, 77818, 150998, 48466, 36806, 2732, 23261, 11741, 236162, 18243, 126216,\n  28690, 50546, 16385, 92760, 197383, 246558, 201295, 88255, 67588, 71687, 176076, 172653, 169058, 33906, 63747, 24835,\n  157621, 43338, 30050, 46152, 132741, 2770, 51371, 94835, 6614, 15112, 11749, 56936, 1250, 19027, 399017, 58036,\n  100215, 23388, 55815, 308768, 124152, 94803, 9521, 64186, 8971, 28, 30427, 62163, 7616, 103838, 35079, 29203,\n  131235, 7743, 17389, 10882, 37420, 61460, 228512, 85363, 41581, 131077, 62822, 119647, 10130, 54445, 26925, 19968,\n  29016, 24446, 74028, 24176, 61448, 67185, 9254, 8563, 119129, 9771, 99184, 37716, 39514, 10532, 221512, 258753,\n  218630, 55980, 23394, 32141, 61924, 66749, 32411, 3741, 36475, 26678, 77010, 44946, 91203, 128749, 116953, 20476,\n  49625, 53116, 13735, 102335, 29376, 51946, 83407, 67892, 59212, 34685, 21083, 1546, 112982, 32972, 74397, 1078,\n  190545, 16082, 86140, 58591, 89611, 101531, 10061, 105104, 76319, 20035, 17551, 52611, 169061, 190842, 100780, 23907,\n  90413, 115619, 9675, 34710, 193435, 49443, 129734, 11183, 258877, 16318, 136182, 126808, 44635, 27304, 192375, 2599,\n  125648, 47051, 12091, 23814, 721, 58800, 40137, 66726, 97930, 60877, 74487, 7942, 54326, 9841, 41428, 13762,\n  8211, 85383, 6950, 99177, 79806, 201786, 296464, 124087, 13144, 29741, 41721, 47634, 55088, 254286, 106408, 17041,\n  99064, 12942, 64086, 45233, 14005, 2612, 55827, 255, 7984, 13980, 38574, 12776, 46654, 73499, 249951, 2101,\n  26676, 25996, 132326, 116415, 119062, 50449, 31033, 23038, 11589, 179252, 20007, 14860, 129270, 21143, 17796, 144715,\n  60106, 70758, 69842, 34674, 282133, 44014, 16774, 57268, 38528, 24053, 46373, 201667, 28327, 471023, 51889, 102667,\n  21193, 114909, 84132, 69317, 96723, 67969, 16134, 68145, 15058, 28765, 32035, 2524, 101089, 98664, 25045, 76571,\n  14957, 86040, 118506, 262428, 154764, 81573, 39681, 283900, 73287, 127825, 544, 80448, 52347, 38512, 175971, 15180,\n  45467, 33086, 46552, 48894, 81107, 43213, 36672, 54025, 76703, 8053, 7608, 13299, 56619, 20752, 238099, 54164,\n  105133, 1444, 32942, 953, 37564, 8000, 66316, 119463, 106817, 404, 13667, 149108, 128597, 31267, 10269, 49836,\n  106150, 1484, 52330, 76965, 160486, 171648, 38456, 31263, 22424, 37738, 66245, 67467, 143369, 60471, 75610, 20895,\n  115528, 86070, 60854, 40796, 49347, 18989, 15030, 11371, 37578, 15779, 79867, 10187, 86462, 46402, 155626, 93200,\n  40229, 7090, 57547, 108053, 99598, 11088, 47505, 41218, 206017, 2173, 20988, 30219, 22919, 80563, 57566, 42369,\n  93141, 41675, 2407, 182519, 120495, 27154, 16702, 29456, 14349, 7958, 16688, 117177, 140375, 42467, 261919, 74916,\n  153569, 10836, 34742, 49526, 7621, 105997, 12212, 2270, 392377, 7755, 17959, 25086, 232152, 138791, 33847, 13860,\n  35316, 5811, 1344, 71259, 50452, 207539, 92635, 50359, 5821, 33674, 30255, 2086, 2587, 96264, 17543, 42,\n  6029, 9580, 43007, 139248, 82831, 12917, 29607, 25786, 51467, 42137, 85161, 100698, 31561, 88989, 121990, 278500,\n  3602, 109344, 37982, 15279, 116442, 28936, 30880, 87894, 58079, 128661, 126731, 67392, 28051, 146885, 4861, 16216,\n  97344, 42827, 147561, 153948, 22684, 21335, 47685, 1853, 43349, 15185, 59642, 10229, 25520, 187921, 108972, 5579,\n  98037, 24945, 6697, 19193, 63734, 137934, 75056, 89740, 19767, 224268, 56138, 63643, 151661, 39313, 70618, 84031,\n  89723, 84074, 13703, 85626, 35460, 8867, 64845, 3439, 57906, 99776, 63968, 49270, 81130, 34356, 16210, 23547,\n  36446, 34090, 140028, 72439, 2221, 22163, 57058, 363492, 113754, 18913, 95451, 48663, 54464, 54037, 176097, 68425,\n  3023, 34906, 29482, 117389, 341780, 80431, 58330, 16753, 92616, 60907, 94846, 147486, 4498, 48646, 7773, 46801,\n  7778, 18946, 464978, 47558, 33223, 177444, 7328, 15626, 63337, 94700, 11743, 9351, 255024, 39098, 16447, 42647,\n  96230, 39769, 58840, 10068, 63439, 35800, 65843, 58823, 413844, 9156, 51258, 7434, 61791, 85018, 6872, 3692,\n  28096, 7121, 33024, 6009, 75532, 31997, 192535, 9661, 3304, 9547, 14753, 31987, 25314, 55689, 15896, 20430,\n  39472, 31340, 99744, 25398, 115569, 54883, 28719, 205423, 23071, 57855, 64638, 149867, 25671, 82403, 37616, 20668,\n  39989, 77996, 74948, 140555, 175248, 64810, 36515, 46595, 4958, 248773, 24045, 28728, 136673, 168704, 20804, 114833,\n  100325, 27135, 21205, 96151, 153134, 45992, 7093, 13992, 76047, 1980, 19432, 145001, 75159, 87462, 17710, 1013,\n  45556, 34297, 144882, 20648, 26061, 11319, 129567, 108555, 18872, 464580, 33386, 22717, 65948, 167189, 5603, 135042,\n  79542, 8801, 202632, 18114, 91882, 5973, 5239, 67315, 4431, 60916, 47819, 71693, 32597, 32606, 18183, 45072,\n  80329, 76385, 24749, 51305, 40314, 156514, 14693, 130345, 13168, 66214, 18029, 12858, 34801, 27628, 14544, 10823,\n  40522, 40185, 33739, 148694, 23548, 9923, 61012, 28859, 17933, 19442, 34364, 99849, 164107, 141167, 30629, 21054,\n  6744, 36491, 8096, 42474, 41706, 155060, 30650, 10600, 163442, 1143, 96655, 61390, 52359, 7559, 51568, 64256,\n  203854, 4467, 22453, 14504, 436398, 7878, 6980, 8293, 63610, 293747, 16167, 35763, 19627, 147603, 15419, 18032,\n  110744, 51346, 33681, 54571, 40472, 48615, 39073, 21604, 13754, 173027, 92560, 11083, 47299, 63062, 11813, 52007,\n  29883, 9734, 139722, 15953, 1550, 20651, 13616, 49306, 16113, 90089, 92326, 7584, 30712, 72424, 164858, 6831,\n  152871, 55746, 197721, 34167, 196442, 6022, 112107, 55215, 7538, 123381, 4920, 43539, 77165, 8939, 50392, 34192,\n  20225, 79762, 22505, 58667, 40770, 29788, 97180, 82835, 4568, 8579, 13273, 363569, 35898, 49983, 436, 36598,\n  3237, 131691, 62418, 35591, 8101, 4073, 379438, 65218, 76072, 33887, 2968, 27573, 212619, 288680, 68278, 72851,\n  150504, 217896, 6913, 121339, 22017, 35340, 51072, 43616, 75043, 31437, 10833, 81487, 4364, 22968, 41454, 106687,\n  85446, 19863, 109625, 149241, 524, 141850, 214404, 54376, 657, 237023, 9401, 108137, 53800, 32474, 49712, 53334,\n  126876, 27337, 45552, 177696, 8269, 15036, 12097, 42240, 2328, 125374, 119295, 99715, 2500, 19624, 39441, 27220,\n  102691, 60957, 94543, 39101, 18566, 67362, 13975, 78230, 25017, 34017, 239007, 90027, 39351, 41681, 35354, 43822,\n  1043, 916, 58587, 141983, 94818, 38799, 75459, 41114, 67432, 16195, 36606, 59568, 22272, 126769, 31424, 68659,\n  12287, 134302, 257977, 5756, 207285, 95637, 47248, 117689, 19583, 77451, 22373, 12200, 54993, 117118, 34244, 29386,\n  34562, 53819, 71267, 64172, 77665, 49368, 7716, 59301, 25749, 45426, 194789, 17297, 2650, 1766, 32501, 45198,\n  20403, 20984, 6600, 14171, 94604, 19037, 5402, 29896, 9938, 59935, 109708, 88081, 145182, 44844, 39167, 352626,\n  164173, 35374, 45982, 6122, 154, 73419, 220487, 53834, 53601, 17992, 8609, 229321, 5610, 68098, 66815, 71012,\n  95069, 140968, 27396, 8957, 134489, 24656, 86659, 56598, 134852, 17316, 123838, 255436, 6613, 41610, 138033, 81452,\n  32023, 32396, 123687, 63398, 8693, 29712, 30407, 19296, 121188, 3551, 36099, 20032, 111948, 56624, 16547, 27453,\n  35916, 15378, 52039, 56849, 13489, 22214, 73177, 53097, 277349, 2157, 14029, 187886, 10260, 141743, 246460, 91880,\n  50869, 3788, 49486, 133566, 54950, 33120, 129337, 53768, 18333, 9525, 26902, 312251, 10297, 9020, 70759, 16647,\n  112432, 59260, 84609, 9818, 82766, 73569, 468, 46001, 75780, 55028, 52106, 11498, 43645, 108069, 17150, 17753,\n  29417, 16705, 31799, 9606, 289, 122254, 115975, 8620, 6133, 255357, 56908, 14456, 133464, 43554, 79224, 11247,\n  29630, 160, 12756, 25464, 65960, 350428, 62521, 321796, 100359, 67358, 35169, 46172, 113128, 48988, 88868, 31094,\n  33266, 6847, 60887, 98188, 49659, 69117, 92977, 220228, 13947, 80181, 35103, 62170, 97351, 13475, 2440, 199768,\n  19498, 36597, 46971, 25234, 67806, 62881, 84717, 73648, 181966, 10488, 94149, 21550, 26655, 63436, 48375, 14405,\n  165650, 9621, 24439, 28043, 42735, 4490, 29963, 56674, 45373, 1934, 262446, 50855, 67098, 26898, 5261, 52696,\n  40644, 33900, 9440, 180286, 87162, 22940, 19704, 26936, 69769, 10254, 101759, 27406, 12243, 48000, 73926, 113215,\n  54935, 5726, 192787, 4312, 106216, 9366, 11550, 52949, 23457, 212271, 277152, 133895, 108374, 6191, 96477, 29980,\n  218916, 58024, 54696, 40853, 91124, 65894, 91170, 65908, 252552, 6793, 29212, 15389, 44516, 122515, 52617, 35058,\n  9017, 103536, 39510, 49136, 19242, 130652, 662077, 74699, 47024, 31422, 8517, 73351, 24399, 13867, 128360, 4810,\n  4434, 61779, 111983, 61036, 17798, 110240, 59722, 102960, 39688, 10001, 23803, 23039, 176498, 56659, 44814, 134295,\n  17188, 77577, 74466, 226175, 102472, 154333, 63900, 111747, 18062, 41171, 79669, 32773, 408933, 42562, 28931, 30907,\n  107388, 43487, 2946, 240310, 23938, 24354, 319, 184983, 7927, 6488, 1422, 10790, 68809, 68209, 64775, 4361,\n  202, 17123, 59634, 51200, 44391, 18188, 17843, 2619, 74278, 3230, 9540, 47187, 21702, 36274, 56894, 43907,\n  16310, 34790, 16866, 6150, 5561, 13587, 107545, 108873, 126867, 86986, 28640, 33427, 19017, 5762, 80637, 17430,\n  46903, 2047, 131055, 25958, 13558, 5444, 47152, 13900, 44563, 122857, 45348, 70863, 39593, 54332, 38068, 33637,\n  318, 40310, 143467, 18502, 24520, 11377, 62013, 28942, 27246, 28269, 83545, 17999, 59015, 90707, 30065, 15161,\n  34720, 1263, 37008, 2012, 6060, 98575, 92933, 5721, 299, 199555, 24578, 29223, 2985, 743, 115825, 109523,\n  136657, 47454, 26378, 53586, 3733, 174945, 93340, 244456, 5693, 37386, 28782, 89767, 27545, 23573, 18798, 136425,\n  34320, 84778, 20041, 48453, 38215, 7477, 71958, 40621, 8773, 5874, 187927, 105965, 51100, 43533, 18083, 8443,\n  10180, 43597, 2003, 183999, 69689, 12216, 129696, 146188, 62389, 34044, 68410, 12765, 43273, 26949, 266807, 3345,\n  34477, 79197, 5688, 47539, 213110, 21634, 22257, 50092, 32222, 42346, 39530, 63668, 98, 134978, 74022, 5152,\n  59088, 174145, 37220, 9934, 9545, 118937, 5724, 87240, 19875, 15784, 40143, 23263, 87513, 181654, 285152, 37881,\n  263241, 4966, 43934, 10433, 186657, 6470, 74416, 225854, 25908, 142677, 246262, 32280, 6192, 75890, 45546, 143264,\n  135305, 29742, 47013, 77787, 11732, 126658, 8763, 37950, 21806, 57557, 113464, 89465, 108995, 164574, 23894, 22996,\n  23169, 15369, 23117, 17642, 130607, 40503, 36239, 280990, 44666, 9981, 40427, 147487, 26869, 168452, 32886, 32991,\n  46798, 240839, 15111, 70502, 65697, 88548, 44145, 28701, 48767, 31139, 206777, 35659, 181164, 166262, 14554, 171445,\n  31786, 66523, 76607, 17956, 6507, 31279, 90476, 116611, 167918, 6560, 1243, 115324, 80128, 41867, 55897, 187323,\n  37069, 32596, 189444, 145931, 13390, 105530, 65709, 26805, 6999, 55714, 41300, 22915, 68951, 22138, 21120, 22264,\n  10058, 19945, 33635, 56123, 99085, 10032, 5818, 6016, 46649, 57476, 35264, 94413, 112522, 262288, 93686, 83038,\n  14341, 23204, 28807, 66084, 77987, 6101, 126673, 7133, 38126, 5923, 122091, 170240, 97772, 46874, 215746, 43948,\n  41622, 3272, 55596, 8332, 146411, 251315, 13533, 8561, 81521, 115449, 48616, 175175, 2063, 186556, 3036, 134537,\n  75772, 29728, 82360, 22973, 186559, 86348, 89100, 38388, 82297, 45610, 2613, 87082, 9986, 177812, 57884, 23591,\n  47485, 42543, 33582, 44713, 74439, 257444, 252451, 31825, 35631, 38540, 33066, 5147, 13973, 4343, 51830, 70378,\n  22827, 26448, 95560, 36896, 241741, 48067, 203953, 298860, 61620, 20450, 3220, 67272, 6586, 107662, 100160, 108684,\n  6929, 57226, 4762, 7457, 1320, 40404, 77204, 99309, 62750, 208653, 59977, 44000, 74315, 34332, 5819, 172217,\n  64904, 114077, 18147, 84012, 1791, 98456, 90930, 21446, 116669, 103938, 7422, 85140, 59713, 5768, 326211, 16239,\n  75411, 13229, 29398, 10758, 236107, 1539, 112472, 95979, 152154, 151294, 306, 21196, 38146, 10700, 6891, 84282,\n  109646, 56492, 40539, 6589, 119491, 51354, 30685, 140209, 136906, 29622, 73617, 49553, 70525, 51671, 166869, 139616,\n  74395, 37439, 49595, 45678, 11959, 33211, 86560, 52434, 9282, 62690, 112155, 130810, 5243, 108261, 99970, 265613,\n  72551, 80049, 6391, 33365, 90721, 66737, 69872, 87011, 1860, 9032, 112544, 60905, 37371, 89015, 140351, 19076,\n  850, 373531, 2802, 36725, 218795, 72062, 28990, 16550, 24614, 7815, 6187, 26336, 33373, 32162, 42791, 73555,\n  32062, 23386, 10244, 56392, 49442, 27076, 136262, 12412, 14883, 1134, 33675, 97153, 199281, 15608, 100152, 74072,\n  47942, 254301, 36451, 16026, 10687, 65067, 56708, 254030, 30290, 50490, 13864, 57941, 259331, 35588, 23485, 43486,\n  24869, 21620, 92971, 22072, 88645, 1048, 182050, 13343, 32452, 14825, 19509, 3325, 216938, 45740, 99716, 189082,\n  53740, 78245, 25609, 24311, 176777, 47340, 308354, 40669, 66085, 14102, 125339, 9225, 128709, 97207, 1271, 200933,\n  78439, 113451, 88975, 18324, 46521, 11819, 18570, 141756, 72512, 170020, 52754, 63550, 118515, 103073, 93330, 32736,\n  50499, 14722, 31600, 68452, 398867, 29316, 172786, 18417, 104924, 2606, 5670, 84818, 16288, 67106, 59580, 82929,\n  607401, 291, 85829, 359, 15897, 35830, 50696, 65630, 52672, 22115, 356968, 29895, 40837, 231192, 34024, 38957,\n  26722, 406, 23335, 124952, 72068, 68804, 13268, 147101, 164740, 276569, 162596, 66943, 11569, 26654, 66358, 4777,\n  23229, 102127, 5848, 978, 2921, 59666, 5371, 28212, 90108, 42938, 39320, 2499, 4271, 108792, 33510, 125072,\n  71653, 65239, 38250, 66357, 38577, 13964, 86251, 35708, 50755, 36010, 29448, 12209, 3844, 38222, 206337, 100876,\n  67827, 137088, 14167, 252225, 84163, 195270, 1306, 5703, 54198, 779, 46802, 22028, 51124, 86759, 70560, 113164,\n  35685, 162145, 45471, 34561, 422, 2611, 6464, 47486, 19223, 38246, 9191, 18331, 89942, 243642, 212364, 15893,\n  17518, 22617, 6409, 30046, 126182, 59716, 36560, 104428, 18846, 26592, 19458, 50793, 147333, 30826, 1388, 27647,\n  10922, 14495, 33545, 19269, 135828, 39727, 41601, 46931, 233379, 49169, 131130, 182112, 16276, 82381, 118209, 142445,\n  128310, 19672, 28740, 82907, 33436, 3118, 102206, 28723, 24819, 41937, 38854, 5157, 3881, 111491, 1142, 9776,\n  421673, 152241, 29309, 14961, 87854, 6054, 15424, 3796, 82656, 54996, 2108, 55367, 239450, 154525, 9643, 118103,\n  106041, 64601, 68549, 48707, 30266, 25772, 18740, 9462, 229669, 91798, 112152, 191327, 14493, 72828, 8175, 66636,\n  236474, 25817, 87351, 129027, 76653, 20422, 22983, 71240, 27846, 44661, 12399, 46158, 77704, 53101, 35032, 11072,\n  17300, 109294, 33638, 24408, 1895, 11241, 760, 17584, 82479, 125877, 63150, 141075, 34259, 23274, 81698, 15732,\n  43577, 48340, 91584, 14688, 16379, 24481, 150280, 96420, 262050, 48635, 43727, 61819, 56268, 72003, 88178, 17281,\n  79912, 13218, 122519, 125295, 166396, 11811, 2171, 118930, 67746, 17636, 178278, 174656, 95661, 173039, 83845, 79689,\n  17473, 98555, 127696, 203415, 54730, 22925, 232239, 9309, 12136, 175026, 20740, 180188, 10747, 39816, 314017, 266131,\n  10040, 175732, 112550, 220651, 31974, 37393, 888, 23008, 86799, 4303, 64905, 148467, 75337, 251, 3284, 370102,\n  50264, 9835, 5438, 23655, 4481, 29851, 329, 12855, 7162, 64931, 78141, 12804, 42372, 296771, 83547, 18624,\n  34874, 86271, 3360, 48665, 77735, 88767, 11463, 63527, 28889, 22258, 29140, 194315, 113924, 25499, 6406, 31334,\n  1845, 4802, 49184, 43455, 35469, 127594, 92970, 61038, 115005, 38840, 87761, 106838, 8811, 20572, 55637, 11162,\n  96721, 132425, 108925, 2948, 125457, 36356, 3502, 75270, 27622, 127192, 2561, 123095, 49394, 61155, 16897, 110064,\n  9699, 89448, 53356, 19628, 220310, 21622, 83036, 9885, 112214, 6087, 26713, 17901, 161912, 91492, 3440, 68594,\n  9266, 92238, 8087, 6866, 150194, 72175, 80701, 13459, 31836, 43243, 239700, 95846, 44749, 50647, 21945, 230538,\n  120612, 132371, 244604, 5193, 105637, 34661, 41341, 68775, 85393, 1874, 8771, 33718, 49672, 77403, 595452, 99507,\n  6490, 58895, 128742, 7704, 39239, 73217, 43816, 62824, 37804, 199976, 22361, 80005, 87514, 94832, 14089, 4574,\n  139975, 59142, 75523, 100268, 43906, 53442, 15152, 2547, 186002, 17011, 19513, 204282, 3343, 60568, 128318, 119250,\n  4298, 51871, 41336, 71759, 21921, 45074, 98169, 145889, 99427, 11350, 1237, 5520, 28799, 7803, 53702, 21026,\n  136352, 38293, 128690, 12158, 90132, 44600, 10184, 26957, 39459, 126025, 78904, 82999, 59373, 39301, 150198, 120529,\n  153042, 20177, 50089, 14764, 271571, 30530, 123161, 38975, 101562, 22941, 5648, 124654, 109243, 69817, 71675, 49162,\n  106884, 21241, 107795, 30258, 16572, 188262, 141456, 7688, 60718, 8271, 11044, 32440, 104608, 103419, 236109, 93156,\n  43293, 128929, 42107, 67180, 25201, 115254, 185488, 130954, 72813, 167547, 20537, 39969, 38432, 22582, 184022, 1139,\n  27199, 5655, 17767, 97412, 122606, 209377, 27070, 35871, 326617, 188954, 42680, 73512, 80911, 22629, 3011, 95021,\n  315242, 157737, 383, 41821, 41808, 19335, 27950, 15674, 25677, 110950, 35375, 76835, 59108, 57370, 35262, 16569,\n  160415, 37706, 78086, 32041, 49691, 137143, 9782, 172080, 50148, 77917, 6323, 10110, 69172, 17711, 21795, 59511,\n  76184, 135114, 31046, 132319, 59105, 157578, 20549, 80778, 57649, 158421, 65143, 4575, 72235, 21899, 10797, 92745,\n  34035, 106079, 80159, 4508, 78304, 25350, 75457, 46458, 32937, 25623, 47, 8531, 104751, 84953, 8138, 36508,\n  187199, 66310, 115274, 13253, 32461, 38536, 1916, 42007, 187160, 35055, 26325, 84394, 35963, 94216, 45590, 97782\n]\n", "import { randomBytes } from '@libp2p/crypto'\nimport { setMaxListeners } from '@libp2p/interface'\nimport { peerIdFromMultihash } from '@libp2p/peer-id'\nimport length from 'it-length'\nimport * as Digest from 'multiformats/hashes/digest'\nimport { sha256 } from 'multiformats/hashes/sha2'\nimport { xor as uint8ArrayXor } from 'uint8arrays/xor'\nimport { TABLE_REFRESH_INTERVAL, TABLE_REFRESH_QUERY_TIMEOUT } from '../constants.js'\nimport GENERATED_PREFIXES from './generated-prefix-list.js'\nimport type { RoutingTable } from './index.js'\nimport type { PeerRouting } from '../peer-routing/index.js'\nimport type { ComponentLogger, Logger, PeerId } from '@libp2p/interface'\n\n/**\n * Cannot generate random KadIds longer than this + 1\n */\nconst MAX_COMMON_PREFIX_LENGTH = 15\n\nexport interface RoutingTableRefreshComponents {\n  logger: ComponentLogger\n}\n\nexport interface RoutingTableRefreshInit {\n  peerRouting: PeerRouting\n  routingTable: RoutingTable\n  logPrefix: string\n  refreshInterval?: number\n  refreshQueryTimeout?: number\n}\n\n/**\n * A wrapper around `k-bucket`, to provide easy store and\n * retrieval for peers.\n */\nexport class RoutingTableRefresh {\n  private readonly log: Logger\n  private readonly peerRouting: PeerRouting\n  private readonly routingTable: RoutingTable\n  private readonly refreshInterval: number\n  private readonly refreshQueryTimeout: number\n  private readonly commonPrefixLengthRefreshedAt: Date[]\n  private refreshTimeoutId?: ReturnType<typeof setTimeout>\n\n  constructor (components: RoutingTableRefreshComponents, init: RoutingTableRefreshInit) {\n    const { peerRouting, routingTable, refreshInterval, refreshQueryTimeout, logPrefix } = init\n    this.log = components.logger.forComponent(`${logPrefix}:routing-table:refresh`)\n    this.peerRouting = peerRouting\n    this.routingTable = routingTable\n    this.refreshInterval = refreshInterval ?? TABLE_REFRESH_INTERVAL\n    this.refreshQueryTimeout = refreshQueryTimeout ?? TABLE_REFRESH_QUERY_TIMEOUT\n    this.commonPrefixLengthRefreshedAt = []\n\n    this.refreshTable = this.refreshTable.bind(this)\n  }\n\n  async afterStart (): Promise<void> {\n    this.log(`refreshing routing table every ${this.refreshInterval}ms`)\n    this.refreshTable(true)\n  }\n\n  async stop (): Promise<void> {\n    if (this.refreshTimeoutId != null) {\n      clearTimeout(this.refreshTimeoutId)\n    }\n  }\n\n  /**\n   * To speed lookups, we seed the table with random PeerIds. This means\n   * when we are asked to locate a peer on the network, we can find a KadId\n   * that is close to the requested peer ID and query that, then network\n   * peers will tell us who they know who is close to the fake ID\n   */\n  refreshTable (force: boolean = false): void {\n    this.log('refreshing routing table')\n\n    const prefixLength = this._maxCommonPrefix()\n    const refreshCpls = this._getTrackedCommonPrefixLengthsForRefresh(prefixLength)\n\n    this.log(`max common prefix length ${prefixLength}`)\n    this.log(`tracked CPLs [ ${refreshCpls.map(date => date.toISOString()).join(', ')} ]`)\n\n    /**\n     * If we see a gap at a common prefix length in the Routing table, we ONLY refresh up until\n     * the maximum cpl we have in the Routing Table OR (2 * (Cpl+ 1) with the gap), whichever\n     * is smaller.\n     *\n     * This is to prevent refreshes for Cpls that have no peers in the network but happen to be\n     * before a very high max Cpl for which we do have peers in the network.\n     *\n     * The number of 2 * (Cpl + 1) can be proved and a proof would have been written here if\n     * the programmer had paid more attention in the Math classes at university.\n     *\n     * So, please be patient and a doc explaining it will be published soon.\n     *\n     * https://github.com/libp2p/go-libp2p-kad-dht/commit/2851c88acb0a3f86bcfe3cfd0f4604a03db801d8#diff-ad45f4ba97ffbc4083c2eb87a4420c1157057b233f048030d67c6b551855ccf6R219\n     */\n    Promise.all(\n      refreshCpls.map(async (lastRefresh, index) => {\n        try {\n          await this._refreshCommonPrefixLength(index, lastRefresh, force)\n\n          if (this._numPeersForCpl(prefixLength) === 0) {\n            const lastCpl = Math.min(2 * (index + 1), refreshCpls.length - 1)\n\n            for (let n = index + 1; n < lastCpl + 1; n++) {\n              try {\n                await this._refreshCommonPrefixLength(n, lastRefresh, force)\n              } catch (err: any) {\n                this.log.error(err)\n              }\n            }\n          }\n        } catch (err: any) {\n          this.log.error(err)\n        }\n      })\n    ).catch(err => {\n      this.log.error(err)\n    }).then(() => {\n      this.refreshTimeoutId = setTimeout(this.refreshTable, this.refreshInterval)\n\n      if (this.refreshTimeoutId.unref != null) {\n        this.refreshTimeoutId.unref()\n      }\n    }).catch(err => {\n      this.log.error(err)\n    })\n  }\n\n  async _refreshCommonPrefixLength (cpl: number, lastRefresh: Date, force: boolean): Promise<void> {\n    if (!force && lastRefresh.getTime() > (Date.now() - this.refreshInterval)) {\n      this.log('not running refresh for cpl %s as time since last refresh not above interval', cpl)\n      return\n    }\n\n    // gen a key for the query to refresh the cpl\n    const peerId = await this._generateRandomPeerId(cpl)\n\n    this.log('starting refreshing cpl %s with key %p (routing table size was %s)', cpl, peerId, this.routingTable.size)\n\n    const signal = AbortSignal.timeout(this.refreshQueryTimeout)\n    setMaxListeners(Infinity, signal)\n\n    const peers = await length(this.peerRouting.getClosestPeers(peerId.toMultihash().bytes, {\n      signal\n    }))\n\n    this.log(`found ${peers} peers that were close to imaginary peer %p`, peerId)\n    this.log('finished refreshing cpl %s with key %p (routing table size is now %s)', cpl, peerId, this.routingTable.size)\n  }\n\n  _getTrackedCommonPrefixLengthsForRefresh (maxCommonPrefix: number): Date[] {\n    if (maxCommonPrefix > MAX_COMMON_PREFIX_LENGTH) {\n      maxCommonPrefix = MAX_COMMON_PREFIX_LENGTH\n    }\n\n    const dates: Date[] = []\n\n    for (let i = 0; i <= maxCommonPrefix; i++) {\n      // defaults to the zero value if we haven't refreshed it yet.\n      dates[i] = this.commonPrefixLengthRefreshedAt[i] ?? new Date()\n    }\n\n    return dates\n  }\n\n  async _generateRandomPeerId (targetCommonPrefixLength: number): Promise<PeerId> {\n    if (this.routingTable.kb == null) {\n      throw new Error('Routing table not started')\n    }\n\n    if (this.routingTable.kb.localPeer == null) {\n      throw new Error('Local peer not set')\n    }\n\n    const randomData = randomBytes(2)\n    const randomUint16 = (randomData[1] << 8) + randomData[0]\n\n    const key = await this._makePeerId(this.routingTable.kb.localPeer.kadId, randomUint16, targetCommonPrefixLength)\n    const multihash = Digest.decode(key)\n\n    return peerIdFromMultihash(multihash)\n  }\n\n  async _makePeerId (localKadId: Uint8Array, randomPrefix: number, targetCommonPrefixLength: number): Promise<Uint8Array> {\n    if (targetCommonPrefixLength > MAX_COMMON_PREFIX_LENGTH) {\n      throw new Error(`Cannot generate peer ID for common prefix length greater than ${MAX_COMMON_PREFIX_LENGTH}`)\n    }\n\n    const view = new DataView(localKadId.buffer, localKadId.byteOffset, localKadId.byteLength)\n    const localPrefix = view.getUint16(0, false)\n\n    // For host with ID `L`, an ID `K` belongs to a bucket with ID `B` ONLY IF CommonPrefixLen(L,K) is EXACTLY B.\n    // Hence, to achieve a targetPrefix `T`, we must toggle the (T+1)th bit in L & then copy (T+1) bits from L\n    // to our randomly generated prefix.\n    const toggledLocalPrefix = localPrefix ^ (0x8000 >> targetCommonPrefixLength)\n\n    // Combine the toggled local prefix and the random bits at the correct offset\n    // such that ONLY the first `targetCommonPrefixLength` bits match the local ID.\n    const mask = 65535 << (16 - (targetCommonPrefixLength + 1))\n    const targetPrefix = (toggledLocalPrefix & mask) | (randomPrefix & ~mask)\n\n    // Convert to a known peer ID.\n    const keyPrefix = GENERATED_PREFIXES[targetPrefix]\n\n    const keyBuffer = new ArrayBuffer(34)\n    const keyView = new DataView(keyBuffer, 0, keyBuffer.byteLength)\n    keyView.setUint8(0, sha256.code)\n    keyView.setUint8(1, 32)\n    keyView.setUint32(2, keyPrefix, false)\n\n    return new Uint8Array(keyView.buffer, keyView.byteOffset, keyView.byteLength)\n  }\n\n  /**\n   * returns the maximum common prefix length between any peer in the table\n   * and the current peer\n   */\n  _maxCommonPrefix (): number {\n    // xor our KadId with every KadId in the k-bucket tree,\n    // return the longest id prefix that is the same\n    let prefixLength = 0\n\n    for (const length of this._prefixLengths()) {\n      if (length > prefixLength) {\n        prefixLength = length\n      }\n    }\n\n    return prefixLength\n  }\n\n  /**\n   * Returns the number of peers in the table with a given prefix length\n   */\n  _numPeersForCpl (prefixLength: number): number {\n    let count = 0\n\n    for (const length of this._prefixLengths()) {\n      if (length === prefixLength) {\n        count++\n      }\n    }\n\n    return count\n  }\n\n  /**\n   * Yields the common prefix length of every peer in the table\n   */\n  * _prefixLengths (): Generator<number> {\n    if (this.routingTable.kb?.localPeer == null) {\n      return\n    }\n\n    for (const { kadId } of this.routingTable.kb.toIterable()) {\n      const distance = uint8ArrayXor(this.routingTable.kb.localPeer.kadId, kadId)\n      let leadingZeros = 0\n\n      for (const byte of distance) {\n        if (byte === 0) {\n          leadingZeros++\n        } else {\n          break\n        }\n      }\n\n      yield leadingZeros\n    }\n  }\n}\n", "import { InvalidMessageError } from '@libp2p/interface'\nimport { peerIdFromMultihash } from '@libp2p/peer-id'\nimport { multiaddr } from '@multiformats/multiaddr'\nimport { CID } from 'multiformats/cid'\nimport * as Digest from 'multiformats/hashes/digest'\nimport type { Message } from '../../message/dht.js'\nimport type { Providers } from '../../providers'\nimport type { DHTMessageHandler } from '../index.js'\nimport type { ComponentLogger, Logger, PeerId, PeerStore } from '@libp2p/interface'\n\nexport interface AddProviderComponents {\n  peerId: PeerId\n  peerStore: PeerStore\n  logger: ComponentLogger\n}\n\nexport interface AddProviderHandlerInit {\n  providers: Providers\n  logPrefix: string\n}\n\nexport class AddProviderHandler implements DHTMessageHandler {\n  private readonly peerId: PeerId\n  private readonly providers: Providers\n  private readonly peerStore: PeerStore\n  private readonly log: Logger\n\n  constructor (components: AddProviderComponents, init: AddProviderHandlerInit) {\n    this.log = components.logger.forComponent(`${init.logPrefix}:rpc:handlers:add-provider`)\n    this.peerId = components.peerId\n    this.providers = init.providers\n    this.peerStore = components.peerStore\n  }\n\n  async handle (peerId: PeerId, msg: Message): Promise<Message | undefined> {\n    if (msg.key == null || msg.key.length === 0) {\n      throw new InvalidMessageError('Missing key')\n    }\n\n    let cid: CID\n    try {\n      // this is actually just the multihash, not the whole CID\n      cid = CID.decode(msg.key)\n    } catch (err: any) {\n      throw new InvalidMessageError('Invalid CID')\n    }\n\n    if (msg.providers == null || msg.providers.length === 0) {\n      this.log.error('no providers found in message')\n    }\n\n    this.log('%p asked us, %p to store provider record for for %c', peerId, this.peerId, cid)\n\n    await Promise.all(\n      msg.providers.map(async (pi) => {\n        const digest = Digest.decode(pi.id)\n        const providerId = peerIdFromMultihash(digest)\n        const providerMultiaddrs = pi.multiaddrs.map(buf => multiaddr(buf))\n\n        // Ignore providers not from the originator\n        if (!peerId.equals(providerId)) {\n          this.log('invalid provider peer %p from %p', pi.id, peerId)\n          return\n        }\n\n        if (pi.multiaddrs.length < 1) {\n          this.log('no valid addresses for provider %p. Ignore', peerId)\n          return\n        }\n\n        this.log.trace('received provider %p for %s (addrs %s)', peerId, cid, providerMultiaddrs)\n\n        await this.providers.addProvider(cid, providerId)\n        await this.peerStore.merge(providerId, {\n          multiaddrs: providerMultiaddrs\n        })\n      })\n    )\n\n    return undefined\n  }\n}\n", "import { InvalidMessageError } from '@libp2p/interface'\nimport { protocols } from '@multiformats/multiaddr'\nimport { equals as uint8ArrayEquals } from 'uint8arrays'\nimport { MessageType } from '../../message/dht.js'\nimport type { PeerInfoMapper } from '../../index.js'\nimport type { Message } from '../../message/dht.js'\nimport type { PeerRouting } from '../../peer-routing/index.js'\nimport type { DHTMessageHandler } from '../index.js'\nimport type { ComponentLogger, Logger, PeerId, PeerInfo } from '@libp2p/interface'\nimport type { AddressManager } from '@libp2p/interface-internal'\n\nexport interface FindNodeHandlerInit {\n  peerRouting: PeerRouting\n  logPrefix: string\n  peerInfoMapper: PeerInfoMapper\n}\n\nexport interface FindNodeHandlerComponents {\n  peerId: PeerId\n  addressManager: AddressManager\n  logger: ComponentLogger\n}\n\nexport class FindNodeHandler implements DHTMessageHandler {\n  private readonly peerRouting: PeerRouting\n  private readonly peerInfoMapper: PeerInfoMapper\n  private readonly peerId: PeerId\n  private readonly addressManager: AddressManager\n  private readonly log: Logger\n\n  constructor (components: FindNodeHandlerComponents, init: FindNodeHandlerInit) {\n    const { peerRouting, logPrefix } = init\n\n    this.log = components.logger.forComponent(`${logPrefix}:rpc:handlers:find-node`)\n    this.peerId = components.peerId\n    this.addressManager = components.addressManager\n    this.peerRouting = peerRouting\n    this.peerInfoMapper = init.peerInfoMapper\n  }\n\n  /**\n   * Process `FindNode` DHT messages\n   */\n  async handle (peerId: PeerId, msg: Message): Promise<Message> {\n    this.log('incoming request from %p for peers closer to %b', peerId, msg.key)\n\n    if (msg.key == null) {\n      throw new InvalidMessageError('Invalid FIND_NODE message received - key was missing')\n    }\n\n    const closer: PeerInfo[] = await this.peerRouting.getCloserPeersOffline(msg.key, peerId)\n\n    if (uint8ArrayEquals(this.peerId.toMultihash().bytes, msg.key)) {\n      closer.push({\n        id: this.peerId,\n        multiaddrs: this.addressManager.getAddresses().map(ma => ma.decapsulateCode(protocols('p2p').code))\n      })\n    }\n\n    const response: Message = {\n      type: MessageType.FIND_NODE,\n      clusterLevel: msg.clusterLevel,\n      closer: closer\n        .map(this.peerInfoMapper)\n        .filter(({ multiaddrs }) => multiaddrs.length)\n        .map(peerInfo => ({\n          id: peerInfo.id.toMultihash().bytes,\n          multiaddrs: peerInfo.multiaddrs.map(ma => ma.bytes)\n        })),\n      providers: []\n    }\n\n    if (response.closer.length === 0) {\n      this.log('could not find any peers closer to %b than %p', msg.key, peerId)\n    }\n\n    return response\n  }\n}\n", "import { InvalidMessageError } from '@libp2p/interface'\nimport all from 'it-all'\nimport map from 'it-map'\nimport { CID } from 'multiformats/cid'\nimport { MessageType } from '../../message/dht.js'\nimport type { PeerInfoMapper } from '../../index.js'\nimport type { Message } from '../../message/dht.js'\nimport type { PeerRouting } from '../../peer-routing/index.js'\nimport type { Providers } from '../../providers.js'\nimport type { DHTMessageHandler } from '../index.js'\nimport type { ComponentLogger, Logger, PeerId, PeerInfo, PeerStore } from '@libp2p/interface'\nimport type { Multiaddr } from '@multiformats/multiaddr'\n\nexport interface GetProvidersHandlerInit {\n  peerRouting: PeerRouting\n  providers: Providers\n  logPrefix: string\n  peerInfoMapper: PeerInfoMapper\n}\n\nexport interface GetProvidersHandlerComponents {\n  peerId: PeerId\n  peerStore: PeerStore\n  logger: ComponentLogger\n}\n\nexport class GetProvidersHandler implements DHTMessageHandler {\n  private readonly peerId: PeerId\n  private readonly peerRouting: PeerRouting\n  private readonly providers: Providers\n  private readonly peerStore: PeerStore\n  private readonly peerInfoMapper: PeerInfoMapper\n  private readonly log: Logger\n\n  constructor (components: GetProvidersHandlerComponents, init: GetProvidersHandlerInit) {\n    const { peerRouting, providers, logPrefix } = init\n\n    this.log = components.logger.forComponent(`${logPrefix}:rpc:handlers:get-providers`)\n    this.peerId = components.peerId\n    this.peerStore = components.peerStore\n    this.peerRouting = peerRouting\n    this.providers = providers\n    this.peerInfoMapper = init.peerInfoMapper\n  }\n\n  async handle (peerId: PeerId, msg: Message): Promise<Message> {\n    if (msg.key == null) {\n      throw new InvalidMessageError('Invalid GET_PROVIDERS message received - key was missing')\n    }\n\n    let cid\n    try {\n      cid = CID.decode(msg.key)\n    } catch (err: any) {\n      throw new InvalidMessageError('Invalid CID')\n    }\n\n    this.log('%p asking for providers for %s', peerId, cid)\n\n    const [providerPeers, closerPeers] = await Promise.all([\n      all(map(await this.providers.getProviders(cid), async (peerId) => {\n        const peer = await this.peerStore.get(peerId)\n        const info: PeerInfo = {\n          id: peer.id,\n          multiaddrs: peer.addresses.map(({ multiaddr }) => multiaddr)\n        }\n\n        return info\n      })),\n      this.peerRouting.getCloserPeersOffline(msg.key, this.peerId)\n    ])\n\n    const response: Message = {\n      type: MessageType.GET_PROVIDERS,\n      key: msg.key,\n      clusterLevel: msg.clusterLevel,\n      closer: closerPeers\n        .map(this.peerInfoMapper)\n        .filter(({ id, multiaddrs }) => multiaddrs.length > 0)\n        .map(peerInfo => ({\n          id: peerInfo.id.toMultihash().bytes,\n          multiaddrs: peerInfo.multiaddrs.map(ma => ma.bytes)\n        })),\n      providers: providerPeers\n        .map(this.peerInfoMapper)\n        .filter(({ id, multiaddrs }) => multiaddrs.length > 0)\n        .map(peerInfo => ({\n          id: peerInfo.id.toMultihash().bytes,\n          multiaddrs: peerInfo.multiaddrs.map(ma => ma.bytes)\n        }))\n    }\n\n    this.log('got %s providers %s closerPeers', response.providers.length, response.closer.length)\n\n    return response\n  }\n\n  async _getAddresses (peerId: PeerId): Promise<Multiaddr[]> {\n    return []\n  }\n}\n", "import { publicKeyToProtobuf } from '@libp2p/crypto/keys'\nimport { InvalidMessageError, NotFoundError } from '@libp2p/interface'\nimport { Libp2pRecord } from '@libp2p/record'\nimport {\n  MAX_RECORD_AGE\n} from '../../constants.js'\nimport { MessageType } from '../../message/dht.js'\nimport { bufferToRecordKey, isPublicKeyKey, fromPublicKeyKey } from '../../utils.js'\nimport type { Message } from '../../message/dht.js'\nimport type { PeerRouting } from '../../peer-routing/index.js'\nimport type { DHTMessageHandler } from '../index.js'\nimport type { ComponentLogger, Logger, PeerId, PeerStore } from '@libp2p/interface'\nimport type { Datastore } from 'interface-datastore'\n\nexport interface GetValueHandlerInit {\n  peerRouting: PeerRouting\n  logPrefix: string\n  datastorePrefix: string\n}\n\nexport interface GetValueHandlerComponents {\n  peerStore: PeerStore\n  datastore: Datastore\n  logger: ComponentLogger\n}\n\nexport class GetValueHandler implements DHTMessageHandler {\n  private readonly peerStore: PeerStore\n  private readonly datastore: Datastore\n  private readonly peerRouting: PeerRouting\n  private readonly log: Logger\n  private readonly datastorePrefix: string\n\n  constructor (components: GetValueHandlerComponents, init: GetValueHandlerInit) {\n    this.log = components.logger.forComponent(`${init.logPrefix}:rpc:handlers:get-value`)\n    this.datastorePrefix = `${init.datastorePrefix}/record`\n    this.peerStore = components.peerStore\n    this.datastore = components.datastore\n    this.peerRouting = init.peerRouting\n  }\n\n  async handle (peerId: PeerId, msg: Message): Promise<Message> {\n    const key = msg.key\n\n    this.log('%p asked for key %b', peerId, key)\n\n    if (key == null || key.length === 0) {\n      throw new InvalidMessageError('Invalid key')\n    }\n\n    const response: Message = {\n      type: MessageType.GET_VALUE,\n      key,\n      clusterLevel: msg.clusterLevel,\n      closer: [],\n      providers: []\n    }\n\n    if (isPublicKeyKey(key)) {\n      this.log('is public key')\n      const idFromKey = fromPublicKeyKey(key)\n      let pubKey: Uint8Array | undefined\n\n      try {\n        const peer = await this.peerStore.get(idFromKey)\n\n        if (peer.id.publicKey == null) {\n          throw new NotFoundError('No public key found in key book')\n        }\n\n        pubKey = publicKeyToProtobuf(peer.id.publicKey)\n      } catch (err: any) {\n        if (err.name !== 'NotFoundError') {\n          throw err\n        }\n      }\n\n      if (pubKey != null) {\n        this.log('returning found public key')\n        response.record = new Libp2pRecord(key, pubKey, new Date()).serialize()\n        return response\n      }\n    }\n\n    const [record, closer] = await Promise.all([\n      this._checkLocalDatastore(key),\n      this.peerRouting.getCloserPeersOffline(key, peerId)\n    ])\n\n    if (record != null) {\n      this.log('had record for %b in local datastore', key)\n      response.record = record.serialize()\n    }\n\n    if (closer.length > 0) {\n      this.log('had %s closer peers in routing table', closer.length)\n      response.closer = closer.map(peerInfo => ({\n        id: peerInfo.id.toMultihash().bytes,\n        multiaddrs: peerInfo.multiaddrs.map(ma => ma.bytes)\n      }))\n    }\n\n    return response\n  }\n\n  /**\n   * Try to fetch a given record by from the local datastore.\n   * Returns the record if it is still valid, meaning\n   * - it was either authored by this node, or\n   * - it was received less than `MAX_RECORD_AGE` ago.\n   */\n  async _checkLocalDatastore (key: Uint8Array): Promise<Libp2pRecord | undefined> {\n    this.log('checkLocalDatastore looking for %b', key)\n    const dsKey = bufferToRecordKey(this.datastorePrefix, key)\n\n    // Fetch value from ds\n    let rawRecord\n    try {\n      rawRecord = await this.datastore.get(dsKey)\n    } catch (err: any) {\n      if (err.name === 'NotFoundError') {\n        return undefined\n      }\n      throw err\n    }\n\n    // Create record from the returned bytes\n    const record = Libp2pRecord.deserialize(rawRecord)\n\n    // Check validity: compare time received with max record age\n    if (record.timeReceived == null ||\n      Date.now() - record.timeReceived.getTime() > MAX_RECORD_AGE) {\n      // If record is bad delete it and return\n      await this.datastore.delete(dsKey)\n      return undefined\n    }\n\n    // Record is valid\n    return record\n  }\n}\n", "import type { Message } from '../../message/dht.js'\nimport type { DHTMessageHandler } from '../index.js'\nimport type { ComponentLogger, Logger, PeerId } from '@libp2p/interface'\n\nexport interface PingComponents {\n  logger: ComponentLogger\n}\n\nexport interface PingHandlerInit {\n  logPrefix: string\n}\n\nexport class PingHandler implements DHTMessageHandler {\n  private readonly log: Logger\n\n  constructor (components: PingComponents, init: PingHandlerInit) {\n    this.log = components.logger.forComponent(`${init.logPrefix}:rpc:handlers:ping`)\n  }\n\n  async handle (peerId: PeerId, msg: Message): Promise<Message> {\n    this.log('ping from %p', peerId)\n    return msg\n  }\n}\n", "import { InvalidMessageError } from '@libp2p/interface'\nimport { Libp2pRecord } from '@libp2p/record'\nimport { verifyRecord } from '../../record/validators.js'\nimport { bufferToRecordKey } from '../../utils.js'\nimport type { Validators } from '../../index.js'\nimport type { Message } from '../../message/dht.js'\nimport type { DHTMessageHandler } from '../index.js'\nimport type { ComponentLogger, Logger, PeerId } from '@libp2p/interface'\nimport type { Datastore } from 'interface-datastore'\n\nexport interface PutValueHandlerInit {\n  validators: Validators\n  logPrefix: string\n  datastorePrefix: string\n}\n\nexport interface PutValueHandlerComponents {\n  datastore: Datastore\n  logger: ComponentLogger\n}\n\nexport class PutValueHandler implements DHTMessageHandler {\n  private readonly components: PutValueHandlerComponents\n  private readonly validators: Validators\n  private readonly log: Logger\n  private readonly datastorePrefix: string\n\n  constructor (components: PutValueHandlerComponents, init: PutValueHandlerInit) {\n    const { validators } = init\n\n    this.components = components\n    this.log = components.logger.forComponent(`${init.logPrefix}:rpc:handlers:put-value`)\n    this.datastorePrefix = `${init.datastorePrefix}/record`\n    this.validators = validators\n  }\n\n  async handle (peerId: PeerId, msg: Message): Promise<Message> {\n    const key = msg.key\n    this.log('%p asked us to store value for key %b', peerId, key)\n\n    if (msg.record == null) {\n      const errMsg = `Empty record from: ${peerId.toString()}`\n\n      this.log.error(errMsg)\n      throw new InvalidMessageError(errMsg)\n    }\n\n    try {\n      const deserializedRecord = Libp2pRecord.deserialize(msg.record)\n\n      await verifyRecord(this.validators, deserializedRecord)\n\n      deserializedRecord.timeReceived = new Date()\n      const recordKey = bufferToRecordKey(this.datastorePrefix, deserializedRecord.key)\n      await this.components.datastore.put(recordKey, deserializedRecord.serialize().subarray())\n      this.log('put record for %b into datastore under key %k', key, recordKey)\n    } catch (err: any) {\n      this.log('did not put record for key %b into datastore %o', key, err)\n    }\n\n    return msg\n  }\n}\n", "import * as lp from 'it-length-prefixed'\nimport { pipe } from 'it-pipe'\nimport { Message, MessageType } from '../message/dht.js'\nimport { AddProviderHandler } from './handlers/add-provider.js'\nimport { FindNodeHandler, type FindNodeHandlerComponents } from './handlers/find-node.js'\nimport { GetProvidersHandler, type GetProvidersHandlerComponents } from './handlers/get-providers.js'\nimport { GetValueHandler, type GetValueHandlerComponents } from './handlers/get-value.js'\nimport { PingHandler } from './handlers/ping.js'\nimport { PutValueHandler, type PutValueHandlerComponents } from './handlers/put-value.js'\nimport type { PeerInfoMapper, Validators } from '../index.js'\nimport type { PeerRouting } from '../peer-routing'\nimport type { Providers } from '../providers'\nimport type { RoutingTable } from '../routing-table'\nimport type { CounterGroup, Logger, Metrics, PeerId } from '@libp2p/interface'\nimport type { IncomingStreamData } from '@libp2p/interface-internal'\n\nexport interface DHTMessageHandler {\n  handle(peerId: PeerId, msg: Message): Promise<Message | undefined>\n}\n\nexport interface RPCInit {\n  routingTable: RoutingTable\n  providers: Providers\n  peerRouting: PeerRouting\n  validators: Validators\n  logPrefix: string\n  metricsPrefix: string\n  datastorePrefix: string\n  peerInfoMapper: PeerInfoMapper\n}\n\nexport interface RPCComponents extends GetValueHandlerComponents, PutValueHandlerComponents, FindNodeHandlerComponents, GetProvidersHandlerComponents {\n  metrics?: Metrics\n}\n\nexport class RPC {\n  private readonly handlers: Record<string, DHTMessageHandler>\n  private readonly routingTable: RoutingTable\n  private readonly log: Logger\n  private readonly metrics: {\n    operations?: CounterGroup\n    errors?: CounterGroup\n  }\n\n  constructor (components: RPCComponents, init: RPCInit) {\n    this.metrics = {\n      operations: components.metrics?.registerCounterGroup(`${init.metricsPrefix}_inbound_rpc_requests_total`),\n      errors: components.metrics?.registerCounterGroup(`${init.metricsPrefix}_inbound_rpc_errors_total`)\n    }\n\n    this.log = components.logger.forComponent(`${init.logPrefix}:rpc`)\n    this.routingTable = init.routingTable\n    this.handlers = {\n      [MessageType.GET_VALUE.toString()]: new GetValueHandler(components, init),\n      [MessageType.PUT_VALUE.toString()]: new PutValueHandler(components, init),\n      [MessageType.FIND_NODE.toString()]: new FindNodeHandler(components, init),\n      [MessageType.ADD_PROVIDER.toString()]: new AddProviderHandler(components, init),\n      [MessageType.GET_PROVIDERS.toString()]: new GetProvidersHandler(components, init),\n      [MessageType.PING.toString()]: new PingHandler(components, init)\n    }\n  }\n\n  /**\n   * Process incoming DHT messages\n   */\n  async handleMessage (peerId: PeerId, msg: Message): Promise<Message | undefined> {\n    // get handler & execute it\n    const handler = this.handlers[msg.type]\n\n    if (handler == null) {\n      this.log.error(`no handler found for message type: ${msg.type}`)\n      return\n    }\n\n    try {\n      this.metrics.operations?.increment({\n        [msg.type]: true\n      })\n\n      return await handler.handle(peerId, msg)\n    } catch {\n      this.metrics.errors?.increment({\n        [msg.type]: true\n      })\n    }\n  }\n\n  /**\n   * Handle incoming streams on the dht protocol\n   */\n  onIncomingStream (data: IncomingStreamData): void {\n    let message = 'unknown'\n\n    Promise.resolve().then(async () => {\n      const { stream, connection } = data\n      const peerId = connection.remotePeer\n\n      const self = this // eslint-disable-line @typescript-eslint/no-this-alias\n\n      await pipe(\n        stream,\n        (source) => lp.decode(source),\n        async function * (source) {\n          for await (const msg of source) {\n            // handle the message\n            const desMessage = Message.decode(msg)\n            message = desMessage.type\n            self.log('incoming %s from %p', desMessage.type, peerId)\n            const res = await self.handleMessage(peerId, desMessage)\n\n            // Not all handlers will return a response\n            if (res != null) {\n              yield Message.encode(res)\n            }\n          }\n        },\n        (source) => lp.encode(source),\n        stream\n      )\n    })\n      .catch(err => {\n        this.log.error('error handling %s RPC message from %p - %e', message, data.connection.remotePeer, err)\n      })\n  }\n}\n", "import { TypedEventEmitter } from '@libp2p/interface'\nimport type { KadDHTComponents } from '.'\nimport type { Logger, PeerId, Startable } from '@libp2p/interface'\n\nexport interface TopologyListenerInit {\n  protocol: string\n  logPrefix: string\n}\n\nexport interface TopologyListenerEvents {\n  'peer': CustomEvent<PeerId>\n}\n\n/**\n * Receives notifications of new peers joining the network that support the DHT protocol\n */\nexport class TopologyListener extends TypedEventEmitter<TopologyListenerEvents> implements Startable {\n  private readonly log: Logger\n  private readonly components: KadDHTComponents\n  private readonly protocol: string\n  private running: boolean\n  private registrarId?: string\n\n  constructor (components: KadDHTComponents, init: TopologyListenerInit) {\n    super()\n\n    const { protocol, logPrefix } = init\n\n    this.components = components\n    this.log = components.logger.forComponent(`${logPrefix}:topology-listener`)\n    this.running = false\n    this.protocol = protocol\n  }\n\n  isStarted (): boolean {\n    return this.running\n  }\n\n  /**\n   * Start the network\n   */\n  async start (): Promise<void> {\n    if (this.running) {\n      return\n    }\n\n    this.running = true\n\n    // register protocol with topology\n    this.registrarId = await this.components.registrar.register(this.protocol, {\n      onConnect: (peerId) => {\n        this.log('observed peer %p with protocol %s', peerId, this.protocol)\n        this.dispatchEvent(new CustomEvent('peer', {\n          detail: peerId\n        }))\n      }\n    })\n  }\n\n  /**\n   * Stop all network activity\n   */\n  async stop (): Promise<void> {\n    this.running = false\n\n    // unregister protocol and handlers\n    if (this.registrarId != null) {\n      this.components.registrar.unregister(this.registrarId)\n      this.registrarId = undefined\n    }\n  }\n}\n", "import { NotFoundError, TypedEventEmitter, contentRoutingSymbol, peerDiscoverySymbol, peerRoutingSymbol, serviceCapabilities, serviceDependencies, start, stop } from '@libp2p/interface'\nimport drain from 'it-drain'\nimport createMortice from 'mortice'\nimport pDefer from 'p-defer'\nimport { PROTOCOL } from './constants.js'\nimport { ContentFetching } from './content-fetching/index.js'\nimport { ContentRouting as KADDHTContentRouting } from './content-routing/index.js'\nimport { Network } from './network.js'\nimport { PeerRouting as KADDHTPeerRouting } from './peer-routing/index.js'\nimport { Providers } from './providers.js'\nimport { QueryManager } from './query/manager.js'\nimport { QuerySelf } from './query-self.js'\nimport { selectors as recordSelectors } from './record/selectors.js'\nimport { validators as recordValidators } from './record/validators.js'\nimport { Reprovider } from './reprovider.js'\nimport { RoutingTable } from './routing-table/index.js'\nimport { RoutingTableRefresh } from './routing-table/refresh.js'\nimport { RPC } from './rpc/index.js'\nimport { TopologyListener } from './topology-listener.js'\nimport {\n  multiaddrIsPublic,\n  removePrivateAddressesMapper,\n  timeOperationGenerator\n} from './utils.js'\nimport type { KadDHTComponents, KadDHTInit, Validators, Selectors, KadDHT as KadDHTInterface, QueryEvent, PeerInfoMapper } from './index.js'\nimport type { ContentRouting, CounterGroup, Logger, MetricGroup, PeerDiscovery, PeerDiscoveryEvents, PeerId, PeerInfo, PeerRouting, RoutingOptions, Startable } from '@libp2p/interface'\nimport type { CID } from 'multiformats/cid'\n\n/**\n * Wrapper class to convert events into returned values\n */\nclass DHTContentRouting implements ContentRouting {\n  private readonly dht: KadDHTInterface\n\n  constructor (dht: KadDHTInterface) {\n    this.dht = dht\n  }\n\n  async provide (cid: CID, options: RoutingOptions = {}): Promise<void> {\n    await drain(this.dht.provide(cid, options))\n  }\n\n  async cancelReprovide (key: CID): Promise<void> {\n    await this.dht.cancelReprovide(key)\n  }\n\n  async * findProviders (cid: CID, options: RoutingOptions = {}): AsyncGenerator<PeerInfo, void, undefined> {\n    for await (const event of this.dht.findProviders(cid, options)) {\n      if (event.name === 'PROVIDER') {\n        yield * event.providers\n      }\n    }\n  }\n\n  async put (key: Uint8Array, value: Uint8Array, options?: RoutingOptions): Promise<void> {\n    await drain(this.dht.put(key, value, options))\n  }\n\n  async get (key: Uint8Array, options?: RoutingOptions): Promise<Uint8Array> {\n    for await (const event of this.dht.get(key, options)) {\n      if (event.name === 'VALUE') {\n        return event.value\n      }\n    }\n\n    throw new NotFoundError('Could not find value for key')\n  }\n}\n\n/**\n * Wrapper class to convert events into returned values\n */\nclass DHTPeerRouting implements PeerRouting {\n  private readonly dht: KadDHTInterface\n\n  constructor (dht: KadDHTInterface) {\n    this.dht = dht\n  }\n\n  async findPeer (peerId: PeerId, options: RoutingOptions = {}): Promise<PeerInfo> {\n    for await (const event of this.dht.findPeer(peerId, options)) {\n      if (event.name === 'FINAL_PEER') {\n        return event.peer\n      }\n    }\n\n    throw new NotFoundError('Peer not found')\n  }\n\n  async * getClosestPeers (key: Uint8Array, options: RoutingOptions = {}): AsyncIterable<PeerInfo> {\n    for await (const event of this.dht.getClosestPeers(key, options)) {\n      if (event.name === 'FINAL_PEER') {\n        yield event.peer\n      }\n    }\n  }\n}\n\nexport const DEFAULT_MAX_INBOUND_STREAMS = 32\nexport const DEFAULT_MAX_OUTBOUND_STREAMS = 64\n\nexport type Operation = 'GET_VALUE' | 'FIND_PROVIDERS' | 'FIND_PEER' | 'GET_CLOSEST_PEERS' | 'PROVIDE' | 'PUT_VALUE' | 'SELF_QUERY'\n\nexport interface OperationMetrics {\n  queries?: MetricGroup<Operation>\n  errors?: CounterGroup<Operation>\n  queryTime?: MetricGroup<Operation>\n  errorTime?: MetricGroup<Operation>\n}\n\n/**\n * A DHT implementation modelled after Kademlia with S/Kademlia modifications.\n * Original implementation in go: https://github.com/libp2p/go-libp2p-kad-dht.\n */\nexport class KadDHT extends TypedEventEmitter<PeerDiscoveryEvents> implements KadDHTInterface, Startable {\n  public protocol: string\n  public routingTable: RoutingTable\n  public providers: Providers\n  public network: Network\n  public peerRouting: KADDHTPeerRouting\n\n  public readonly components: KadDHTComponents\n  private readonly log: Logger\n  private running: boolean\n  private readonly kBucketSize: number\n  private clientMode: boolean\n  private readonly validators: Validators\n  private readonly selectors: Selectors\n  private readonly queryManager: QueryManager\n  private readonly contentFetching: ContentFetching\n  private readonly contentRouting: KADDHTContentRouting\n  private readonly routingTableRefresh: RoutingTableRefresh\n  private readonly rpc: RPC\n  private readonly topologyListener: TopologyListener\n  private readonly querySelf: QuerySelf\n  private readonly maxInboundStreams: number\n  private readonly maxOutboundStreams: number\n\n  private readonly dhtContentRouting: DHTContentRouting\n  private readonly dhtPeerRouting: DHTPeerRouting\n  private readonly peerInfoMapper: PeerInfoMapper\n  private readonly reprovider: Reprovider\n\n  /**\n   * Create a new KadDHT\n   */\n  constructor (components: KadDHTComponents, init: KadDHTInit = {}) {\n    super()\n\n    const logPrefix = init.logPrefix ?? 'libp2p:kad-dht'\n    const datastorePrefix = init.datastorePrefix ?? '/dht'\n    const metricsPrefix = init.metricsPrefix ?? 'libp2p_kad_dht'\n\n    const operationMetrics: OperationMetrics = {\n      queries: components.metrics?.registerMetricGroup(`${metricsPrefix}_operations_total`, { label: 'operation' }),\n      errors: components.metrics?.registerCounterGroup(`${metricsPrefix}_operation_errors_total`, { label: 'operation' }),\n      queryTime: components.metrics?.registerMetricGroup(`${metricsPrefix}_operation_time_seconds`, { label: 'operation' }),\n      errorTime: components.metrics?.registerMetricGroup(`${metricsPrefix}_operation_error_time_seconds`, { label: 'operation' })\n    }\n\n    this.running = false\n    this.components = components\n    this.log = components.logger.forComponent(logPrefix)\n    this.protocol = init.protocol ?? PROTOCOL\n    this.kBucketSize = init.kBucketSize ?? 20\n    this.clientMode = init.clientMode ?? true\n    this.maxInboundStreams = init.maxInboundStreams ?? DEFAULT_MAX_INBOUND_STREAMS\n    this.maxOutboundStreams = init.maxOutboundStreams ?? DEFAULT_MAX_OUTBOUND_STREAMS\n    this.peerInfoMapper = init.peerInfoMapper ?? removePrivateAddressesMapper\n\n    const providerLock = createMortice()\n\n    this.providers = new Providers(components, {\n      ...init.providers,\n      logPrefix,\n      datastorePrefix,\n      lock: providerLock\n    })\n\n    this.validators = {\n      ...recordValidators,\n      ...init.validators\n    }\n    this.selectors = {\n      ...recordSelectors,\n      ...init.selectors\n    }\n    this.network = new Network(components, {\n      protocol: this.protocol,\n      logPrefix,\n      metricsPrefix\n    })\n\n    this.routingTable = new RoutingTable(components, {\n      kBucketSize: init.kBucketSize,\n      pingOldContactTimeout: init.pingOldContactTimeout,\n      pingOldContactConcurrency: init.pingOldContactConcurrency,\n      pingOldContactMaxQueueSize: init.pingOldContactMaxQueueSize,\n      pingNewContactTimeout: init.pingNewContactTimeout,\n      pingNewContactConcurrency: init.pingNewContactConcurrency,\n      pingNewContactMaxQueueSize: init.pingNewContactMaxQueueSize,\n      protocol: this.protocol,\n      logPrefix,\n      metricsPrefix,\n      prefixLength: init.prefixLength,\n      splitThreshold: init.kBucketSplitThreshold,\n      network: this.network\n    })\n\n    // all queries should wait for the initial query-self query to run so we have\n    // some peers and don't force consumers to use arbitrary timeouts\n    const initialQuerySelfHasRun = pDefer<any>()\n\n    // if the user doesn't want to wait for query peers, resolve the initial\n    // self-query promise immediately\n    if (init.allowQueryWithZeroPeers === true) {\n      initialQuerySelfHasRun.resolve()\n    }\n\n    this.queryManager = new QueryManager(components, {\n      // Number of disjoint query paths to use - This is set to `kBucketSize/2` per the S/Kademlia paper\n      disjointPaths: Math.ceil(this.kBucketSize / 2),\n      logPrefix,\n      metricsPrefix,\n      initialQuerySelfHasRun,\n      routingTable: this.routingTable\n    })\n\n    // DHT components\n    this.peerRouting = new KADDHTPeerRouting(components, {\n      routingTable: this.routingTable,\n      network: this.network,\n      validators: this.validators,\n      queryManager: this.queryManager,\n      logPrefix\n    })\n    this.contentFetching = new ContentFetching(components, {\n      validators: this.validators,\n      selectors: this.selectors,\n      peerRouting: this.peerRouting,\n      queryManager: this.queryManager,\n      network: this.network,\n      logPrefix,\n      datastorePrefix\n    })\n    this.contentRouting = new KADDHTContentRouting(components, {\n      network: this.network,\n      peerRouting: this.peerRouting,\n      queryManager: this.queryManager,\n      routingTable: this.routingTable,\n      providers: this.providers,\n      logPrefix\n    })\n    this.routingTableRefresh = new RoutingTableRefresh(components, {\n      peerRouting: this.peerRouting,\n      routingTable: this.routingTable,\n      logPrefix\n    })\n    this.rpc = new RPC(components, {\n      routingTable: this.routingTable,\n      providers: this.providers,\n      peerRouting: this.peerRouting,\n      validators: this.validators,\n      logPrefix,\n      metricsPrefix,\n      datastorePrefix,\n      peerInfoMapper: this.peerInfoMapper\n    })\n    this.topologyListener = new TopologyListener(components, {\n      protocol: this.protocol,\n      logPrefix\n    })\n    this.querySelf = new QuerySelf(components, {\n      peerRouting: this.peerRouting,\n      interval: init.querySelfInterval,\n      initialInterval: init.initialQuerySelfInterval,\n      logPrefix,\n      initialQuerySelfHasRun,\n      routingTable: this.routingTable,\n      operationMetrics\n    })\n    this.reprovider = new Reprovider(components, {\n      ...init.reprovide,\n      logPrefix,\n      metricsPrefix,\n      datastorePrefix,\n      contentRouting: this.contentRouting,\n      lock: providerLock,\n      operationMetrics\n    })\n\n    // handle peers being discovered during processing of DHT messages\n    this.network.addEventListener('peer', (evt) => {\n      const peerData = evt.detail\n\n      this.onPeerConnect(peerData).catch(err => {\n        this.log.error('could not add %p to routing table', peerData.id, err)\n      })\n\n      this.dispatchEvent(new CustomEvent('peer', {\n        detail: peerData\n      }))\n    })\n\n    // handle peers being discovered via other peer discovery mechanisms\n    this.topologyListener.addEventListener('peer', (evt) => {\n      const peerId = evt.detail\n\n      Promise.resolve().then(async () => {\n        const peer = await this.components.peerStore.get(peerId)\n\n        const peerData = {\n          id: peerId,\n          multiaddrs: peer.addresses.map(({ multiaddr }) => multiaddr),\n          protocols: peer.protocols\n        }\n\n        await this.onPeerConnect(peerData)\n      }).catch(err => {\n        this.log.error('could not add %p to routing table - %e', peerId, err)\n      })\n    })\n\n    this.dhtPeerRouting = new DHTPeerRouting(this)\n    this.dhtContentRouting = new DHTContentRouting(this)\n\n    // if client mode has not been explicitly specified, auto-switch to server\n    // mode when the node's peer data is updated with publicly dialable\n    // addresses\n    if (init.clientMode == null) {\n      components.events.addEventListener('self:peer:update', (evt) => {\n        this.log('received update of self-peer info')\n\n        void Promise.resolve().then(async () => {\n          const hasPublicAddress = evt.detail.peer.addresses\n            .some(({ multiaddr }) => multiaddrIsPublic(multiaddr))\n\n          const mode = this.getMode()\n\n          if (hasPublicAddress && mode === 'client') {\n            await this.setMode('server')\n          } else if (mode === 'server' && !hasPublicAddress) {\n            await this.setMode('client')\n          }\n        })\n          .catch(err => {\n            this.log.error('error setting dht server mode', err)\n          })\n      })\n    }\n\n    this.get = timeOperationGenerator(this.get.bind(this), operationMetrics, 'GET_VALUE')\n    this.findProviders = timeOperationGenerator(this.findProviders.bind(this), operationMetrics, 'FIND_PROVIDERS')\n    this.findPeer = timeOperationGenerator(this.findPeer.bind(this), operationMetrics, 'FIND_PEER')\n    this.getClosestPeers = timeOperationGenerator(this.getClosestPeers.bind(this), operationMetrics, 'GET_CLOSEST_PEERS')\n    this.provide = timeOperationGenerator(this.provide.bind(this), operationMetrics, 'PROVIDE')\n    this.put = timeOperationGenerator(this.put.bind(this), operationMetrics, 'PUT_VALUE')\n  }\n\n  readonly [Symbol.toStringTag] = '@libp2p/kad-dht'\n\n  readonly [serviceCapabilities]: string[] = [\n    '@libp2p/content-routing',\n    '@libp2p/peer-routing',\n    '@libp2p/peer-discovery'\n  ]\n\n  readonly [serviceDependencies]: string[] = [\n    '@libp2p/identify'\n  ]\n\n  get [contentRoutingSymbol] (): ContentRouting {\n    return this.dhtContentRouting\n  }\n\n  get [peerRoutingSymbol] (): PeerRouting {\n    return this.dhtPeerRouting\n  }\n\n  get [peerDiscoverySymbol] (): PeerDiscovery {\n    return this\n  }\n\n  async onPeerConnect (peerData: PeerInfo): Promise<void> {\n    this.log.trace('peer %p connected', peerData.id)\n\n    peerData = this.peerInfoMapper(peerData)\n\n    if (peerData.multiaddrs.length === 0) {\n      this.log.trace('ignoring %p as there were no valid addresses in %s after filtering', peerData.id, peerData.multiaddrs.map(addr => addr.toString()))\n      return\n    }\n\n    try {\n      await this.routingTable.add(peerData.id)\n    } catch (err: any) {\n      this.log.error('could not add %p to routing table', peerData.id, err)\n    }\n  }\n\n  /**\n   * Is this DHT running.\n   */\n  isStarted (): boolean {\n    return this.running\n  }\n\n  /**\n   * If 'server' this node will respond to DHT queries, if 'client' this node will not\n   */\n  getMode (): 'client' | 'server' {\n    return this.clientMode ? 'client' : 'server'\n  }\n\n  /**\n   * If 'server' this node will respond to DHT queries, if 'client' this node will not\n   */\n  async setMode (mode: 'client' | 'server', force = false): Promise<void> {\n    if (mode === this.getMode() && !force) {\n      this.log('already in %s mode', mode)\n      return\n    }\n\n    await this.components.registrar.unhandle(this.protocol)\n\n    // check again after async work\n    if (mode === this.getMode() && !force) {\n      this.log('already in %s mode', mode)\n      return\n    }\n\n    if (mode === 'client') {\n      this.log('enabling client mode while in %s mode', this.getMode())\n      this.clientMode = true\n    } else {\n      this.log('enabling server mode while in %s mode', this.getMode())\n      this.clientMode = false\n      await this.components.registrar.handle(this.protocol, this.rpc.onIncomingStream.bind(this.rpc), {\n        maxInboundStreams: this.maxInboundStreams,\n        maxOutboundStreams: this.maxOutboundStreams\n      })\n    }\n  }\n\n  /**\n   * Start listening to incoming connections.\n   */\n  async start (): Promise<void> {\n    if (this.running) {\n      return\n    }\n\n    this.running = true\n\n    // Only respond to queries when not in client mode\n    await this.setMode(this.clientMode ? 'client' : 'server', true)\n\n    await start(\n      this.routingTable,\n      this.queryManager,\n      this.network,\n      this.topologyListener,\n      this.routingTableRefresh,\n      this.reprovider\n    )\n\n    // Query self after other components are configured\n    await start(\n      this.querySelf\n    )\n  }\n\n  /**\n   * Stop accepting incoming connections and sending outgoing\n   * messages.\n   */\n  async stop (): Promise<void> {\n    this.running = false\n\n    await stop(\n      this.querySelf,\n      this.queryManager,\n      this.network,\n      this.routingTable,\n      this.routingTableRefresh,\n      this.topologyListener,\n      this.reprovider\n    )\n  }\n\n  /**\n   * Store the given key/value pair in the DHT\n   */\n  async * put (key: Uint8Array, value: Uint8Array, options: RoutingOptions = {}): AsyncGenerator<any, void, undefined> {\n    yield * this.contentFetching.put(key, value, options)\n  }\n\n  /**\n   * Get the value that corresponds to the passed key\n   */\n  async * get (key: Uint8Array, options: RoutingOptions = {}): AsyncGenerator<QueryEvent, void, undefined> {\n    yield * this.contentFetching.get(key, options)\n  }\n\n  // ----------- Content Routing\n\n  /**\n   * Announce to the network that we can provide given key's value\n   */\n  async * provide (key: CID, options: RoutingOptions = {}): AsyncGenerator<QueryEvent, void, undefined> {\n    yield * this.contentRouting.provide(key, this.components.addressManager.getAddresses(), options)\n  }\n\n  /**\n   * Provider records must be re-published every 24 hours - pass a previously\n   * provided CID here to not re-publish a record for it any more\n   */\n  async cancelReprovide (key: CID): Promise<void> {\n    await this.providers.removeProvider(key, this.components.peerId)\n  }\n\n  /**\n   * Search the dht for providers of the given CID\n   */\n  async * findProviders (key: CID, options: RoutingOptions = {}): AsyncGenerator<QueryEvent, any, unknown> {\n    yield * this.contentRouting.findProviders(key, options)\n  }\n\n  // ----------- Peer Routing -----------\n\n  /**\n   * Search for a peer with the given ID\n   */\n  async * findPeer (id: PeerId, options: RoutingOptions = {}): AsyncGenerator<QueryEvent, any, unknown> {\n    yield * this.peerRouting.findPeer(id, options)\n  }\n\n  /**\n   * Kademlia 'node lookup' operation\n   */\n  async * getClosestPeers (key: Uint8Array, options: RoutingOptions = {}): AsyncGenerator<QueryEvent, any, unknown> {\n    yield * this.peerRouting.getClosestPeers(key, options)\n  }\n\n  async refreshRoutingTable (): Promise<void> {\n    this.routingTableRefresh.refreshTable(true)\n  }\n}\n", "/**\n * @packageDocumentation\n *\n * This module implements the [libp2p Kademlia spec](https://github.com/libp2p/specs/blob/master/kad-dht/README.md) in TypeScript.\n *\n * The Kademlia DHT allow for several operations such as finding peers, searching for providers of DHT records, etc.\n *\n * @example Using with libp2p\n *\n * ```TypeScript\n * import { kadDHT } from '@libp2p/kad-dht'\n * import { createLibp2p } from 'libp2p'\n * import { peerIdFromString } from '@libp2p/peer-id'\n *\n * const node = await createLibp2p({\n *   services: {\n *     dht: kadDHT({\n *       // DHT options\n *     })\n *   }\n * })\n *\n * const peerId = peerIdFromString('QmFoo')\n * const peerInfo = await node.peerRouting.findPeer(peerId)\n *\n * console.info(peerInfo) // peer id, multiaddrs\n * ```\n *\n * @example Connecting to the IPFS Amino DHT\n *\n * The [Amino DHT](https://blog.ipfs.tech/2023-09-amino-refactoring/) is a public-good DHT used by IPFS to fetch content, find peers, etc.\n *\n * If you are trying to access content on the public internet, this is the implementation you want.\n *\n * ```TypeScript\n * import { kadDHT, removePrivateAddressesMapper } from '@libp2p/kad-dht'\n * import { createLibp2p } from 'libp2p'\n * import { peerIdFromString } from '@libp2p/peer-id'\n *\n * const node = await createLibp2p({\n *   services: {\n *     aminoDHT: kadDHT({\n *       protocol: '/ipfs/kad/1.0.0',\n *       peerInfoMapper: removePrivateAddressesMapper\n *     })\n *   }\n * })\n *\n * const peerId = peerIdFromString('QmFoo')\n * const peerInfo = await node.peerRouting.findPeer(peerId)\n *\n * console.info(peerInfo) // peer id, multiaddrs\n * ```\n *\n * @example Connecting to a LAN-only DHT\n *\n * This DHT only works with privately dialable peers.\n *\n * This is for use when peers are on the local area network.\n *\n * ```TypeScript\n * import { kadDHT, removePublicAddressesMapper } from '@libp2p/kad-dht'\n * import { createLibp2p } from 'libp2p'\n * import { peerIdFromString } from '@libp2p/peer-id'\n *\n * const node = await createLibp2p({\n *   services: {\n *     lanDHT: kadDHT({\n *       protocol: '/ipfs/lan/kad/1.0.0',\n *       peerInfoMapper: removePublicAddressesMapper,\n *       clientMode: false\n *     })\n *   }\n * })\n *\n * const peerId = peerIdFromString('QmFoo')\n * const peerInfo = await node.peerRouting.findPeer(peerId)\n *\n * console.info(peerInfo) // peer id, multiaddrs\n * ```\n *\n * @example Connecting to both a LAN-only DHT and the IPFS Amino DHT\n *\n * When using multiple DHTs, you should specify distinct datastore, metrics and\n * log prefixes to ensure that data is kept separate for each instance.\n *\n * ```TypeScript\n * import { kadDHT, removePublicAddressesMapper, removePrivateAddressesMapper } from '@libp2p/kad-dht'\n * import { createLibp2p } from 'libp2p'\n * import { peerIdFromString } from '@libp2p/peer-id'\n *\n * const node = await createLibp2p({\n *   services: {\n *     lanDHT: kadDHT({\n *       protocol: '/ipfs/lan/kad/1.0.0',\n *       peerInfoMapper: removePublicAddressesMapper,\n *       clientMode: false,\n *       logPrefix: 'libp2p:dht-lan',\n *       datastorePrefix: '/dht-lan',\n *       metricsPrefix: 'libp2p_dht_lan'\n *     }),\n *     aminoDHT: kadDHT({\n *       protocol: '/ipfs/kad/1.0.0',\n *       peerInfoMapper: removePrivateAddressesMapper,\n *       logPrefix: 'libp2p:dht-amino',\n *       datastorePrefix: '/dht-amino',\n *       metricsPrefix: 'libp2p_dht_amino'\n *     })\n *   }\n * })\n *\n * const peerId = peerIdFromString('QmFoo')\n * const peerInfo = await node.peerRouting.findPeer(peerId)\n *\n * console.info(peerInfo) // peer id, multiaddrs\n * ```\n */\n\nimport { KadDHT as KadDHTClass } from './kad-dht.js'\nimport { MessageType } from './message/dht.js'\nimport { removePrivateAddressesMapper, removePublicAddressesMapper, passthroughMapper } from './utils.js'\nimport type { Libp2pEvents, ComponentLogger, TypedEventTarget, Metrics, PeerId, PeerInfo, PeerStore, RoutingOptions, PrivateKey } from '@libp2p/interface'\nimport type { AddressManager, ConnectionManager, Registrar } from '@libp2p/interface-internal'\nimport type { AdaptiveTimeoutInit } from '@libp2p/utils/src/adaptive-timeout.js'\nimport type { Datastore } from 'interface-datastore'\nimport type { CID } from 'multiformats/cid'\nimport type { ProgressEvent } from 'progress-events'\n\nexport { Libp2pRecord as Record } from '@libp2p/record'\nexport { removePrivateAddressesMapper, removePublicAddressesMapper, passthroughMapper }\n\n/**\n * The types of events emitted during DHT queries\n */\nexport enum EventTypes {\n  SEND_QUERY = 0,\n  PEER_RESPONSE,\n  FINAL_PEER,\n  QUERY_ERROR,\n  PROVIDER,\n  VALUE,\n  ADD_PEER,\n  DIAL_PEER\n}\n\n/**\n * The types of messages sent to peers during DHT queries\n */\nexport { MessageType }\n\nexport type MessageName = keyof typeof MessageType\n\nexport interface DHTRecord {\n  key: Uint8Array\n  value: Uint8Array\n  timeReceived?: Date\n}\n\nexport type DHTProgressEvents =\n  ProgressEvent<'kad-dht:query:send-query', SendQueryEvent> |\n  ProgressEvent<'kad-dht:query:peer-response', PeerResponseEvent> |\n  ProgressEvent<'kad-dht:query:final-peer', FinalPeerEvent> |\n  ProgressEvent<'kad-dht:query:query-error', QueryErrorEvent> |\n  ProgressEvent<'kad-dht:query:provider', ProviderEvent> |\n  ProgressEvent<'kad-dht:query:value', ValueEvent> |\n  ProgressEvent<'kad-dht:query:add-peer', AddPeerEvent> |\n  ProgressEvent<'kad-dht:query:dial-peer', DialPeerEvent>\n\n/**\n * Emitted when sending queries to remote peers\n */\nexport interface SendQueryEvent {\n  to: PeerId\n  type: EventTypes.SEND_QUERY\n  name: 'SEND_QUERY'\n  messageName: keyof typeof MessageType\n  messageType: MessageType\n}\n\n/**\n * Emitted when query responses are received form remote peers.  Depending on the query\n * these events may be followed by a `FinalPeerEvent`, a `ValueEvent` or a `ProviderEvent`.\n */\nexport interface PeerResponseEvent {\n  from: PeerId\n  type: EventTypes.PEER_RESPONSE\n  name: 'PEER_RESPONSE'\n  messageName: keyof typeof MessageType\n  messageType: MessageType\n  closer: PeerInfo[]\n  providers: PeerInfo[]\n  record?: DHTRecord\n}\n\n/**\n * Emitted at the end of a `findPeer` query\n */\nexport interface FinalPeerEvent {\n  from: PeerId\n  peer: PeerInfo\n  type: EventTypes.FINAL_PEER\n  name: 'FINAL_PEER'\n}\n\n/**\n * Something went wrong with the query\n */\nexport interface QueryErrorEvent {\n  from: PeerId\n  type: EventTypes.QUERY_ERROR\n  name: 'QUERY_ERROR'\n  error: Error\n}\n\n/**\n * Emitted when providers are found\n */\nexport interface ProviderEvent {\n  from: PeerId\n  type: EventTypes.PROVIDER\n  name: 'PROVIDER'\n  providers: PeerInfo[]\n}\n\n/**\n * Emitted when values are found\n */\nexport interface ValueEvent {\n  from: PeerId\n  type: EventTypes.VALUE\n  name: 'VALUE'\n  value: Uint8Array\n}\n\n/**\n * Emitted when peers are added to a query\n */\nexport interface AddPeerEvent {\n  type: EventTypes.ADD_PEER\n  name: 'ADD_PEER'\n  peer: PeerId\n}\n\n/**\n * Emitted when peers are dialled as part of a query\n */\nexport interface DialPeerEvent {\n  peer: PeerId\n  type: EventTypes.DIAL_PEER\n  name: 'DIAL_PEER'\n}\n\nexport type QueryEvent = SendQueryEvent | PeerResponseEvent | FinalPeerEvent | QueryErrorEvent | ProviderEvent | ValueEvent | AddPeerEvent | DialPeerEvent\n\nexport interface RoutingTable {\n  size: number\n}\n\nexport interface PeerInfoMapper {\n  (peer: PeerInfo): PeerInfo\n}\n\nexport interface KadDHT {\n  /**\n   * Get a value from the DHT, the final ValueEvent will be the best value\n   */\n  get(key: Uint8Array, options?: RoutingOptions): AsyncIterable<QueryEvent>\n\n  /**\n   * Find providers of a given CID\n   */\n  findProviders(key: CID, options?: RoutingOptions): AsyncIterable<QueryEvent>\n\n  /**\n   * Find a peer on the DHT\n   */\n  findPeer(id: PeerId, options?: RoutingOptions): AsyncIterable<QueryEvent>\n\n  /**\n   * Find the closest peers to the passed key\n   */\n  getClosestPeers(key: Uint8Array, options?: RoutingOptions): AsyncIterable<QueryEvent>\n\n  /**\n   * Store provider records for the passed CID on the DHT pointing to us\n   */\n  provide(key: CID, options?: RoutingOptions): AsyncIterable<QueryEvent>\n\n  /**\n   * Provider records must be re-published every 24 hours - pass a previously\n   * provided CID here to not re-publish a record for it any more\n   */\n  cancelReprovide(key: CID): Promise<void>\n\n  /**\n   * Store the passed value under the passed key on the DHT\n   */\n  put(key: Uint8Array, value: Uint8Array, options?: RoutingOptions): AsyncIterable<QueryEvent>\n\n  /**\n   * Returns the mode this node is in\n   */\n  getMode(): 'client' | 'server'\n\n  /**\n   * If 'server' this node will respond to DHT queries, if 'client' this node\n   * will not.\n   */\n  setMode(mode: 'client' | 'server'): Promise<void>\n\n  /**\n   * Force a routing table refresh\n   */\n  refreshRoutingTable(): Promise<void>\n}\n\nexport interface SingleKadDHT extends KadDHT {\n  routingTable: RoutingTable\n}\n\n/**\n * A selector function takes a DHT key and a list of records and returns the\n * index of the best record in the list\n */\nexport interface SelectFn { (key: Uint8Array, records: Uint8Array[]): number }\n\n/**\n * A validator function takes a DHT key and the value of the record for that key\n * and throws if the record is invalid\n */\nexport interface ValidateFn { (key: Uint8Array, value: Uint8Array): Promise<void> }\n\n/**\n * Selectors are a map of key prefixes to selector functions\n */\nexport type Selectors = Record<string, SelectFn>\n\n/**\n * Validators are a map of key prefixes to validator functions\n */\nexport type Validators = Record<string, ValidateFn>\n\nexport interface ProvidersInit {\n  /**\n   * @default 256\n   */\n  cacheSize?: number\n  /**\n   * How often invalid records are cleaned in seconds\n   *\n   * @default 5_400\n   */\n  cleanupInterval?: number\n  /**\n   * How long is a provider valid for in seconds\n   *\n   * @default 86_400\n   */\n  provideValidity?: number\n}\n\nexport interface ReProvideInit {\n  /**\n   * How many re-provide operations to run simultaneously\n   *\n   * @default 10\n   */\n  concurrency?: number\n\n  /**\n   * How long to let the re-provide queue grow\n   *\n   * @default 16_384\n   */\n  maxQueueSize?: number\n\n  /**\n   * How long before the record expiry to re-provide in ms\n   *\n   * @default 86_400_000 (24 hours)\n   */\n  threshold?: number\n\n  /**\n   * How often to check which records need re-providing in ms\n   *\n   * @default 3_600_000 (1 hour)\n   */\n  interval?: number\n\n  /**\n   * How long provider records are valid for in ms\n   *\n   * @default 172_800_000 (48 hours)\n   */\n  validity?: number\n}\n\nexport interface KadDHTInit {\n  /**\n   * How many peers to store in each kBucket. Once there are more than this\n   * number of peers for a given prefix in a kBucket, the node will start to\n   * ping existing peers to see if they are still online - if they are offline\n   * they will be evicted and the new peer added.\n   *\n   * @default 20\n   */\n  kBucketSize?: number\n\n  /**\n   * The threshold at which a kBucket will be split into two smaller kBuckets.\n   *\n   * KBuckets will not be split once the maximum trie depth is reached\n   * (controlled by the `prefixLength` option) so one can replicate go-libp2p's\n   * accelerated DHT client by (for example) setting `kBucketSize` to `Infinity`\n   * and `kBucketSplitThreshold` to 20.\n   *\n   * @default kBucketSize\n   */\n  kBucketSplitThreshold?: number\n\n  /**\n   * How many bits of the KAD-ID of peers to use when creating the routing\n   * table.\n   *\n   * The routing table is a binary trie with peers stored in the leaf nodes. The\n   * larger this number gets, the taller the trie can grow and the more peers\n   * can be stored.\n   *\n   * Storing more peers means fewer lookups (and network operations) are needed\n   * to locate a certain peer, but also that more memory is consumed.\n   *\n   * @default 32\n   */\n  prefixLength?: number\n\n  /**\n   * If true, only ever be a DHT client. If false, be a DHT client until told\n   * to be a DHT server via `setMode`.\n   *\n   * @default false\n   */\n  clientMode?: boolean\n\n  /**\n   * Record selectors\n   */\n  selectors?: Selectors\n\n  /**\n   * Record validators\n   */\n  validators?: Validators\n\n  /**\n   * How often to query our own PeerId in order to ensure we have a\n   * good view on the KAD address space local to our PeerId\n   */\n  querySelfInterval?: number\n\n  /**\n   * During startup we run the self-query at a shorter interval to ensure\n   * the containing node can respond to queries quickly. Set this interval\n   * here in ms.\n   *\n   * @default 1000\n   */\n  initialQuerySelfInterval?: number\n\n  /**\n   * After startup by default all queries will be paused until the initial\n   * self-query has run and there are some peers in the routing table.\n   *\n   * Pass true here to disable this behaviour.\n   *\n   * @default false\n   */\n  allowQueryWithZeroPeers?: boolean\n\n  /**\n   * The network protocol to use\n   *\n   * @default \"/ipfs/kad/1.0.0\"\n   */\n  protocol?: string\n\n  /**\n   * The logging prefix to use\n   *\n   * @default \"libp2p:kad-dht\"\n   */\n  logPrefix?: string\n\n  /**\n   * The datastore prefix to use\n   *\n   * @default \"/dht\"\n   */\n  datastorePrefix?: string\n\n  /**\n   * The metrics prefix to use\n   *\n   * @default \"libp2p_kad_dht\"\n   */\n  metricsPrefix?: string\n\n  /**\n   * Settings for how long to wait in ms when pinging DHT peers to decide if\n   * they should be evicted from the routing table or not.\n   */\n  pingOldContactTimeout?: Omit<AdaptiveTimeoutInit, 'metricsName' | 'metrics'>\n\n  /**\n   * How many peers to ping in parallel when deciding if they should\n   * be evicted from the routing table or not\n   *\n   * @default 10\n   */\n  pingOldContactConcurrency?: number\n\n  /**\n   * How long the queue to ping peers is allowed to grow\n   *\n   * @default 100\n   */\n  pingOldContactMaxQueueSize?: number\n\n  /**\n   * Settings for how long to wait in ms when pinging DHT peers to decide if\n   * they should be added to the routing table or not.\n   */\n  pingNewContactTimeout?: Omit<AdaptiveTimeoutInit, 'metricsName' | 'metrics'>\n\n  /**\n   * How many peers to ping in parallel when deciding if they should be added to\n   * the routing table or not\n   *\n   * @default 10\n   */\n  pingNewContactConcurrency?: number\n\n  /**\n   * How long the queue to ping peers is allowed to grow\n   *\n   * @default 100\n   */\n  pingNewContactMaxQueueSize?: number\n\n  /**\n   * How many parallel incoming streams to allow on the DHT protocol per\n   * connection\n   *\n   * @default 32\n   */\n  maxInboundStreams?: number\n\n  /**\n   * How many parallel outgoing streams to allow on the DHT protocol per\n   * connection\n   *\n   * @default 64\n   */\n  maxOutboundStreams?: number\n\n  /**\n   * Initialization options for the Providers component\n   */\n  providers?: ProvidersInit\n\n  /**\n   * Initialization options for the Reprovider component\n   */\n  reprovide?: ReProvideInit\n\n  /**\n   * For every incoming and outgoing PeerInfo, override address configuration\n   * with this filter.\n   */\n  peerInfoMapper?(peer: PeerInfo): PeerInfo\n\n  /**\n   * Dynamic network timeout settings for sending messages to peers\n   */\n  networkDialTimeout?: Omit<AdaptiveTimeoutInit, 'metricsName' | 'metrics'>\n}\n\nexport interface KadDHTComponents {\n  peerId: PeerId\n  privateKey: PrivateKey\n  registrar: Registrar\n  addressManager: AddressManager\n  peerStore: PeerStore\n  metrics?: Metrics\n  connectionManager: ConnectionManager\n  datastore: Datastore\n  events: TypedEventTarget<Libp2pEvents>\n  logger: ComponentLogger\n}\n\n/**\n * Creates a custom DHT implementation, please ensure you pass a `protocol`\n * string as an option.\n */\nexport function kadDHT (init: KadDHTInit = {}): (components: KadDHTComponents) => KadDHT {\n  return (components: KadDHTComponents) => new KadDHTClass(components, init)\n}\n", "/* eslint max-nested-callbacks: [\"error\", 5] */\n\nimport { pbkdf2, randomBytes } from '@libp2p/crypto'\nimport { privateKeyToProtobuf } from '@libp2p/crypto/keys'\nimport { InvalidParametersError, NotFoundError, serviceCapabilities } from '@libp2p/interface'\nimport { Key } from 'interface-datastore/key'\nimport mergeOptions from 'merge-options'\nimport { base58btc } from 'multiformats/bases/base58'\nimport { sha256 } from 'multiformats/hashes/sha2'\nimport sanitize from 'sanitize-filename'\nimport { fromString as uint8ArrayFromString } from 'uint8arrays/from-string'\nimport { toString as uint8ArrayToString } from 'uint8arrays/to-string'\nimport { exportPrivateKey } from './utils/export.js'\nimport { importPrivateKey } from './utils/import.js'\nimport type { KeychainComponents, KeychainInit, Keychain as KeychainInterface, KeyInfo } from './index.js'\nimport type { Logger, PrivateKey } from '@libp2p/interface'\n\nconst keyPrefix = '/pkcs8/'\nconst infoPrefix = '/info/'\nconst privates = new WeakMap<object, { dek: string }>()\n\n// NIST SP 800-132\nconst NIST = {\n  minKeyLength: 112 / 8,\n  minSaltLength: 128 / 8,\n  minIterationCount: 1000\n}\n\nconst defaultOptions = {\n  // See https://cryptosense.com/parametesr-choice-for-pbkdf2/\n  dek: {\n    keyLength: 512 / 8,\n    iterationCount: 10000,\n    salt: 'you should override this value with a crypto secure random number',\n    hash: 'sha2-512'\n  }\n}\n\nfunction validateKeyName (name: string): boolean {\n  if (name == null) {\n    return false\n  }\n  if (typeof name !== 'string') {\n    return false\n  }\n  return name === sanitize(name.trim()) && name.length > 0\n}\n\n/**\n * Throws an error after a delay\n *\n * This assumes than an error indicates that the keychain is under attack. Delay returning an\n * error to make brute force attacks harder.\n */\nasync function randomDelay (): Promise<void> {\n  const min = 200\n  const max = 1000\n  const delay = Math.random() * (max - min) + min\n\n  await new Promise(resolve => setTimeout(resolve, delay))\n}\n\n/**\n * Converts a key name into a datastore name\n */\nfunction DsName (name: string): Key {\n  return new Key(keyPrefix + name)\n}\n\n/**\n * Converts a key name into a datastore info name\n */\nfunction DsInfoName (name: string): Key {\n  return new Key(infoPrefix + name)\n}\n\nexport async function keyId (key: PrivateKey): Promise<string> {\n  const pb = privateKeyToProtobuf(key)\n  const hash = await sha256.digest(pb)\n\n  return base58btc.encode(hash.bytes).substring(1)\n}\n\n/**\n * Manages the lifecycle of a key. Keys are encrypted at rest using PKCS #8.\n *\n * A key in the store has two entries\n * - '/info/*key-name*', contains the KeyInfo for the key\n * - '/pkcs8/*key-name*', contains the PKCS #8 for the key\n *\n */\nexport class Keychain implements KeychainInterface {\n  private readonly components: KeychainComponents\n  private readonly init: KeychainInit\n  private readonly log: Logger\n\n  /**\n   * Creates a new instance of a key chain\n   */\n  constructor (components: KeychainComponents, init: KeychainInit) {\n    this.components = components\n    this.log = components.logger.forComponent('libp2p:keychain')\n    this.init = mergeOptions(defaultOptions, init)\n\n    // Enforce NIST SP 800-132\n    if (this.init.pass != null && this.init.pass?.length < 20) {\n      throw new Error('pass must be least 20 characters')\n    }\n    if (this.init.dek?.keyLength != null && this.init.dek.keyLength < NIST.minKeyLength) {\n      throw new Error(`dek.keyLength must be least ${NIST.minKeyLength} bytes`)\n    }\n    if (this.init.dek?.salt?.length != null && this.init.dek.salt.length < NIST.minSaltLength) {\n      throw new Error(`dek.saltLength must be least ${NIST.minSaltLength} bytes`)\n    }\n    if (this.init.dek?.iterationCount != null && this.init.dek.iterationCount < NIST.minIterationCount) {\n      throw new Error(`dek.iterationCount must be least ${NIST.minIterationCount}`)\n    }\n\n    const dek = this.init.pass != null && this.init.dek?.salt != null\n      ? pbkdf2(\n        this.init.pass,\n        this.init.dek?.salt,\n        this.init.dek?.iterationCount,\n        this.init.dek?.keyLength,\n        this.init.dek?.hash)\n      : ''\n\n    privates.set(this, { dek })\n  }\n\n  readonly [Symbol.toStringTag] = '@libp2p/keychain'\n\n  readonly [serviceCapabilities]: string[] = [\n    '@libp2p/keychain'\n  ]\n\n  /**\n   * Generates the options for a keychain.  A random salt is produced.\n   *\n   * @returns {object}\n   */\n  static generateOptions (): KeychainInit {\n    const options = Object.assign({}, defaultOptions)\n    const saltLength = Math.ceil(NIST.minSaltLength / 3) * 3 // no base64 padding\n    options.dek.salt = uint8ArrayToString(randomBytes(saltLength), 'base64')\n    return options\n  }\n\n  /**\n   * Gets an object that can encrypt/decrypt protected data.\n   * The default options for a keychain.\n   *\n   * @returns {object}\n   */\n  static get options (): typeof defaultOptions {\n    return defaultOptions\n  }\n\n  async findKeyByName (name: string): Promise<KeyInfo> {\n    if (!validateKeyName(name)) {\n      await randomDelay()\n      throw new InvalidParametersError(`Invalid key name '${name}'`)\n    }\n\n    const dsname = DsInfoName(name)\n\n    try {\n      const res = await this.components.datastore.get(dsname)\n      return JSON.parse(uint8ArrayToString(res))\n    } catch (err: any) {\n      await randomDelay()\n      this.log.error(err)\n      throw new NotFoundError(`Key '${name}' does not exist.`)\n    }\n  }\n\n  async findKeyById (id: string): Promise<KeyInfo> {\n    try {\n      const query = {\n        prefix: infoPrefix\n      }\n\n      for await (const value of this.components.datastore.query(query)) {\n        const key = JSON.parse(uint8ArrayToString(value.value))\n\n        if (key.id === id) {\n          return key\n        }\n      }\n\n      throw new InvalidParametersError(`Key with id '${id}' does not exist.`)\n    } catch (err: any) {\n      await randomDelay()\n      throw err\n    }\n  }\n\n  async importKey (name: string, key: PrivateKey): Promise<KeyInfo> {\n    if (!validateKeyName(name)) {\n      await randomDelay()\n      throw new InvalidParametersError(`Invalid key name '${name}'`)\n    }\n    if (key == null) {\n      await randomDelay()\n      throw new InvalidParametersError('Key is required')\n    }\n    const dsname = DsName(name)\n    const exists = await this.components.datastore.has(dsname)\n    if (exists) {\n      await randomDelay()\n      throw new InvalidParametersError(`Key '${name}' already exists`)\n    }\n\n    let kid: string\n    let pem: string\n    try {\n      kid = await keyId(key)\n      const cached = privates.get(this)\n\n      if (cached == null) {\n        throw new InvalidParametersError('dek missing')\n      }\n\n      const dek = cached.dek\n      pem = await exportPrivateKey(key, dek, key.type === 'RSA' ? 'pkcs-8' : 'libp2p-key')\n    } catch (err: any) {\n      await randomDelay()\n      throw err\n    }\n\n    const keyInfo = {\n      name,\n      id: kid\n    }\n    const batch = this.components.datastore.batch()\n    batch.put(dsname, uint8ArrayFromString(pem))\n    batch.put(DsInfoName(name), uint8ArrayFromString(JSON.stringify(keyInfo)))\n    await batch.commit()\n\n    return keyInfo\n  }\n\n  async exportKey (name: string): Promise<PrivateKey> {\n    if (!validateKeyName(name)) {\n      await randomDelay()\n      throw new InvalidParametersError(`Invalid key name '${name}'`)\n    }\n\n    const dsname = DsName(name)\n    try {\n      const res = await this.components.datastore.get(dsname)\n      const pem = uint8ArrayToString(res)\n      const cached = privates.get(this)\n\n      if (cached == null) {\n        throw new InvalidParametersError('dek missing')\n      }\n\n      const dek = cached.dek\n\n      return await importPrivateKey(pem, dek)\n    } catch (err: any) {\n      await randomDelay()\n      throw err\n    }\n  }\n\n  async removeKey (name: string): Promise<KeyInfo> {\n    if (!validateKeyName(name) || name === 'self') {\n      await randomDelay()\n      throw new InvalidParametersError(`Invalid key name '${name}'`)\n    }\n\n    const dsname = DsName(name)\n    const keyInfo = await this.findKeyByName(name)\n    const batch = this.components.datastore.batch()\n    batch.delete(dsname)\n    batch.delete(DsInfoName(name))\n    await batch.commit()\n\n    return keyInfo\n  }\n\n  /**\n   * List all the keys.\n   *\n   * @returns {Promise<KeyInfo[]>}\n   */\n  async listKeys (): Promise<KeyInfo[]> {\n    const query = {\n      prefix: infoPrefix\n    }\n\n    const info = []\n    for await (const value of this.components.datastore.query(query)) {\n      info.push(JSON.parse(uint8ArrayToString(value.value)))\n    }\n\n    return info\n  }\n\n  /**\n   * Rename a key\n   *\n   * @param {string} oldName - The old local key name; must already exist.\n   * @param {string} newName - The new local key name; must not already exist.\n   * @returns {Promise<KeyInfo>}\n   */\n  async renameKey (oldName: string, newName: string): Promise<KeyInfo> {\n    if (!validateKeyName(oldName) || oldName === 'self') {\n      await randomDelay()\n      throw new InvalidParametersError(`Invalid old key name '${oldName}'`)\n    }\n    if (!validateKeyName(newName) || newName === 'self') {\n      await randomDelay()\n      throw new InvalidParametersError(`Invalid new key name '${newName}'`)\n    }\n    const oldDsname = DsName(oldName)\n    const newDsname = DsName(newName)\n    const oldInfoName = DsInfoName(oldName)\n    const newInfoName = DsInfoName(newName)\n\n    const exists = await this.components.datastore.has(newDsname)\n    if (exists) {\n      await randomDelay()\n      throw new InvalidParametersError(`Key '${newName}' already exists`)\n    }\n\n    try {\n      const pem = await this.components.datastore.get(oldDsname)\n      const res = await this.components.datastore.get(oldInfoName)\n\n      const keyInfo = JSON.parse(uint8ArrayToString(res))\n      keyInfo.name = newName\n      const batch = this.components.datastore.batch()\n      batch.put(newDsname, pem)\n      batch.put(newInfoName, uint8ArrayFromString(JSON.stringify(keyInfo)))\n      batch.delete(oldDsname)\n      batch.delete(oldInfoName)\n      await batch.commit()\n      return keyInfo\n    } catch (err: any) {\n      await randomDelay()\n      throw err\n    }\n  }\n\n  /**\n   * Rotate keychain password and re-encrypt all associated keys\n   */\n  async rotateKeychainPass (oldPass: string, newPass: string): Promise<void> {\n    if (typeof oldPass !== 'string') {\n      await randomDelay()\n      throw new InvalidParametersError(`Invalid old pass type '${typeof oldPass}'`)\n    }\n    if (typeof newPass !== 'string') {\n      await randomDelay()\n      throw new InvalidParametersError(`Invalid new pass type '${typeof newPass}'`)\n    }\n    if (newPass.length < 20) {\n      await randomDelay()\n      throw new InvalidParametersError(`Invalid pass length ${newPass.length}`)\n    }\n    this.log('recreating keychain')\n    const cached = privates.get(this)\n\n    if (cached == null) {\n      throw new InvalidParametersError('dek missing')\n    }\n\n    const oldDek = cached.dek\n    this.init.pass = newPass\n    const newDek = newPass != null && this.init.dek?.salt != null\n      ? pbkdf2(\n        newPass,\n        this.init.dek.salt,\n        this.init.dek?.iterationCount,\n        this.init.dek?.keyLength,\n        this.init.dek?.hash)\n      : ''\n    privates.set(this, { dek: newDek })\n    const keys = await this.listKeys()\n    for (const key of keys) {\n      const res = await this.components.datastore.get(DsName(key.name))\n      const pem = uint8ArrayToString(res)\n      const privateKey = await importPrivateKey(pem, oldDek)\n      const password = newDek.toString()\n      const keyAsPEM = await exportPrivateKey(privateKey, password, privateKey.type === 'RSA' ? 'pkcs-8' : 'libp2p-key')\n\n      // Update stored key\n      const batch = this.components.datastore.batch()\n      const keyInfo = {\n        name: key.name,\n        id: key.id\n      }\n      batch.put(DsName(key.name), uint8ArrayFromString(keyAsPEM))\n      batch.put(DsInfoName(key.name), uint8ArrayFromString(JSON.stringify(keyInfo)))\n      await batch.commit()\n    }\n    this.log('keychain reconstructed')\n  }\n}\n", "import { concat } from 'uint8arrays/concat'\nimport { fromString } from 'uint8arrays/from-string'\nimport webcrypto from '../webcrypto/index.js'\nimport type { CreateOptions, AESCipher } from './interface.js'\n\n// WebKit on Linux does not support deriving a key from an empty PBKDF2 key.\n// So, as a workaround, we provide the generated key as a constant. We test that\n// this generated key is accurate in test/workaround.spec.ts\n// Generated via:\n// await crypto.subtle.exportKey('jwk',\n//   await crypto.subtle.deriveKey(\n//     { name: 'PBKDF2', salt: new Uint8Array(16), iterations: 32767, hash: { name: 'SHA-256' } },\n//     await crypto.subtle.importKey('raw', new Uint8Array(0), { name: 'PBKDF2' }, false, ['deriveKey']),\n//     { name: 'AES-GCM', length: 128 }, true, ['encrypt', 'decrypt'])\n// )\nexport const derivedEmptyPasswordKey = { alg: 'A128GCM', ext: true, k: 'scm9jmO_4BJAgdwWGVulLg', key_ops: ['encrypt', 'decrypt'], kty: 'oct' }\n\n// Based off of code from https://github.com/luke-park/SecureCompatibleEncryptionExamples\n\nexport function create (opts?: CreateOptions): AESCipher {\n  const algorithm = opts?.algorithm ?? 'AES-GCM'\n  let keyLength = opts?.keyLength ?? 16\n  const nonceLength = opts?.nonceLength ?? 12\n  const digest = opts?.digest ?? 'SHA-256'\n  const saltLength = opts?.saltLength ?? 16\n  const iterations = opts?.iterations ?? 32767\n\n  const crypto = webcrypto.get()\n  keyLength *= 8 // Browser crypto uses bits instead of bytes\n\n  /**\n   * Uses the provided password to derive a pbkdf2 key. The key\n   * will then be used to encrypt the data.\n   */\n  async function encrypt (data: Uint8Array, password: string | Uint8Array): Promise<Uint8Array> {\n    const salt = crypto.getRandomValues(new Uint8Array(saltLength))\n    const nonce = crypto.getRandomValues(new Uint8Array(nonceLength))\n    const aesGcm = { name: algorithm, iv: nonce }\n\n    if (typeof password === 'string') {\n      password = fromString(password)\n    }\n\n    let cryptoKey: CryptoKey\n    if (password.length === 0) {\n      cryptoKey = await crypto.subtle.importKey('jwk', derivedEmptyPasswordKey, { name: 'AES-GCM' }, true, ['encrypt'])\n      try {\n        const deriveParams = { name: 'PBKDF2', salt, iterations, hash: { name: digest } }\n        const runtimeDerivedEmptyPassword = await crypto.subtle.importKey('raw', password, { name: 'PBKDF2' }, false, ['deriveKey'])\n        cryptoKey = await crypto.subtle.deriveKey(deriveParams, runtimeDerivedEmptyPassword, { name: algorithm, length: keyLength }, true, ['encrypt'])\n      } catch {\n        cryptoKey = await crypto.subtle.importKey('jwk', derivedEmptyPasswordKey, { name: 'AES-GCM' }, true, ['encrypt'])\n      }\n    } else {\n      // Derive a key using PBKDF2.\n      const deriveParams = { name: 'PBKDF2', salt, iterations, hash: { name: digest } }\n      const rawKey = await crypto.subtle.importKey('raw', password, { name: 'PBKDF2' }, false, ['deriveKey'])\n      cryptoKey = await crypto.subtle.deriveKey(deriveParams, rawKey, { name: algorithm, length: keyLength }, true, ['encrypt'])\n    }\n\n    // Encrypt the string.\n    const ciphertext = await crypto.subtle.encrypt(aesGcm, cryptoKey, data)\n    return concat([salt, aesGcm.iv, new Uint8Array(ciphertext)])\n  }\n\n  /**\n   * Uses the provided password to derive a pbkdf2 key. The key\n   * will then be used to decrypt the data. The options used to create\n   * this decryption cipher must be the same as those used to create\n   * the encryption cipher.\n   */\n  async function decrypt (data: Uint8Array, password: string | Uint8Array): Promise<Uint8Array> {\n    const salt = data.subarray(0, saltLength)\n    const nonce = data.subarray(saltLength, saltLength + nonceLength)\n    const ciphertext = data.subarray(saltLength + nonceLength)\n    const aesGcm = { name: algorithm, iv: nonce }\n\n    if (typeof password === 'string') {\n      password = fromString(password)\n    }\n\n    let cryptoKey: CryptoKey\n    if (password.length === 0) {\n      try {\n        const deriveParams = { name: 'PBKDF2', salt, iterations, hash: { name: digest } }\n        const runtimeDerivedEmptyPassword = await crypto.subtle.importKey('raw', password, { name: 'PBKDF2' }, false, ['deriveKey'])\n        cryptoKey = await crypto.subtle.deriveKey(deriveParams, runtimeDerivedEmptyPassword, { name: algorithm, length: keyLength }, true, ['decrypt'])\n      } catch {\n        cryptoKey = await crypto.subtle.importKey('jwk', derivedEmptyPasswordKey, { name: 'AES-GCM' }, true, ['decrypt'])\n      }\n    } else {\n      // Derive the key using PBKDF2.\n      const deriveParams = { name: 'PBKDF2', salt, iterations, hash: { name: digest } }\n      const rawKey = await crypto.subtle.importKey('raw', password, { name: 'PBKDF2' }, false, ['deriveKey'])\n      cryptoKey = await crypto.subtle.deriveKey(deriveParams, rawKey, { name: algorithm, length: keyLength }, true, ['decrypt'])\n    }\n\n    // Decrypt the string.\n    const plaintext = await crypto.subtle.decrypt(aesGcm, cryptoKey, ciphertext)\n    return new Uint8Array(plaintext)\n  }\n\n  const cipher: AESCipher = {\n    encrypt,\n    decrypt\n  }\n\n  return cipher\n}\n", "export const SALT_LENGTH = 16\nexport const KEY_SIZE = 32\nexport const ITERATIONS = 10000\n", "import { randomBytes } from '@libp2p/crypto'\nimport { AES_GCM } from '@libp2p/crypto/ciphers'\nimport { privateKeyToProtobuf } from '@libp2p/crypto/keys'\nimport webcrypto from '@libp2p/crypto/webcrypto'\nimport { InvalidParametersError, UnsupportedKeyTypeError } from '@libp2p/interface'\nimport { pbkdf2Async } from '@noble/hashes/pbkdf2'\nimport { sha512 } from '@noble/hashes/sha512'\nimport * as asn1js from 'asn1js'\nimport { base64 } from 'multiformats/bases/base64'\nimport { toString as uint8ArrayToString } from 'uint8arrays/to-string'\nimport { ITERATIONS, KEY_SIZE, SALT_LENGTH } from './constants.js'\nimport type { Ed25519PrivateKey, PrivateKey, RSAPrivateKey, Secp256k1PrivateKey } from '@libp2p/interface'\nimport type { Multibase } from 'multiformats/bases/interface'\n\n/**\n * Exports the given PrivateKey as a base64 encoded string.\n * The PrivateKey is encrypted via a password derived PBKDF2 key\n * leveraging the aes-gcm cipher algorithm.\n */\nexport async function exporter (privateKey: Uint8Array, password: string): Promise<Multibase<'m'>> {\n  const cipher = AES_GCM.create()\n  const encryptedKey = await cipher.encrypt(privateKey, password)\n  return base64.encode(encryptedKey)\n}\n\nexport type ExportFormat = 'pkcs-8' | 'libp2p-key'\n\n/**\n * Converts an exported private key into its representative object.\n *\n * Supported formats are 'pem' (RSA only) and 'libp2p-key'.\n */\nexport async function exportPrivateKey (key: PrivateKey, password: string, format?: ExportFormat): Promise<Multibase<'m'>> {\n  if (key.type === 'RSA') {\n    return exportRSAPrivateKey(key, password, format)\n  }\n\n  if (key.type === 'Ed25519') {\n    return exportEd25519PrivateKey(key, password, format)\n  }\n\n  if (key.type === 'secp256k1') {\n    return exportSecp256k1PrivateKey(key, password, format)\n  }\n\n  throw new UnsupportedKeyTypeError()\n}\n\n/**\n * Exports the key into a password protected `format`\n */\nexport async function exportEd25519PrivateKey (key: Ed25519PrivateKey, password: string, format: ExportFormat = 'libp2p-key'): Promise<Multibase<'m'>> {\n  if (format === 'libp2p-key') {\n    return exporter(privateKeyToProtobuf(key), password)\n  } else {\n    throw new InvalidParametersError(`export format '${format}' is not supported`)\n  }\n}\n\n/**\n * Exports the key into a password protected `format`\n */\nexport async function exportSecp256k1PrivateKey (key: Secp256k1PrivateKey, password: string, format: ExportFormat = 'libp2p-key'): Promise<Multibase<'m'>> {\n  if (format === 'libp2p-key') {\n    return exporter(privateKeyToProtobuf(key), password)\n  } else {\n    throw new InvalidParametersError('Export format is not supported')\n  }\n}\n\n/**\n * Exports the key as libp2p-key - a aes-gcm encrypted value with the key\n * derived from the password.\n *\n * To export it as a password protected PEM file, please use the `exportPEM`\n * function from `@libp2p/rsa`.\n */\nexport async function exportRSAPrivateKey (key: RSAPrivateKey, password: string, format: ExportFormat = 'pkcs-8'): Promise<Multibase<'m'>> {\n  if (format === 'pkcs-8') {\n    return exportToPem(key, password)\n  } else if (format === 'libp2p-key') {\n    return exporter(privateKeyToProtobuf(key), password)\n  } else {\n    throw new InvalidParametersError('Export format is not supported')\n  }\n}\n\nexport async function exportToPem (privateKey: RSAPrivateKey, password: string): Promise<string> {\n  const crypto = webcrypto.get()\n\n  // PrivateKeyInfo\n  const keyWrapper = new asn1js.Sequence({\n    value: [\n      // version (0)\n      new asn1js.Integer({ value: 0 }),\n\n      // privateKeyAlgorithm\n      new asn1js.Sequence({\n        value: [\n        // rsaEncryption OID\n          new asn1js.ObjectIdentifier({\n            value: '1.2.840.113549.1.1.1'\n          }),\n          new asn1js.Null()\n        ]\n      }),\n\n      // PrivateKey\n      new asn1js.OctetString({\n        valueHex: privateKey.raw\n      })\n    ]\n  })\n\n  const keyBuf = keyWrapper.toBER()\n  const keyArr = new Uint8Array(keyBuf, 0, keyBuf.byteLength)\n  const salt = randomBytes(SALT_LENGTH)\n\n  const encryptionKey = await pbkdf2Async(\n    sha512,\n    password,\n    salt, {\n      c: ITERATIONS,\n      dkLen: KEY_SIZE\n    }\n  )\n\n  const iv = randomBytes(16)\n  const cryptoKey = await crypto.subtle.importKey('raw', encryptionKey, 'AES-CBC', false, ['encrypt'])\n  const encrypted = await crypto.subtle.encrypt({\n    name: 'AES-CBC',\n    iv\n  }, cryptoKey, keyArr)\n\n  const pbkdf2Params = new asn1js.Sequence({\n    value: [\n      // salt\n      new asn1js.OctetString({ valueHex: salt }),\n\n      // iteration count\n      new asn1js.Integer({ value: ITERATIONS }),\n\n      // key length\n      new asn1js.Integer({ value: KEY_SIZE }),\n\n      // AlgorithmIdentifier\n      new asn1js.Sequence({\n        value: [\n          // hmacWithSHA512\n          new asn1js.ObjectIdentifier({ value: '1.2.840.113549.2.11' }),\n          new asn1js.Null()\n        ]\n      })\n    ]\n  })\n\n  const encryptionAlgorithm = new asn1js.Sequence({\n    value: [\n      // pkcs5PBES2\n      new asn1js.ObjectIdentifier({\n        value: '1.2.840.113549.1.5.13'\n      }),\n      new asn1js.Sequence({\n        value: [\n          // keyDerivationFunc\n          new asn1js.Sequence({\n            value: [\n              // pkcs5PBKDF2\n              new asn1js.ObjectIdentifier({\n                value: '1.2.840.113549.1.5.12'\n              }),\n              // PBKDF2-params\n              pbkdf2Params\n            ]\n          }),\n\n          // encryptionScheme\n          new asn1js.Sequence({\n            value: [\n              // aes256-CBC\n              new asn1js.ObjectIdentifier({\n                value: '2.16.840.1.101.3.4.1.42'\n              }),\n              // iv\n              new asn1js.OctetString({\n                valueHex: iv\n              })\n            ]\n          })\n        ]\n      })\n    ]\n  })\n\n  const finalWrapper = new asn1js.Sequence({\n    value: [\n      encryptionAlgorithm,\n      new asn1js.OctetString({ valueHex: encrypted })\n    ]\n  })\n\n  const finalWrapperBuf = finalWrapper.toBER()\n  const finalWrapperArr = new Uint8Array(finalWrapperBuf, 0, finalWrapperBuf.byteLength)\n\n  return [\n    '-----BEGIN ENCRYPTED PRIVATE KEY-----',\n    ...uint8ArrayToString(finalWrapperArr, 'base64pad').split(/(.{64})/).filter(Boolean),\n    '-----END ENCRYPTED PRIVATE KEY-----'\n  ].join('\\n')\n}\n", "import { AES_GCM } from '@libp2p/crypto/ciphers'\nimport { privateKeyFromProtobuf, privateKeyFromRaw } from '@libp2p/crypto/keys'\nimport webcrypto from '@libp2p/crypto/webcrypto'\nimport { InvalidParametersError } from '@libp2p/interface'\nimport { pbkdf2Async } from '@noble/hashes/pbkdf2'\nimport { sha512 } from '@noble/hashes/sha512'\nimport * as asn1js from 'asn1js'\nimport { base64 } from 'multiformats/bases/base64'\nimport { fromString as uint8ArrayFromString } from 'uint8arrays/from-string'\nimport { ITERATIONS, KEY_SIZE } from './constants.js'\nimport type { PrivateKey, RSAPrivateKey } from '@libp2p/interface'\n\n/**\n * Converts an exported private key into its representative object.\n *\n * Supported formats are 'pem' (RSA only) and 'libp2p-key'.\n */\nexport async function importPrivateKey (encryptedKey: string, password: string): Promise<PrivateKey> {\n  try {\n    const key = await importer(encryptedKey, password)\n    return privateKeyFromProtobuf(key)\n  } catch {\n    // Ignore and try the old pem decrypt\n  }\n\n  if (!encryptedKey.includes('BEGIN')) {\n    throw new InvalidParametersError('Encrypted key was not a libp2p-key or a PEM file')\n  }\n\n  return importFromPem(encryptedKey, password)\n}\n\n/**\n * Attempts to decrypt a base64 encoded PrivateKey string\n * with the given password. The privateKey must have been exported\n * using the same password and underlying cipher (aes-gcm)\n */\nexport async function importer (privateKey: string, password: string): Promise<Uint8Array> {\n  const encryptedKey = base64.decode(privateKey)\n  const cipher = AES_GCM.create()\n  return cipher.decrypt(encryptedKey, password)\n}\n\nexport async function importFromPem (pem: string, password: string): Promise<RSAPrivateKey> {\n  const crypto = webcrypto.get()\n  let plaintext: Uint8Array\n\n  if (pem.includes('-----BEGIN ENCRYPTED PRIVATE KEY-----')) {\n    const key = uint8ArrayFromString(\n      pem\n        .replace('-----BEGIN ENCRYPTED PRIVATE KEY-----', '')\n        .replace('-----END ENCRYPTED PRIVATE KEY-----', '')\n        .replace(/\\n/g, '')\n        .trim(),\n      'base64pad'\n    )\n\n    const { result } = asn1js.fromBER(key)\n\n    const {\n      iv,\n      salt,\n      iterations,\n      keySize,\n      cipherText\n    } = findEncryptedPEMData(result)\n\n    const encryptionKey = await pbkdf2Async(\n      sha512,\n      password,\n      salt, {\n        c: iterations,\n        dkLen: keySize\n      }\n    )\n\n    const cryptoKey = await crypto.subtle.importKey('raw', encryptionKey, 'AES-CBC', false, ['decrypt'])\n    const decrypted = toUint8Array(await crypto.subtle.decrypt({\n      name: 'AES-CBC',\n      iv\n    }, cryptoKey, cipherText))\n\n    const { result: decryptedResult } = asn1js.fromBER(decrypted)\n    plaintext = findPEMData(decryptedResult)\n  } else if (pem.includes('-----BEGIN PRIVATE KEY-----')) {\n    const key = uint8ArrayFromString(\n      pem\n        .replace('-----BEGIN PRIVATE KEY-----', '')\n        .replace('-----END PRIVATE KEY-----', '')\n        .replace(/\\n/g, '')\n        .trim(),\n      'base64pad'\n    )\n\n    const { result } = asn1js.fromBER(key)\n\n    plaintext = findPEMData(result)\n  } else {\n    throw new InvalidParametersError('Could not parse private key from PEM data')\n  }\n\n  const key = privateKeyFromRaw(plaintext)\n\n  if (key.type !== 'RSA') {\n    throw new InvalidParametersError('Could not parse RSA private key from PEM data')\n  }\n\n  return key\n}\n\nfunction findEncryptedPEMData (root: any): { cipherText: Uint8Array, iv: Uint8Array, salt: Uint8Array, iterations: number, keySize: number } {\n  const encryptionAlgorithm = root.valueBlock.value[0]\n  const scheme = encryptionAlgorithm.valueBlock.value[0].toString()\n\n  if (scheme !== 'OBJECT IDENTIFIER : 1.2.840.113549.1.5.13') {\n    throw new InvalidParametersError('Only pkcs5PBES2 encrypted private keys are supported')\n  }\n\n  const keyDerivationFunc = encryptionAlgorithm.valueBlock.value[1].valueBlock.value[0]\n  const keyDerivationFuncName = keyDerivationFunc.valueBlock.value[0].toString()\n\n  if (keyDerivationFuncName !== 'OBJECT IDENTIFIER : 1.2.840.113549.1.5.12') {\n    throw new InvalidParametersError('Only pkcs5PBKDF2 key derivation functions are supported')\n  }\n\n  const pbkdf2Params = keyDerivationFunc.valueBlock.value[1]\n\n  const salt = toUint8Array(pbkdf2Params.valueBlock.value[0].getValue())\n\n  let iterations = ITERATIONS\n  let keySize = KEY_SIZE\n\n  if (pbkdf2Params.valueBlock.value.length === 3) {\n    iterations = Number((pbkdf2Params.valueBlock.value[1] as asn1js.Integer).toBigInt())\n    keySize = Number((pbkdf2Params.valueBlock.value[2]).toBigInt())\n  } else if (pbkdf2Params.valueBlock.value.length === 2) {\n    throw new InvalidParametersError('Could not derive key size and iterations from PEM file - please use @libp2p/rsa to re-import your key')\n  }\n\n  const encryptionScheme = encryptionAlgorithm.valueBlock.value[1].valueBlock.value[1]\n  const encryptionSchemeName = encryptionScheme.valueBlock.value[0].toString()\n\n  if (encryptionSchemeName === 'OBJECT IDENTIFIER : 1.2.840.113549.3.7') {\n    // des-EDE3-CBC\n  } else if (encryptionSchemeName === 'OBJECT IDENTIFIER : 1.3.14.3.2.7') {\n    // des-CBC\n  } else if (encryptionSchemeName === 'OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.2') {\n    // aes128-CBC\n  } else if (encryptionSchemeName === 'OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.22') {\n    // aes192-CBC\n  } else if (encryptionSchemeName === 'OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.42') {\n    // aes256-CBC\n  } else {\n    throw new InvalidParametersError('Only AES-CBC encryption schemes are supported')\n  }\n\n  const iv = toUint8Array(encryptionScheme.valueBlock.value[1].getValue())\n\n  return {\n    cipherText: toUint8Array(root.valueBlock.value[1].getValue()),\n    salt,\n    iterations,\n    keySize,\n    iv\n  }\n}\n\nfunction findPEMData (seq: any): Uint8Array {\n  return toUint8Array(seq.valueBlock.value[2].getValue())\n}\n\nfunction toUint8Array (buf: ArrayBuffer): Uint8Array {\n  return new Uint8Array(buf, 0, buf.byteLength)\n}\n", "/**\n * @packageDocumentation\n *\n * - Manages the lifecycle of a key\n * - Keys are encrypted at rest\n * - Enforces the use of safe key names\n * - Uses encrypted PKCS 8 for key storage\n * - Uses PBKDF2 for a \"stetched\" key encryption key\n * - Enforces NIST SP 800-131A and NIST SP 800-132\n * - Delays reporting errors to slow down brute force attacks\n *\n * ## KeyInfo\n *\n * The key management and naming service API all return a `KeyInfo` object.  The `id` is a universally unique identifier for the key.  The `name` is local to the key chain.\n *\n * ```JSON\n * {\n *   \"name\": \"rsa-key\",\n *   \"id\": \"QmYWYSUZ4PV6MRFYpdtEDJBiGs4UrmE6g8wmAWSePekXVW\"\n * }\n * ```\n *\n * The **key id** is the SHA-256 [multihash](https://github.com/multiformats/multihash) of its public key.\n *\n * The *public key* is a [protobuf encoding](https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/src/keys/keys.proto.js) containing a type and the [DER encoding](https://en.wikipedia.org/wiki/X.690) of the PKCS [SubjectPublicKeyInfo](https://www.ietf.org/rfc/rfc3279.txt).\n *\n * ## Private key storage\n *\n * A private key is stored as an encrypted PKCS 8 structure in the PEM format. It is protected by a key generated from the key chain's *passPhrase* using **PBKDF2**.\n *\n * The default options for generating the derived encryption key are in the `dek` object.  This, along with the passPhrase, is the input to a `PBKDF2` function.\n *\n * ```TypeScript\n * const defaultOptions = {\n *   // See https://cryptosense.com/parameter-choice-for-pbkdf2/\n *   dek: {\n *     keyLength: 512 / 8,\n *     iterationCount: 1000,\n *     salt: 'at least 16 characters long',\n *     hash: 'sha2-512'\n *   }\n * }\n * ```\n *\n * ![key storage](https://github.com/libp2p/js-libp2p/blob/main/doc/private-key.png?raw=true)\n *\n * ## Physical storage\n *\n * The actual physical storage of an encrypted key is left to implementations of [interface-datastore](https://github.com/ipfs/interface-datastore/).\n *\n * A key benefit is that now the key chain can be used in browser with the [js-datastore-level](https://github.com/ipfs/js-datastore-level) implementation.\n */\n\nimport { Keychain as KeychainClass } from './keychain.js'\nimport type { ComponentLogger, PrivateKey } from '@libp2p/interface'\nimport type { Datastore } from 'interface-datastore'\n\nexport interface DEKConfig {\n  hash: string\n  salt: string\n  iterationCount: number\n  keyLength: number\n}\n\nexport interface KeychainInit {\n  pass?: string\n  dek?: DEKConfig\n}\n\nexport interface KeychainComponents {\n  datastore: Datastore\n  logger: ComponentLogger\n}\n\nexport interface KeyInfo {\n  /**\n   * The universally unique key id\n   */\n  id: string\n\n  /**\n   * The local key name\n   */\n  name: string\n}\n\nexport interface Keychain {\n  /**\n   * Find a key by name\n   *\n   * @example\n   *\n   * ```TypeScript\n   * import { generateKeyPair } from '@libp2p/crypto/keys'\n   *\n   * const key = await generateKeyPair('Ed25519')\n   * const keyInfo = await libp2p.keychain.importKey('my-key', key)\n   * const keyInfo2 = await libp2p.keychain.findKeyByName(keyInfo.name)\n   * ```\n   */\n  findKeyByName(name: string): Promise<KeyInfo>\n\n  /**\n   * Find a key by id\n   *\n   * @example\n   *\n   * ```TypeScript\n   * import { generateKeyPair } from '@libp2p/crypto/keys'\n   *\n   * const key = await generateKeyPair('Ed25519')\n   * const keyInfo = await libp2p.keychain.importKey('my-key', key)\n   * const keyInfo2 = await libp2p.keychain.findKeyById(keyInfo.id)\n   * ```\n   */\n  findKeyById (id: string): Promise<KeyInfo>\n\n  /**\n   * Import a new private key.\n   *\n   * @example\n   *\n   * ```TypeScript\n   * import { generateKeyPair } from '@libp2p/crypto/keys'\n   *\n   * const key = await generateKeyPair('Ed25519')\n   * const keyInfo = await libp2p.keychain.importKey('my-key', key)\n   * ```\n   */\n  importKey(name: string, key: PrivateKey): Promise<KeyInfo>\n\n  /**\n   * Export an existing private key.\n   *\n   * @example\n   *\n   * ```TypeScript\n   * import { generateKeyPair } from '@libp2p/crypto/keys'\n   *\n   * const key = await generateKeyPair('Ed25519')\n   * const keyInfo = await libp2p.keychain.importKey('my-key', key)\n   * const key = await libp2p.keychain.exportKey(keyInfo.id)\n   * ```\n   */\n  exportKey(name: string): Promise<PrivateKey>\n\n  /**\n   * Removes a key from the keychain.\n   *\n   * @example\n   *\n   * ```TypeScript\n   * await libp2p.services.keychain.createKey('keyTest', 'RSA', 4096)\n   * const keyInfo = await libp2p.services.keychain.removeKey('keyTest')\n   * ```\n   */\n  removeKey(name: string): Promise<KeyInfo>\n\n  /**\n   * Rename a key in the keychain. This is done in a batch commit with rollback\n   * so errors thrown during the operation will not cause key loss.\n   *\n   * @example\n   *\n   * ```TypeScript\n   * await libp2p.services.keychain.createKey('keyTest', 'RSA', 4096)\n   * const keyInfo = await libp2p.services.keychain.renameKey('keyTest', 'keyNewNtest')\n   * ```\n   */\n  renameKey(oldName: string, newName: string): Promise<KeyInfo>\n\n  /**\n   * List all the keys.\n   *\n   * @example\n   *\n   * ```TypeScript\n   * const keyInfos = await libp2p.keychain.listKeys()\n   * ```\n   */\n  listKeys(): Promise<KeyInfo[]>\n\n  /**\n   * Rotate keychain password and re-encrypt all associated keys\n   *\n   * @example\n   *\n   * ```TypeScript\n   * await libp2p.services.keychain.rotateKeychainPass('oldPassword', 'newPassword')\n   * ```\n   */\n  rotateKeychainPass(oldPass: string, newPass: string): Promise<void>\n}\n\nexport function keychain (init: KeychainInit = {}): (components: KeychainComponents) => Keychain {\n  return (components: KeychainComponents) => {\n    return new KeychainClass(components, init)\n  }\n}\n", "import type { Uint8ArrayList } from 'uint8arraylist'\n\ntype INITIATOR_NAME = 'NEW_STREAM' | 'MESSAGE' | 'CLOSE' | 'RESET'\ntype RECEIVER_NAME = 'MESSAGE' | 'CLOSE' | 'RESET'\ntype NAME = 'NEW_STREAM' | 'MESSAGE_INITIATOR' | 'CLOSE_INITIATOR' | 'RESET_INITIATOR' | 'MESSAGE_RECEIVER' | 'CLOSE_RECEIVER' | 'RESET_RECEIVER'\ntype CODE = 0 | 1 | 2 | 3 | 4 | 5 | 6\n\nexport enum MessageTypes {\n  NEW_STREAM = 0,\n  MESSAGE_RECEIVER = 1,\n  MESSAGE_INITIATOR = 2,\n  CLOSE_RECEIVER = 3,\n  CLOSE_INITIATOR = 4,\n  RESET_RECEIVER = 5,\n  RESET_INITIATOR = 6\n}\n\nexport const MessageTypeNames: Record<CODE, NAME> = Object.freeze({\n  0: 'NEW_STREAM',\n  1: 'MESSAGE_RECEIVER',\n  2: 'MESSAGE_INITIATOR',\n  3: 'CLOSE_RECEIVER',\n  4: 'CLOSE_INITIATOR',\n  5: 'RESET_RECEIVER',\n  6: 'RESET_INITIATOR'\n})\n\nexport const InitiatorMessageTypes: Record<INITIATOR_NAME, CODE> = Object.freeze({\n  NEW_STREAM: MessageTypes.NEW_STREAM,\n  MESSAGE: MessageTypes.MESSAGE_INITIATOR,\n  CLOSE: MessageTypes.CLOSE_INITIATOR,\n  RESET: MessageTypes.RESET_INITIATOR\n})\n\nexport const ReceiverMessageTypes: Record<RECEIVER_NAME, CODE> = Object.freeze({\n  MESSAGE: MessageTypes.MESSAGE_RECEIVER,\n  CLOSE: MessageTypes.CLOSE_RECEIVER,\n  RESET: MessageTypes.RESET_RECEIVER\n})\n\nexport interface NewStreamMessage {\n  id: number\n  type: MessageTypes.NEW_STREAM\n  data: Uint8ArrayList\n}\n\nexport interface MessageReceiverMessage {\n  id: number\n  type: MessageTypes.MESSAGE_RECEIVER\n  data: Uint8ArrayList\n}\n\nexport interface MessageInitiatorMessage {\n  id: number\n  type: MessageTypes.MESSAGE_INITIATOR\n  data: Uint8ArrayList\n}\n\nexport interface CloseReceiverMessage {\n  id: number\n  type: MessageTypes.CLOSE_RECEIVER\n}\n\nexport interface CloseInitiatorMessage {\n  id: number\n  type: MessageTypes.CLOSE_INITIATOR\n}\n\nexport interface ResetReceiverMessage {\n  id: number\n  type: MessageTypes.RESET_RECEIVER\n}\n\nexport interface ResetInitiatorMessage {\n  id: number\n  type: MessageTypes.RESET_INITIATOR\n}\n\nexport type Message = NewStreamMessage | MessageReceiverMessage | MessageInitiatorMessage | CloseReceiverMessage | CloseInitiatorMessage | ResetReceiverMessage | ResetInitiatorMessage\n", "import { InvalidMessageError } from '@libp2p/interface'\nimport { Uint8ArrayList } from 'uint8arraylist'\nimport { MessageTypeNames, MessageTypes } from './message-types.js'\nimport type { Message } from './message-types.js'\n\nexport const MAX_MSG_SIZE = 1 << 20 // 1MB\nexport const MAX_MSG_QUEUE_SIZE = 4 << 20 // 4MB\n\ninterface MessageHeader {\n  id: number\n  type: keyof typeof MessageTypeNames\n  offset: number\n  length: number\n}\n\nexport class Decoder {\n  private readonly _buffer: Uint8ArrayList\n  private _headerInfo: MessageHeader | null\n  private readonly _maxMessageSize: number\n  private readonly _maxUnprocessedMessageQueueSize: number\n\n  constructor (maxMessageSize: number = MAX_MSG_SIZE, maxUnprocessedMessageQueueSize: number = MAX_MSG_QUEUE_SIZE) {\n    this._buffer = new Uint8ArrayList()\n    this._headerInfo = null\n    this._maxMessageSize = maxMessageSize\n    this._maxUnprocessedMessageQueueSize = maxUnprocessedMessageQueueSize\n  }\n\n  write (chunk: Uint8Array | Uint8ArrayList): Message[] {\n    if (chunk == null || chunk.length === 0) {\n      return []\n    }\n\n    this._buffer.append(chunk)\n\n    if (this._buffer.byteLength > this._maxUnprocessedMessageQueueSize) {\n      throw new InvalidMessageError('Unprocessed message queue size too large!')\n    }\n\n    const msgs: Message[] = []\n\n    while (this._buffer.length !== 0) {\n      if (this._headerInfo == null) {\n        try {\n          this._headerInfo = this._decodeHeader(this._buffer)\n        } catch (err: any) {\n          if (err.name === 'InvalidMessageError') {\n            throw err\n          }\n\n          break // We haven't received enough data yet\n        }\n      }\n\n      const { id, type, length, offset } = this._headerInfo\n      const bufferedDataLength = this._buffer.length - offset\n\n      if (bufferedDataLength < length) {\n        break // not enough data yet\n      }\n\n      const msg: any = {\n        id,\n        type\n      }\n\n      if (type === MessageTypes.NEW_STREAM || type === MessageTypes.MESSAGE_INITIATOR || type === MessageTypes.MESSAGE_RECEIVER) {\n        msg.data = this._buffer.sublist(offset, offset + length)\n      }\n\n      msgs.push(msg)\n\n      this._buffer.consume(offset + length)\n      this._headerInfo = null\n    }\n\n    return msgs\n  }\n\n  /**\n   * Attempts to decode the message header from the buffer\n   */\n  _decodeHeader (data: Uint8ArrayList): MessageHeader {\n    const {\n      value: h,\n      offset\n    } = readVarInt(data)\n    const {\n      value: length,\n      offset: end\n    } = readVarInt(data, offset)\n\n    const type = h & 7\n\n    // @ts-expect-error h is a number not a CODE\n    if (MessageTypeNames[type] == null) {\n      throw new Error(`Invalid type received: ${type}`)\n    }\n\n    // test message type varint + data length\n    if (length > this._maxMessageSize) {\n      throw new InvalidMessageError('Message size too large')\n    }\n\n    // @ts-expect-error h is a number not a CODE\n    return { id: h >> 3, type, offset: offset + end, length }\n  }\n}\n\nconst MSB = 0x80\nconst REST = 0x7F\n\nexport interface ReadVarIntResult {\n  value: number\n  offset: number\n}\n\nfunction readVarInt (buf: Uint8ArrayList, offset: number = 0): ReadVarIntResult {\n  let res = 0\n  let shift = 0\n  let counter = offset\n  let b: number\n  const l = buf.length\n\n  do {\n    if (counter >= l || shift > 49) {\n      offset = 0\n      throw new RangeError('Could not decode varint')\n    }\n    b = buf.get(counter++)\n    res += shift < 28\n      ? (b & REST) << shift\n      : (b & REST) * Math.pow(2, shift)\n    shift += 7\n  } while (b >= MSB)\n\n  offset = counter - offset\n\n  return {\n    value: res,\n    offset\n  }\n}\n", "import * as varint from 'uint8-varint'\nimport { Uint8ArrayList } from 'uint8arraylist'\nimport { allocUnsafe } from 'uint8arrays/alloc'\nimport { type Message, MessageTypes } from './message-types.js'\nimport type { Source } from 'it-stream-types'\n\nconst POOL_SIZE = 10 * 1024\n\nclass Encoder {\n  private _pool: Uint8Array\n  private _poolOffset: number\n\n  constructor () {\n    this._pool = allocUnsafe(POOL_SIZE)\n    this._poolOffset = 0\n  }\n\n  /**\n   * Encodes the given message and adds it to the passed list\n   */\n  write (msg: Message, list: Uint8ArrayList): void {\n    const pool = this._pool\n    let offset = this._poolOffset\n\n    varint.encode(msg.id << 3 | msg.type, pool, offset)\n    offset += varint.encodingLength(msg.id << 3 | msg.type)\n\n    if ((msg.type === MessageTypes.NEW_STREAM || msg.type === MessageTypes.MESSAGE_INITIATOR || msg.type === MessageTypes.MESSAGE_RECEIVER) && msg.data != null) {\n      varint.encode(msg.data.length, pool, offset)\n      offset += varint.encodingLength(msg.data.length)\n    } else {\n      varint.encode(0, pool, offset)\n      offset += varint.encodingLength(0)\n    }\n\n    const header = pool.subarray(this._poolOffset, offset)\n\n    if (POOL_SIZE - offset < 100) {\n      this._pool = allocUnsafe(POOL_SIZE)\n      this._poolOffset = 0\n    } else {\n      this._poolOffset = offset\n    }\n\n    list.append(header)\n\n    if ((msg.type === MessageTypes.NEW_STREAM || msg.type === MessageTypes.MESSAGE_INITIATOR || msg.type === MessageTypes.MESSAGE_RECEIVER) && msg.data != null) {\n      list.append(msg.data)\n    }\n  }\n}\n\nconst encoder = new Encoder()\n\n/**\n * Encode and yield one or more messages\n */\nexport async function * encode (source: Source<Message>): AsyncGenerator<Uint8Array | Uint8ArrayList, void, undefined> {\n  for await (const message of source) {\n    const list = new Uint8ArrayList()\n    encoder.write(message, list)\n    yield list\n  }\n}\n", "/**\n * There was an error in the stream input buffer\n */\nexport class StreamInputBufferError extends Error {\n  constructor (message = 'Stream input buffer error') {\n    super(message)\n    this.name = 'StreamInputBufferError'\n  }\n}\n", "import { AbstractStream, type AbstractStreamInit } from '@libp2p/utils/abstract-stream'\nimport { Uint8ArrayList } from 'uint8arraylist'\nimport { fromString as uint8ArrayFromString } from 'uint8arrays/from-string'\nimport { MAX_MSG_SIZE } from './decode.js'\nimport { InitiatorMessageTypes, ReceiverMessageTypes } from './message-types.js'\nimport type { Message } from './message-types.js'\nimport type { ComponentLogger } from '@libp2p/interface'\n\nexport interface Options {\n  id: number\n  send(msg: Message): Promise<void>\n  name?: string\n  onEnd?(err?: Error): void\n  type?: 'initiator' | 'receiver'\n  maxMsgSize?: number\n  logger: ComponentLogger\n}\n\ninterface MplexStreamInit extends AbstractStreamInit {\n  streamId: number\n  name: string\n  send(msg: Message): Promise<void>\n\n  /**\n   * The maximum allowable data size, any data larger than this will be\n   * chunked and sent in multiple data messages\n   */\n  maxDataSize: number\n}\n\nexport class MplexStream extends AbstractStream {\n  private readonly name: string\n  private readonly streamId: number\n  private readonly send: (msg: Message) => Promise<void>\n  private readonly types: Record<string, number>\n  private readonly maxDataSize: number\n\n  constructor (init: MplexStreamInit) {\n    super(init)\n\n    this.types = init.direction === 'outbound' ? InitiatorMessageTypes : ReceiverMessageTypes\n    this.send = init.send\n    this.name = init.name\n    this.streamId = init.streamId\n    this.maxDataSize = init.maxDataSize\n  }\n\n  async sendNewStream (): Promise<void> {\n    await this.send({ id: this.streamId, type: InitiatorMessageTypes.NEW_STREAM, data: new Uint8ArrayList(uint8ArrayFromString(this.name)) })\n  }\n\n  async sendData (data: Uint8ArrayList): Promise<void> {\n    data = data.sublist()\n\n    while (data.byteLength > 0) {\n      const toSend = Math.min(data.byteLength, this.maxDataSize)\n      await this.send({\n        id: this.streamId,\n        type: this.types.MESSAGE,\n        data: data.sublist(0, toSend)\n      })\n\n      data.consume(toSend)\n    }\n  }\n\n  async sendReset (): Promise<void> {\n    await this.send({ id: this.streamId, type: this.types.RESET })\n  }\n\n  async sendCloseWrite (): Promise<void> {\n    await this.send({ id: this.streamId, type: this.types.CLOSE })\n  }\n\n  async sendCloseRead (): Promise<void> {\n    // mplex does not support close read, only close write\n  }\n}\n\nexport function createStream (options: Options): MplexStream {\n  const { id, name, send, onEnd, type = 'initiator', maxMsgSize = MAX_MSG_SIZE } = options\n\n  return new MplexStream({\n    id: type === 'initiator' ? (`i${id}`) : `r${id}`,\n    streamId: id,\n    name: `${name ?? id}`,\n    direction: type === 'initiator' ? 'outbound' : 'inbound',\n    maxDataSize: maxMsgSize,\n    onEnd,\n    send,\n    log: options.logger.forComponent(`libp2p:mplex:stream:${type}:${id}`)\n  })\n}\n", "import { TooManyOutboundProtocolStreamsError, MuxerClosedError } from '@libp2p/interface'\nimport { closeSource } from '@libp2p/utils/close-source'\nimport { RateLimiter } from '@libp2p/utils/rate-limiter'\nimport { pipe } from 'it-pipe'\nimport { type Pushable, pushable } from 'it-pushable'\nimport { toString as uint8ArrayToString } from 'uint8arrays'\nimport { Decoder } from './decode.js'\nimport { encode } from './encode.js'\nimport { StreamInputBufferError } from './errors.js'\nimport { MessageTypes, MessageTypeNames, type Message } from './message-types.js'\nimport { createStream, type MplexStream } from './stream.js'\nimport type { MplexInit } from './index.js'\nimport type { AbortOptions, ComponentLogger, Logger, Stream, StreamMuxer, StreamMuxerInit } from '@libp2p/interface'\nimport type { Sink, Source } from 'it-stream-types'\nimport type { Uint8ArrayList } from 'uint8arraylist'\n\nconst MAX_STREAMS_INBOUND_STREAMS_PER_CONNECTION = 1024\nconst MAX_STREAMS_OUTBOUND_STREAMS_PER_CONNECTION = 1024\nconst MAX_STREAM_BUFFER_SIZE = 1024 * 1024 * 4 // 4MB\nconst DISCONNECT_THRESHOLD = 5\nconst CLOSE_TIMEOUT = 500\n\nfunction printMessage (msg: Message): any {\n  const output: any = {\n    ...msg,\n    type: `${MessageTypeNames[msg.type]} (${msg.type})`\n  }\n\n  if (msg.type === MessageTypes.NEW_STREAM) {\n    output.data = uint8ArrayToString(msg.data instanceof Uint8Array ? msg.data : msg.data.subarray())\n  }\n\n  if (msg.type === MessageTypes.MESSAGE_INITIATOR || msg.type === MessageTypes.MESSAGE_RECEIVER) {\n    output.data = uint8ArrayToString(msg.data instanceof Uint8Array ? msg.data : msg.data.subarray(), 'base16')\n  }\n\n  return output\n}\n\nexport interface MplexComponents {\n  logger: ComponentLogger\n}\n\ninterface MplexStreamMuxerInit extends MplexInit, StreamMuxerInit {\n  /**\n   * The default timeout to use in ms when shutting down the muxer.\n   */\n  closeTimeout?: number\n}\n\nexport class MplexStreamMuxer implements StreamMuxer {\n  public protocol = '/mplex/6.7.0'\n\n  public sink: Sink<Source<Uint8ArrayList | Uint8Array>, Promise<void>>\n  public source: AsyncGenerator<Uint8ArrayList | Uint8Array>\n\n  private readonly log: Logger\n  private _streamId: number\n  private readonly _streams: { initiators: Map<number, MplexStream>, receivers: Map<number, MplexStream> }\n  private readonly _init: MplexStreamMuxerInit\n  private readonly _source: Pushable<Message>\n  private readonly closeController: AbortController\n  private readonly rateLimiter: RateLimiter\n  private readonly closeTimeout: number\n  private readonly logger: ComponentLogger\n\n  constructor (components: MplexComponents, init?: MplexStreamMuxerInit) {\n    init = init ?? {}\n\n    this.log = components.logger.forComponent('libp2p:mplex')\n    this.logger = components.logger\n    this._streamId = 0\n    this._streams = {\n      /**\n       * Stream to ids map\n       */\n      initiators: new Map<number, MplexStream>(),\n      /**\n       * Stream to ids map\n       */\n      receivers: new Map<number, MplexStream>()\n    }\n    this._init = init\n    this.closeTimeout = init.closeTimeout ?? CLOSE_TIMEOUT\n\n    /**\n     * An iterable sink\n     */\n    this.sink = this._createSink()\n\n    /**\n     * An iterable source\n     */\n    this._source = pushable<Message>({\n      objectMode: true,\n      onEnd: (): void => {\n        // the source has ended, we can't write any more messages to gracefully\n        // close streams so all we can do is destroy them\n        for (const stream of this._streams.initiators.values()) {\n          stream.destroy()\n        }\n\n        for (const stream of this._streams.receivers.values()) {\n          stream.destroy()\n        }\n      }\n    })\n    this.source = pipe(\n      this._source,\n      source => encode(source)\n    )\n\n    /**\n     * Close controller\n     */\n    this.closeController = new AbortController()\n\n    this.rateLimiter = new RateLimiter({\n      points: init.disconnectThreshold ?? DISCONNECT_THRESHOLD,\n      duration: 1\n    })\n  }\n\n  /**\n   * Returns a Map of streams and their ids\n   */\n  get streams (): Stream[] {\n    // Inbound and Outbound streams may have the same ids, so we need to make those unique\n    const streams: Stream[] = []\n    for (const stream of this._streams.initiators.values()) {\n      streams.push(stream)\n    }\n\n    for (const stream of this._streams.receivers.values()) {\n      streams.push(stream)\n    }\n    return streams\n  }\n\n  /**\n   * Initiate a new stream with the given name. If no name is\n   * provided, the id of the stream will be used.\n   */\n  newStream (name?: string): Stream {\n    if (this.closeController.signal.aborted) {\n      throw new MuxerClosedError('Muxer already closed')\n    }\n    const id = this._streamId++\n    name = name == null ? id.toString() : name.toString()\n    const registry = this._streams.initiators\n    return this._newStream({ id, name, type: 'initiator', registry })\n  }\n\n  /**\n   * Close or abort all tracked streams and stop the muxer\n   */\n  async close (options?: AbortOptions): Promise<void> {\n    if (this.closeController.signal.aborted) {\n      return\n    }\n\n    const signal = options?.signal ?? AbortSignal.timeout(this.closeTimeout)\n\n    try {\n      // try to gracefully close all streams\n      await Promise.all(\n        this.streams.map(async s => s.close({\n          signal\n        }))\n      )\n\n      this._source.end()\n\n      // try to gracefully close the muxer\n      await this._source.onEmpty({\n        signal\n      })\n\n      this.closeController.abort()\n    } catch (err: any) {\n      this.abort(err)\n    }\n  }\n\n  abort (err: Error): void {\n    if (this.closeController.signal.aborted) {\n      return\n    }\n\n    this.streams.forEach(s => { s.abort(err) })\n    this.closeController.abort(err)\n  }\n\n  /**\n   * Called whenever an inbound stream is created\n   */\n  _newReceiverStream (options: { id: number, name: string }): MplexStream {\n    const { id, name } = options\n    const registry = this._streams.receivers\n    return this._newStream({ id, name, type: 'receiver', registry })\n  }\n\n  _newStream (options: { id: number, name: string, type: 'initiator' | 'receiver', registry: Map<number, MplexStream> }): MplexStream {\n    const { id, name, type, registry } = options\n\n    this.log('new %s stream %s', type, id)\n\n    if (type === 'initiator' && this._streams.initiators.size === (this._init.maxOutboundStreams ?? MAX_STREAMS_OUTBOUND_STREAMS_PER_CONNECTION)) {\n      throw new TooManyOutboundProtocolStreamsError('Too many outbound streams open')\n    }\n\n    if (registry.has(id)) {\n      throw new Error(`${type} stream ${id} already exists!`)\n    }\n\n    const send = async (msg: Message): Promise<void> => {\n      if (this.log.enabled) {\n        this.log.trace('%s stream %s send', type, id, printMessage(msg))\n      }\n\n      this._source.push(msg)\n    }\n\n    const onEnd = (): void => {\n      this.log('%s stream with id %s and protocol %s ended', type, id, stream.protocol)\n      registry.delete(id)\n\n      if (this._init.onStreamEnd != null) {\n        this._init.onStreamEnd(stream)\n      }\n    }\n\n    const stream = createStream({ id, name, send, type, onEnd, maxMsgSize: this._init.maxMsgSize, logger: this.logger })\n    registry.set(id, stream)\n    return stream\n  }\n\n  /**\n   * Creates a sink with an abortable source. Incoming messages will\n   * also have their size restricted. All messages will be varint decoded.\n   */\n  _createSink (): Sink<Source<Uint8ArrayList | Uint8Array>, Promise<void>> {\n    const sink: Sink<Source<Uint8ArrayList | Uint8Array>, Promise<void>> = async source => {\n      const abortListener = (): void => {\n        closeSource(source, this.log)\n      }\n\n      this.closeController.signal.addEventListener('abort', abortListener)\n\n      try {\n        const decoder = new Decoder(this._init.maxMsgSize, this._init.maxUnprocessedMessageQueueSize)\n\n        for await (const chunk of source) {\n          for (const msg of decoder.write(chunk)) {\n            await this._handleIncoming(msg)\n          }\n        }\n\n        this._source.end()\n      } catch (err: any) {\n        this.log('error in sink', err)\n        this._source.end(err) // End the source with an error\n      } finally {\n        this.closeController.signal.removeEventListener('abort', abortListener)\n      }\n    }\n\n    return sink\n  }\n\n  async _handleIncoming (message: Message): Promise<void> {\n    const { id, type } = message\n\n    if (this.log.enabled) {\n      this.log.trace('incoming message', printMessage(message))\n    }\n\n    // Create a new stream?\n    if (message.type === MessageTypes.NEW_STREAM) {\n      if (this._streams.receivers.size === (this._init.maxInboundStreams ?? MAX_STREAMS_INBOUND_STREAMS_PER_CONNECTION)) {\n        this.log('too many inbound streams open')\n\n        // not going to allow this stream, send the reset message manually\n        // instead of setting it up just to tear it down\n        this._source.push({\n          id,\n          type: MessageTypes.RESET_RECEIVER\n        })\n\n        // if we've hit our stream limit, and the remote keeps trying to open\n        // more new streams, if they are doing this very quickly maybe they\n        // are attacking us and we should close the connection\n        try {\n          await this.rateLimiter.consume('new-stream', 1)\n        } catch {\n          this.log('rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection')\n          // since there's no backpressure in mplex, the only thing we can really do to protect ourselves is close the connection\n          this.abort(new Error('Too many open streams'))\n          return\n        }\n\n        return\n      }\n\n      const stream = this._newReceiverStream({ id, name: uint8ArrayToString(message.data instanceof Uint8Array ? message.data : message.data.subarray()) })\n\n      if (this._init.onIncomingStream != null) {\n        this._init.onIncomingStream(stream)\n      }\n\n      return\n    }\n\n    const list = (type & 1) === 1 ? this._streams.initiators : this._streams.receivers\n    const stream = list.get(id)\n\n    if (stream == null) {\n      this.log('missing stream %s for message type %s', id, MessageTypeNames[type])\n\n      // if the remote keeps sending us messages for streams that have been\n      // closed or were never opened they may be attacking us so if they do\n      // this very quickly all we can do is close the connection\n      try {\n        await this.rateLimiter.consume('missing-stream', 1)\n      } catch {\n        this.log('rate limit hit when receiving messages for streams that do not exist - closing remote connection')\n        // since there's no backpressure in mplex, the only thing we can really do to protect ourselves is close the connection\n        this.abort(new Error('Too many messages for missing streams'))\n        return\n      }\n\n      return\n    }\n\n    const maxBufferSize = this._init.maxStreamBufferSize ?? MAX_STREAM_BUFFER_SIZE\n\n    try {\n      switch (type) {\n        case MessageTypes.MESSAGE_INITIATOR:\n        case MessageTypes.MESSAGE_RECEIVER:\n          if (stream.sourceReadableLength() > maxBufferSize) {\n            // Stream buffer has got too large, reset the stream\n            this._source.push({\n              id: message.id,\n              type: type === MessageTypes.MESSAGE_INITIATOR ? MessageTypes.RESET_RECEIVER : MessageTypes.RESET_INITIATOR\n            })\n\n            // Inform the stream consumer they are not fast enough\n            throw new StreamInputBufferError('Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers')\n          }\n\n          // We got data from the remote, push it into our local stream\n          stream.sourcePush(message.data)\n          break\n        case MessageTypes.CLOSE_INITIATOR:\n        case MessageTypes.CLOSE_RECEIVER:\n          // The remote has stopped writing, so we can stop reading\n          stream.remoteCloseWrite()\n          break\n        case MessageTypes.RESET_INITIATOR:\n        case MessageTypes.RESET_RECEIVER:\n          // The remote has errored, stop reading and writing to the stream immediately\n          stream.reset()\n          break\n        default:\n          this.log('unknown message type %s', type)\n      }\n    } catch (err: any) {\n      this.log.error('error while processing message', err)\n      stream.abort(err)\n    }\n  }\n}\n", "/**\n * @packageDocumentation\n *\n * This is a [simple stream multiplexer(https://docs.libp2p.io/concepts/multiplex/mplex/) that has been deprecated.\n *\n * Please use [@chainsafe/libp2p-yamux](https://www.npmjs.com/package/@chainsafe/libp2p-yamux) instead.\n *\n * @example\n *\n * ```TypeScript\n * import { mplex } from '@libp2p/mplex'\n * import { pipe } from 'it-pipe'\n *\n * const factory = mplex()\n *\n * const muxer = factory.createStreamMuxer(components, {\n *   onStream: stream => { // Receive a duplex stream from the remote\n *     // ...receive data from the remote and optionally send data back\n *   },\n *   onStreamEnd: stream => {\n *     // ...handle any tracking you may need of stream closures\n *   }\n * })\n *\n * pipe(conn, muxer, conn) // conn is duplex connection to another peer\n *\n * const stream = muxer.newStream() // Create a new duplex stream to the remote\n *\n * // Use the duplex stream to send some data to the remote...\n * pipe([1, 2, 3], stream)\n * ```\n */\n\nimport { serviceCapabilities } from '@libp2p/interface'\nimport { MplexStreamMuxer, type MplexComponents } from './mplex.js'\nimport type { StreamMuxer, StreamMuxerFactory, StreamMuxerInit } from '@libp2p/interface'\n\nexport type { MplexComponents }\n\nexport interface MplexInit {\n  /**\n   * The maximum size of message that can be sent in one go in bytes.\n   * Messages larger than this will be split into multiple smaller\n   * messages. If we receive a message larger than this an error will\n   * be thrown and the connection closed.\n   *\n   * @default 1048576\n   */\n  maxMsgSize?: number\n\n  /**\n   * Constrains the size of the unprocessed message queue buffer.\n   * Before messages are deserialized, the raw bytes are buffered to ensure\n   * we have the complete message to deserialized. If the queue gets longer\n   * than this value an error will be thrown and the connection closed.\n   *\n   * @default 4194304\n   */\n  maxUnprocessedMessageQueueSize?: number\n\n  /**\n   * The maximum number of multiplexed streams that can be open at any\n   * one time. A request to open more than this will have a stream\n   * reset message sent immediately as a response for the newly opened\n   * stream id\n   *\n   * @default 1024\n   */\n  maxInboundStreams?: number\n\n  /**\n   * The maximum number of multiplexed streams that can be open at any\n   * one time. An attempt to open more than this will throw\n   *\n   * @default 1024\n   */\n  maxOutboundStreams?: number\n\n  /**\n   * Incoming stream messages are buffered until processed by the stream\n   * handler. If the buffer reaches this size in bytes the stream will\n   * be reset\n   *\n   * @default 4194304\n   */\n  maxStreamBufferSize?: number\n\n  /**\n   * When `maxInboundStreams` is hit, if the remote continues try to open\n   * more than this many new multiplexed streams per second the connection\n   * will be closed\n   *\n   * @default 5\n   */\n  disconnectThreshold?: number\n}\n\nclass Mplex implements StreamMuxerFactory {\n  public protocol = '/mplex/6.7.0'\n  private readonly _init: MplexInit\n  private readonly components: MplexComponents\n\n  constructor (components: MplexComponents, init: MplexInit = {}) {\n    this.components = components\n    this._init = init\n  }\n\n  readonly [Symbol.toStringTag] = '@libp2p/mplex'\n\n  readonly [serviceCapabilities]: string[] = [\n    '@libp2p/stream-multiplexing'\n  ]\n\n  createStreamMuxer (init: StreamMuxerInit = {}): StreamMuxer {\n    return new MplexStreamMuxer(this.components, {\n      ...init,\n      ...this._init\n    })\n  }\n}\n\n/**\n * @deprecated mplex is deprecated as it has no flow control. Please use yamux instead.\n */\nexport function mplex (init: MplexInit = {}): (components: MplexComponents) => StreamMuxerFactory {\n  return (components) => new Mplex(components, init)\n}\n", "export const PING_PROTOCOL = '/ipfs/ping/1.0.0'\nexport const PING_LENGTH = 32\nexport const PROTOCOL_VERSION = '1.0.0'\nexport const PROTOCOL_NAME = 'ping'\nexport const PROTOCOL_PREFIX = 'ipfs'\nexport const TIMEOUT = 10000\n\n// See https://github.com/libp2p/specs/blob/d4b5fb0152a6bb86cfd9ea/ping/ping.md?plain=1#L38-L43\n// The dialing peer MUST NOT keep more than one outbound stream for the ping protocol per peer.\n// The listening peer SHOULD accept at most two streams per peer since cross-stream behavior is\n// non-linear and stream writes occur asynchronously. The listening peer may perceive the\n// dialing peer closing and opening the wrong streams (for instance, closing stream B and\n// opening stream A even though the dialing peer is opening stream B and closing stream A).\nexport const MAX_INBOUND_STREAMS = 2\nexport const MAX_OUTBOUND_STREAMS = 1\n", "import { randomBytes } from '@libp2p/crypto'\nimport { ProtocolError, TimeoutError, setMaxListeners } from '@libp2p/interface'\nimport { byteStream } from 'it-byte-stream'\nimport { equals as uint8ArrayEquals } from 'uint8arrays/equals'\nimport { PROTOCOL_PREFIX, PROTOCOL_NAME, PING_LENGTH, PROTOCOL_VERSION, TIMEOUT, MAX_INBOUND_STREAMS, MAX_OUTBOUND_STREAMS } from './constants.js'\nimport type { PingServiceComponents, PingServiceInit, PingService as PingServiceInterface } from './index.js'\nimport type { AbortOptions, Logger, Stream, PeerId, Startable } from '@libp2p/interface'\nimport type { IncomingStreamData } from '@libp2p/interface-internal'\nimport type { Multiaddr } from '@multiformats/multiaddr'\n\nexport class PingService implements Startable, PingServiceInterface {\n  public readonly protocol: string\n  private readonly components: PingServiceComponents\n  private started: boolean\n  private readonly timeout: number\n  private readonly maxInboundStreams: number\n  private readonly maxOutboundStreams: number\n  private readonly runOnLimitedConnection: boolean\n  private readonly log: Logger\n\n  constructor (components: PingServiceComponents, init: PingServiceInit = {}) {\n    this.components = components\n    this.log = components.logger.forComponent('libp2p:ping')\n    this.started = false\n    this.protocol = `/${init.protocolPrefix ?? PROTOCOL_PREFIX}/${PROTOCOL_NAME}/${PROTOCOL_VERSION}`\n    this.timeout = init.timeout ?? TIMEOUT\n    this.maxInboundStreams = init.maxInboundStreams ?? MAX_INBOUND_STREAMS\n    this.maxOutboundStreams = init.maxOutboundStreams ?? MAX_OUTBOUND_STREAMS\n    this.runOnLimitedConnection = init.runOnLimitedConnection ?? true\n\n    this.handleMessage = this.handleMessage.bind(this)\n  }\n\n  readonly [Symbol.toStringTag] = '@libp2p/ping'\n\n  async start (): Promise<void> {\n    await this.components.registrar.handle(this.protocol, this.handleMessage, {\n      maxInboundStreams: this.maxInboundStreams,\n      maxOutboundStreams: this.maxOutboundStreams,\n      runOnLimitedConnection: this.runOnLimitedConnection\n    })\n    this.started = true\n  }\n\n  async stop (): Promise<void> {\n    await this.components.registrar.unhandle(this.protocol)\n    this.started = false\n  }\n\n  isStarted (): boolean {\n    return this.started\n  }\n\n  /**\n   * A handler to register with Libp2p to process ping messages\n   */\n  handleMessage (data: IncomingStreamData): void {\n    this.log('incoming ping from %p', data.connection.remotePeer)\n\n    const { stream } = data\n    const start = Date.now()\n    const bytes = byteStream(stream)\n    let pinged = false\n\n    Promise.resolve().then(async () => {\n      while (true) {\n        const signal = AbortSignal.timeout(this.timeout)\n        setMaxListeners(Infinity, signal)\n        signal.addEventListener('abort', () => {\n          stream?.abort(new TimeoutError('ping timeout'))\n        })\n\n        const buf = await bytes.read(PING_LENGTH, {\n          signal\n        })\n        await bytes.write(buf, {\n          signal\n        })\n\n        pinged = true\n      }\n    })\n      .catch(err => {\n        // ignore the error if we've processed at least one ping, the remote\n        // closed the stream and we handled or are handling the close cleanly\n        if (pinged && err.name === 'UnexpectedEOFError' && stream.readStatus !== 'ready') {\n          return\n        }\n\n        this.log.error('incoming ping from %p failed with error - %e', data.connection.remotePeer, err)\n        stream?.abort(err)\n      })\n      .finally(() => {\n        const ms = Date.now() - start\n        this.log('incoming ping from %p complete in %dms', data.connection.remotePeer, ms)\n\n        const signal = AbortSignal.timeout(this.timeout)\n        setMaxListeners(Infinity, signal)\n\n        stream.close({\n          signal\n        })\n          .catch(err => {\n            this.log.error('error closing ping stream from %p - %e', data.connection.remotePeer, err)\n            stream?.abort(err)\n          })\n      })\n  }\n\n  /**\n   * Ping a given peer and wait for its response, getting the operation latency.\n   */\n  async ping (peer: PeerId | Multiaddr | Multiaddr[], options: AbortOptions = {}): Promise<number> {\n    this.log('pinging %p', peer)\n\n    const start = Date.now()\n    const data = randomBytes(PING_LENGTH)\n    const connection = await this.components.connectionManager.openConnection(peer, options)\n    let stream: Stream | undefined\n\n    if (options.signal == null) {\n      const signal = AbortSignal.timeout(this.timeout)\n\n      options = {\n        ...options,\n        signal\n      }\n    }\n\n    try {\n      stream = await connection.newStream(this.protocol, {\n        ...options,\n        runOnLimitedConnection: this.runOnLimitedConnection\n      })\n\n      const bytes = byteStream(stream)\n\n      const [, result] = await Promise.all([\n        bytes.write(data, options),\n        bytes.read(PING_LENGTH, options)\n      ])\n\n      const ms = Date.now() - start\n\n      if (!uint8ArrayEquals(data, result.subarray())) {\n        throw new ProtocolError(`Received wrong ping ack after ${ms}ms`)\n      }\n\n      this.log('ping %p complete in %dms', connection.remotePeer, ms)\n\n      return ms\n    } catch (err: any) {\n      this.log.error('error while pinging %p', connection.remotePeer, err)\n\n      stream?.abort(err)\n\n      throw err\n    } finally {\n      if (stream != null) {\n        await stream.close(options)\n      }\n    }\n  }\n}\n", "/**\n * @packageDocumentation\n *\n * The ping service implements the [libp2p ping spec](https://github.com/libp2p/specs/blob/master/ping/ping.md) allowing you to make a latency measurement to a remote peer.\n *\n * @example\n *\n * ```typescript\n * import { createLibp2p } from 'libp2p'\n * import { ping } from '@libp2p/ping'\n * import { multiaddr } from '@multiformats/multiaddr'\n *\n * const node = await createLibp2p({\n *   services: {\n *     ping: ping()\n *   }\n * })\n *\n * const rtt = await node.services.ping.ping(multiaddr('/ip4/...'))\n *\n * console.info(rtt)\n * ```\n */\n\nimport { PingService as PingServiceClass } from './ping.js'\nimport type { AbortOptions, ComponentLogger, PeerId } from '@libp2p/interface'\nimport type { ConnectionManager, Registrar } from '@libp2p/interface-internal'\nimport type { Multiaddr } from '@multiformats/multiaddr'\n\nexport interface PingService {\n  ping(peer: PeerId | Multiaddr | Multiaddr[], options?: AbortOptions): Promise<number>\n}\n\nexport interface PingServiceInit {\n  protocolPrefix?: string\n  maxInboundStreams?: number\n  maxOutboundStreams?: number\n  runOnLimitedConnection?: boolean\n\n  /**\n   * How long we should wait for a ping response\n   */\n  timeout?: number\n}\n\nexport interface PingServiceComponents {\n  registrar: Registrar\n  connectionManager: ConnectionManager\n  logger: ComponentLogger\n}\n\nexport function ping (init: PingServiceInit = {}): (components: PingServiceComponents) => PingService {\n  return (components) => new PingServiceClass(components, init)\n}\n\nexport { PING_PROTOCOL } from './constants.js'\n", "var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar BrowserInfo = /** @class */ (function () {\n    function BrowserInfo(name, version, os) {\n        this.name = name;\n        this.version = version;\n        this.os = os;\n        this.type = 'browser';\n    }\n    return BrowserInfo;\n}());\nexport { BrowserInfo };\nvar NodeInfo = /** @class */ (function () {\n    function NodeInfo(version) {\n        this.version = version;\n        this.type = 'node';\n        this.name = 'node';\n        this.os = process.platform;\n    }\n    return NodeInfo;\n}());\nexport { NodeInfo };\nvar SearchBotDeviceInfo = /** @class */ (function () {\n    function SearchBotDeviceInfo(name, version, os, bot) {\n        this.name = name;\n        this.version = version;\n        this.os = os;\n        this.bot = bot;\n        this.type = 'bot-device';\n    }\n    return SearchBotDeviceInfo;\n}());\nexport { SearchBotDeviceInfo };\nvar BotInfo = /** @class */ (function () {\n    function BotInfo() {\n        this.type = 'bot';\n        this.bot = true; // NOTE: deprecated test name instead\n        this.name = 'bot';\n        this.version = null;\n        this.os = null;\n    }\n    return BotInfo;\n}());\nexport { BotInfo };\nvar ReactNativeInfo = /** @class */ (function () {\n    function ReactNativeInfo() {\n        this.type = 'react-native';\n        this.name = 'react-native';\n        this.version = null;\n        this.os = null;\n    }\n    return ReactNativeInfo;\n}());\nexport { ReactNativeInfo };\n// tslint:disable-next-line:max-line-length\nvar SEARCHBOX_UA_REGEX = /alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/;\nvar SEARCHBOT_OS_REGEX = /(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\\ Jeeves\\/Teoma|ia_archiver)/;\nvar REQUIRED_VERSION_PARTS = 3;\nvar userAgentRules = [\n    ['aol', /AOLShield\\/([0-9\\._]+)/],\n    ['edge', /Edge\\/([0-9\\._]+)/],\n    ['edge-ios', /EdgiOS\\/([0-9\\._]+)/],\n    ['yandexbrowser', /YaBrowser\\/([0-9\\._]+)/],\n    ['kakaotalk', /KAKAOTALK\\s([0-9\\.]+)/],\n    ['samsung', /SamsungBrowser\\/([0-9\\.]+)/],\n    ['silk', /\\bSilk\\/([0-9._-]+)\\b/],\n    ['miui', /MiuiBrowser\\/([0-9\\.]+)$/],\n    ['beaker', /BeakerBrowser\\/([0-9\\.]+)/],\n    ['edge-chromium', /EdgA?\\/([0-9\\.]+)/],\n    [\n        'chromium-webview',\n        /(?!Chrom.*OPR)wv\\).*Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/,\n    ],\n    ['chrome', /(?!Chrom.*OPR)Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/],\n    ['phantomjs', /PhantomJS\\/([0-9\\.]+)(:?\\s|$)/],\n    ['crios', /CriOS\\/([0-9\\.]+)(:?\\s|$)/],\n    ['firefox', /Firefox\\/([0-9\\.]+)(?:\\s|$)/],\n    ['fxios', /FxiOS\\/([0-9\\.]+)/],\n    ['opera-mini', /Opera Mini.*Version\\/([0-9\\.]+)/],\n    ['opera', /Opera\\/([0-9\\.]+)(?:\\s|$)/],\n    ['opera', /OPR\\/([0-9\\.]+)(:?\\s|$)/],\n    ['pie', /^Microsoft Pocket Internet Explorer\\/(\\d+\\.\\d+)$/],\n    ['pie', /^Mozilla\\/\\d\\.\\d+\\s\\(compatible;\\s(?:MSP?IE|MSInternet Explorer) (\\d+\\.\\d+);.*Windows CE.*\\)$/],\n    ['netfront', /^Mozilla\\/\\d\\.\\d+.*NetFront\\/(\\d.\\d)/],\n    ['ie', /Trident\\/7\\.0.*rv\\:([0-9\\.]+).*\\).*Gecko$/],\n    ['ie', /MSIE\\s([0-9\\.]+);.*Trident\\/[4-7].0/],\n    ['ie', /MSIE\\s(7\\.0)/],\n    ['bb10', /BB10;\\sTouch.*Version\\/([0-9\\.]+)/],\n    ['android', /Android\\s([0-9\\.]+)/],\n    ['ios', /Version\\/([0-9\\._]+).*Mobile.*Safari.*/],\n    ['safari', /Version\\/([0-9\\._]+).*Safari/],\n    ['facebook', /FB[AS]V\\/([0-9\\.]+)/],\n    ['instagram', /Instagram\\s([0-9\\.]+)/],\n    ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Mobile/],\n    ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Gecko\\)$/],\n    ['curl', /^curl\\/([0-9\\.]+)$/],\n    ['searchbot', SEARCHBOX_UA_REGEX],\n];\nvar operatingSystemRules = [\n    ['iOS', /iP(hone|od|ad)/],\n    ['Android OS', /Android/],\n    ['BlackBerry OS', /BlackBerry|BB10/],\n    ['Windows Mobile', /IEMobile/],\n    ['Amazon OS', /Kindle/],\n    ['Windows 3.11', /Win16/],\n    ['Windows 95', /(Windows 95)|(Win95)|(Windows_95)/],\n    ['Windows 98', /(Windows 98)|(Win98)/],\n    ['Windows 2000', /(Windows NT 5.0)|(Windows 2000)/],\n    ['Windows XP', /(Windows NT 5.1)|(Windows XP)/],\n    ['Windows Server 2003', /(Windows NT 5.2)/],\n    ['Windows Vista', /(Windows NT 6.0)/],\n    ['Windows 7', /(Windows NT 6.1)/],\n    ['Windows 8', /(Windows NT 6.2)/],\n    ['Windows 8.1', /(Windows NT 6.3)/],\n    ['Windows 10', /(Windows NT 10.0)/],\n    ['Windows ME', /Windows ME/],\n    ['Windows CE', /Windows CE|WinCE|Microsoft Pocket Internet Explorer/],\n    ['Open BSD', /OpenBSD/],\n    ['Sun OS', /SunOS/],\n    ['Chrome OS', /CrOS/],\n    ['Linux', /(Linux)|(X11)/],\n    ['Mac OS', /(Mac_PowerPC)|(Macintosh)/],\n    ['QNX', /QNX/],\n    ['BeOS', /BeOS/],\n    ['OS/2', /OS\\/2/],\n];\nexport function detect(userAgent) {\n    if (!!userAgent) {\n        return parseUserAgent(userAgent);\n    }\n    if (typeof document === 'undefined' &&\n        typeof navigator !== 'undefined' &&\n        navigator.product === 'ReactNative') {\n        return new ReactNativeInfo();\n    }\n    if (typeof navigator !== 'undefined') {\n        return parseUserAgent(navigator.userAgent);\n    }\n    return getNodeVersion();\n}\nfunction matchUserAgent(ua) {\n    // opted for using reduce here rather than Array#first with a regex.test call\n    // this is primarily because using the reduce we only perform the regex\n    // execution once rather than once for the test and for the exec again below\n    // probably something that needs to be benchmarked though\n    return (ua !== '' &&\n        userAgentRules.reduce(function (matched, _a) {\n            var browser = _a[0], regex = _a[1];\n            if (matched) {\n                return matched;\n            }\n            var uaMatch = regex.exec(ua);\n            return !!uaMatch && [browser, uaMatch];\n        }, false));\n}\nexport function browserName(ua) {\n    var data = matchUserAgent(ua);\n    return data ? data[0] : null;\n}\nexport function parseUserAgent(ua) {\n    var matchedRule = matchUserAgent(ua);\n    if (!matchedRule) {\n        return null;\n    }\n    var name = matchedRule[0], match = matchedRule[1];\n    if (name === 'searchbot') {\n        return new BotInfo();\n    }\n    // Do not use RegExp for split operation as some browser do not support it (See: http://blog.stevenlevithan.com/archives/cross-browser-split)\n    var versionParts = match[1] && match[1].split('.').join('_').split('_').slice(0, 3);\n    if (versionParts) {\n        if (versionParts.length < REQUIRED_VERSION_PARTS) {\n            versionParts = __spreadArray(__spreadArray([], versionParts, true), createVersionParts(REQUIRED_VERSION_PARTS - versionParts.length), true);\n        }\n    }\n    else {\n        versionParts = [];\n    }\n    var version = versionParts.join('.');\n    var os = detectOS(ua);\n    var searchBotMatch = SEARCHBOT_OS_REGEX.exec(ua);\n    if (searchBotMatch && searchBotMatch[1]) {\n        return new SearchBotDeviceInfo(name, version, os, searchBotMatch[1]);\n    }\n    return new BrowserInfo(name, version, os);\n}\nexport function detectOS(ua) {\n    for (var ii = 0, count = operatingSystemRules.length; ii < count; ii++) {\n        var _a = operatingSystemRules[ii], os = _a[0], regex = _a[1];\n        var match = regex.exec(ua);\n        if (match) {\n            return os;\n        }\n    }\n    return null;\n}\nexport function getNodeVersion() {\n    var isNode = typeof process !== 'undefined' && process.version;\n    return isNode ? new NodeInfo(process.version.slice(1)) : null;\n}\nfunction createVersionParts(count) {\n    var output = [];\n    for (var ii = 0; ii < count; ii++) {\n        output.push('0');\n    }\n    return output;\n}\n", "/**\n * STUN servers help clients discover their own public IPs.\n *\n * Using five or more servers causes warnings to be printed so\n * ensure we limit it to max x4\n *\n * @see https://gist.github.com/mondain/b0ec1cf5f60ae726202e\n */\nexport const DEFAULT_ICE_SERVERS = [\n  'stun:stun.l.google.com:19302',\n  'stun:global.stun.twilio.com:3478',\n  'stun:stun.cloudflare.com:3478',\n  'stun:stun.services.mozilla.com:3478'\n]\n", "import { detect } from 'detect-browser'\nimport pDefer from 'p-defer'\nimport pTimeout from 'p-timeout'\nimport { DEFAULT_ICE_SERVERS } from './constants.js'\nimport type { LoggerOptions } from '@libp2p/interface'\n\nconst browser = detect()\nexport const isFirefox = ((browser != null) && browser.name === 'firefox')\n\nexport const nopSource = async function * nop (): AsyncGenerator<Uint8Array, any, unknown> {}\n\nexport const nopSink = async (_: any): Promise<void> => {}\n\nexport const DATA_CHANNEL_DRAIN_TIMEOUT = 30 * 1000\n\nexport function drainAndClose (channel: RTCDataChannel, direction: string, drainTimeout: number = DATA_CHANNEL_DRAIN_TIMEOUT, options: LoggerOptions): void {\n  if (channel.readyState !== 'open') {\n    return\n  }\n\n  void Promise.resolve()\n    .then(async () => {\n      // wait for bufferedAmount to become zero\n      if (channel.bufferedAmount > 0) {\n        options.log('%s drain channel with %d buffered bytes', direction, channel.bufferedAmount)\n        const deferred = pDefer()\n        let drained = false\n\n        channel.bufferedAmountLowThreshold = 0\n\n        const closeListener = (): void => {\n          if (!drained) {\n            options.log('%s drain channel closed before drain', direction)\n            deferred.resolve()\n          }\n        }\n\n        channel.addEventListener('close', closeListener, {\n          once: true\n        })\n\n        channel.addEventListener('bufferedamountlow', () => {\n          drained = true\n          channel.removeEventListener('close', closeListener)\n          deferred.resolve()\n        })\n\n        await pTimeout(deferred.promise, {\n          milliseconds: drainTimeout\n        })\n      }\n    })\n    .then(async () => {\n      // only close if the channel is still open\n      if (channel.readyState === 'open') {\n        channel.close()\n      }\n    })\n    .catch(err => {\n      options.log.error('error closing outbound stream', err)\n    })\n}\n\nexport interface AbortPromiseOptions {\n  signal?: AbortSignal\n  message?: string\n}\n\nexport async function getRtcConfiguration (config?: RTCConfiguration | (() => RTCConfiguration | Promise<RTCConfiguration>)): Promise<RTCConfiguration> {\n  config = config ?? {}\n\n  if (typeof config === 'function') {\n    config = await config()\n  }\n\n  config.iceServers = config.iceServers ?? DEFAULT_ICE_SERVERS.map(url => ({\n    urls: [\n      url\n    ]\n  }))\n\n  return config\n}\n", "import { nopSink, nopSource } from './util.js'\nimport type { ComponentLogger, Logger, MultiaddrConnection, MultiaddrConnectionTimeline, CounterGroup } from '@libp2p/interface'\nimport type { AbortOptions, Multiaddr } from '@multiformats/multiaddr'\nimport type { Source, Sink } from 'it-stream-types'\nimport type { Uint8ArrayList } from 'uint8arraylist'\n\ninterface WebRTCMultiaddrConnectionInit {\n  /**\n   * WebRTC Peer Connection\n   */\n  peerConnection: RTCPeerConnection\n\n  /**\n   * The multiaddr address used to communicate with the remote peer\n   */\n  remoteAddr: Multiaddr\n\n  /**\n   * Holds the relevant events timestamps of the connection\n   */\n  timeline: MultiaddrConnectionTimeline\n\n  /**\n   * Optional metrics counter group for this connection\n   */\n  metrics?: CounterGroup\n}\n\nexport interface WebRTCMultiaddrConnectionComponents {\n  logger: ComponentLogger\n}\n\nexport class WebRTCMultiaddrConnection implements MultiaddrConnection {\n  readonly log: Logger\n\n  /**\n   * WebRTC Peer Connection\n   */\n  readonly peerConnection: RTCPeerConnection\n\n  /**\n   * The multiaddr address used to communicate with the remote peer\n   */\n  remoteAddr: Multiaddr\n\n  /**\n   * Holds the lifecycle times of the connection\n   */\n  timeline: MultiaddrConnectionTimeline\n\n  /**\n   * Optional metrics counter group for this connection\n   */\n  metrics?: CounterGroup\n\n  /**\n   * The stream source, a no-op as the transport natively supports multiplexing\n   */\n  source: AsyncGenerator<Uint8Array, any, unknown> = nopSource()\n\n  /**\n   * The stream destination, a no-op as the transport natively supports multiplexing\n   */\n  sink: Sink<Source<Uint8Array | Uint8ArrayList>, Promise<void>> = nopSink\n\n  constructor (components: WebRTCMultiaddrConnectionComponents, init: WebRTCMultiaddrConnectionInit) {\n    this.log = components.logger.forComponent('libp2p:webrtc:maconn')\n    this.remoteAddr = init.remoteAddr\n    this.timeline = init.timeline\n    this.peerConnection = init.peerConnection\n\n    const initialState = this.peerConnection.connectionState\n\n    this.peerConnection.onconnectionstatechange = () => {\n      this.log.trace('peer connection state change', this.peerConnection.connectionState, 'initial state', initialState)\n\n      if (this.peerConnection.connectionState === 'disconnected' || this.peerConnection.connectionState === 'failed' || this.peerConnection.connectionState === 'closed') {\n        // nothing else to do but close the connection\n        this.timeline.close = Date.now()\n      }\n    }\n  }\n\n  async close (options?: AbortOptions): Promise<void> {\n    this.log.trace('closing connection')\n\n    this.peerConnection.close()\n    this.timeline.close = Date.now()\n    this.metrics?.increment({ close: true })\n  }\n\n  abort (err: Error): void {\n    this.log.error('closing connection due to error', err)\n\n    this.peerConnection.close()\n    this.timeline.close = Date.now()\n    this.metrics?.increment({ abort: true })\n  }\n}\n", "/* eslint-disable import/export */\n/* eslint-disable complexity */\n/* eslint-disable @typescript-eslint/no-namespace */\n/* eslint-disable @typescript-eslint/no-unnecessary-boolean-literal-compare */\n/* eslint-disable @typescript-eslint/no-empty-interface */\n\nimport { type Codec, decodeMessage, type DecodeOptions, encodeMessage, enumeration, message } from 'protons-runtime'\nimport type { Uint8ArrayList } from 'uint8arraylist'\n\nexport interface Message {\n  flag?: Message.Flag\n  message?: Uint8Array\n}\n\nexport namespace Message {\n  export enum Flag {\n    FIN = 'FIN',\n    STOP_SENDING = 'STOP_SENDING',\n    RESET = 'RESET',\n    FIN_ACK = 'FIN_ACK'\n  }\n\n  enum __FlagValues {\n    FIN = 0,\n    STOP_SENDING = 1,\n    RESET = 2,\n    FIN_ACK = 3\n  }\n\n  export namespace Flag {\n    export const codec = (): Codec<Flag> => {\n      return enumeration<Flag>(__FlagValues)\n    }\n  }\n\n  let _codec: Codec<Message>\n\n  export const codec = (): Codec<Message> => {\n    if (_codec == null) {\n      _codec = message<Message>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if (obj.flag != null) {\n          w.uint32(8)\n          Message.Flag.codec().encode(obj.flag, w)\n        }\n\n        if (obj.message != null) {\n          w.uint32(18)\n          w.bytes(obj.message)\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {}\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.flag = Message.Flag.codec().decode(reader)\n              break\n            }\n            case 2: {\n              obj.message = reader.bytes()\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<Message>): Uint8Array => {\n    return encodeMessage(obj, Message.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<Message>): Message => {\n    return decodeMessage(buf, Message.codec(), opts)\n  }\n}\n", "import { StreamStateError, TimeoutError } from '@libp2p/interface'\nimport { AbstractStream, type AbstractStreamInit } from '@libp2p/utils/abstract-stream'\nimport * as lengthPrefixed from 'it-length-prefixed'\nimport { type Pushable, pushable } from 'it-pushable'\nimport pDefer from 'p-defer'\nimport { pEvent } from 'p-event'\nimport pTimeout from 'p-timeout'\nimport { raceSignal } from 'race-signal'\nimport { encodingLength } from 'uint8-varint'\nimport { Uint8ArrayList } from 'uint8arraylist'\nimport { Message } from './pb/message.js'\nimport type { DataChannelOptions } from './index.js'\nimport type { AbortOptions, ComponentLogger, Direction } from '@libp2p/interface'\nimport type { DeferredPromise } from 'p-defer'\n\nexport interface WebRTCStreamInit extends AbstractStreamInit, DataChannelOptions {\n  /**\n   * The network channel used for bidirectional peer-to-peer transfers of\n   * arbitrary data\n   *\n   * {@link https://developer.mozilla.org/en-US/docs/Web/API/RTCDataChannel}\n   */\n  channel: RTCDataChannel\n\n  logger: ComponentLogger\n}\n\n/**\n * How much can be buffered to the DataChannel at once\n */\nexport const MAX_BUFFERED_AMOUNT = 2 * 1024 * 1024\n\n/**\n * How long time we wait for the 'bufferedamountlow' event to be emitted\n */\nexport const BUFFERED_AMOUNT_LOW_TIMEOUT = 30 * 1000\n\n/**\n * Max message size that can be sent to the DataChannel. In browsers this is\n * 256KiB but go-libp2p and rust-libp2p only support 16KiB at the time of\n * writing.\n *\n * @see https://blog.mozilla.org/webrtc/large-data-channel-messages/\n * @see https://issues.webrtc.org/issues/40644524\n */\nexport const MAX_MESSAGE_SIZE = 16 * 1024\n\n/**\n * max protobuf overhead:\n *\n * ```\n * [message-length][flag-field-id+type][flag-field-length][flag-field][message-field-id+type][message-field-length][message-field]\n * ```\n */\nfunction calculateProtobufOverhead (maxMessageSize = MAX_MESSAGE_SIZE): number {\n  // these have a fixed size\n  const messageLength = encodingLength(maxMessageSize - encodingLength(maxMessageSize))\n  const flagField = 1 + encodingLength(Object.keys(Message.Flag).length - 1) // id+type/value\n  const messageFieldIdType = 1 // id+type\n  const available = maxMessageSize - messageLength - flagField - messageFieldIdType\n\n  // let message-length/message-data fill the rest of the message\n  const messageFieldLengthLength = encodingLength(available)\n\n  return messageLength + flagField + messageFieldIdType + messageFieldLengthLength\n}\n\n/**\n * The protobuf message overhead includes the maximum amount of all bytes in the\n * protobuf that aren't message field bytes\n */\nexport const PROTOBUF_OVERHEAD = calculateProtobufOverhead()\n\n/**\n * When closing streams we send a FIN then wait for the remote to\n * reply with a FIN_ACK. If that does not happen within this timeout\n * we close the stream anyway.\n */\nexport const FIN_ACK_TIMEOUT = 5000\n\n/**\n * When sending data messages, if the channel is not in the \"open\" state, wait\n * this long for the \"open\" event to fire.\n */\nexport const OPEN_TIMEOUT = 5000\n\nexport class WebRTCStream extends AbstractStream {\n  /**\n   * The data channel used to send and receive data\n   */\n  private readonly channel: RTCDataChannel\n\n  /**\n   * push data from the underlying datachannel to the length prefix decoder\n   * and then the protobuf decoder.\n   */\n  private readonly incomingData: Pushable<Uint8Array>\n\n  private readonly maxBufferedAmount: number\n\n  private readonly bufferedAmountLowEventTimeout: number\n\n  /**\n   * The maximum size of a message in bytes\n   */\n  private readonly maxMessageSize: number\n\n  /**\n   * When this promise is resolved, the remote has sent us a FIN flag\n   */\n  private readonly receiveFinAck: DeferredPromise<void>\n  private readonly finAckTimeout: number\n  private readonly openTimeout: number\n\n  constructor (init: WebRTCStreamInit) {\n    // override onEnd to send/receive FIN_ACK before closing the stream\n    const originalOnEnd = init.onEnd\n    init.onEnd = (err?: Error): void => {\n      this.log.trace('readable and writeable ends closed', this.status)\n\n      void Promise.resolve(async () => {\n        if (this.timeline.abort != null || this.timeline.reset !== null) {\n          return\n        }\n\n        // wait for FIN_ACK if we haven't received it already\n        try {\n          await pTimeout(this.receiveFinAck.promise, {\n            milliseconds: this.finAckTimeout\n          })\n        } catch (err) {\n          this.log.error('error receiving FIN_ACK', err)\n        }\n      })\n        .then(() => {\n        // stop processing incoming messages\n          this.incomingData.end()\n\n          // final cleanup\n          originalOnEnd?.(err)\n        })\n        .catch(err => {\n          this.log.error('error ending stream', err)\n        })\n    }\n\n    super(init)\n\n    this.channel = init.channel\n    this.channel.binaryType = 'arraybuffer'\n    this.incomingData = pushable<Uint8Array>()\n    this.bufferedAmountLowEventTimeout = init.bufferedAmountLowEventTimeout ?? BUFFERED_AMOUNT_LOW_TIMEOUT\n    this.maxBufferedAmount = init.maxBufferedAmount ?? MAX_BUFFERED_AMOUNT\n    this.maxMessageSize = (init.maxMessageSize ?? MAX_MESSAGE_SIZE) - PROTOBUF_OVERHEAD\n    this.receiveFinAck = pDefer()\n    this.finAckTimeout = init.closeTimeout ?? FIN_ACK_TIMEOUT\n    this.openTimeout = init.openTimeout ?? OPEN_TIMEOUT\n\n    // set up initial state\n    switch (this.channel.readyState) {\n      case 'open':\n        this.timeline.open = new Date().getTime()\n        break\n\n      case 'closed':\n      case 'closing':\n        if (this.timeline.close === undefined || this.timeline.close === 0) {\n          this.timeline.close = Date.now()\n        }\n        break\n      case 'connecting':\n        // noop\n        break\n\n      default:\n        this.log.error('unknown datachannel state %s', this.channel.readyState)\n        throw new StreamStateError('Unknown datachannel state')\n    }\n\n    // handle RTCDataChannel events\n    this.channel.onopen = (_evt) => {\n      this.timeline.open = new Date().getTime()\n    }\n\n    this.channel.onclose = (_evt) => {\n      // if the channel has closed we'll never receive a FIN_ACK so resolve the\n      // promise so we don't try to wait later\n      this.receiveFinAck.resolve()\n\n      void this.close().catch(err => {\n        this.log.error('error closing stream after channel closed', err)\n      })\n    }\n\n    this.channel.onerror = (evt) => {\n      const err = (evt as RTCErrorEvent).error\n      this.abort(err)\n    }\n\n    this.channel.onmessage = async (event: MessageEvent<ArrayBuffer>) => {\n      const { data } = event\n\n      if (data === null || data.byteLength === 0) {\n        return\n      }\n\n      this.incomingData.push(new Uint8Array(data, 0, data.byteLength))\n    }\n\n    const self = this\n\n    // pipe framed protobuf messages through a length prefixed decoder, and\n    // surface data from the `Message.message` field through a source.\n    Promise.resolve().then(async () => {\n      for await (const buf of lengthPrefixed.decode(this.incomingData)) {\n        const message = self.processIncomingProtobuf(buf)\n\n        if (message != null) {\n          self.sourcePush(new Uint8ArrayList(message))\n        }\n      }\n    })\n      .catch(err => {\n        this.log.error('error processing incoming data channel messages', err)\n      })\n  }\n\n  sendNewStream (): void {\n    // opening new streams is handled by WebRTC so this is a noop\n  }\n\n  async _sendMessage (data: Uint8ArrayList, checkBuffer: boolean = true): Promise<void> {\n    if (checkBuffer && this.channel.bufferedAmount > this.maxBufferedAmount) {\n      try {\n        this.log('channel buffer is %d, wait for \"bufferedamountlow\" event', this.channel.bufferedAmount)\n        await pEvent(this.channel, 'bufferedamountlow', { timeout: this.bufferedAmountLowEventTimeout })\n      } catch (err: any) {\n        if (err instanceof TimeoutError) {\n          throw new TimeoutError(`Timed out waiting for DataChannel buffer to clear after ${this.bufferedAmountLowEventTimeout}ms`)\n        }\n\n        throw err\n      }\n    }\n\n    if (this.channel.readyState === 'closed' || this.channel.readyState === 'closing') {\n      throw new StreamStateError(`Invalid datachannel state - ${this.channel.readyState}`)\n    }\n\n    if (this.channel.readyState !== 'open') {\n      this.log('channel state is \"%s\" and not \"open\", waiting for \"open\" event before sending data', this.channel.readyState)\n      await pEvent(this.channel, 'open', { timeout: this.openTimeout })\n      this.log('channel state is now \"%s\", sending data', this.channel.readyState)\n    }\n\n    // send message without copying data\n    this.channel.send(data.subarray())\n  }\n\n  async sendData (data: Uint8ArrayList): Promise<void> {\n    // sending messages is an async operation so use a copy of the list as it\n    // may be changed beneath us\n    data = data.sublist()\n\n    while (data.byteLength > 0) {\n      const toSend = Math.min(data.byteLength, this.maxMessageSize)\n      const buf = data.subarray(0, toSend)\n      const msgbuf = Message.encode({ message: buf })\n      const sendbuf = lengthPrefixed.encode.single(msgbuf)\n      await this._sendMessage(sendbuf)\n\n      data.consume(toSend)\n    }\n  }\n\n  async sendReset (): Promise<void> {\n    try {\n      await this._sendFlag(Message.Flag.RESET)\n    } catch (err) {\n      this.log.error('failed to send reset - %e', err)\n    }\n  }\n\n  async sendCloseWrite (options: AbortOptions): Promise<void> {\n    const sent = await this._sendFlag(Message.Flag.FIN)\n\n    if (sent) {\n      this.log.trace('awaiting FIN_ACK')\n      try {\n        await raceSignal(this.receiveFinAck.promise, options?.signal, {\n          errorMessage: 'sending close-write was aborted before FIN_ACK was received',\n          errorName: 'FinAckNotReceivedError'\n        })\n      } catch (err) {\n        this.log.error('failed to await FIN_ACK', err)\n      }\n    } else {\n      this.log.trace('sending FIN failed, not awaiting FIN_ACK')\n    }\n\n    // if we've attempted to receive a FIN_ACK, do not try again\n    this.receiveFinAck.resolve()\n  }\n\n  async sendCloseRead (): Promise<void> {\n    await this._sendFlag(Message.Flag.STOP_SENDING)\n  }\n\n  /**\n   * Handle incoming\n   */\n  private processIncomingProtobuf (buffer: Uint8ArrayList): Uint8Array | undefined {\n    const message = Message.decode(buffer)\n\n    if (message.flag !== undefined) {\n      this.log.trace('incoming flag %s, write status \"%s\", read status \"%s\"', message.flag, this.writeStatus, this.readStatus)\n\n      if (message.flag === Message.Flag.FIN) {\n        // We should expect no more data from the remote, stop reading\n        this.remoteCloseWrite()\n\n        this.log.trace('sending FIN_ACK')\n        void this._sendFlag(Message.Flag.FIN_ACK)\n          .catch(err => {\n            this.log.error('error sending FIN_ACK immediately', err)\n          })\n      }\n\n      if (message.flag === Message.Flag.RESET) {\n        // Stop reading and writing to the stream immediately\n        this.reset()\n      }\n\n      if (message.flag === Message.Flag.STOP_SENDING) {\n        // The remote has stopped reading\n        this.remoteCloseRead()\n      }\n\n      if (message.flag === Message.Flag.FIN_ACK) {\n        this.log.trace('received FIN_ACK')\n        this.receiveFinAck.resolve()\n      }\n    }\n\n    // ignore data messages if we've closed the readable end already\n    if (this.readStatus === 'ready') {\n      return message.message\n    }\n  }\n\n  private async _sendFlag (flag: Message.Flag): Promise<boolean> {\n    if (this.channel.readyState !== 'open') {\n      // flags can be sent while we or the remote are closing the datachannel so\n      // if the channel isn't open, don't try to send it but return false to let\n      // the caller know and act if they need to\n      this.log.trace('not sending flag %s because channel is \"%s\" and not \"open\"', this.channel.readyState, flag.toString())\n      return false\n    }\n\n    this.log.trace('sending flag %s', flag.toString())\n    const msgbuf = Message.encode({ flag })\n    const prefixedBuf = lengthPrefixed.encode.single(msgbuf)\n\n    try {\n      await this._sendMessage(prefixedBuf, false)\n\n      return true\n    } catch (err: any) {\n      this.log.error('could not send flag %s - %e', flag.toString(), err)\n    }\n\n    return false\n  }\n}\n\nexport interface WebRTCStreamOptions extends DataChannelOptions {\n  /**\n   * The network channel used for bidirectional peer-to-peer transfers of\n   * arbitrary data\n   *\n   * {@link https://developer.mozilla.org/en-US/docs/Web/API/RTCDataChannel}\n   */\n  channel: RTCDataChannel\n\n  /**\n   * The stream direction\n   */\n  direction: Direction\n\n  /**\n   * A callback invoked when the channel ends\n   */\n  onEnd?(err?: Error | undefined): void\n\n  logger: ComponentLogger\n}\n\nexport function createStream (options: WebRTCStreamOptions): WebRTCStream {\n  const { channel, direction } = options\n\n  return new WebRTCStream({\n    id: direction === 'inbound' ? (`i${channel.id}`) : `r${channel.id}`,\n    log: options.logger.forComponent(`libp2p:webrtc:stream:${direction}:${channel.id}`),\n    ...options\n  })\n}\n", "import { createStream } from './stream.js'\nimport { drainAndClose, nopSink, nopSource } from './util.js'\nimport type { DataChannelOptions } from './index.js'\nimport type { ComponentLogger, Logger, Stream, CounterGroup, StreamMuxer, StreamMuxerFactory, StreamMuxerInit } from '@libp2p/interface'\nimport type { AbortOptions } from '@multiformats/multiaddr'\nimport type { Source, Sink } from 'it-stream-types'\nimport type { Uint8ArrayList } from 'uint8arraylist'\n\nconst PROTOCOL = '/webrtc'\n\nexport interface DataChannelMuxerFactoryInit {\n  /**\n   * WebRTC Peer Connection\n   */\n  peerConnection: RTCPeerConnection\n\n  /**\n   * The protocol to use\n   */\n  protocol?: string\n\n  /**\n   * Optional metrics for this data channel muxer\n   */\n  metrics?: CounterGroup\n\n  dataChannelOptions?: DataChannelOptions\n}\n\nexport interface DataChannelMuxerFactoryComponents {\n  logger: ComponentLogger\n}\n\ninterface BufferedStream {\n  stream: Stream\n  channel: RTCDataChannel\n  onEnd(err?: Error): void\n}\n\nexport class DataChannelMuxerFactory implements StreamMuxerFactory {\n  public readonly protocol: string\n\n  /**\n   * WebRTC Peer Connection\n   */\n  private readonly peerConnection: RTCPeerConnection\n  private bufferedStreams: BufferedStream[] = []\n  private readonly metrics?: CounterGroup\n  private readonly dataChannelOptions?: DataChannelOptions\n  private readonly components: DataChannelMuxerFactoryComponents\n  private readonly log: Logger\n\n  constructor (components: DataChannelMuxerFactoryComponents, init: DataChannelMuxerFactoryInit) {\n    this.components = components\n    this.peerConnection = init.peerConnection\n    this.metrics = init.metrics\n    this.protocol = init.protocol ?? PROTOCOL\n    this.dataChannelOptions = init.dataChannelOptions ?? {}\n    this.log = components.logger.forComponent('libp2p:webrtc:datachannelmuxerfactory')\n\n    // store any datachannels opened before upgrade has been completed\n    this.peerConnection.ondatachannel = ({ channel }) => {\n      this.log.trace('incoming early datachannel with channel id %d and label \"%s\"', channel.id)\n\n      // 'init' channel is only used during connection establishment\n      if (channel.label === 'init') {\n        this.log.trace('closing early init channel')\n        channel.close()\n\n        return\n      }\n\n      // @ts-expect-error fields are set below\n      const bufferedStream: BufferedStream = {}\n\n      const stream = createStream({\n        channel,\n        direction: 'inbound',\n        onEnd: (err) => {\n          bufferedStream.onEnd(err)\n        },\n        logger: components.logger,\n        ...this.dataChannelOptions\n      })\n\n      bufferedStream.stream = stream\n      bufferedStream.channel = channel\n      bufferedStream.onEnd = () => {\n        this.bufferedStreams = this.bufferedStreams.filter(s => s.stream.id !== stream.id)\n      }\n\n      this.bufferedStreams.push(bufferedStream)\n    }\n  }\n\n  createStreamMuxer (init?: StreamMuxerInit): StreamMuxer {\n    return new DataChannelMuxer(this.components, {\n      ...init,\n      peerConnection: this.peerConnection,\n      dataChannelOptions: this.dataChannelOptions,\n      metrics: this.metrics,\n      streams: this.bufferedStreams,\n      protocol: this.protocol\n    })\n  }\n}\n\nexport interface DataChannelMuxerInit extends DataChannelMuxerFactoryInit, StreamMuxerInit {\n  streams: BufferedStream[]\n}\n\nexport interface DataChannelMuxerComponents {\n  logger: ComponentLogger\n}\n\n/**\n * A libp2p data channel stream muxer\n */\nexport class DataChannelMuxer implements StreamMuxer {\n  /**\n   * Array of streams in the data channel\n   */\n  public streams: Stream[]\n  public protocol: string\n\n  private readonly log: Logger\n  private readonly peerConnection: RTCPeerConnection\n  private readonly dataChannelOptions: DataChannelOptions\n  private readonly metrics?: CounterGroup\n  private readonly logger: ComponentLogger\n\n  constructor (components: DataChannelMuxerComponents, readonly init: DataChannelMuxerInit) {\n    this.log = components.logger.forComponent('libp2p:webrtc:muxer')\n    this.logger = components.logger\n    this.streams = init.streams.map(s => s.stream)\n    this.peerConnection = init.peerConnection\n    this.protocol = init.protocol ?? PROTOCOL\n    this.metrics = init.metrics\n    this.dataChannelOptions = init.dataChannelOptions ?? {}\n\n    /**\n     * Fired when a data channel has been added to the connection has been\n     * added by the remote peer.\n     *\n     * {@link https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/datachannel_event}\n     */\n    this.peerConnection.ondatachannel = ({ channel }) => {\n      this.log.trace('incoming datachannel with channel id %d', channel.id)\n\n      // 'init' channel is only used during connection establishment\n      if (channel.label === 'init') {\n        this.log.trace('closing init channel')\n        channel.close()\n\n        return\n      }\n\n      // lib-datachannel throws if `.getId` is called on a closed channel so\n      // memoize it\n      const id = channel.id\n\n      const stream = createStream({\n        channel,\n        direction: 'inbound',\n        onEnd: () => {\n          this.#onStreamEnd(stream, channel)\n          this.log('incoming channel %s ended', id)\n        },\n        logger: this.logger,\n        ...this.dataChannelOptions\n      })\n\n      this.streams.push(stream)\n      this.metrics?.increment({ incoming_stream: true })\n      init?.onIncomingStream?.(stream)\n    }\n\n    // the DataChannelMuxer constructor is called during set up of the\n    // connection by the upgrader.\n    //\n    // If we invoke `init.onIncomingStream` immediately, the connection object\n    // will not be set up yet so add a tiny delay before letting the\n    // connection know about early streams\n    if (this.init.streams.length > 0) {\n      queueMicrotask(() => {\n        this.init.streams.forEach(bufferedStream => {\n          bufferedStream.onEnd = () => {\n            this.log('incoming early channel %s ended with state %s', bufferedStream.channel.id, bufferedStream.channel.readyState)\n            this.#onStreamEnd(bufferedStream.stream, bufferedStream.channel)\n          }\n\n          this.metrics?.increment({ incoming_stream: true })\n          this.init?.onIncomingStream?.(bufferedStream.stream)\n        })\n      })\n    }\n  }\n\n  #onStreamEnd (stream: Stream, channel: RTCDataChannel): void {\n    this.log.trace('stream %s %s %s onEnd', stream.direction, stream.id, stream.protocol)\n    drainAndClose(\n      channel,\n      `${stream.direction} ${stream.id} ${stream.protocol}`,\n      this.dataChannelOptions.drainTimeout, {\n        log: this.log\n      }\n    )\n    this.streams = this.streams.filter(s => s.id !== stream.id)\n    this.metrics?.increment({ stream_end: true })\n    this.init?.onStreamEnd?.(stream)\n  }\n\n  /**\n   * Gracefully close all tracked streams and stop the muxer\n   */\n  async close (options?: AbortOptions): Promise<void> {\n    try {\n      await Promise.all(\n        this.streams.map(async stream => stream.close(options))\n      )\n    } catch (err: any) {\n      this.abort(err)\n    }\n  }\n\n  /**\n   * Abort all tracked streams and stop the muxer\n   */\n  abort (err: Error): void {\n    for (const stream of this.streams) {\n      stream.abort(err)\n    }\n  }\n\n  /**\n   * The stream source, a no-op as the transport natively supports multiplexing\n   */\n  source: AsyncGenerator<Uint8Array, any, unknown> = nopSource()\n\n  /**\n   * The stream destination, a no-op as the transport natively supports multiplexing\n   */\n  sink: Sink<Source<Uint8Array | Uint8ArrayList>, Promise<void>> = nopSink\n\n  newStream (): Stream {\n    // The spec says the label SHOULD be an empty string: https://github.com/libp2p/specs/blob/master/webrtc/README.md#rtcdatachannel-label\n    const channel = this.peerConnection.createDataChannel('')\n    // lib-datachannel throws if `.getId` is called on a closed channel so\n    // memoize it\n    const id = channel.id\n\n    this.log.trace('opened outgoing datachannel with channel id %s', id)\n\n    const stream = createStream({\n      channel,\n      direction: 'outbound',\n      onEnd: () => {\n        this.#onStreamEnd(stream, channel)\n        this.log('outgoing channel %s ended', id)\n      },\n      logger: this.logger,\n      ...this.dataChannelOptions\n    })\n    this.streams.push(stream)\n    this.metrics?.increment({ outgoing_stream: true })\n\n    return stream\n  }\n}\n", "export const RTCPeerConnection = globalThis.RTCPeerConnection\nexport const RTCSessionDescription = globalThis.RTCSessionDescription\nexport const RTCIceCandidate = globalThis.RTCIceCandidate\n", "export class WebRTCTransportError extends Error {\n  constructor (msg: string) {\n    super(`WebRTC transport error: ${msg}`)\n    this.name = 'WebRTCTransportError'\n  }\n}\n\nexport class SDPHandshakeFailedError extends WebRTCTransportError {\n  constructor (message = 'SDP handshake failed') {\n    super(message)\n    this.name = 'SDPHandshakeFailedError'\n  }\n}\n\nexport class ConnectionClosedError extends WebRTCTransportError {\n  constructor (state: RTCPeerConnectionState, msg: string) {\n    super(`peerconnection moved to state: ${state}: ${msg}`)\n    this.name = 'WebRTC/ConnectionClosed'\n  }\n}\n\nexport class DataChannelError extends WebRTCTransportError {\n  constructor (streamLabel: string, msg: string) {\n    super(`[stream: ${streamLabel}] data channel error: ${msg}`)\n    this.name = 'WebRTC/DataChannelError'\n  }\n}\n\nexport class InappropriateMultiaddrError extends WebRTCTransportError {\n  constructor (msg: string) {\n    super(`There was a problem with the Multiaddr which was passed in: ${msg}`)\n    this.name = 'WebRTC/InappropriateMultiaddrError'\n  }\n}\n\nexport class InvalidArgumentError extends WebRTCTransportError {\n  constructor (msg: string) {\n    super(`There was a problem with a provided argument: ${msg}`)\n    this.name = 'WebRTC/InvalidArgumentError'\n  }\n}\n\nexport class InvalidFingerprintError extends WebRTCTransportError {\n  constructor (fingerprint: string, source: string) {\n    super(`Invalid fingerprint \"${fingerprint}\" within ${source}`)\n    this.name = 'WebRTC/InvalidFingerprintError'\n  }\n}\n\nexport class OperationAbortedError extends WebRTCTransportError {\n  constructor (context: string, abortReason: string) {\n    super(`Signalled to abort because (${abortReason}}) ${context}`)\n    this.name = 'WebRTC/OperationAbortedError'\n  }\n}\n\nexport class OverStreamLimitError extends WebRTCTransportError {\n  constructor (msg: string) {\n    super(msg)\n    this.name = 'WebRTC/OverStreamLimitError'\n  }\n}\n\nexport class UnimplementedError extends WebRTCTransportError {\n  constructor (methodName: string) {\n    super(`A method (${methodName}) was called though it has been intentionally left unimplemented.`)\n    this.name = 'WebRTC/UnimplementedError'\n  }\n}\n\nexport class UnsupportedHashAlgorithmError extends WebRTCTransportError {\n  constructor (algo: number) {\n    super(`unsupported hash algorithm code: ${algo} please see the codes at https://github.com/multiformats/multicodec/blob/master/table.csv `)\n    this.name = 'WebRTC/UnsupportedHashAlgorithmError'\n  }\n}\n", "/* eslint-disable import/export */\n/* eslint-disable complexity */\n/* eslint-disable @typescript-eslint/no-namespace */\n/* eslint-disable @typescript-eslint/no-unnecessary-boolean-literal-compare */\n/* eslint-disable @typescript-eslint/no-empty-interface */\n\nimport { type Codec, decodeMessage, type DecodeOptions, encodeMessage, enumeration, message } from 'protons-runtime'\nimport type { Uint8ArrayList } from 'uint8arraylist'\n\nexport interface Message {\n  type?: Message.Type\n  data?: string\n}\n\nexport namespace Message {\n  export enum Type {\n    SDP_OFFER = 'SDP_OFFER',\n    SDP_ANSWER = 'SDP_ANSWER',\n    ICE_CANDIDATE = 'ICE_CANDIDATE'\n  }\n\n  enum __TypeValues {\n    SDP_OFFER = 0,\n    SDP_ANSWER = 1,\n    ICE_CANDIDATE = 2\n  }\n\n  export namespace Type {\n    export const codec = (): Codec<Type> => {\n      return enumeration<Type>(__TypeValues)\n    }\n  }\n\n  let _codec: Codec<Message>\n\n  export const codec = (): Codec<Message> => {\n    if (_codec == null) {\n      _codec = message<Message>((obj, w, opts = {}) => {\n        if (opts.lengthDelimited !== false) {\n          w.fork()\n        }\n\n        if (obj.type != null) {\n          w.uint32(8)\n          Message.Type.codec().encode(obj.type, w)\n        }\n\n        if (obj.data != null) {\n          w.uint32(18)\n          w.string(obj.data)\n        }\n\n        if (opts.lengthDelimited !== false) {\n          w.ldelim()\n        }\n      }, (reader, length, opts = {}) => {\n        const obj: any = {}\n\n        const end = length == null ? reader.len : reader.pos + length\n\n        while (reader.pos < end) {\n          const tag = reader.uint32()\n\n          switch (tag >>> 3) {\n            case 1: {\n              obj.type = Message.Type.codec().decode(reader)\n              break\n            }\n            case 2: {\n              obj.data = reader.string()\n              break\n            }\n            default: {\n              reader.skipType(tag & 7)\n              break\n            }\n          }\n        }\n\n        return obj\n      })\n    }\n\n    return _codec\n  }\n\n  export const encode = (obj: Partial<Message>): Uint8Array => {\n    return encodeMessage(obj, Message.codec())\n  }\n\n  export const decode = (buf: Uint8Array | Uint8ArrayList, opts?: DecodeOptions<Message>): Message => {\n    return decodeMessage(buf, Message.codec(), opts)\n  }\n}\n", "import { ConnectionFailedError, InvalidMessageError } from '@libp2p/interface'\nimport pDefer from 'p-defer'\nimport { CustomProgressEvent } from 'progress-events'\nimport { isFirefox } from '../util.js'\nimport { RTCIceCandidate } from '../webrtc/index.js'\nimport { Message } from './pb/message.js'\nimport type { WebRTCDialEvents } from './transport.js'\nimport type { LoggerOptions, Stream } from '@libp2p/interface'\nimport type { AbortOptions, MessageStream } from 'it-protobuf-stream'\nimport type { DeferredPromise } from 'p-defer'\nimport type { ProgressOptions } from 'progress-events'\n\nexport interface ReadCandidatesOptions extends AbortOptions, LoggerOptions, ProgressOptions<WebRTCDialEvents> {\n  direction: string\n}\n\nexport const readCandidatesUntilConnected = async (pc: RTCPeerConnection, stream: MessageStream<Message, Stream>, options: ReadCandidatesOptions): Promise<void> => {\n  try {\n    const connectedPromise: DeferredPromise<void> = pDefer()\n    resolveOnConnected(pc, connectedPromise)\n\n    // read candidates until we are connected or we reach the end of the stream\n    while (true) {\n      // if we connect, stop trying to read from the stream\n      const message = await Promise.race([\n        connectedPromise.promise,\n        stream.read({\n          signal: options.signal\n        }).catch(() => {})\n      ])\n\n      // stream ended or we became connected\n      if (message == null) {\n        // throw if we timed out\n        options.signal?.throwIfAborted()\n\n        break\n      }\n\n      if (message.type !== Message.Type.ICE_CANDIDATE) {\n        throw new InvalidMessageError('ICE candidate message expected')\n      }\n\n      const candidateInit = JSON.parse(message.data ?? 'null')\n\n      // an empty string means this generation of candidates is complete, a null\n      // candidate means candidate gathering has finished\n      // see - https://www.w3.org/TR/webrtc/#rtcpeerconnectioniceevent\n      if (candidateInit === '' || candidateInit === null) {\n        options.onProgress?.(new CustomProgressEvent('webrtc:end-of-ice-candidates'))\n        options.log.trace('end-of-candidates received')\n\n        continue\n      }\n\n      const candidate = new RTCIceCandidate(candidateInit)\n\n      options.log.trace('%s received new ICE candidate %o', options.direction, candidateInit)\n\n      try {\n        options.onProgress?.(new CustomProgressEvent<string>('webrtc:add-ice-candidate', candidate.candidate))\n        await pc.addIceCandidate(candidate)\n      } catch (err) {\n        options.log.error('%s bad candidate received', options.direction, candidateInit, err)\n      }\n    }\n  } catch (err) {\n    options.log.error('%s error parsing ICE candidate', options.direction, err)\n\n    if (options.signal?.aborted === true && getConnectionState(pc) !== 'connected') {\n      throw err\n    }\n  }\n}\n\nexport function getConnectionState (pc: RTCPeerConnection): string {\n  return isFirefox ? pc.iceConnectionState : pc.connectionState\n}\n\nfunction resolveOnConnected (pc: RTCPeerConnection, promise: DeferredPromise<void>): void {\n  pc[isFirefox ? 'oniceconnectionstatechange' : 'onconnectionstatechange'] = (_) => {\n    switch (getConnectionState(pc)) {\n      case 'connected':\n        promise.resolve()\n        break\n      case 'failed':\n      case 'disconnected':\n      case 'closed':\n        promise.reject(new ConnectionFailedError('RTCPeerConnection was closed'))\n        break\n      default:\n        break\n    }\n  }\n}\n", "import { InvalidParametersError } from '@libp2p/interface'\nimport { peerIdFromString } from '@libp2p/peer-id'\nimport { pbStream } from 'it-protobuf-stream'\nimport { CustomProgressEvent } from 'progress-events'\nimport { SDPHandshakeFailedError } from '../error.js'\nimport { DataChannelMuxerFactory } from '../muxer.js'\nimport { RTCPeerConnection, RTCSessionDescription } from '../webrtc/index.js'\nimport { Message } from './pb/message.js'\nimport { SIGNALING_PROTO_ID, splitAddr, type WebRTCDialEvents, type WebRTCTransportMetrics } from './transport.js'\nimport { readCandidatesUntilConnected } from './util.js'\nimport type { DataChannelOptions } from '../index.js'\nimport type { LoggerOptions, Connection, ComponentLogger } from '@libp2p/interface'\nimport type { ConnectionManager, IncomingStreamData, TransportManager } from '@libp2p/interface-internal'\nimport type { Multiaddr } from '@multiformats/multiaddr'\nimport type { ProgressOptions } from 'progress-events'\n\nexport interface IncomingStreamOpts extends IncomingStreamData {\n  rtcConfiguration?: RTCConfiguration\n  dataChannelOptions?: Partial<DataChannelOptions>\n  signal: AbortSignal\n}\n\nexport interface ConnectOptions extends LoggerOptions, ProgressOptions<WebRTCDialEvents> {\n  rtcConfiguration?: RTCConfiguration\n  dataChannel?: DataChannelOptions\n  multiaddr: Multiaddr\n  connectionManager: ConnectionManager\n  transportManager: TransportManager\n  dataChannelOptions?: Partial<DataChannelOptions>\n  signal?: AbortSignal\n  metrics?: WebRTCTransportMetrics\n  logger: ComponentLogger\n}\n\nexport async function initiateConnection ({ rtcConfiguration, dataChannel, signal, metrics, multiaddr: ma, connectionManager, transportManager, log, logger, onProgress }: ConnectOptions): Promise<{ remoteAddress: Multiaddr, peerConnection: RTCPeerConnection, muxerFactory: DataChannelMuxerFactory }> {\n  const { baseAddr } = splitAddr(ma)\n\n  metrics?.dialerEvents.increment({ open: true })\n\n  log.trace('dialing base address: %a', baseAddr)\n\n  const relayPeer = baseAddr.getPeerId()\n\n  if (relayPeer == null) {\n    throw new InvalidParametersError('Relay peer was missing')\n  }\n\n  const connections = connectionManager.getConnections(peerIdFromString(relayPeer))\n  let connection: Connection\n  let shouldCloseConnection = false\n\n  if (connections.length === 0) {\n    onProgress?.(new CustomProgressEvent('webrtc:dial-relay'))\n\n    // use the transport manager to open a connection. Initiating a WebRTC\n    // connection takes place in the context of a dial - if we use the\n    // connection manager instead we can end up joining our own dial context\n    connection = await transportManager.dial(baseAddr, {\n      signal,\n      onProgress\n    })\n    // this connection is unmanaged by the connection manager so we should\n    // close it when we are done\n    shouldCloseConnection = true\n  } else {\n    onProgress?.(new CustomProgressEvent('webrtc:reuse-relay-connection'))\n\n    connection = connections[0]\n  }\n\n  try {\n    onProgress?.(new CustomProgressEvent('webrtc:open-signaling-stream'))\n\n    const stream = await connection.newStream(SIGNALING_PROTO_ID, {\n      signal,\n      runOnLimitedConnection: true\n    })\n\n    const messageStream = pbStream(stream).pb(Message)\n    const peerConnection = new RTCPeerConnection(rtcConfiguration)\n    const muxerFactory = new DataChannelMuxerFactory({\n      logger\n    }, {\n      peerConnection,\n      dataChannelOptions: dataChannel\n    })\n\n    try {\n      // we create the channel so that the RTCPeerConnection has a component for\n      // which to collect candidates. The label is not relevant to connection\n      // initiation but can be useful for debugging\n      const channel = peerConnection.createDataChannel('init')\n\n      // setup callback to write ICE candidates to the remote peer\n      peerConnection.onicecandidate = ({ candidate }) => {\n        // a null candidate means end-of-candidates, an empty string candidate\n        // means end-of-candidates for this generation, otherwise this should\n        // be a valid candidate object\n        // see - https://www.w3.org/TR/webrtc/#rtcpeerconnectioniceevent\n        const data = JSON.stringify(candidate?.toJSON() ?? null)\n\n        log.trace('initiator sending ICE candidate %o', candidate)\n\n        void messageStream.write({\n          type: Message.Type.ICE_CANDIDATE,\n          data\n        }, {\n          signal\n        })\n          .catch(err => {\n            log.error('error sending ICE candidate', err)\n          })\n      }\n      peerConnection.onicecandidateerror = (event) => {\n        log.error('initiator ICE candidate error', event)\n      }\n\n      // create an offer\n      const offerSdp = await peerConnection.createOffer().catch(err => {\n        log.error('could not execute createOffer', err)\n        throw new SDPHandshakeFailedError('Failed to set createOffer')\n      })\n\n      log.trace('initiator send SDP offer %s', offerSdp.sdp)\n\n      onProgress?.(new CustomProgressEvent('webrtc:send-sdp-offer'))\n\n      // write the offer to the stream\n      await messageStream.write({ type: Message.Type.SDP_OFFER, data: offerSdp.sdp }, {\n        signal\n      })\n\n      // set offer as local description\n      await peerConnection.setLocalDescription(offerSdp).catch(err => {\n        log.error('could not execute setLocalDescription', err)\n        throw new SDPHandshakeFailedError('Failed to set localDescription')\n      })\n\n      onProgress?.(new CustomProgressEvent('webrtc:read-sdp-answer'))\n\n      log.trace('initiator read SDP answer')\n\n      // read answer\n      const answerMessage = await messageStream.read({\n        signal\n      })\n\n      if (answerMessage.type !== Message.Type.SDP_ANSWER) {\n        throw new SDPHandshakeFailedError('Remote should send an SDP answer')\n      }\n\n      log.trace('initiator received SDP answer %s', answerMessage.data)\n\n      const answerSdp = new RTCSessionDescription({ type: 'answer', sdp: answerMessage.data })\n      await peerConnection.setRemoteDescription(answerSdp).catch(err => {\n        log.error('could not execute setRemoteDescription', err)\n        throw new SDPHandshakeFailedError('Failed to set remoteDescription')\n      })\n\n      log.trace('initiator read candidates until connected')\n\n      onProgress?.(new CustomProgressEvent('webrtc:read-ice-candidates'))\n\n      await readCandidatesUntilConnected(peerConnection, messageStream, {\n        direction: 'initiator',\n        signal,\n        log,\n        onProgress\n      })\n\n      log.trace('initiator connected, closing init channel')\n      channel.close()\n\n      onProgress?.(new CustomProgressEvent('webrtc:close-signaling-stream'))\n\n      log.trace('closing signaling channel')\n      await stream.close({\n        signal\n      })\n\n      log.trace('initiator connected to remote address %s', ma)\n\n      return {\n        remoteAddress: ma,\n        peerConnection,\n        muxerFactory\n      }\n    } catch (err: any) {\n      log.error('outgoing signaling error', err)\n\n      peerConnection.close()\n      stream.abort(err)\n      throw err\n    } finally {\n      peerConnection.onicecandidate = null\n      peerConnection.onicecandidateerror = null\n    }\n  } finally {\n    // if we had to open a connection to perform the SDP handshake\n    // close it because it's not tracked by the connection manager\n    if (shouldCloseConnection) {\n      try {\n        await connection.close({\n          signal\n        })\n      } catch (err: any) {\n        connection.abort(err)\n      }\n    }\n  }\n}\n", "import { TypedEventEmitter } from '@libp2p/interface'\nimport { P2P } from '@multiformats/multiaddr-matcher'\nimport { fmt, literal } from '@multiformats/multiaddr-matcher/utils'\nimport type { PeerId, ListenerEvents, Listener } from '@libp2p/interface'\nimport type { TransportManager } from '@libp2p/interface-internal'\nimport type { Multiaddr } from '@multiformats/multiaddr'\n\nconst Circuit = fmt(P2P.matchers[0], literal('p2p-circuit'))\n\nexport interface WebRTCPeerListenerComponents {\n  peerId: PeerId\n  transportManager: TransportManager\n}\n\nexport interface WebRTCPeerListenerInit {\n  shutdownController: AbortController\n}\n\nexport class WebRTCPeerListener extends TypedEventEmitter<ListenerEvents> implements Listener {\n  private readonly transportManager: TransportManager\n  private readonly shutdownController: AbortController\n\n  constructor (components: WebRTCPeerListenerComponents, init: WebRTCPeerListenerInit) {\n    super()\n\n    this.transportManager = components.transportManager\n    this.shutdownController = init.shutdownController\n  }\n\n  async listen (): Promise<void> {\n    queueMicrotask(() => {\n      this.safeDispatchEvent('listening')\n    })\n  }\n\n  getAddrs (): Multiaddr[] {\n    return this.transportManager\n      .getListeners()\n      .filter(l => l !== this)\n      .map(l => l.getAddrs()\n        .filter(ma => Circuit.exactMatch(ma))\n        .map(ma => {\n          return ma.encapsulate('/webrtc')\n        })\n      )\n      .flat()\n  }\n\n  async close (): Promise<void> {\n    this.shutdownController.abort()\n    queueMicrotask(() => {\n      this.safeDispatchEvent('close')\n    })\n  }\n}\n", "import { multiaddr, type Multiaddr } from '@multiformats/multiaddr'\nimport { pbStream } from 'it-protobuf-stream'\nimport { SDPHandshakeFailedError } from '../error.js'\nimport { type RTCPeerConnection, RTCSessionDescription } from '../webrtc/index.js'\nimport { Message } from './pb/message.js'\nimport { getConnectionState, readCandidatesUntilConnected } from './util.js'\nimport type { Logger } from '@libp2p/interface'\nimport type { IncomingStreamData } from '@libp2p/interface-internal'\n\nexport interface IncomingStreamOpts extends IncomingStreamData {\n  peerConnection: RTCPeerConnection\n  signal: AbortSignal\n  log: Logger\n}\n\nexport async function handleIncomingStream ({ peerConnection, stream, signal, connection, log }: IncomingStreamOpts): Promise<{ remoteAddress: Multiaddr }> {\n  log.trace('new inbound signaling stream')\n\n  const messageStream = pbStream(stream).pb(Message)\n\n  try {\n    // candidate callbacks\n    peerConnection.onicecandidate = ({ candidate }) => {\n      // a null candidate means end-of-candidates, an empty string candidate\n      // means end-of-candidates for this generation, otherwise this should\n      // be a valid candidate object\n      // see - https://www.w3.org/TR/webrtc/#rtcpeerconnectioniceevent\n      const data = JSON.stringify(candidate?.toJSON() ?? null)\n\n      log.trace('recipient sending ICE candidate %s', data)\n\n      messageStream.write({\n        type: Message.Type.ICE_CANDIDATE,\n        data\n      }, {\n        signal\n      })\n        .catch(err => {\n          log.error('error sending ICE candidate', err)\n        })\n    }\n\n    log.trace('recipient read SDP offer')\n\n    // read an SDP offer\n    const pbOffer = await messageStream.read({\n      signal\n    })\n\n    if (pbOffer.type !== Message.Type.SDP_OFFER) {\n      throw new SDPHandshakeFailedError(`expected message type SDP_OFFER, received: ${pbOffer.type ?? 'undefined'} `)\n    }\n\n    log.trace('recipient received SDP offer %s', pbOffer.data)\n\n    const offer = new RTCSessionDescription({\n      type: 'offer',\n      sdp: pbOffer.data\n    })\n\n    await peerConnection.setRemoteDescription(offer).catch(err => {\n      log.error('could not execute setRemoteDescription', err)\n      throw new SDPHandshakeFailedError('Failed to set remoteDescription')\n    })\n\n    // create and write an SDP answer\n    const answer = await peerConnection.createAnswer().catch(err => {\n      log.error('could not execute createAnswer', err)\n      throw new SDPHandshakeFailedError('Failed to create answer')\n    })\n\n    log.trace('recipient send SDP answer %s', answer.sdp)\n\n    // write the answer to the remote\n    await messageStream.write({ type: Message.Type.SDP_ANSWER, data: answer.sdp }, {\n      signal\n    })\n\n    await peerConnection.setLocalDescription(answer).catch(err => {\n      log.error('could not execute setLocalDescription', err)\n      throw new SDPHandshakeFailedError('Failed to set localDescription')\n    })\n\n    log.trace('recipient read candidates until connected')\n\n    // wait until candidates are connected\n    await readCandidatesUntilConnected(peerConnection, messageStream, {\n      direction: 'recipient',\n      signal,\n      log\n    })\n  } catch (err: any) {\n    if (getConnectionState(peerConnection) !== 'connected') {\n      log.error('error while handling signaling stream from peer %a', connection.remoteAddr, err)\n\n      peerConnection.close()\n      throw err\n    } else {\n      log('error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected', connection.remoteAddr, err)\n    }\n  }\n\n  const remoteAddress = multiaddr(`/webrtc/p2p/${connection.remoteAddr.getPeerId()}`)\n\n  log.trace('recipient connected to remote address %s', remoteAddress)\n\n  return { remoteAddress }\n}\n", "import { InvalidParametersError, serviceCapabilities, serviceDependencies, setMaxListeners, transportSymbol } from '@libp2p/interface'\nimport { peerIdFromString } from '@libp2p/peer-id'\nimport { multiaddr, type Multiaddr } from '@multiformats/multiaddr'\nimport { WebRTC } from '@multiformats/multiaddr-matcher'\nimport { WebRTCMultiaddrConnection } from '../maconn.js'\nimport { DataChannelMuxerFactory } from '../muxer.js'\nimport { getRtcConfiguration } from '../util.js'\nimport { RTCPeerConnection } from '../webrtc/index.js'\nimport { initiateConnection } from './initiate-connection.js'\nimport { WebRTCPeerListener } from './listener.js'\nimport { handleIncomingStream } from './signaling-stream-handler.js'\nimport type { DataChannelOptions } from '../index.js'\nimport type { OutboundConnectionUpgradeEvents, CreateListenerOptions, DialTransportOptions, Transport, Listener, Upgrader, ComponentLogger, Logger, Connection, PeerId, CounterGroup, Metrics, Startable, OpenConnectionProgressEvents } from '@libp2p/interface'\nimport type { IncomingStreamData, Registrar, ConnectionManager, TransportManager } from '@libp2p/interface-internal'\nimport type { ProgressEvent } from 'progress-events'\n\nconst WEBRTC_TRANSPORT = '/webrtc'\nconst CIRCUIT_RELAY_TRANSPORT = '/p2p-circuit'\nexport const SIGNALING_PROTO_ID = '/webrtc-signaling/0.0.1'\nconst INBOUND_CONNECTION_TIMEOUT = 30 * 1000\n\nexport interface WebRTCTransportInit {\n  rtcConfiguration?: RTCConfiguration | (() => RTCConfiguration | Promise<RTCConfiguration>)\n  dataChannel?: DataChannelOptions\n\n  /**\n   * Inbound connections must complete the upgrade within this many ms\n   *\n   * @default 30000\n   */\n  inboundConnectionTimeout?: number\n}\n\nexport interface WebRTCTransportComponents {\n  peerId: PeerId\n  registrar: Registrar\n  upgrader: Upgrader\n  transportManager: TransportManager\n  connectionManager: ConnectionManager\n  metrics?: Metrics\n  logger: ComponentLogger\n}\n\nexport interface WebRTCTransportMetrics {\n  dialerEvents: CounterGroup\n  listenerEvents: CounterGroup\n}\n\nexport type WebRTCDialEvents =\n  OutboundConnectionUpgradeEvents |\n  OpenConnectionProgressEvents |\n  ProgressEvent<'webrtc:dial-relay'> |\n  ProgressEvent<'webrtc:reuse-relay-connection'> |\n  ProgressEvent<'webrtc:open-signaling-stream'> |\n  ProgressEvent<'webrtc:send-sdp-offer'> |\n  ProgressEvent<'webrtc:read-sdp-answer'> |\n  ProgressEvent<'webrtc:read-ice-candidates'> |\n  ProgressEvent<'webrtc:add-ice-candidate', string> |\n  ProgressEvent<'webrtc:end-of-ice-candidates'> |\n  ProgressEvent<'webrtc:close-signaling-stream'>\n\nexport class WebRTCTransport implements Transport<WebRTCDialEvents>, Startable {\n  private readonly log: Logger\n  private _started = false\n  private readonly metrics?: WebRTCTransportMetrics\n  private readonly shutdownController: AbortController\n\n  constructor (\n    private readonly components: WebRTCTransportComponents,\n    private readonly init: WebRTCTransportInit = {}\n  ) {\n    this.log = components.logger.forComponent('libp2p:webrtc')\n    this.shutdownController = new AbortController()\n    setMaxListeners(Infinity, this.shutdownController.signal)\n\n    if (components.metrics != null) {\n      this.metrics = {\n        dialerEvents: components.metrics.registerCounterGroup('libp2p_webrtc_dialer_events_total', {\n          label: 'event',\n          help: 'Total count of WebRTC dialer events by type'\n        }),\n        listenerEvents: components.metrics.registerCounterGroup('libp2p_webrtc_listener_events_total', {\n          label: 'event',\n          help: 'Total count of WebRTC listener events by type'\n        })\n      }\n    }\n  }\n\n  readonly [transportSymbol] = true\n\n  readonly [Symbol.toStringTag] = '@libp2p/webrtc'\n\n  readonly [serviceCapabilities]: string[] = [\n    '@libp2p/transport'\n  ]\n\n  readonly [serviceDependencies]: string[] = [\n    '@libp2p/identify',\n    '@libp2p/circuit-relay-v2-transport'\n  ]\n\n  isStarted (): boolean {\n    return this._started\n  }\n\n  async start (): Promise<void> {\n    await this.components.registrar.handle(SIGNALING_PROTO_ID, (data: IncomingStreamData) => {\n      this._onProtocol(data).catch(err => { this.log.error('failed to handle incoming connect from %p', data.connection.remotePeer, err) })\n    }, {\n      runOnLimitedConnection: true\n    })\n    this._started = true\n  }\n\n  async stop (): Promise<void> {\n    await this.components.registrar.unhandle(SIGNALING_PROTO_ID)\n    this._started = false\n  }\n\n  createListener (options: CreateListenerOptions): Listener {\n    return new WebRTCPeerListener(this.components, {\n      shutdownController: this.shutdownController\n    })\n  }\n\n  /**\n   * Filter check for all Multiaddrs that this transport can listen on\n   */\n  listenFilter (multiaddrs: Multiaddr[]): Multiaddr[] {\n    return multiaddrs.filter(WebRTC.exactMatch)\n  }\n\n  /**\n   * Filter check for all Multiaddrs that this transport can dial\n   */\n  dialFilter (multiaddrs: Multiaddr[]): Multiaddr[] {\n    return this.listenFilter(multiaddrs)\n  }\n\n  /*\n   * dial connects to a remote via the circuit relay or any other protocol\n   * and proceeds to upgrade to a webrtc connection.\n   * multiaddr of the form: <multiaddr>/webrtc/p2p/<destination-peer>\n   * For a circuit relay, this will be of the form\n   * <relay address>/p2p/<relay-peer>/p2p-circuit/webrtc/p2p/<destination-peer>\n  */\n  async dial (ma: Multiaddr, options: DialTransportOptions<WebRTCDialEvents>): Promise<Connection> {\n    this.log.trace('dialing address: %a', ma)\n\n    const { remoteAddress, peerConnection, muxerFactory } = await initiateConnection({\n      rtcConfiguration: await getRtcConfiguration(this.init.rtcConfiguration),\n      dataChannel: this.init.dataChannel,\n      multiaddr: ma,\n      dataChannelOptions: this.init.dataChannel,\n      signal: options.signal,\n      connectionManager: this.components.connectionManager,\n      transportManager: this.components.transportManager,\n      log: this.log,\n      logger: this.components.logger,\n      onProgress: options.onProgress\n    })\n\n    const webRTCConn = new WebRTCMultiaddrConnection(this.components, {\n      peerConnection,\n      timeline: { open: Date.now() },\n      remoteAddr: remoteAddress,\n      metrics: this.metrics?.dialerEvents\n    })\n\n    const connection = await options.upgrader.upgradeOutbound(webRTCConn, {\n      skipProtection: true,\n      skipEncryption: true,\n      muxerFactory,\n      onProgress: options.onProgress\n    })\n\n    // close the connection on shut down\n    this._closeOnShutdown(peerConnection, webRTCConn)\n\n    return connection\n  }\n\n  async _onProtocol ({ connection, stream }: IncomingStreamData): Promise<void> {\n    const signal = AbortSignal.timeout(this.init.inboundConnectionTimeout ?? INBOUND_CONNECTION_TIMEOUT)\n    const peerConnection = new RTCPeerConnection(await getRtcConfiguration(this.init.rtcConfiguration))\n    const muxerFactory = new DataChannelMuxerFactory(this.components, {\n      peerConnection,\n      dataChannelOptions: this.init.dataChannel\n    })\n\n    try {\n      const { remoteAddress } = await handleIncomingStream({\n        peerConnection,\n        connection,\n        stream,\n        signal,\n        log: this.log\n      })\n\n      // close the stream if SDP messages have been exchanged successfully\n      await stream.close({\n        signal\n      })\n\n      const webRTCConn = new WebRTCMultiaddrConnection(this.components, {\n        peerConnection,\n        timeline: { open: (new Date()).getTime() },\n        remoteAddr: remoteAddress,\n        metrics: this.metrics?.listenerEvents\n      })\n\n      await this.components.upgrader.upgradeInbound(webRTCConn, {\n        skipEncryption: true,\n        skipProtection: true,\n        muxerFactory\n      })\n\n      // close the connection on shut down\n      this._closeOnShutdown(peerConnection, webRTCConn)\n    } catch (err: any) {\n      this.log.error('incoming signaling error', err)\n\n      peerConnection.close()\n      stream.abort(err)\n      throw err\n    }\n  }\n\n  private _closeOnShutdown (pc: RTCPeerConnection, webRTCConn: WebRTCMultiaddrConnection): void {\n    // close the connection on shut down\n    const shutDownListener = (): void => {\n      webRTCConn.close()\n        .catch(err => {\n          this.log.error('could not close WebRTCMultiaddrConnection', err)\n        })\n    }\n\n    this.shutdownController.signal.addEventListener('abort', shutDownListener)\n\n    pc.addEventListener('close', () => {\n      this.shutdownController.signal.removeEventListener('abort', shutDownListener)\n    })\n  }\n}\n\nexport function splitAddr (ma: Multiaddr): { baseAddr: Multiaddr, peerId: PeerId } {\n  const addrs = ma.toString().split(WEBRTC_TRANSPORT + '/')\n  if (addrs.length !== 2) {\n    throw new InvalidParametersError('webrtc protocol was not present in multiaddr')\n  }\n\n  if (!addrs[0].includes(CIRCUIT_RELAY_TRANSPORT)) {\n    throw new InvalidParametersError('p2p-circuit protocol was not present in multiaddr')\n  }\n\n  // look for remote peerId\n  let remoteAddr = multiaddr(addrs[0])\n  const destination = multiaddr('/' + addrs[1])\n\n  const destinationIdString = destination.getPeerId()\n  if (destinationIdString == null) {\n    throw new InvalidParametersError('destination peer id was missing')\n  }\n\n  const lastProtoInRemote = remoteAddr.protos().pop()\n  if (lastProtoInRemote === undefined) {\n    throw new InvalidParametersError('invalid multiaddr')\n  }\n  if (lastProtoInRemote.name !== 'p2p') {\n    remoteAddr = remoteAddr.encapsulate(`/p2p/${destinationIdString}`)\n  }\n\n  return { baseAddr: remoteAddr, peerId: peerIdFromString(destinationIdString) }\n}\n", "import { InvalidParametersError } from '@libp2p/interface'\nimport { type Multiaddr } from '@multiformats/multiaddr'\nimport { bases, digest } from 'multiformats/basics'\nimport { InvalidFingerprintError, UnsupportedHashAlgorithmError } from '../error.js'\nimport { MAX_MESSAGE_SIZE } from '../stream.js'\nimport { CERTHASH_CODE } from './transport.js'\nimport type { LoggerOptions } from '@libp2p/interface'\nimport type { MultihashDigest } from 'multiformats/hashes/interface'\n\n/**\n * Get base2 | identity decoders\n */\n// @ts-expect-error - Not easy to combine these types.\nexport const mbdecoder: any = Object.values(bases).map(b => b.decoder).reduce((d, b) => d.or(b))\n\nexport function getLocalFingerprint (pc: RTCPeerConnection, options: LoggerOptions): string | undefined {\n  // try to fetch fingerprint from local certificate\n  const localCert = pc.getConfiguration().certificates?.at(0)\n  if (localCert?.getFingerprints == null) {\n    options.log.trace('fetching fingerprint from local SDP')\n    const localDescription = pc.localDescription\n    if (localDescription == null) {\n      return undefined\n    }\n    return getFingerprintFromSdp(localDescription.sdp)\n  }\n\n  options.log.trace('fetching fingerprint from local certificate')\n\n  if (localCert.getFingerprints().length === 0) {\n    return undefined\n  }\n\n  const fingerprint = localCert.getFingerprints()[0].value\n  if (fingerprint == null) {\n    throw new InvalidFingerprintError('', 'no fingerprint on local certificate')\n  }\n\n  return fingerprint\n}\n\nconst fingerprintRegex = /^a=fingerprint:(?:\\w+-[0-9]+)\\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m\nexport function getFingerprintFromSdp (sdp: string): string | undefined {\n  const searchResult = sdp.match(fingerprintRegex)\n  return searchResult?.groups?.fingerprint\n}\n\n/**\n * Get base2 | identity decoders\n */\nfunction ipv (ma: Multiaddr): string {\n  for (const proto of ma.protoNames()) {\n    if (proto.startsWith('ip')) {\n      return proto.toUpperCase()\n    }\n  }\n\n  return 'IP6'\n}\n\n// Extract the certhash from a multiaddr\nexport function certhash (ma: Multiaddr): string {\n  const tups = ma.stringTuples()\n  const certhash = tups.filter((tup) => tup[0] === CERTHASH_CODE).map((tup) => tup[1])[0]\n\n  if (certhash === undefined || certhash === '') {\n    throw new InvalidParametersError(`Couldn't find a certhash component of multiaddr: ${ma.toString()}`)\n  }\n\n  return certhash\n}\n\n/**\n * Convert a certhash into a multihash\n */\nexport function decodeCerthash (certhash: string): MultihashDigest {\n  return digest.decode(mbdecoder.decode(certhash))\n}\n\n/**\n * Extract the fingerprint from a multiaddr\n */\nexport function ma2Fingerprint (ma: Multiaddr): string[] {\n  const mhdecoded = decodeCerthash(certhash(ma))\n  const prefix = toSupportedHashFunction(mhdecoded.code)\n  const fingerprint = mhdecoded.digest.reduce((str, byte) => str + byte.toString(16).padStart(2, '0'), '')\n  const sdp = fingerprint.match(/.{1,2}/g)\n\n  if (sdp == null) {\n    throw new InvalidFingerprintError(fingerprint, ma.toString())\n  }\n\n  return [`${prefix} ${sdp.join(':').toUpperCase()}`, fingerprint]\n}\n\n/**\n * Normalize the hash name from a given multihash has name\n */\nexport function toSupportedHashFunction (code: number): 'SHA-1' | 'SHA-256' | 'SHA-512' {\n  switch (code) {\n    case 0x11:\n      return 'SHA-1'\n    case 0x12:\n      return 'SHA-256'\n    case 0x13:\n      return 'SHA-512'\n    default:\n      throw new UnsupportedHashAlgorithmError(code)\n  }\n}\n\n/**\n * Convert a multiaddr into a SDP\n */\nfunction ma2sdp (ma: Multiaddr, ufrag: string): string {\n  const { host, port } = ma.toOptions()\n  const ipVersion = ipv(ma)\n  const [CERTFP] = ma2Fingerprint(ma)\n\n  return `v=0\no=- 0 0 IN ${ipVersion} ${host}\ns=-\nc=IN ${ipVersion} ${host}\nt=0 0\na=ice-lite\nm=application ${port} UDP/DTLS/SCTP webrtc-datachannel\na=mid:0\na=setup:passive\na=ice-ufrag:${ufrag}\na=ice-pwd:${ufrag}\na=fingerprint:${CERTFP}\na=sctp-port:5000\na=max-message-size:${MAX_MESSAGE_SIZE}\na=candidate:1467250027 1 UDP 1467250027 ${host} ${port} typ host\\r\\n`\n}\n\n/**\n * Create an answer SDP from a multiaddr\n */\nexport function fromMultiAddr (ma: Multiaddr, ufrag: string): RTCSessionDescriptionInit {\n  return {\n    type: 'answer',\n    sdp: ma2sdp(ma, ufrag)\n  }\n}\n\n/**\n * Replace (munge) the ufrag and password values in a SDP\n */\nexport function munge (desc: RTCSessionDescriptionInit, ufrag: string): RTCSessionDescriptionInit {\n  if (desc.sdp === undefined) {\n    throw new InvalidParametersError(\"Can't munge a missing SDP\")\n  }\n\n  desc.sdp = desc.sdp\n    .replace(/\\na=ice-ufrag:[^\\n]*\\n/, '\\na=ice-ufrag:' + ufrag + '\\n')\n    .replace(/\\na=ice-pwd:[^\\n]*\\n/, '\\na=ice-pwd:' + ufrag + '\\n')\n  return desc\n}\n", "const charset = Array.from('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/')\nexport const genUfrag = (len: number): string => [...Array(len)].map(() => charset.at(Math.floor(Math.random() * charset.length))).join('')\n", "import { noise } from '@chainsafe/libp2p-noise'\nimport { transportSymbol, serviceCapabilities, InvalidParametersError } from '@libp2p/interface'\nimport { peerIdFromString } from '@libp2p/peer-id'\nimport { protocols } from '@multiformats/multiaddr'\nimport { WebRTCDirect } from '@multiformats/multiaddr-matcher'\nimport * as Digest from 'multiformats/hashes/digest'\nimport { concat } from 'uint8arrays/concat'\nimport { fromString as uint8arrayFromString } from 'uint8arrays/from-string'\nimport { DataChannelError, UnimplementedError } from '../error.js'\nimport { WebRTCMultiaddrConnection } from '../maconn.js'\nimport { DataChannelMuxerFactory } from '../muxer.js'\nimport { createStream } from '../stream.js'\nimport { getRtcConfiguration, isFirefox } from '../util.js'\nimport { RTCPeerConnection } from '../webrtc/index.js'\nimport * as sdp from './sdp.js'\nimport { genUfrag } from './util.js'\nimport type { WebRTCDialOptions } from './options.js'\nimport type { DataChannelOptions } from '../index.js'\nimport type { CreateListenerOptions, Transport, Listener, ComponentLogger, Logger, Connection, CounterGroup, Metrics, PeerId, PrivateKey } from '@libp2p/interface'\nimport type { Multiaddr } from '@multiformats/multiaddr'\n\n/**\n * The time to wait, in milliseconds, for the data channel handshake to complete\n */\nconst HANDSHAKE_TIMEOUT_MS = 10_000\n\n/**\n * Created by converting the hexadecimal protocol code to an integer.\n *\n * {@link https://github.com/multiformats/multiaddr/blob/master/protocols.csv}\n */\nexport const WEBRTC_CODE: number = protocols('webrtc-direct').code\n\n/**\n * Created by converting the hexadecimal protocol code to an integer.\n *\n * {@link https://github.com/multiformats/multiaddr/blob/master/protocols.csv}\n */\nexport const CERTHASH_CODE: number = protocols('certhash').code\n\n/**\n * The peer for this transport\n */\nexport interface WebRTCDirectTransportComponents {\n  peerId: PeerId\n  privateKey: PrivateKey\n  metrics?: Metrics\n  logger: ComponentLogger\n}\n\nexport interface WebRTCMetrics {\n  dialerEvents: CounterGroup\n}\n\nexport interface WebRTCTransportDirectInit {\n  rtcConfiguration?: RTCConfiguration | (() => RTCConfiguration | Promise<RTCConfiguration>)\n  dataChannel?: DataChannelOptions\n}\n\nexport class WebRTCDirectTransport implements Transport {\n  private readonly log: Logger\n  private readonly metrics?: WebRTCMetrics\n  private readonly components: WebRTCDirectTransportComponents\n  private readonly init: WebRTCTransportDirectInit\n  constructor (components: WebRTCDirectTransportComponents, init: WebRTCTransportDirectInit = {}) {\n    this.log = components.logger.forComponent('libp2p:webrtc-direct')\n    this.components = components\n    this.init = init\n    if (components.metrics != null) {\n      this.metrics = {\n        dialerEvents: components.metrics.registerCounterGroup('libp2p_webrtc-direct_dialer_events_total', {\n          label: 'event',\n          help: 'Total count of WebRTC-direct dial events by type'\n        })\n      }\n    }\n  }\n\n  readonly [transportSymbol] = true\n\n  readonly [Symbol.toStringTag] = '@libp2p/webrtc-direct'\n\n  readonly [serviceCapabilities]: string[] = [\n    '@libp2p/transport'\n  ]\n\n  /**\n   * Dial a given multiaddr\n   */\n  async dial (ma: Multiaddr, options: WebRTCDialOptions): Promise<Connection> {\n    const rawConn = await this._connect(ma, options)\n    this.log('dialing address: %a', ma)\n    return rawConn\n  }\n\n  /**\n   * Create transport listeners no supported by browsers\n   */\n  createListener (options: CreateListenerOptions): Listener {\n    throw new UnimplementedError('WebRTCTransport.createListener')\n  }\n\n  /**\n   * Filter check for all Multiaddrs that this transport can listen on\n   */\n  listenFilter (multiaddrs: Multiaddr[]): Multiaddr[] {\n    return multiaddrs.filter(WebRTCDirect.exactMatch)\n  }\n\n  /**\n   * Filter check for all Multiaddrs that this transport can dial\n   */\n  dialFilter (multiaddrs: Multiaddr[]): Multiaddr[] {\n    return this.listenFilter(multiaddrs)\n  }\n\n  /**\n   * Connect to a peer using a multiaddr\n   */\n  async _connect (ma: Multiaddr, options: WebRTCDialOptions): Promise<Connection> {\n    const controller = new AbortController()\n    const signal = controller.signal\n\n    let remotePeer: PeerId | undefined\n    const remotePeerString = ma.getPeerId()\n    if (remotePeerString != null) {\n      remotePeer = peerIdFromString(remotePeerString)\n    }\n\n    const remoteCerthash = sdp.decodeCerthash(sdp.certhash(ma))\n\n    // ECDSA is preferred over RSA here. From our testing we find that P-256 elliptic\n    // curve is supported by Pion, webrtc-rs, as well as Chromium (P-228 and P-384\n    // was not supported in Chromium). We use the same hash function as found in the\n    // multiaddr if it is supported.\n    const certificate = await RTCPeerConnection.generateCertificate({\n      name: 'ECDSA',\n      namedCurve: 'P-256',\n      hash: sdp.toSupportedHashFunction(remoteCerthash.code)\n    } as any)\n\n    const peerConnection = new RTCPeerConnection({\n      ...(await getRtcConfiguration(this.init.rtcConfiguration)),\n      certificates: [certificate]\n    })\n\n    try {\n      // create data channel for running the noise handshake. Once the data channel is opened,\n      // the remote will initiate the noise handshake. This is used to confirm the identity of\n      // the peer.\n      const dataChannelOpenPromise = new Promise<RTCDataChannel>((resolve, reject) => {\n        const handshakeDataChannel = peerConnection.createDataChannel('', { negotiated: true, id: 0 })\n        const handshakeTimeout = setTimeout(() => {\n          const error = `Data channel was never opened: state: ${handshakeDataChannel.readyState}`\n          this.log.error(error)\n          this.metrics?.dialerEvents.increment({ open_error: true })\n          reject(new DataChannelError('data', error))\n        }, HANDSHAKE_TIMEOUT_MS)\n\n        handshakeDataChannel.onopen = (_) => {\n          clearTimeout(handshakeTimeout)\n          resolve(handshakeDataChannel)\n        }\n\n        // ref: https://developer.mozilla.org/en-US/docs/Web/API/RTCDataChannel/error_event\n        handshakeDataChannel.onerror = (event: Event) => {\n          clearTimeout(handshakeTimeout)\n          const errorTarget = event.target?.toString() ?? 'not specified'\n          const error = `Error opening a data channel for handshaking: ${errorTarget}`\n          this.log.error(error)\n          // NOTE: We use unknown error here but this could potentially be considered a reset by some standards.\n          this.metrics?.dialerEvents.increment({ unknown_error: true })\n          reject(new DataChannelError('data', error))\n        }\n      })\n\n      const ufrag = 'libp2p+webrtc+v1/' + genUfrag(32)\n\n      // Create offer and munge sdp with ufrag == pwd. This allows the remote to\n      // respond to STUN messages without performing an actual SDP exchange.\n      // This is because it can infer the passwd field by reading the USERNAME\n      // attribute of the STUN message.\n      const offerSdp = await peerConnection.createOffer()\n      const mungedOfferSdp = sdp.munge(offerSdp, ufrag)\n      await peerConnection.setLocalDescription(mungedOfferSdp)\n\n      // construct answer sdp from multiaddr and ufrag\n      const answerSdp = sdp.fromMultiAddr(ma, ufrag)\n      await peerConnection.setRemoteDescription(answerSdp)\n\n      // wait for peerconnection.onopen to fire, or for the datachannel to open\n      const handshakeDataChannel = await dataChannelOpenPromise\n\n      // Do noise handshake.\n      // Set the Noise Prologue to libp2p-webrtc-noise:<FINGERPRINTS> before starting the actual Noise handshake.\n      // <FINGERPRINTS> is the concatenation of the of the two TLS fingerprints of A and B in their multihash byte representation, sorted in ascending order.\n      const fingerprintsPrologue = this.generateNoisePrologue(peerConnection, remoteCerthash.code, ma)\n\n      // Since we use the default crypto interface and do not use a static key or early data,\n      // we pass in undefined for these parameters.\n      const connectionEncrypter = noise({ prologueBytes: fingerprintsPrologue })(this.components)\n\n      const wrappedChannel = createStream({\n        channel: handshakeDataChannel,\n        direction: 'inbound',\n        logger: this.components.logger,\n        ...(this.init.dataChannel ?? {})\n      })\n      const wrappedDuplex = {\n        ...wrappedChannel,\n        sink: wrappedChannel.sink.bind(wrappedChannel),\n        source: (async function * () {\n          for await (const list of wrappedChannel.source) {\n            for (const buf of list) {\n              yield buf\n            }\n          }\n        }())\n      }\n\n      // Creating the connection before completion of the noise\n      // handshake ensures that the stream opening callback is set up\n      const maConn = new WebRTCMultiaddrConnection(this.components, {\n        peerConnection,\n        remoteAddr: ma,\n        timeline: {\n          open: Date.now()\n        },\n        metrics: this.metrics?.dialerEvents\n      })\n\n      const eventListeningName = isFirefox ? 'iceconnectionstatechange' : 'connectionstatechange'\n\n      peerConnection.addEventListener(eventListeningName, () => {\n        switch (peerConnection.connectionState) {\n          case 'failed':\n          case 'disconnected':\n          case 'closed':\n            maConn.close().catch((err) => {\n              this.log.error('error closing connection', err)\n            }).finally(() => {\n              // Remove the event listener once the connection is closed\n              controller.abort()\n            })\n            break\n          default:\n            break\n        }\n      }, { signal })\n\n      // Track opened peer connection\n      this.metrics?.dialerEvents.increment({ peer_connection: true })\n\n      const muxerFactory = new DataChannelMuxerFactory(this.components, {\n        peerConnection,\n        metrics: this.metrics?.dialerEvents,\n        dataChannelOptions: this.init.dataChannel\n      })\n\n      // For outbound connections, the remote is expected to start the noise handshake.\n      // Therefore, we need to secure an inbound noise connection from the remote.\n      await connectionEncrypter.secureInbound(wrappedDuplex, {\n        signal,\n        remotePeer\n      })\n\n      return await options.upgrader.upgradeOutbound(maConn, { skipProtection: true, skipEncryption: true, muxerFactory })\n    } catch (err) {\n      peerConnection.close()\n      throw err\n    }\n  }\n\n  /**\n   * Generate a noise prologue from the peer connection's certificate.\n   * noise prologue = bytes('libp2p-webrtc-noise:') + noise-responder fingerprint + noise-initiator fingerprint\n   */\n  private generateNoisePrologue (pc: RTCPeerConnection, hashCode: number, ma: Multiaddr): Uint8Array {\n    if (pc.getConfiguration().certificates?.length === 0) {\n      throw new InvalidParametersError('no local certificate')\n    }\n\n    const localFingerprint = sdp.getLocalFingerprint(pc, {\n      log: this.log\n    })\n    if (localFingerprint == null) {\n      throw new InvalidParametersError('no local fingerprint found')\n    }\n\n    const localFpString = localFingerprint.trim().toLowerCase().replaceAll(':', '')\n    const localFpArray = uint8arrayFromString(localFpString, 'hex')\n    const local = Digest.create(hashCode, localFpArray)\n    const remote: Uint8Array = sdp.mbdecoder.decode(sdp.certhash(ma))\n    const prefix = uint8arrayFromString('libp2p-webrtc-noise:')\n\n    return concat([prefix, local.bytes, remote])\n  }\n}\n", "/**\n * @packageDocumentation\n *\n * A [libp2p transport](https://docs.libp2p.io/concepts/transports/overview/) based on [WebRTC datachannels](https://webrtc.org/).\n *\n * [WebRTC](https://www.w3.org/TR/webrtc/) is a specification that allows real-time communication between nodes - it's commonly used in browser video conferencing applications but it also provides a reliable data transport mechanism called [data channels](https://www.w3.org/TR/webrtc/#peer-to-peer-data-api) which libp2p uses to facilitate [protocol streams](https://docs.libp2p.io/concepts/multiplex/overview/) between peers.\n *\n * There are two transports exposed by this module, [webRTC](https://github.com/libp2p/specs/blob/master/webrtc/webrtc.md) and [webRTCDirect](https://github.com/libp2p/specs/blob/master/webrtc/webrtc-direct.md).\n *\n * ## WebRTC vs WebRTC Direct\n *\n * The connection establishment phase of WebRTC involves a handshake using [SDP](https://en.wikipedia.org/wiki/Session_Description_Protocol) during which two peers will exchange information such as open ports, network addresses and required capabilities.\n *\n * A third party is usually necessary to carry out this handshake, forwarding messages between the two peers until they can make a direct connection between themselves.\n *\n * The WebRTC transport uses libp2p [Circuit Relay](https://docs.libp2p.io/concepts/nat/circuit-relay/)s to forward SDP messages. Once a direct connection is formed the relay plays no further part in the exchange.\n *\n * WebRTC Direct uses a technique known as [SDP munging](https://webrtchacks.com/not-a-guide-to-sdp-munging/) to skip the handshake step, instead encoding enough information in the connection request that the responder can derive what would have been in the handshake messages and so requires no third parties to establish a connection.\n *\n * A WebRTC Direct multiaddr also includes a certhash of the target peer - this is used to allow opening a connection to the remote, which would otherwise be denied due to use of a self-signed certificate.\n *\n * In both cases, once the connection is established a [Noise handshake](https://noiseprotocol.org/noise.html) is carried out to ensure that the remote peer has the private key that corresponds to the public key that makes up their PeerId, giving you both encryption and authentication.\n *\n * ## Support\n *\n * WebRTC is supported in both Node.js and browsers.\n *\n * At the time of writing, WebRTC Direct is dial-only in browsers and not supported in Node.js at all.\n *\n * Support in Node.js is possible but PRs will need to be opened to [libdatachannel](https://github.com/paullouisageneau/libdatachannel) and the appropriate APIs exposed in [node-datachannel](https://github.com/murat-dogan/node-datachannel).\n *\n * WebRTC Direct support is available in rust-libp2p and arriving soon in go-libp2p.\n *\n * See the WebRTC section of https://connectivity.libp2p.io for more information.\n *\n * @example WebRTC\n *\n * WebRTC requires use of a relay to connect two nodes. The listener first discovers a relay server and makes a reservation, then the dialer can connect via the relayed address.\n *\n * ```TypeScript\n * import { noise } from '@chainsafe/libp2p-noise'\n * import { yamux } from '@chainsafe/libp2p-yamux'\n * import { echo } from '@libp2p/echo'\n * import { circuitRelayTransport, circuitRelayServer } from '@libp2p/circuit-relay-v2'\n * import { identify } from '@libp2p/identify'\n * import { webRTC } from '@libp2p/webrtc'\n * import { webSockets } from '@libp2p/websockets'\n * import * as filters from '@libp2p/websockets/filters'\n * import { WebRTC } from '@multiformats/multiaddr-matcher'\n * import delay from 'delay'\n * import { pipe } from 'it-pipe'\n * import { createLibp2p } from 'libp2p'\n * import type { Multiaddr } from '@multiformats/multiaddr'\n *\n * // the relay server listens on a transport dialable by the listener and the\n * // dialer, and has a relay service configured\n * const relay = await createLibp2p({\n *   addresses: {\n *   listen: ['/ip4/127.0.0.1/tcp/0/ws']\n *   },\n *   transports: [\n *     webSockets({filter: filters.all})\n *   ],\n *   connectionEncrypters: [noise()],\n *   streamMuxers: [yamux()],\n *   services: {\n *     identify: identify(),\n *     relay: circuitRelayServer()\n *   }\n * })\n *\n * // the listener has a WebSocket transport to dial the relay, a Circuit Relay\n * // transport to make a reservation, and a WebRTC transport to accept incoming\n * // WebRTC connections\n * const listener = await createLibp2p({\n *   addresses: {\n *     listen: [\n *       '/p2p-circuit',\n *       '/webrtc'\n *     ]\n *   },\n *   transports: [\n *     webSockets({filter: filters.all}),\n *     webRTC(),\n *     circuitRelayTransport()\n *   ],\n *   connectionEncrypters: [noise()],\n *   streamMuxers: [yamux()],\n *   services: {\n *     identify: identify(),\n *     echo: echo()\n *   }\n * })\n *\n * // the listener dials the relay (or discovers a public relay via some other\n * // method)\n * await listener.dial(relay.getMultiaddrs(), {\n *   signal: AbortSignal.timeout(5000)\n * })\n *\n * let webRTCMultiaddr: Multiaddr | undefined\n *\n * // wait for the listener to make a reservation on the relay\n * while (true) {\n *   webRTCMultiaddr = listener.getMultiaddrs().find(ma => WebRTC.matches(ma))\n *\n *   if (webRTCMultiaddr != null) {\n *     break\n *   }\n *\n *   // try again later\n *   await delay(1000)\n * }\n *\n * // the dialer has Circuit Relay, WebSocket and WebRTC transports to dial\n * // the listener via the relay, complete the SDP handshake and establish a\n * // direct WebRTC connection\n * const dialer = await createLibp2p({\n *   transports: [\n *     webSockets({filter: filters.all}),\n *     webRTC(),\n *     circuitRelayTransport()\n *   ],\n *   connectionEncrypters: [noise()],\n *   streamMuxers: [yamux()],\n *   services: {\n *     identify: identify(),\n *     echo: echo()\n *   }\n * })\n *\n * // dial the listener and open an echo protocol stream\n * const stream = await dialer.dialProtocol(webRTCMultiaddr, dialer.services.echo.protocol, {\n *   signal: AbortSignal.timeout(5000)\n * })\n *\n * // we can now stop the relay\n * await relay.stop()\n *\n * // send/receive some data from the remote peer via a direct connection\n * await pipe(\n *   [new TextEncoder().encode('hello world')],\n *   stream,\n *   async source => {\n *     for await (const buf of source) {\n *       console.info(new TextDecoder().decode(buf.subarray()))\n *     }\n *   }\n * )\n * ```\n *\n * @example WebRTC Direct\n *\n * At the time of writing WebRTC Direct is dial-only in browsers and unsupported in Node.js.\n *\n * The only implementation that supports a WebRTC Direct listener is go-libp2p and it's not yet enabled by default.\n *\n * ```TypeScript\n * import { createLibp2p } from 'libp2p'\n * import { noise } from '@chainsafe/libp2p-noise'\n * import { multiaddr } from '@multiformats/multiaddr'\n * import { pipe } from 'it-pipe'\n * import { fromString, toString } from 'uint8arrays'\n * import { webRTCDirect } from '@libp2p/webrtc'\n *\n * const node = await createLibp2p({\n *   transports: [\n *     webRTCDirect()\n *   ],\n *   connectionEncrypters: [\n *     noise()\n *   ]\n * })\n *\n * await node.start()\n *\n * // this multiaddr corresponds to a remote node running a WebRTC Direct listener\n * const ma = multiaddr('/ip4/0.0.0.0/udp/56093/webrtc-direct/certhash/uEiByaEfNSLBexWBNFZy_QB1vAKEj7JAXDizRs4_SnTflsQ')\n * const stream = await node.dialProtocol(ma, '/my-protocol/1.0.0', {\n *   signal: AbortSignal.timeout(10_000)\n * })\n *\n * await pipe(\n *   [fromString(`Hello js-libp2p-webrtc\\n`)],\n *   stream,\n *   async function (source) {\n *     for await (const buf of source) {\n *       console.info(toString(buf.subarray()))\n *     }\n *   }\n * )\n * ```\n */\n\nimport { WebRTCTransport } from './private-to-private/transport.js'\nimport { WebRTCDirectTransport, type WebRTCTransportDirectInit, type WebRTCDirectTransportComponents } from './private-to-public/transport.js'\nimport type { WebRTCTransportComponents, WebRTCTransportInit } from './private-to-private/transport.js'\nimport type { Transport } from '@libp2p/interface'\n\nexport interface DataChannelOptions {\n  /**\n   * The maximum message size sendable over the channel in bytes\n   *\n   * @default 16384\n   */\n  maxMessageSize?: number\n\n  /**\n   * If the channel's `bufferedAmount` grows over this amount in bytes, wait\n   * for it to drain before sending more data\n   *\n   * @default 16777216\n   */\n  maxBufferedAmount?: number\n\n  /**\n   * When `bufferedAmount` is above `maxBufferedAmount`, we pause sending until\n   * the `bufferedAmountLow` event fires - this controls how long we wait for\n   * that event in ms\n   *\n   * @default 30000\n   */\n  bufferedAmountLowEventTimeout?: number\n\n  /**\n   * When closing a stream, we wait for `bufferedAmount` to become 0 before\n   * closing the underlying RTCDataChannel - this controls how long we wait\n   * in ms\n   *\n   * @default 30000\n   */\n  drainTimeout?: number\n\n  /**\n   * When closing a stream we first send a FIN flag to the remote and wait\n   * for a FIN_ACK reply before closing the underlying RTCDataChannel - this\n   * controls how long we wait for the acknowledgement in ms\n   *\n   * @default 5000\n   */\n  closeTimeout?: number\n\n  /**\n   * When sending the first data message, if the channel is not in the \"open\"\n   * state, wait this long for the \"open\" event to fire.\n   */\n  openTimeout?: number\n}\n\nexport type { WebRTCTransportDirectInit, WebRTCDirectTransportComponents }\n\nfunction webRTCDirect (init?: WebRTCTransportDirectInit): (components: WebRTCDirectTransportComponents) => Transport {\n  return (components: WebRTCDirectTransportComponents) => new WebRTCDirectTransport(components, init)\n}\n\nexport type { WebRTCTransportInit, WebRTCTransportComponents }\n\nfunction webRTC (init?: WebRTCTransportInit): (components: WebRTCTransportComponents) => Transport {\n  return (components: WebRTCTransportComponents) => new WebRTCTransport(components, init)\n}\n\nexport { webRTC, webRTCDirect }\n", "import NanoDate from 'timestamp-nano'\nimport { IpnsEntry } from './pb/ipns.js'\nimport { unmarshalIPNSRecord } from './utils.js'\n\nexport function ipnsSelector (key: Uint8Array, data: Uint8Array[]): number {\n  const entries = data.map((buf, index) => ({\n    record: unmarshalIPNSRecord(buf),\n    index\n  }))\n\n  entries.sort((a, b) => {\n    // Before we'd sort based on the signature version. Unmarshal now fails if\n    // a record does not have SignatureV2, so that is no longer needed. V1-only\n    // records haven't been issues in a long time.\n\n    const aSeq = a.record.sequence\n    const bSeq = b.record.sequence\n\n    // choose later sequence number\n    if (aSeq > bSeq) {\n      return -1\n    } else if (aSeq < bSeq) {\n      return 1\n    }\n\n    if (a.record.validityType === IpnsEntry.ValidityType.EOL && b.record.validityType === IpnsEntry.ValidityType.EOL) {\n      // choose longer lived record if sequence numbers the same\n      const recordAValidityDate = NanoDate.fromString(a.record.validity).toDate()\n      const recordBValidityDate = NanoDate.fromString(b.record.validity).toDate()\n\n      if (recordAValidityDate.getTime() > recordBValidityDate.getTime()) {\n        return -1\n      }\n\n      if (recordAValidityDate.getTime() < recordBValidityDate.getTime()) {\n        return 1\n      }\n    }\n\n    return 0\n  })\n\n  return entries[0].index\n}\n", "export const version = '5.2.0'\nexport const name = 'helia'\n", "// this list comes from https://github.com/ipfs/kubo/blob/da28fbc65a2e0f1ce59f9923823326ae2bc4f713/config/bootstrap_peers.go#L17\nexport const bootstrapConfig = {\n  list: [\n    '/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN',\n    '/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb',\n    '/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt',\n    // va1 is not in the TXT records for _dnsaddr.bootstrap.libp2p.io yet\n    // so use the host name directly\n    '/dnsaddr/va1.bootstrap.libp2p.io/p2p/12D3KooWKnDdG3iXw9eTFijk3EWSunZcFi54Zka4wmtqtt6rPxc8',\n    '/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ'\n  ]\n}\n", "import { noise } from '@chainsafe/libp2p-noise'\nimport { yamux } from '@chainsafe/libp2p-yamux'\nimport { createDelegatedRoutingV1HttpApiClient } from '@helia/delegated-routing-v1-http-api-client'\nimport { delegatedHTTPRoutingDefaults } from '@helia/routers'\nimport { autoNAT } from '@libp2p/autonat'\nimport { bootstrap } from '@libp2p/bootstrap'\nimport { circuitRelayTransport } from '@libp2p/circuit-relay-v2'\nimport { dcutr } from '@libp2p/dcutr'\nimport { type Identify, identify, identifyPush } from '@libp2p/identify'\nimport { type KadDHT, kadDHT } from '@libp2p/kad-dht'\nimport { keychain, type Keychain } from '@libp2p/keychain'\nimport { mplex } from '@libp2p/mplex'\nimport { ping, type PingService } from '@libp2p/ping'\nimport { webRTC, webRTCDirect } from '@libp2p/webrtc'\nimport { webSockets } from '@libp2p/websockets'\nimport { ipnsSelector } from 'ipns/selector'\nimport { ipnsValidator } from 'ipns/validator'\nimport * as libp2pInfo from 'libp2p/version'\nimport { name, version } from '../version.js'\nimport { bootstrapConfig } from './bootstrappers.js'\nimport type { Libp2pDefaultsOptions } from './libp2p.js'\nimport type { Libp2pOptions } from 'libp2p'\n\nexport interface DefaultLibp2pServices extends Record<string, unknown> {\n  autoNAT: unknown\n  dcutr: unknown\n  delegatedRouting: unknown\n  dht: KadDHT\n  identify: Identify\n  keychain: Keychain\n  ping: PingService\n}\n\nexport function libp2pDefaults (options: Libp2pDefaultsOptions = {}): Libp2pOptions<DefaultLibp2pServices> & Required<Pick<Libp2pOptions<DefaultLibp2pServices>, 'services'>> {\n  const agentVersion = `${name}/${version} ${libp2pInfo.name}/${libp2pInfo.version} UserAgent=${globalThis.navigator.userAgent}`\n\n  return {\n    privateKey: options.privateKey,\n    dns: options.dns,\n    addresses: {\n      listen: [\n        '/p2p-circuit',\n        '/webrtc'\n      ]\n    },\n    transports: [\n      circuitRelayTransport(),\n      webRTC(),\n      webRTCDirect(),\n      webSockets()\n    ],\n    connectionEncrypters: [\n      noise()\n    ],\n    streamMuxers: [\n      yamux(),\n      mplex()\n    ],\n    peerDiscovery: [\n      bootstrap(bootstrapConfig)\n    ],\n    services: {\n      autoNAT: autoNAT(),\n      dcutr: dcutr(),\n      delegatedRouting: () => createDelegatedRoutingV1HttpApiClient('https://delegated-ipfs.dev', delegatedHTTPRoutingDefaults()),\n      dht: kadDHT({\n        clientMode: true,\n        validators: {\n          ipns: ipnsValidator\n        },\n        selectors: {\n          ipns: ipnsSelector\n        }\n      }),\n      identify: identify({\n        agentVersion\n      }),\n      identifyPush: identifyPush({\n        agentVersion\n      }),\n      keychain: keychain(options.keychain),\n      ping: ping()\n    }\n  }\n}\n", "import { generateKeyPair } from '@libp2p/crypto/keys'\nimport { keychain } from '@libp2p/keychain'\nimport { defaultLogger } from '@libp2p/logger'\nimport { Key } from 'interface-datastore'\nimport type { PrivateKey, KeyType } from '@libp2p/interface'\nimport type { KeychainInit } from '@libp2p/keychain'\nimport type { Datastore } from 'interface-datastore'\n\nexport interface LoadOrCreateSelfKeyOptions extends KeychainInit {\n  /**\n   * If no private key is found in the datastore, create one with this type\n   *\n   * @default 'Ed25519'\n   */\n  keyType?: KeyType\n}\n\nexport async function loadOrCreateSelfKey (datastore: Datastore, init: LoadOrCreateSelfKeyOptions = {}): Promise<PrivateKey> {\n  const chain = keychain(init)({\n    datastore,\n    logger: defaultLogger()\n  })\n\n  const selfKey = new Key('/pkcs8/self')\n  let privateKey\n\n  if (await datastore.has(selfKey)) {\n    privateKey = await chain.exportKey('self')\n  } else {\n    privateKey = await generateKeyPair(init.keyType ?? 'Ed25519')\n\n    // persist the peer id in the keychain for next time\n    await chain.importKey('self', privateKey)\n  }\n\n  return privateKey\n}\n", "import { loadOrCreateSelfKey } from '@libp2p/config'\nimport { createLibp2p as create } from 'libp2p'\nimport { libp2pDefaults } from './libp2p-defaults.js'\nimport type { DefaultLibp2pServices } from './libp2p-defaults.js'\nimport type { ComponentLogger, Libp2p, PrivateKey } from '@libp2p/interface'\nimport type { KeychainInit } from '@libp2p/keychain'\nimport type { DNS } from '@multiformats/dns'\nimport type { Datastore } from 'interface-datastore'\nimport type { Libp2pOptions } from 'libp2p'\n\nexport interface CreateLibp2pOptions<T extends Record<string, unknown>> {\n  datastore: Datastore\n  libp2p?: Libp2pOptions<T>\n  logger?: ComponentLogger\n  keychain?: KeychainInit\n  start?: boolean\n}\n\nexport interface Libp2pDefaultsOptions {\n  privateKey?: PrivateKey\n  keychain?: KeychainInit\n  dns?: DNS\n}\n\nexport async function createLibp2p <T extends Record<string, unknown> = DefaultLibp2pServices> (options: CreateLibp2pOptions<T>): Promise<Libp2p<T>> {\n  const libp2pOptions = options.libp2p ?? {}\n\n  // if no peer id was passed, try to load it from the keychain\n  if (libp2pOptions.privateKey == null && options.datastore != null) {\n    libp2pOptions.privateKey = await loadOrCreateSelfKey(options.datastore, options.keychain)\n  }\n\n  const defaults = libp2pDefaults(libp2pOptions)\n  defaults.datastore = defaults.datastore ?? options.datastore\n\n  // @ts-expect-error derived ServiceMap is not compatible with ServiceFactoryMap\n  const node = await create({\n    ...defaults,\n    ...libp2pOptions,\n    start: false\n  })\n\n  return node\n}\n", "/**\n * @packageDocumentation\n *\n * Exports a `createHelia` function that returns an object that implements the {@link Helia} API.\n *\n * Pass it to other modules like {@link https://www.npmjs.com/package/@helia/unixfs | @helia/unixfs} to make files available on the distributed web.\n *\n * @example\n *\n * ```typescript\n * import { createHelia } from 'helia'\n * import { unixfs } from '@helia/unixfs'\n * import { CID } from 'multiformats/cid'\n *\n * const helia = await createHelia()\n *\n * const fs = unixfs(helia)\n * fs.cat(CID.parse('bafyFoo'))\n * ```\n */\n\nimport { bitswap, trustlessGateway } from '@helia/block-brokers'\nimport { httpGatewayRouting, libp2pRouting } from '@helia/routers'\nimport { MemoryBlockstore } from 'blockstore-core'\nimport { MemoryDatastore } from 'datastore-core'\nimport { HeliaP2P } from './helia-p2p.js'\nimport { libp2pDefaults } from './utils/libp2p-defaults.js'\nimport { createLibp2p } from './utils/libp2p.js'\nimport type { DefaultLibp2pServices } from './utils/libp2p-defaults.js'\nimport type { Libp2pDefaultsOptions } from './utils/libp2p.js'\nimport type { Helia } from '@helia/interface'\nimport type { HeliaInit as HeliaClassInit } from '@helia/utils'\nimport type { Libp2p } from '@libp2p/interface'\nimport type { KeychainInit } from '@libp2p/keychain'\nimport type { Libp2pOptions } from 'libp2p'\nimport type { CID } from 'multiformats/cid'\n\n// re-export interface types so people don't have to depend on @helia/interface\n// if they don't want to\nexport * from '@helia/interface'\n\nexport type { DefaultLibp2pServices, Libp2pDefaultsOptions }\nexport { libp2pDefaults }\n\n/**\n * DAGWalkers take a block and yield CIDs encoded in that block\n */\nexport interface DAGWalker {\n  codec: number\n  walk(block: Uint8Array): Generator<CID, void, undefined>\n}\n\n/**\n * Options used to create a Helia node.\n */\nexport interface HeliaInit<T extends Libp2p = Libp2p> extends HeliaClassInit {\n  /**\n   * A libp2p node is required to perform network operations. Either a\n   * preconfigured node or options to configure a node can be passed\n   * here.\n   *\n   * If node options are passed, they will be merged with the default\n   * config for the current platform. In this case all passed config\n   * keys will replace those from the default config.\n   *\n   * The libp2p `start` option is not supported, instead please pass `start` in\n   * the root of the HeliaInit object.\n   */\n  libp2p?: T | Omit<Libp2pOptions<any>, 'start'>\n\n  /**\n   * Pass `false` to not start the Helia node\n   */\n  start?: boolean\n\n  /**\n   * By default Helia stores the node's PeerId in an encrypted form in a\n   * libp2p keystore. These options control how that keystore is configured.\n   */\n  keychain?: KeychainInit\n}\n\nexport interface HeliaLibp2p<T extends Libp2p = Libp2p<DefaultLibp2pServices>> extends Helia {\n  libp2p: T\n}\n\n/**\n * Create and return a Helia node\n */\nexport async function createHelia <T extends Libp2p> (init: Partial<HeliaInit<T>>): Promise<HeliaLibp2p<T>>\nexport async function createHelia (init?: Partial<HeliaInit<Libp2p<DefaultLibp2pServices>>>): Promise<HeliaLibp2p<Libp2p<DefaultLibp2pServices>>>\nexport async function createHelia (init: Partial<HeliaInit> = {}): Promise<HeliaLibp2p> {\n  const datastore = init.datastore ?? new MemoryDatastore()\n  const blockstore = init.blockstore ?? new MemoryBlockstore()\n\n  let libp2p: Libp2p<DefaultLibp2pServices>\n\n  if (isLibp2p(init.libp2p)) {\n    libp2p = init.libp2p as any\n  } else {\n    libp2p = await createLibp2p<DefaultLibp2pServices>({\n      ...init,\n      libp2p: {\n        dns: init.dns,\n        ...init.libp2p,\n\n        // ignore the libp2p start parameter as it should be on the main init\n        // object instead\n        start: undefined\n      },\n      datastore\n    })\n  }\n\n  const helia = new HeliaP2P({\n    ...init,\n    libp2p,\n    datastore,\n    blockstore,\n    blockBrokers: init.blockBrokers ?? [\n      trustlessGateway(),\n      bitswap()\n    ],\n    routers: init.routers ?? [\n      libp2pRouting(libp2p),\n      httpGatewayRouting()\n    ],\n    metrics: libp2p.metrics\n  })\n\n  if (init.start !== false) {\n    await helia.start()\n  }\n\n  return helia\n}\n\nfunction isLibp2p (obj: any): obj is Libp2p {\n  if (obj == null) {\n    return false\n  }\n\n  // a non-exhaustive list of methods found on the libp2p object\n  const funcs = ['dial', 'dialProtocol', 'hangUp', 'handle', 'unhandle', 'getMultiaddrs', 'getProtocols']\n\n  // if these are all functions it's probably a libp2p object\n  return funcs.every(m => typeof obj[m] === 'function')\n}\n"],
  "mappings": "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AAQ;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAC1G;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAK;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAC1G;EAAM;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EACzG;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAC3G;EAAM;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAC1G;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAO;EAAK;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EACtG;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAC3G;EAAM;EAAO;EAAQ;EAAM;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAQ;EAC1G;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAC3G;EAAO;EAAM;EAAQ;EAAQ;EAAM;EAAO;EAAM;EAAO;EAAM;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EACvG;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAQ;EAAM;EAAM;EACtG;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EACzG;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EACzG;EAAO;EAAO;EAAM;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EACtG;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EACzG;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAC/G;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAM;EACxG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAC1G;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAC9G;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EACzG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EACzG;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAC5G;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAM;EAAQ;EAAM;EAAQ;EAAM;EAAO;EAC1G;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAK;EAAM;EAAO;EACtG;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAK;EAAM;EAAO;EAAO;EAAO;EACvG;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAC/G;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAC3G;EAAM;EAAQ;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAC5G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAM;EAAO;EAAO;EAAK;EAAO;EAAO;EAAO;EACtG;EAAQ;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EACxG;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EACzG;EAAO;EAAQ;EAAQ;EAAM;EAAM;EAAO;EAAM;EAAO;EAAO;EAAM;EAAM;EAAO;EAAM;EAAM;EAAO;EACpG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAQ;EAAO;EAAQ;EAC7G;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAK;EAAO;EAAQ;EACzG;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAC5G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAM;EAAQ;EACxG;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACzG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAC9G;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACxG;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAQ;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAM;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAM;EAAO;EAAO;EAAM;EAAO;EAAQ;EACzG;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAM;EAAO;EACtG;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAAO;EAC1G;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAC7G;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAC1G;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EACvG;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAC5G;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAQ;EAAQ;EAAQ;EAAQ;EAClH;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAQ;EAAQ;EAAQ;EAC9G;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAM;EAAQ;EAC1G;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAC1G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAC5G;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAM;EAAO;EAAM;EAAO;EAAM;EAAO;EACxG;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACzG;EAAQ;EAAO;EAAM;EAAM;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAAM;EAAO;EAAO;EACxG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EACzG;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAC9G;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAC5G;EAAQ;EAAQ;EAAO;EAAM;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAC9G;EAAO;EAAQ;EAAQ;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAC3G;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAQ;EACzG;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EACzG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EACxG;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC7G;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAC7G;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAC7G;EAAO;EAAM;EAAQ;EAAM;EAAO;EAAO;EAAM;EAAO;EAAM;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAM;EACxG;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAK;EAAO;EAAM;EAAO;EACxG;EAAM;EAAQ;EAAQ;EAAM;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC3G;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAM;EAAO;EACzG;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAM;EACvG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EACxG;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAC9G;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EACvG;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC1G;EAAQ;EAAO;EAAM;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAM;EAAO;EAAO;EAC1G;EAAM;EAAQ;EAAO;EAAK;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EACxG;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAC7G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAK;EAAK;EAAO;EAAO;EAAO;EACvG;EAAM;EAAQ;EAAM;EAAQ;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAM;EAAQ;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAK;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAK;EAAO;EAAQ;EAAO;EACvG;EAAO;EAAO;EAAO;EAAK;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EACzG;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAK;EAAO;EAAO;EAAK;EAAO;EAAO;EAAO;EAAQ;EAAO;EACzG;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAC1G;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC5G;EAAQ;EAAO;EAAM;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAM;EAAQ;EACzG;EAAQ;EAAO;EAAM;EAAM;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAK;EAAO;EAAQ;EAAO;EAAO;EAAM;EACxG;EAAO;EAAM;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAC5G;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAM;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAC1G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAI;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EACxG;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC1G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAC9G;EAAM;EAAK;EAAM;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EACpG;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAC1G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAC3G;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAC7G;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAK;EAAO;EAAO;EAAO;EAAM;EAAQ;EAC3G;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAM;EAAQ;EAAO;EAAM;EAAO;EAAM;EAAM;EAAQ;EACvG;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAC9G;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAC5G;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EACvG;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAQ;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAChH;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAM;EAAO;EAC5G;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EACzG;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAM;EAAQ;EACvG;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAM;EAAO;EACvG;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAK;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EACvG;EAAO;EAAK;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EACxG;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAQ;EAAQ;EAC9G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAM;EAAO;EACxG;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAC7G;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EAAM;EACpG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAK;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAO;EACxG;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAM;EAAQ;EAAM;EAAO;EAAM;EAAQ;EAAO;EACxG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EACtG;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAM;EAAO;EAAO;EAAM;EACtG;EAAO;EAAQ;EAAM;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAC9G;EAAQ;EAAM;EAAO;EAAQ;EAAQ;EAAQ;EAAQ;EAAQ;EAAQ;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAC/G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAC1G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAC9G;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC3G;EAAM;EAAM;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EACxG;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAO;EAAM;EACtG;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACzG;EAAO;EAAO;EAAM;EAAM;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAK;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EACxG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAM;EAAQ;EACvG;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EAAQ;EACvG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAC3G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAC7G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC5G;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAM;EAAM;EAAO;EAAK;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EACtG;EAAM;EAAM;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAC7G;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAI;EAAM;EAAQ;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAQ;EACvG;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EACtG;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC3G;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAC9G;EAAQ;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAC1G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC5G;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAQ;EAAK;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC7G;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAC9G;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EACzG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EACvG;EAAO;EAAO;EAAO;EAAM;EAAO;EAAM;EAAM;EAAQ;EAAQ;EAAM;EAAQ;EAAO;EAAO;EAAQ;EAAO;EACzG;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAM;EAAM;EAAO;EAAM;EAAO;EAAO;EAAO;EAAM;EACtG;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EACzG;EAAO;EAAM;EAAO;EAAQ;EAAM;EAAK;EAAQ;EAAK;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAM;EAAO;EACrG;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EACtG;EAAM;EAAQ;EAAO;EAAQ;EAAQ;EAAK;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC1G;EAAQ;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAK;EAAO;EAAM;EAAO;EAAM;EAAO;EACzG;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAM;EAC1G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAM;EAC1G;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAC5G;EAAM;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EACvG;EAAM;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EACvG;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACzG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAK;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAC3G;EAAK;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAAO;EAAM;EACxG;EAAQ;EAAM;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAC5G;EAAO;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAQ;EAAQ;EAC7G;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAC5G;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAQ;EACvG;EAAO;EAAM;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAK;EAAO;EAAM;EAAO;EAAO;EACxG;EAAO;EAAM;EAAM;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAC3G;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAK;EACtG;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAQ;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAC5G;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAM;EAAQ;EAAM;EAAO;EAAM;EAAQ;EAAO;EACtG;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EACzG;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAK;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EACxG;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC3G;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAK;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EACpG;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAM;EAAM;EACxG;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EACzG;EAAQ;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAC1G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAK;EAAQ;EACxG;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAM;EACvG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAC1G;EAAO;EAAQ;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAC/G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAQ;EAC7G;EAAO;EAAO;EAAQ;EAAM;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC5G;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC1G;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EACzG;EAAM;EAAQ;EAAQ;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EACxG;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EACxG;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAC1G;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAAM;EAC3G;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAM;EAAM;EAAO;EACvG;EAAO;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAM;EACvG;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EACzG;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAC1G;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAQ;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EACzG;EAAM;EAAK;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EACrG;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EACzG;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAO;EACxG;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAC/G;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAC3G;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EACzG;EAAM;EAAO;EAAM;EAAM;EAAO;EAAK;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAM;EACrG;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAK;EAAM;EAAM;EAAO;EACxG;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAK;EAAQ;EAAO;EACxG;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC1G;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAM;EAAQ;EAAM;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAM;EAAQ;EAAQ;EAAO;EAAO;EAAM;EACzG;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAAO;EAC5G;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAC3G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAQ;EAAO;EAAO;EAAM;EAC3G;EAAM;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACzG;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EACzG;EAAQ;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAAQ;EAC9G;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EACxG;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAM;EAAQ;EAAM;EAAO;EAAO;EAAQ;EACzG;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAC7G;EAAM;EAAO;EAAO;EAAK;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAQ;EAAO;EACzG;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAK;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAK;EAAM;EAAQ;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EACxG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAQ;EAAO;EAAO;EAC1G;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAQ;EAAO;EAAQ;EAAM;EAAM;EAAO;EAAO;EACxG;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAM;EAAM;EAAQ;EAC1G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAC1G;EAAO;EAAK;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EACxG;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAC7G;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAC9G;EAAK;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EACzG;EAAO;EAAM;EAAO;EAAM;EAAQ;EAAM;EAAO;EAAO;EAAQ;EAAM;EAAI;EAAQ;EAAQ;EAAM;EAAM;EACpG;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAC1G;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAC1G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC5G;EAAQ;EAAO;EAAQ;EAAQ;EAAK;EAAO;EAAQ;EAAO;EAAO;EAAK;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAC1G;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAQ;EAAG;EAAO;EAAM;EAAO;EAAO;EAAO;EACrG;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAC1G;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAC3G;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAQ;EAC1G;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAM;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAChH;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EACxG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EACzG;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EACvG;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAO;EAAO;EAAI;EAAO;EAAO;EAAO;EAAO;EAAO;EACpG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAC3G;EAAM;EAAM;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EACvG;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC1G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAC1G;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAC9G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAC9G;EAAO;EAAO;EAAM;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EACtG;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAM;EAAO;EAAQ;EAAQ;EAAK;EAAO;EAAO;EAAO;EACtG;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAM;EAC5G;EAAM;EAAO;EAAO;EAAK;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EACpG;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAM;EAC1G;EAAM;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAAO;EACzG;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EACzG;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAC5G;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EACzG;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAC3G;EAAQ;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAM;EAAM;EACxG;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAC5G;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAC1G;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACzG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAM;EAAK;EAAO;EACtG;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAC1G;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAC5G;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EACxG;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACvG;EAAM;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAC3G;EAAK;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EACtG;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAC7G;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAQ;EAAQ;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAC7G;EAAK;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAM;EAAQ;EAAQ;EAAQ;EAC1G;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAC/G;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAM;EAAM;EAAQ;EAAO;EACzG;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAAM;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAC7G;EAAO;EAAM;EAAM;EAAM;EAAM;EAAO;EAAM;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EACzG;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAK;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EACvG;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAC5G;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACxG;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAC3G;EAAM;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAM;EACvG;EAAO;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAK;EAAO;EAAM;EAAO;EAAO;EAAO;EAAM;EAAO;EACtG;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAC7G;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAK;EAAO;EACrG;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EACzG;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAC1G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EACzG;EAAK;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAC5G;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAK;EAAO;EAC1G;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAC/G;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC7G;EAAO;EAAO;EAAO;EAAK;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EACzG;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAC3G;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAM;EAAK;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EACtG;EAAQ;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAK;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EACxG;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EACzG;EAAO;EAAO;EAAQ;EAAM;EAAM;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAQ;EAC1G;EAAM;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAM;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACvG;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAC9G;EAAK;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EACxG;EAAM;EAAQ;EAAQ;EAAK;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EACxG;EAAQ;EAAQ;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAC7G;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC1G;EAAQ;EAAQ;EAAK;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAK;EAAO;EAAM;EAAO;EACvG;EAAQ;EAAQ;EAAQ;EAAO;EAAQ;EAAM;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAC/G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAO;EACzG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EACvG;EAAO;EAAO;EAAK;EAAO;EAAO;EAAO;EAAM;EAAM;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EACzG;EAAM;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EACxG;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAQ;EAC5G;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EACzG;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAM;EACxG;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAAO;EACzG;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAK;EAC3G;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAQ;EAAO;EAC3G;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAM;EAAQ;EAC1G;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAC1G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAC1G;EAAM;EAAO;EAAO;EAAK;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAC1G;EAAO;EAAK;EAAO;EAAO;EAAM;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACtG;EAAM;EAAK;EAAO;EAAM;EAAM;EAAQ;EAAO;EAAO;EAAK;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAClG;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAC5G;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAK;EAAM;EAAO;EAAK;EAAO;EAAO;EAAO;EAAO;EACrG;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAC7G;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAQ;EAAM;EAAO;EAAQ;EAAO;EAC3G;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAC7G;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAQ;EAChH;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAC/G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAK;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EACvG;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAC1G;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EACzG;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC5G;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAQ;EAAM;EACxG;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAQ;EAC9G;EAAK;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EACvG;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAM;EAC1G;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAC5G;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAK;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EACvG;EAAO;EAAK;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAC3G;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAC5G;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EACvG;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EACzG;EAAQ;EAAO;EAAK;EAAM;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACvG;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAK;EAAO;EAAM;EAAO;EAAO;EAAM;EACvG;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAAO;EAC9G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC5G;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC3G;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAQ;EAAK;EAAQ;EAAO;EAAQ;EAAM;EAC1G;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EACzG;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC1G;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAC3G;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAQ;EAAO;EAAO;EAC1G;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAAM;EAAO;EAC7G;EAAO;EAAO;EAAM;EAAQ;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAAO;EAC1G;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EACvG;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAK;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAM;EAAO;EAC1G;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC7G;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAM;EAC5G;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAM;EAAO;EAAO;EACxG;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EACvG;EAAQ;EAAQ;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC1G;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAC3G;EAAQ;EAAO;EAAM;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAM;EAAQ;EAAQ;EAC5G;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAM;EACzG;EAAQ;EAAO;EAAQ;EAAQ;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAM;EAAO;EAAO;EAC9G;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAK;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAC7G;EAAO;EAAO;EAAM;EAAM;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EACzG;EAAM;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EACzG;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAC9G;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAC3G;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAK;EAAQ;EAAO;EAAQ;EAAM;EAAQ;EAC1G;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAC/G;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAQ;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EACzG;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAC7G;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC5G;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAAK;EAAO;EAAQ;EAAO;EAAQ;EAAM;EAAM;EAAO;EAAO;EAAO;EACxG;EAAO;EAAO;EAAO;EAAO;EAAI;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAAQ;EAAO;EACxG;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAC/G;EAAO;EAAQ;EAAM;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACzG;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAM;EAAO;EAAQ;EAAQ;EAC7G;EAAK;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EACxG;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAC7G;EAAQ;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAM;EACxG;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC5G;EAAO;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EAAM;EAAM;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EACvG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAQ;EAAM;EAAM;EAAQ;EAAQ;EAAO;EAAO;EAC1G;EAAM;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACzG;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAC7G;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAC9G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EACvG;EAAQ;EAAO;EAAM;EAAO;EAAQ;EAAM;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAQ;EAC1G;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAQ;EAC/G;EAAK;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAC1G;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAM;EACzG;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAQ;EAAQ;EAAO;EAAQ;EAC5G;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAK;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAC1G;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAM;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAC5G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAQ;EAC/G;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAM;EAAK;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EACtG;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAC3G;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAQ;EACvG;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC7G;EAAO;EAAO;EAAK;EAAQ;EAAO;EAAQ;EAAM;EAAO;EAAM;EAAQ;EAAQ;EAAO;EAAM;EAAQ;EAAO;EACzG;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAK;EAAM;EAAQ;EAAO;EACvG;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAC9G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EACzG;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAM;EAAQ;EAAQ;EAAQ;EAAO;EAC5G;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAC/G;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EACvG;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAM;EAAQ;EAAO;EAAO;EAAQ;EAC3G;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAQ;EAAQ;EAAO;EAAQ;EAAM;EAC5G;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAM;EAAO;EAAO;EACtG;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAC3G;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EACtG;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAM;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAQ;EACzG;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAK;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EACzG;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EAC7G;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EACzG;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAM;EAC1G;EAAO;EAAM;EAAM;EAAM;EAAQ;EAAO;EAAM;EAAO;EAAM;EAAO;EAAM;EAAM;EAAQ;EAAQ;EAAM;EACpG;EAAQ;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAM;EAAM;EAAQ;EAC3G;EAAO;EAAM;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAK;EACrG;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EACxG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAC5G;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAC5G;EAAO;EAAO;EAAM;EAAM;EAAO;EAAQ;EAAO;EAAM;EAAK;EAAM;EAAQ;EAAO;EAAO;EAAM;EAAO;EACpG;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EACvG;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAC5G;EAAO;EAAO;EAAM;EAAK;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACxG;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAC7G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACvG;EAAQ;EAAM;EAAM;EAAM;EAAQ;EAAO;EAAQ;EAAQ;EAAM;EAAQ;EAAK;EAAO;EAAO;EAAQ;EAAO;EACzG;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EACxG;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC7G;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAM;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAC5G;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EACzG;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACzG;EAAM;EAAM;EAAO;EAAO;EAAM;EAAQ;EAAQ;EAAO;EAAQ;EAAQ;EAAK;EAAQ;EAAM;EAAQ;EAAO;EACzG;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAAQ;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAM;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EACvG;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAM;EAAO;EAAM;EACtG;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAG;EAAO;EAAO;EAAO;EAAM;EACpG;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAC/G;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAM;EAAO;EAAM;EAAO;EAAO;EAAM;EAAO;EAAO;EACpG;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAK;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EACzG;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAQ;EAC3G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAK;EAAM;EAAQ;EAAQ;EAAQ;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EACzG;EAAM;EAAM;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EACtG;EAAO;EAAO;EAAO;EAAM;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAM;EAAM;EACtG;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAM;EAAQ;EACzG;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAC7G;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAM;EAAM;EAAM;EAAO;EACzG;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EACxG;EAAQ;EAAM;EAAO;EAAQ;EAAK;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAC5G;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAC9G;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAM;EAAO;EACvG;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC3G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAC3G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAK;EAAO;EAAM;EACvG;EAAO;EAAO;EAAQ;EAAM;EAAQ;EAAM;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAI;EACvG;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAM;EAAO;EACzG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAC7G;EAAM;EAAO;EAAK;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EACvG;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAK;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAM;EAC1G;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAM;EAAQ;EAAO;EACtG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAC7G;EAAO;EAAM;EAAQ;EAAK;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAM;EACtG;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAI;EAAO;EAAO;EAAO;EAAO;EACxG;EAAQ;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAC3G;EAAM;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAC5G;EAAQ;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EACxG;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAO;EAC1G;EAAM;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EACxG;EAAQ;EAAO;EAAO;EAAK;EAAO;EAAQ;EAAM;EAAO;EAAM;EAAO;EAAM;EAAQ;EAAQ;EAAO;EAAO;EACxG;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EACzG;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAQ;EAAM;EAAO;EAC5G;EAAM;EAAQ;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAC1G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EACzG;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAC7G;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAAQ;EAAQ;EAC5G;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAC3G;EAAK;EAAO;EAAO;EAAQ;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EACzG;EAAO;EAAO;EAAO;EAAK;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EACxG;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAI;EAAQ;EAAQ;EAAQ;EAC3G;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAQ;EAAO;EAAO;EAAO;EACzG;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAC7G;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAAM;EAAM;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EACxG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAC9G;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAK;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EACzG;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAAM;EAAQ;EAAM;EAAO;EAAQ;EAAO;EAAQ;EAAM;EAAO;EAAO;EAC1G;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAK;EAAO;EAAO;EAAM;EAAO;EAAM;EAAQ;EAAO;EACpG;EAAO;EAAM;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAC5G;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EACvG;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAC5G;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAC5G;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAQ;EAAO;EACzG;EAAM;EAAM;EAAM;EAAM;EAAM;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACrG;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAM;EAAQ;EAAO;EAC1G;EAAQ;EAAQ;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAC9G;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAC7G;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAC3G;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EACzG;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EACzG;EAAM;EAAQ;EAAO;EAAO;EAAK;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAM;EACzG;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAK;EAAQ;EAAM;EAAO;EAAO;EAAM;EAAQ;EAAQ;EACzG;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAC5G;EAAO;EAAO;EAAK;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAC5G;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EACzG;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAAQ;EAAM;EAAQ;EAAQ;EAAO;EAC9G;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAC7G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAC1G;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAQ;EAAQ;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAM;EAAM;EAAQ;EAAO;EAAO;EAAM;EAC5G;EAAO;EAAO;EAAO;EAAI;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EACxG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAC7G;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAC7G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EACxG;EAAM;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAK;EACzG;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAK;EAAO;EAAQ;EAAQ;EAAO;EACzG;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACzG;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAK;EAAO;EAAO;EAAO;EAAQ;EAAQ;EACzG;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EACzG;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAC3G;EAAO;EAAM;EAAM;EAAQ;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAC1G;EAAM;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAQ;EAC1G;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EACrG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAK;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAC1G;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC1G;EAAQ;EAAM;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EACxG;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAK;EAAQ;EAAQ;EAAQ;EAAM;EAAQ;EAAQ;EAC3G;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAK;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC1G;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAC3G;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC5G;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAC7G;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAAQ;EAAQ;EAAM;EAC7G;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAC5G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAI;EAAO;EACrG;EAAO;EAAO;EAAK;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAM;EAAM;EAAM;EACrG;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAC7G;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EACzG;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAK;EAAO;EAAO;EACvG;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAC1G;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EACzG;EAAM;EAAO;EAAQ;EAAI;EAAQ;EAAM;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACrG;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAAQ;EAAQ;EAAM;EAAK;EAAO;EAC1G;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAC9G;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAM;EAAI;EAAQ;EAAM;EAAM;EAAO;EAAO;EAAQ;EAAQ;EACzG;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAM;EACtG;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAC9G;EAAM;EAAK;EAAO;EAAM;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACxG;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EACzG;EAAQ;EAAO;EAAO;EAAM;EAAM;EAAO;EAAM;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EACxG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EACzG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAM;EACzG;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAM;EAAM;EAAO;EAC3G;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC5G;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAC7G;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAC3G;EAAO;EAAK;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EACtG;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC5G;EAAQ;EAAO;EAAQ;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAM;EAAO;EACzG;EAAQ;EAAK;EAAO;EAAM;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAK;EAAO;EAAQ;EAAO;EAAO;EAAQ;EACvG;EAAO;EAAM;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAI;EAAO;EAAM;EAAO;EAAO;EAAQ;EACvG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAC3G;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EACzG;EAAQ;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAC3G;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAC5G;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC9G;EAAQ;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EACvG;EAAO;EAAQ;EAAO;EAAK;EAAO;EAAM;EAAQ;EAAO;EAAK;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAQ;EACvG;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EACzG;EAAO;EAAM;EAAM;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EACpG;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAC5G;EAAK;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACzG;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAM;EAAQ;EAAQ;EACvG;EAAQ;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAC/G;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAM;EAAO;EAAM;EAAO;EAAM;EACtG;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAC3G;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAC7G;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAM;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EACvG;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC1G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAK;EAAO;EAAQ;EAAO;EAAQ;EAAO;EACzG;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAM;EAAK;EAAM;EAAO;EAAO;EAAO;EAAM;EAAO;EACpG;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAC3G;EAAK;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAG;EAClG;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAK;EAAO;EAAQ;EAAQ;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAQ;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAC3G;EAAO;EAAK;EAAQ;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAQ;EAAQ;EAAM;EAC9G;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAC5G;EAAQ;EAAM;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAO;EACxG;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAK;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAC1G;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EACzG;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAC3G;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAK;EAAO;EAAO;EAAO;EACrG;EAAO;EAAQ;EAAM;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAC3G;EAAM;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EACtG;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EACzG;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAC5G;EAAM;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACvG;EAAQ;EAAO;EAAK;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACxG;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAM;EAAM;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EACtG;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAC7G;EAAO;EAAO;EAAK;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EACxG;EAAM;EAAM;EAAQ;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAM;EAAO;EAAK;EAAO;EAAQ;EAAO;EAAO;EACtG;EAAO;EAAM;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAQ;EACvG;EAAM;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAM;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAM;EAC1G;EAAM;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAQ;EAC3G;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAC5G;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EACxG;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAO;EAAO;EAAM;EAAO;EAAM;EAC1G;EAAO;EAAQ;EAAM;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAM;EAAQ;EACzG;EAAM;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EACrG;EAAK;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAK;EAAO;EAAM;EAAO;EAAO;EAAO;EACpG;EAAO;EAAO;EAAM;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EACxG;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAK;EAAO;EAAQ;EAAM;EAAQ;EAAO;EAC1G;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAK;EAAQ;EAAO;EAAI;EAAO;EACpG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EACxG;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAQ;EAAO;EAAM;EAAO;EAC9G;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAM;EAAQ;EAAO;EACzG;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAM;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EACxG;EAAK;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAQ;EAC1G;EAAM;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAC1G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACzG;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAQ;EACzG;EAAO;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EAAO;EAAO;EACzG;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAQ;EAC1G;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAQ;EACzG;EAAM;EAAQ;EAAQ;EAAO;EAAM;EAAQ;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAM;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAC1G;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAQ;EAAO;EAAQ;EAAM;EAAO;EAAO;EAC3G;EAAM;EAAQ;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EACzG;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAC7G;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EACzG;EAAO;EAAQ;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAM;EAAO;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AAO;EAAM;EACxG;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAC3G;EAAO;EAAO;EAAM;EAAM;EAAM;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EACtG;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAAM;EAAM;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAC5G;EAAQ;EAAO;EAAO;EAAO;EAAK;EAAM;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EACxG;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EAAM;EAAO;EACtG;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAQ;EAC3G;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAM;EAAO;EAAQ;EACxG;EAAQ;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAQ;EAAK;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAC5G;EAAM;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAO;EAAO;EAAO;EAAO;EAC5G;EAAM;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAQ;EAAM;EAAO;EACxG;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAM;EAAM;EAAO;EAAO;EAAO;EACxG;EAAQ;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAO;EAC3G;EAAO;EAAO;EAAQ;EAAM;EAAO;EAAO;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAM;EAAO;EAAO;EACzG;EAAO;EAAQ;EAAO;EAAO;EAAO;EAAM;EAAO;EAAO;EAAO;EAAQ;EAAO;EAAO;EAAQ;EAAO;EAAQ;EAC5G;EAAO;EAAM;EAAO;EAAM;EAAO;EAAO;EAAO;EAAO;EAAQ;EAAO;E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",
  "names": ["n", "t", "e", "r", "u", "o", "i", "a", "f", "c", "isElectron", "require_browser", "sanitize", "options", "WantType", "__WantTypeValues", "WantlistEntry", "length", "Wantlist", "_a", "_b", "Block", "BlockPresenceType", "__BlockPresenceTypeValues", "BlockPresence", "BitswapMessage", "_c", "_d", "message", "message", "start", "_a", "_b", "decode", "message", "options", "src_default", "encode", "options", "message", "message", "_a", "options", "Block", "Block", "getCodec", "options", "encode", "decode", "cid", "_a", "message", "_a", "_b", "_c", "_d", "options", "self", "options", "_a", "version", "code", "src_exports", "sha512", "code", "options", "NotFoundError", "options", "options", "_a", "_b", "_c", "src_default", "_d", "block", "options", "_a", "options", "src_default", "_a", "_b", "options", "_a", "_b", "_c", "_d", "decode", "options", "_a", "event", "message", "multicodec", "options", "options", "getHasher", "options", "logger", "logger", "options", "options", "_a", "options", "_a", "_b", "options", "message", "IpnsEntry", "ValidityType", "__ValidityTypeValues", "length", "IDENTITY_CODEC", "message", "IDENTITY_CODEC", "decode", "log", "import_timestamp_nano", "log", "NanoDate", "message", "IPNS_PREFIX", "options", "src_default", "log", "_a", "options", "_b", "response", "IPNS_PREFIX", "options", "toString", "options", "clonedRegexp", "options", "options", "NotFoundError", "code", "log", "log", "options", "options", "message", "Message", "MessageType", "__MessageTypeValues", "ResponseStatus", "__ResponseStatusValues", "PeerInfo", "_codec", "length", "_a", "Dial", "DialResponse", "_b", "options", "message", "multiaddr", "connection", "_a", "_b", "octets", "HopMessage", "Type", "__TypeValues", "length", "_a", "_b", "_c", "StopMessage", "Peer", "Reservation", "Limit", "Status", "__StatusValues", "ReservationVoucher", "Envelope", "message", "options", "_a", "_b", "self", "message", "code", "name", "_a", "options", "_b", "_c", "err", "logger", "log", "options", "source", "src_default", "_a", "_b", "_a", "_b", "options", "ReservationStore", "reservation", "start", "err", "_a", "options", "defaults", "_a", "_b", "ReservationStore", "options", "_c", "_d", "code", "HolePunch", "Type", "__TypeValues", "length", "_a", "defaultValues", "_a", "_b", "options", "Identify", "length", "_a", "_b", "detectElectron", "defaultValues", "log", "message", "multiaddr", "_a", "defaultValues", "self", "peer", "src_default", "options", "message", "CODEC_IP6", "_a", "Identify", "defaultValues", "options", "message", "Identify", "second", "minute", "second", "minute", "second", "KEEP_ALIVE_TAG", "Record", "length", "hour", "minute", "second", "message", "Record", "length", "MessageType", "__MessageTypeValues", "ConnectionType", "__ConnectionTypeValues", "PeerInfo", "_a", "Message", "_b", "_c", "_d", "options", "_a", "options", "_a", "selectors", "validators", "multiaddr", "isPrivate", "multiaddr", "code", "decode", "_a", "_b", "_c", "_d", "_a", "_b", "validators", "selectors", "options", "src_default", "self", "_a", "_b", "options", "src_default", "self", "providers", "multiaddr", "Network", "_a", "_b", "_c", "_d", "message", "options", "Message", "_a", "_b", "options", "self", "multiaddr", "options", "log", "options", "signal", "log", "src_default", "options", "_a", "event", "start", "src_default", "_a", "options", "src_default", "_a", "KEEP_ALIVE_TAG", "options", "_a", "peer", "src_default", "_b", "peer", "_a", "options", "result", "src_default", "keyPrefix", "length", "_a", "src_default", "peerId", "multiaddr", "validators", "_a", "_b", "message", "self", "decode", "Message", "encode", "options", "src_default", "DEFAULT_MAX_INBOUND_STREAMS", "DEFAULT_MAX_OUTBOUND_STREAMS", "_a", "_b", "_c", "_d", "Network", "multiaddr", "EventTypes", "create", "create", "crypto", "crypto", "crypto", "key", "name", "sanitize", "_a", "_b", "_c", "_d", "options", "MessageTypes", "length", "encode", "message", "message", "options", "name", "encode", "name", "options", "message", "stream", "_a", "_b", "PROTOCOL_VERSION", "PROTOCOL_NAME", "PROTOCOL_PREFIX", "TIMEOUT", "MAX_INBOUND_STREAMS", "MAX_OUTBOUND_STREAMS", "_a", "PROTOCOL_PREFIX", "PROTOCOL_NAME", "PROTOCOL_VERSION", "TIMEOUT", "MAX_INBOUND_STREAMS", "MAX_OUTBOUND_STREAMS", "start", "options", "BrowserInfo", "name", "version", "NodeInfo", "version", "SearchBotDeviceInfo", "name", "version", "BotInfo", "ReactNativeInfo", "_a", "browser", "name", "version", "_a", "isNode", "options", "options", "_a", "Message", "Flag", "__FlagValues", "length", "MAX_MESSAGE_SIZE", "Message", "err", "self", "decode", "message", "encode", "options", "createStream", "PROTOCOL", "createStream", "_a", "_b", "_c", "options", "message", "Message", "Type", "__TypeValues", "length", "options", "_a", "_b", "_c", "_d", "message", "Message", "log", "logger", "Message", "Circuit", "log", "Message", "_a", "_b", "_c", "options", "options", "_a", "certhash", "code", "MAX_MESSAGE_SIZE", "_a", "_b", "_c", "options", "handshakeDataChannel", "createStream", "import_timestamp_nano", "NanoDate", "version", "name", "options", "name", "version", "createLibp2p", "options", "defaults", "createLibp2p"]
}
